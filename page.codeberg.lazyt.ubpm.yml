app-id: page.codeberg.lazyt.ubpm
runtime: org.kde.Platform
runtime-version: '6.5'
sdk: org.kde.Sdk
command: ubpm
rename-desktop-file: ubpm.desktop
rename-icon: ubpm
modules:
  - name: ubpm
    buildsystem: simple
    build-options:
      no-debuginfo: true
    build-commands:
      - cd sources && qmake && make
      - install -d $FLATPAK_DEST/bin $FLATPAK_DEST/share/icons/hicolor/256x256/apps $FLATPAK_DEST/share/applications $FLATPAK_DEST/share/metainfo $FLATPAK_DEST/bin/Guides $FLATPAK_DEST/bin/Languages $FLATPAK_DEST/bin/Plugins $FLATPAK_DEST/bin/Themes
      - cp sources/mainapp/ubpm $FLATPAK_DEST/bin
      - cp sources/mainapp/res/ico/ubpm.png $FLATPAK_DEST/share/icons/hicolor/256x256/apps
      - cp release/appbundle/lin/ubpm.desktop $FLATPAK_DEST/share/applications
      - cp release/appbundle/lin/$FLATPAK_ID.appdata.xml $FLATPAK_DEST/share/metainfo
      - cp sources/mainapp/hlp/*.q* $FLATPAK_DEST/bin/Guides
      - cp sources/mainapp/lng/mainapp_*.qm sources/plugins/shared/plugin/lng/plugins_*.qm $FLATPAK_DEST/bin/Languages
      - cp sources/plugins/*.so $FLATPAK_DEST/bin/Plugins
      - cp sources/mainapp/qss/*.qss $FLATPAK_DEST/bin/Themes
      - touch $FLATPAK_DEST/bin/.ubpm.flatpak
    sources:
      - type: git
        url: https://codeberg.org/lazyt/ubpm.git
        tag: '1.9.0'
finish-args:
  - --socket=x11
# wayland fails to open default browser?
#  - --socket=wayland
#  - --socket=fallback-x11
  - --socket=cups
  - --device=dri
  - --share=ipc
  - --share=network
  - --allow=bluetooth
  - --system-talk-name=org.bluez
  - --filesystem=home
