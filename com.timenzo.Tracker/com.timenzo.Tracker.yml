app-id: com.timenzo.Tracker
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: timenzo

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --socket=pulseaudio
  - --filesystem=home
  - --device=all
  - --device=dri
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.portal.Desktop
  - --system-talk-name=org.freedesktop.login1

modules:
  - name: timenzo
    buildsystem: simple
    build-commands:
      - tar -xf timenzo-linux-1.0.0.tar.gz
      - cp -r bundle/* /app/
      - chmod +x /app/timenzo
      
      - mkdir -p /app/bin
      - |
        cat > /app/bin/timenzo << 'WRAPPER'
        #!/bin/sh
        cd /app
        export LD_LIBRARY_PATH=/app/lib:$LD_LIBRARY_PATH
        exec /app/timenzo "$@"
        WRAPPER
      - chmod +x /app/bin/timenzo
      
      - install -Dm644 bundle/share/applications/timenzo.desktop /app/share/applications/com.timenzo.Tracker.desktop
      - desktop-file-edit --set-key=Icon --set-value=com.timenzo.Tracker /app/share/applications/com.timenzo.Tracker.desktop
      - desktop-file-edit --set-key=Exec --set-value=timenzo /app/share/applications/com.timenzo.Tracker.desktop
      
      - install -Dm644 timenzo_icon_512.png /app/share/icons/hicolor/512x512/apps/com.timenzo.Tracker.png
      - for size in 256 128 64 48 32 24 16; do
          mkdir -p /app/share/icons/hicolor/${size}x${size}/apps;
          cp /app/share/icons/hicolor/512x512/apps/com.timenzo.Tracker.png /app/share/icons/hicolor/${size}x${size}/apps/;
        done
      
      - install -Dm644 com.timenzo.Tracker.metainfo.xml /app/share/metainfo/com.timenzo.Tracker.metainfo.xml
      
    sources:
      - type: file
        path: timenzo-linux-1.0.0.tar.gz
        sha256: da3db2e6a4c2b36fff3ce10a0f868ecadf917d810630efa8670e8096a77e6b7c
        
      - type: file
        path: timenzo_icon_512.png
        sha256: 77a348c63f6d7d9419e2fe6a7bb094b86b680b29ac7a452cf9416ee16e3b4f5c
        
      - type: file
        path: com.timenzo.Tracker.metainfo.xml