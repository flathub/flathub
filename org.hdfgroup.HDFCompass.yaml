id: org.hdfgroup.HDFCompass
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: HDFCompass
finish-args:
  - --socket=x11
  - --device=all
  - --share=ipc
  - --filesystem=xdg-desktop
  - --filesystem=xdg-documents
  - --filesystem=xdg-download

modules:
  - shared-modules/python2.7/python-2.7.json

  - name: wxWidgets
    buildsystem: autotools
    config-opts:
      - --disable-monolithic
      - --disable-rpath
      - --enable-geometry
      - --enable-graphics_ctx
      - --enable-optimise
      - --enable-sound
      - --enable-display
      - --enable-unicode
      - --with-gtk=3
      - --with-python=/app/bin/python
      - --with-gnomeprint
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/wxwindows/3.0.2/wxWidgets-3.0.2.tar.bz2
        sha256: 346879dc554f3ab8d6da2704f651ecb504a22e9d31c17ef5449b129ed711585d
      - type: shell
        commands:
          - cp /usr/share/gnu-config/config.sub .
          - cp /usr/share/gnu-config/config.guess .

  - name: wxPython
    buildsystem: simple
    build-commands:
      - >-
        cd wxPython; /app/bin/python setup.py
        WXPORT=gtk3
        UNICODE=1
        BUILD_GLCANVAS=0
        EP_ADD_OPTS=1
        EP_FULL_VER=0
        NO_SCRIPTS=1
        WX_CONFIG="/app/bin/wx-config --prefix=/app --no_rpath"
        SYS_WX_CONFIG="wx-config --version=3.0.2.0 --toolkit=gtk3 --static=no"
        build_ext --rpath=/app/lib
        build
      - >-
        cd wxPython; /app/bin/python setup.py
        WXPORT=gtk3
        UNICODE=1
        BUILD_GLCANVAS=0
        EP_ADD_OPTS=1
        EP_FULL_VER=0
        NO_SCRIPTS=1
        WX_CONFIG="/app/bin/wx-config --prefix=/app --no_rpath"
        SYS_WX_CONFIG="wx-config --version=3.0.2.0 --toolkit=gtk3 --static=no --unicode"
        build_ext --rpath=/app/lib
        install
        --root=/
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/wxpython/wxPython/3.0.2.0/wxPython-src-3.0.2.0.tar.bz2
        sha256: d54129e5fbea4fb8091c87b2980760b72c22a386cb3b9dd2eebc928ef5e8df61

  - name: hdf5
    buildsystem: autotools
    config-opts:
      - --enable-cxx
    build-options:
      cflags: -Wno-int-conversion -Wno-incompatible-pointer-types -Wno-implicit-function-declaration
    sources:
      - type: archive
        url: https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.8/hdf5-1.8.16/src/hdf5-1.8.16.tar.bz2
        sha256: 13aaae5ba10b70749ee1718816a4b4bfead897c2fcb72c24176e759aec4598c6
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} bin

  - python-modules.json

  - name: hdfcompass
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/HDFGroup/hdf-compass.git
        tag: v0.6.0
      - type: file
        path: org.hdfgroup.HDFCompass.appdata.xml
      - type: file
        path: org.hdfgroup.HDFCompass.png
    build-commands:
      - python2 setup.py install --prefix=${FLATPAK_DEST} --root=/
    post-install:
      - install -Dm0644 HDFCompass.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - desktop-file-edit ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
        --set-key "Icon" --set-value "${FLATPAK_ID}"
      - install -Dm0644 org.hdfgroup.HDFCompass.appdata.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.appdata.xml
      - install -Dm0644 org.hdfgroup.HDFCompass.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
