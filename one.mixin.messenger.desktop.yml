id: one.mixin.messenger.desktop
runtime: org.gnome.Platform
runtime-version: '42'
sdk: org.gnome.Sdk
command: mixin_desktop
rename-desktop-file: mixin_desktop.desktop
rename-icon: mixin_desktop
rename-appdata-file: mixin_desktop.metainfo.xml
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --socket=pulseaudio
  - --share=network
  - --filesystem=home
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher
  - --device=all
  - --env=PATH=/app/bin:/usr/bin

modules:
  - name: mixin_desktop
    buildsystem: simple
    only-arches:
    - x86_64
    build-commands:
    - mkdir -p FlutterApp
    - tar -xf mixin-desktop-linux-portable.tar.gz -C FlutterApp
    - cp -r FlutterApp /app/
    - chmod +x /app/FlutterApp/mixin_desktop
    - mkdir -p /app/bin
    - ln -s /app/FlutterApp/mixin_desktop /app/bin/mixin_desktop
    - mkdir -p /app/share/metainfo
    - cp -r mixin_desktop.metainfo.xml /app/share/metainfo/
    - mkdir -p /app/share/icons/hicolor/256x256/apps
    - cp -r mixin_desktop.png /app/share/icons/hicolor/256x256/apps/mixin_desktop.png
    - mkdir -p /app/share/applications
    - cp -r mixin_desktop.desktop /app/share/applications/mixin_desktop.desktop
    - mkdir -p /app/share/appdata
    - cp -r mixin_desktop.metainfo.xml /app/share/appdata/
    sources:
      - type: file
        path: mixin_desktop.desktop
      - type: file
        path: mixin_desktop.png
      - type: file
        path: mixin-desktop-linux-portable.tar.gz
      - type: file
        path: mixin_desktop.metainfo.xml