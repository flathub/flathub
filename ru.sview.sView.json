{
    "app-id" : "ru.sview.sView",
    "runtime" : "org.gnome.Platform",
    "runtime-version" : "41",
    "sdk" : "org.gnome.Sdk",
    "add-extensions": {
        "org.freedesktop.Platform.ffmpeg-full": {
            "directory": "lib/ffmpeg",
            "version": "21.08",
            "add-ld-path": "."
        }
    },
    "cleanup-commands": [
        "mkdir -p ${FLATPAK_DEST}/lib/ffmpeg"
    ],
    "command" : "sView",
    "rename-desktop-file" : "sViewMP.desktop",
    "rename-icon" : "sview",
    "finish-args" : [
        /* X11 + XShm access */
        "--share=ipc", "--socket=x11",
        /* GPU acceleration */
        "--device=dri",
        /* Play sounds */
        "--socket=pulseaudio",
        /* Get access to the files */
        "--filesystem=host:ro",
        "--talk-name=org.gtk.vfs.*",
        "--filesystem=xdg-run/gvfs:ro"
    ],
    "modules" : [
        "shared-modules/gtk2/gtk2.json",
        {
            "name" : "libconfig",
            "sources" : [
                {
                    "type": "archive",
                    "url" : "https://hyperrealm.github.io/libconfig/dist/libconfig-1.7.2.tar.gz",
                    "sha256": "7c3c7a9c73ff3302084386e96f903eb62ce06953bb1666235fac74363a16fad9"
                }
            ]
        },
	{
	    "name": "wxWidgets",
	    "rm-configure": true,
            "cleanup": [
                "/bin",
                "/lib/wx",
                "/share/bakefile"
            ],
	    "sources": [
		{
		    "type": "archive",
		    "url": "https://github.com/wxWidgets/wxWidgets/releases/download/v3.0.4/wxWidgets-3.0.4.tar.bz2",
		    "sha256": "96157f988d261b7368e5340afa1a0cad943768f35929c22841f62c25b17bf7f0"
		},
		{
		    "type": "script",
		    "dest-filename": "autogen.sh",
		    "commands": [
			"cp -p /usr/share/automake-*/config.{sub,guess} .",
			"autoconf -f -B build/autoconf_prepend-include"
		    ]
		}
	    ]
	},
        {
            "name": "codeblocks",
            "cleanup": [
                "/share/pixmaps",
                "/share/applications",
                "/share/mime/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://netcologne.dl.sourceforge.net/project/codeblocks/Sources/20.03/codeblocks-20.03.tar.xz",
                    "sha256": "15eeb3e28aea054e1f38b0c7f4671b4d4d1116fd05f63c07aa95a91db89eaac5"
                },
                {
                    "type": "patch",
                    "path": "codeblocks-rev12303.patch",
                    "strip-components": 2
                }
            ]
        },
        {
            "name" : "nanum-fonts",
            "buildsystem": "simple",
            "build-commands": [
                "mkdir -p /app/share/fonts",
                "install -m0644 Fonts/NanumMyeongjo{,Bold}.ttf /app/share/fonts",
                "install -m0644 Fonts/NanumGothic{,Bold}.ttf /app/share/fonts"
            ],
            "sources": [
                {
                    "type": "archive",
                    "archive-type": "7z",
                    "url": "http://appdown.naver.com/naver/font/NanumFont/setup/NanumFontSetup_TTF_ALL_totalsearch.exe",
                    "sha256": "63cbbe0fef0a509bed8031976b30a0fa30d1a49c41a0942ea436db9ccec6a849"
                }
            ]
        },
        {
            "name": "droid-sans",
            "buildsystem": "simple",
            "build-commands": [
                "install -m0644 DroidSansFallbackFull.ttf /app/share/fonts"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://github.com/aosp-mirror/platform_frameworks_base/raw/2d8961d99f3aa559dbd4b78b716ab36c456b43e1/data/fonts/DroidSansFallbackFull.ttf",
                    "sha256" : "2392015530438bafc48edfc4aee6d9de2387f627a6134d8ab3dfcc99d21c8240"
                }
            ]
        },
        {
            "name" : "sview",
            "buildsystem": "simple",
            "build-commands": [
                "make APP_PREFIX=/app DISABLE_UPDATER=1",
                "make install APP_PREFIX=/app"
            ],
            "cleanup": [
                "/share/applications/sViewIV.desktop"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/gkv311/sview.git",
                    "commit": "ee55a31cff365169c848b0ca4ca0a0960e8f4958"
                },
                {
                    "type": "patch",
                    "filename": "sview-desktop-file-fixes-PR102.patch"
                }
            ]
        }
    ]
}
