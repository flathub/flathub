id: so.libdb.dissent
runtime: org.gnome.Platform
runtime-version: '45'
sdk: org.gnome.Sdk
command: dissent

sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --share=ipc
  - --share=network
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.secrets
  - --talk-name=org.kde.kwalletd5
  - --talk-name=org.kde.StatusNotifierWatcher
  - --filesystem=xdg-run/keyring  # TODO: Check if this is even needed
  - --device=dri

modules:
  - name: dissent
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/golang/bin
      env:
        GOBIN: /app/bin
        GOROOT: /usr/lib/sdk/golang
    build-commands:
      - go install -v -mod=vendor ./...
      - desktop-file-edit --set-icon=$FLATPAK_ID --remove-key=DBusActivatable nix/$FLATPAK_ID.desktop
      - install -Dm644 nix/$FLATPAK_ID.desktop /app/share/applications/$FLATPAK_ID.desktop
      - install -Dm644 internal/icons/hicolor/scalable/apps/logo.svg /app/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg
      - install -Dm644 $FLATPAK_ID.metainfo.xml /app/share/metainfo/$FLATPAK_ID.metainfo.xml
    sources:
      - type: archive
        url: https://github.com/diamondburned/dissent/archive/refs/tags/v0.0.19.tar.gz
        sha256: 38fe04773f85e522be5fd42b2aac2d106fd93baf0b5b53b40f66f876b1ba38e3

      - type: file
        url: https://raw.githubusercontent.com/diamondburned/dissent/b04fc22f2e3bf2937d72b63a9b01b1c1943c2eae/so.libdb.dissent.metainfo.xml
        sha256: 1a3e23fcbccc436cb0b15d004b64396489dd5daace57257457df0340af386eab

      # Workaround for Go modules generated by github.com/dennwc/flatpak-go-mod
      - type: file
        path: modules.txt
        dest: vendor

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/adaptive/@v/v0.0.2-0.20221227093656-fa139be203a8.zip
        strip-components: 3
        dest: vendor/github.com/diamondburned/adaptive
        sha256: c226baea81d59d525fc94dc1c60dac111cac0aa19784044abeb3d188643c6c20

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/arikawa/v3/@v/v3.3.5-0.20240122104110-dbc4ae8978dd.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/arikawa/v3
        sha256: c14dbce46c2b8d6e9a1aa31d6904aef28d87eda8d39a51dc2e0dc46c4210240b

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/chatkit/@v/v0.0.0-20240126072327-e7ec2379e6a7.zip
        strip-components: 3
        dest: vendor/github.com/diamondburned/chatkit
        sha256: c4cb0513295f9591a538f82fcbd2bd82df5511f9ef458ca012861e67b6706c54

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/gotk4-adwaita/pkg/@v/v0.0.0-20231226035729-503b3cb0406c.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/gotk4-adwaita/pkg
        sha256: 526d3f95d27a9e57c6eeeba24cdbac4c1b143b7005904ce2e85b39508c3f2614

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/gotk4/pkg/@v/v0.1.1-0.20240210085006-e5bfe6119990.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/gotk4/pkg
        sha256: c9b104eae61504c000971885080bf00625c79ab73ce11f36c2aa43a0f00d3f86

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/gotkit/@v/v0.0.0-20240129021633-217be91d2538.zip
        strip-components: 3
        dest: vendor/github.com/diamondburned/gotkit
        sha256: acf3f5561fce05d763d70abeadabd5f988899985e89148d37cbe6c5269eb99c4

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/ningen/v3/@v/v3.0.1-0.20240123023159-e96f8ed832e6.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/ningen/v3
        sha256: 06775e5a7c819942e2e456dff6b0e97444967d2faf2855b38f23d59b8ce84ce6

      - type: archive
        url: https://proxy.golang.org/github.com/dustin/go-humanize/@v/v1.0.0.zip
        strip-components: 3
        dest: vendor/github.com/dustin/go-humanize
        sha256: e01916e082a6646ea12d7800d77af43045c27284ff2a0a77e3484509989cc107

      - type: archive
        url: https://proxy.golang.org/github.com/enescakir/emoji/@v/v1.0.0.zip
        strip-components: 3
        dest: vendor/github.com/enescakir/emoji
        sha256: 139773b47fe8132ccb980ae91e1c146dc6f0f430633ece25db4bb385baba4867

      - type: archive
        url: https://proxy.golang.org/github.com/ianlancetaylor/cgosymbolizer/@v/v0.0.0-20220405231054-a1ae3e4bba26.zip
        strip-components: 3
        dest: vendor/github.com/ianlancetaylor/cgosymbolizer
        sha256: a5bda5bbba9e412463eb4800e7c28f575c3743d211f5ffc40a652254b6d6c00f

      - type: archive
        url: https://proxy.golang.org/github.com/pkg/errors/@v/v0.9.1.zip
        strip-components: 3
        dest: vendor/github.com/pkg/errors
        sha256: d4c36b8bcd0616290a3913215e0f53b931bd6e00670596f2960df1b44af2bd07

      - type: archive
        url: https://proxy.golang.org/github.com/sahilm/fuzzy/@v/v0.1.0.zip
        strip-components: 3
        dest: vendor/github.com/sahilm/fuzzy
        sha256: 82c8b592ff10966ec1639dea6b5f925706a4901583dc15060ac00392e6693498

      - type: archive
        url: https://proxy.golang.org/github.com/yuin/goldmark/@v/v1.5.6.zip
        strip-components: 3
        dest: vendor/github.com/yuin/goldmark
        sha256: f13dda977b4ccd847d1ab6b6b79b75782e9a259eb7b547e4f2fa28c59430ac44

      - type: archive
        url: https://proxy.golang.org/github.com/!karpeles!lab/weak/@v/v0.1.1.zip
        strip-components: 3
        dest: vendor/github.com/KarpelesLab/weak
        sha256: 95beab3258f52af7133a707f6e6dc53f52e84dc7d81857b9022267146e3fdc0e

      - type: archive
        url: https://proxy.golang.org/github.com/alecthomas/chroma/@v/v0.10.0.zip
        strip-components: 3
        dest: vendor/github.com/alecthomas/chroma
        sha256: beb07b996ee33bc052fe039c93d1c0726e61bcc4819ca39f7bf63304f2ae8c49

      - type: archive
        url: https://proxy.golang.org/github.com/alessio/shellescape/@v/v1.4.1.zip
        strip-components: 3
        dest: vendor/github.com/alessio/shellescape
        sha256: e28d444e73b803a15cf83e6179149d34c6c132baa60cb8137e5f0aea50a543bf

      - type: archive
        url: https://proxy.golang.org/github.com/danieljoos/wincred/@v/v1.1.0.zip
        strip-components: 3
        dest: vendor/github.com/danieljoos/wincred
        sha256: 24f8b136d30eeea7af02e33c26a83c73c8f70dea30cb1c889e8a674f380587aa

      - type: archive
        url: https://proxy.golang.org/github.com/dlclark/regexp2/@v/v1.4.0.zip
        strip-components: 3
        dest: vendor/github.com/dlclark/regexp2
        sha256: 02e1eab44b19362c7c04ea41dffa66a3f7d3239d4e5bebe44db94116455ee561

      - type: archive
        url: https://proxy.golang.org/github.com/godbus/dbus/v5/@v/v5.0.6.zip
        strip-components: 4
        dest: vendor/github.com/godbus/dbus/v5
        sha256: 0097f9b4608dc4bf5ca63cd3a9f3334e5cff6be2cab6170cdef075ef97075d89

      - type: archive
        url: https://proxy.golang.org/github.com/gorilla/schema/@v/v1.2.0.zip
        strip-components: 3
        dest: vendor/github.com/gorilla/schema
        sha256: f47ffecf97cffd0f557c6ed2b541234fa10a1a3d51ae769216987ff7e07c23a9

      - type: archive
        url: https://proxy.golang.org/github.com/gorilla/websocket/@v/v1.4.2.zip
        strip-components: 3
        dest: vendor/github.com/gorilla/websocket
        sha256: d0d1728deaa06dac190bf4964c9c6395923403eae337cb3305d6dda18ef07337

      - type: archive
        url: https://proxy.golang.org/github.com/leonelquinteros/gotext/@v/v1.5.3-0.20230829162019-37f474cfb069.zip
        strip-components: 3
        dest: vendor/github.com/leonelquinteros/gotext
        sha256: 1f2d5e10bfd06693aaeb7de79978469fe3b1bf5e03502072969cd2db3b43ad50

      - type: archive
        url: https://proxy.golang.org/github.com/twmb/murmur3/@v/v1.1.3.zip
        strip-components: 3
        dest: vendor/github.com/twmb/murmur3
        sha256: 5a36acf51b1d82db1f8a0bbd5b7c4ed5e97416d2b2a57ef14ccaeb52e5d35b96

      - type: archive
        url: https://proxy.golang.org/github.com/yalue/merged_fs/@v/v1.2.3.zip
        strip-components: 3
        dest: vendor/github.com/yalue/merged_fs
        sha256: a70bd1e69dd94dc56c3ae5fb5418f03bf81483c5381768008d09b5c952ecc568

      - type: archive
        url: https://proxy.golang.org/github.com/zalando/go-keyring/@v/v0.2.1.zip
        strip-components: 3
        dest: vendor/github.com/zalando/go-keyring
        sha256: 53f2a7ef46f9fcd73b6880f532d9ffa41b55a9244d8e8b1ce73cdbbdec2b9df2

      - type: archive
        url: https://proxy.golang.org/go4.org/@v/v0.0.0-20200411211856-f5505b9728dd.zip
        strip-components: 1
        dest: vendor/go4.org
        sha256: 709687824a6f7d7d130c50dab26cd12a74ba0220833916bb0acdf39b0375cd13

      - type: archive
        url: https://proxy.golang.org/go4.org/unsafe/assume-no-moving-gc/@v/v0.0.0-20231121144256-b99613f794b6.zip
        strip-components: 3
        dest: vendor/go4.org/unsafe/assume-no-moving-gc
        sha256: e9f5fa7ec7ae45153c6cb5b0c21e813860f9a4370b35ed1ab27398ba365dbb43

      - type: archive
        url: https://proxy.golang.org/golang.org/x/crypto/@v/v0.17.0.zip
        strip-components: 3
        dest: vendor/golang.org/x/crypto
        sha256: 97ea91df712ac1ca39c122480489be532b437bf4aeb5d781465cb1cf39824083

      - type: archive
        url: https://proxy.golang.org/golang.org/x/image/@v/v0.0.0-20220902085622-e7cb96979f69.zip
        strip-components: 3
        dest: vendor/golang.org/x/image
        sha256: 0169cad235a87dc82f3b24303bcc7f1c25b9d4993d9a503ce7310815dba86f0f

      - type: archive
        url: https://proxy.golang.org/golang.org/x/sync/@v/v0.1.0.zip
        strip-components: 3
        dest: vendor/golang.org/x/sync
        sha256: f510bec6009e19882d19953e7273137d34df86c65949345d72f123a255c2ecd2

      - type: archive
        url: https://proxy.golang.org/golang.org/x/text/@v/v0.14.0.zip
        strip-components: 3
        dest: vendor/golang.org/x/text
        sha256: b9814897e0e09cd576a7a013f066c7db537a3d538d2e0f60f0caee9bc1b3f4af

      - type: archive
        url: https://proxy.golang.org/golang.org/x/time/@v/v0.0.0-20210723032227-1f47c861a9ac.zip
        strip-components: 3
        dest: vendor/golang.org/x/time
        sha256: e5d8ade42804ec7d96a632c031dde7db087e8bc4cd5dfd6f38df03ce4f16d9b6
