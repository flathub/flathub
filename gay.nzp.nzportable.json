{
    "app-id": "gay.nzp.nzportable",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "24.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "nzportable",
    "finish-args": [
        "--device=dri",
        "--share=ipc",
        "--socket=pulseaudio",
        "--socket=x11",
        "--env=SDL_VIDEODRIVER=x11",
        "--env=SDL_AUDIODRIVER=pulseaudio",
        "--share=network",
        "--device=all"
    ],
    "modules": [
        {
            "name": "nzportable-launcher",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "script",
                    "dest-filename": "nzportable-launcher.sh",
                    "commands": [
                        "#!/bin/bash",
                        "",
                        "DATA_DIR=\"$HOME/.var/app/gay.nzp.nzportable/data\"",
                        "GAME_DIR=\"$DATA_DIR/nzportable\"",
                        "SOURCE_DIR=\"/app/share/nzportable\"",
                        "",
                        "mkdir -p \"$DATA_DIR\"",
                        "",
                        "if [ ! -d \"$GAME_DIR\" ] || [ ! -f \"$GAME_DIR/nzportable.bin\" ]; then",
                        "    echo \"Setting up NZPortable data directory...\"",
                        "    mkdir -p \"$GAME_DIR\"",
                        "    cp -r \"$SOURCE_DIR\"/* \"$GAME_DIR/\"",
                        "    chmod +x \"$GAME_DIR/nzportable.bin\"",
                        "    echo \"Setup complete.\"",
                        "fi",
                        "",
                        "if [ \"$SOURCE_DIR/nzp/version.txt\" -nt \"$GAME_DIR/nzp/version.txt\" ]; then",
                        "    echo \"Updating game data...\"",
                        "    if [ -f \"$GAME_DIR/nzp/user_settings.cfg\" ]; then",
                        "        cp \"$GAME_DIR/nzp/user_settings.cfg\" /tmp/nzp_user_settings_backup.cfg",
                        "    fi",
                        "    cp -r \"$SOURCE_DIR/nzp\"/* \"$GAME_DIR/nzp/\"",
                        "    if [ -f /tmp/nzp_user_settings_backup.cfg ]; then",
                        "        cp /tmp/nzp_user_settings_backup.cfg \"$GAME_DIR/nzp/user_settings.cfg\"",
                        "        rm /tmp/nzp_user_settings_backup.cfg",
                        "    fi",
                        "    echo \"Update complete.\"",
                        "fi",
                        "",
                        "cd \"$GAME_DIR\"",
                        "exec ./nzportable.bin \"$@\""
                    ]
                }
            ],
            "build-commands": [
                "install -Dm755 nzportable-launcher.sh /app/bin/nzportable"
            ]
        },
        {
            "name": "nzportable-linux64",
            "only-arches": [ "x86_64" ],
            "buildsystem": "simple",
            "build-commands": [
                "install -Dm755 nzportable64-sdl /app/share/nzportable/nzportable.bin",
                "install -Dm644 default.fmf -t /app/share/nzportable",
                "mkdir -p /app/share/nzportable/nzp",
                "for f in *; do if [ \"$f\" != \"nzportable64-sdl\" ] && [ \"$f\" != \"default.fmf\" ]; then cp -r \"$f\" /app/share/nzportable/nzp/; fi; done",
                "echo \"nightly\" > /app/share/nzportable/nzp/version.txt"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/nzp-team/nzportable/releases/download/nightly/nzportable-linux64.zip",
                    "sha256": "fbc88bbeabcb31f790f784cdc9c9932fa8b912a56576e4e88f17b33905b166cc"
                }
            ]
        },
        {
            "name": "nzportable-arm64",
            "only-arches": [ "aarch64" ],
            "buildsystem": "simple",
            "build-commands": [
                "install -Dm755 nzportable64-sdl /app/share/nzportable/nzportable.bin",
                "install -Dm644 default.fmf -t /app/share/nzportable",
                "mkdir -p /app/share/nzportable/nzp",
                "for f in *; do if [ \"$f\" != \"nzportable64-sdl\" ] && [ \"$f\" != \"default.fmf\" ]; then cp -r \"$f\" /app/share/nzportable/nzp/; fi; done",
                "echo \"nightly\" > /app/share/nzportable/nzp/version.txt"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/nzp-team/nzportable/releases/download/nightly/nzportable-linuxarm64.zip",
                    "sha256": "beadad423ba4243dff89ee8716d058e6bc94135814aa37a89dc6e0233d518e53"
                }
            ]
        }
    ]
}