app-id: so.onekey.wallet.desktop
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '22.08'
command: onekey-wallet
separate-locales: false
rename-icon: onekey-wallet

finish-args:
  - --share=network
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=all
  - --filesystem=xdg-download:rw
  - --filesystem=xdg-documents:rw
  - --filesystem=xdg-desktop:rw
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.portal.Desktop
  - --talk-name=org.freedesktop.portal.FileChooser
  - --env=ELECTRON_DISABLE_SECURITY_WARNINGS=1
  - --env=SENTRY_DISABLE=1

modules:
  - name: onekey-desktop
    buildsystem: simple
    sources:
      - type: extra-data
        only-arches: [x86_64]
        url: https://github.com/OneKeyHQ/app-monorepo/releases/download/v5.18.0/OneKey-Wallet-5.18.0-linux-x86_64.AppImage
        sha256: 583da5ef2d750401b88a4d204f3efc00ffd4f927d15036ee96fd7e82d346a214
        size: 189399614
        filename: OneKey-Wallet.AppImage
      - type: extra-data
        only-arches: [aarch64]
        url: https://github.com/OneKeyHQ/app-monorepo/releases/download/v5.18.0/OneKey-Wallet-5.18.0-linux-arm64.AppImage
        sha256: 2913650664e0cce5ea25b534573a30b8e369c305c3bcb799bece6ca7e1de7821
        size: 189596808
        filename: OneKey-Wallet.AppImage
      - type: script
        dest-filename: onekey-wallet
        commands: |
          set -e
          arch=$(uname -m)
          case "$arch" in
            x86_64) appimage="/app/extra/OneKey-Wallet.AppImage" ;;
            aarch64) appimage="/app/extra/OneKey-Wallet.AppImage" ;;
            *) echo "Unsupported arch: $arch" >&2; exit 1 ;;
          esac
          exec zypak-wrapper "$appimage" --appimage-extract-and-run "$@"
      - type: file
        path: so.onekey.wallet.desktop
      - type: file
        path: so.onekey.wallet.desktop.appdata.xml
      - type: file
        path: icons/so.onekey.wallet.desktop.png
      - type: file
        path: apply_extra.sh
    build-commands:
      - install -Dm755 apply_extra.sh "${FLATPAK_DEST}/bin/apply_extra"
      - install -Dm755 onekey-wallet "${FLATPAK_DEST}/bin/onekey-wallet"
      - install -Dm644 so.onekey.wallet.desktop "${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop"
      - install -Dm644 so.onekey.wallet.desktop.appdata.xml "${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.appdata.xml"
      - install -Dm644 icons/so.onekey.wallet.desktop.png "${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png"
