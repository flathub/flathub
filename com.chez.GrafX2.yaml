app-id: com.chez.GrafX2
runtime: org.freedesktop.Sdk
runtime-version: 1.6
sdk: org.freedesktop.Sdk
command: grafx2
rename-desktop-file: grafx2.desktop
rename-appdata-file: grafx2.appdata.xml
rename-icon: grafx2
finish-args:
- --socket=wayland
- --socket=x11
- --share=ipc
- --device=dri
- --filesystem=home # required since it doesn't use portals
modules:
- shared-modules/glu/glu-9.0.0.json

- shared-modules/SDL/SDL-1.2.15.json

- shared-modules/SDL/SDL_image-1.2.12.json

- shared-modules/SDL/SDL_ttf-2.0.11.json

- shared-modules/lua5.3/lua-5.3.2.json

- name: grafx2
  no-autogen: true
  subdir: src
  sources:
  - type: archive
    url: https://gitlab.com/GrafX2/grafX2/-/archive/v2.5/grafX2-v2.5.tar.gz
    sha256: 5ae1ee5ff34eab3955d140ca02a00808c730cd0848ed39b2f0c5592df0a23684
  - type: file
    url: https://sourceforge.net/projects/recoil/files/recoil/4.2.0/recoil-4.2.0.tar.gz
    sha256: 4e8c8e3048b143654da49cc1187a0b26679c9f97f841edc0ba9e0b2e2e7f18e5
    dest: 3rdparty/archives # taken from https://git.archlinux.org/svntogit/community.git/tree/trunk/PKGBUILD?h=packages/grafx2
  - type: file
    path: grafx2.appdata.xml # taken from https://src.fedoraproject.org/rpms/grafx2/tree/master
  build-commands:
  - sed -i 's|/usr/local|/app|' ./Makefile
  - sed -i 's|/usr/local|/app|' ../3rdparty/recoil-4.2.0/Makefile
  - mkdir -p /app/share/grafx2/scripts/samples_2.4/picture/others-8bit
  - mkdir -p /app/share/grafx2/scripts/samples_2.4/picture/others-8bit/lib/
  - mkdir -p /app/share/grafx2/scripts/samples_2.4/picture/thomson/
  - mkdir -p /app/share/grafx2/scripts/samples_2.4/picture/thomson/lib
  post-install:
  - install -Dm644 /app/share/icons/grafx2.svg /app/share/icons/hicolor/scalable/apps/grafx2.svg
  - install -Dm644 ../grafx2.appdata.xml /app/share/metainfo/grafx2.appdata.xml
