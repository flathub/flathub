app-id: com.yourorg.wcat
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '23.08'
command: wcat
separate-locales: false
finish-args:
  # IPC and display
  - --share=ipc
  - --socket=x11

  # Audio
  - --socket=pulseaudio

  # Network
  - --share=network

  # Device access (GPU only)
  - --device=dri

  # Filesystem access (user can pick files via portal)
  - --filesystem=xdg-documents:ro
  # หรือจะใช้ --filesystem=host:ro เฉพาะเมื่อจำเป็น (แต่ Flathub ไม่แนะนำ)

  # Environment variables for Electron
  - --env=ELECTRON_DISABLE_GPU=1
  - --env=ELECTRON_ENABLE_WAYLAND=0
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node18
modules:
  - name: wcat
    buildsystem: simple
    build-options:
      env:
        npm_config_platform: linux
        npm_config_arch: x64
    sources:
      - type: archive
        url: https://github.com/NSK912/flathub/releases/download/Wcat/wcat.tar.xz
        sha256: c713d62201b42ce368f78b73807b0adef99271a5c50b97a805ed6d96ce7b5c0f
    build-commands:
      - mkdir -p /app/wcat
      - ls -lh
      - cp -a . /app/wcat/
      - ls -lh /app/wcat
      - pwd
      - . /usr/lib/sdk/node18/enable.sh && cd /app/wcat && npm install
      - |
        cat > wcat.sh <<EOF
        #!/bin/bash
        export ELECTRON_DISABLE_GPU=1
        export ELECTRON_ENABLE_WAYLAND=0
        export TMPDIR="\$XDG_CACHE_HOME/tmp"
        cd /app/wcat
        exec zypak-wrapper /app/wcat/node_modules/electron/dist/electron . "\$@" --ozone-platform=x11
        EOF
      - chmod +x wcat.sh
      - install -Dm755 wcat.sh /app/bin/wcat
      # ...ย้าย cp -r . /app/wcat ไปข้างบนแล้ว...
      - install -Dm644 assets/icon/Wcat-512.png /app/share/icons/hicolor/512x512/apps/com.yourorg.wcat.png
      - |
        cat > com.yourorg.wcat.desktop <<EOF
        [Desktop Entry]
        Name=Wcat
        Version=3.1.0
        Comment=Video editing application
        Exec=wcat
        Icon=com.yourorg.wcat
        Type=Application
        Categories=AudioVideo;Video;
        EOF
      - install -Dm644 com.yourorg.wcat.desktop /app/share/applications/com.yourorg.wcat.desktop
      - install -Dm644 com.yourorg.wcat.metainfo.xml /app/share/metainfo/com.yourorg.wcat.metainfo.xml
      - mkdir -p /app/share/app-info/media
      - install -Dm644 Screenshot1.png /app/share/app-info/media/com.yourorg.wcat-screenshot1.png
      - install -Dm644 Screenshot2.png /app/share/app-info/media/com.yourorg.wcat-screenshot2.png
