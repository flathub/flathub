app-id: io.github.alexays.waybar
runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.vala
command: waybar
finish-args:
  - --socket=wayland
  - --device=dri
  - --socket=pulseaudio
modules:
  - name: libsigc++
    buildsystem: meson
    config-opts:
      - --buildtype=release
      - -Dbuild-examples=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libsigc++/2.10/libsigc++-2.10.8.tar.xz
        sha256: 235a40bec7346c7b82b6a8caae0456353dc06e71f14bc414bcc858af1838719a

  - name: glibmm
    buildsystem: meson
    config-opts:
      - --buildtype=release
      - -Dbuild-examples=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/glibmm/2.66/glibmm-2.66.7.tar.xz
        sha256: fe02c1e5f5825940d82b56b6ec31a12c06c05c1583cfe62f934d0763e1e542b3

  - name: cairomm
    buildsystem: meson
    config-opts:
      - --buildtype=release
      - -Dbuild-examples=false
    sources:
      - type: archive
        url: https://www.cairographics.org/releases/cairomm-1.14.5.tar.xz
        sha256: 70136203540c884e89ce1c9edfb6369b9953937f6cd596d97c78c9758a5d48db

  - name: pangomm
    buildsystem: meson
    config-opts:
      - --buildtype=release
    sources:
      - type: archive
        url: https://download.gnome.org/sources/pangomm/2.46/pangomm-2.46.4.tar.xz
        sha256: b92016661526424de4b9377f1512f59781f41fb16c9c0267d6133ba1cd68db22

  - name: atkmm
    buildsystem: meson
    config-opts:
      - --buildtype=release
    sources:
      - type: archive
        url: https://download.gnome.org/sources/atkmm/2.28/atkmm-2.28.4.tar.xz
        sha256: 0a142a8128f83c001efb8014ee463e9a766054ef84686af953135e04d28fdab3

  - name: gtkmm
    buildsystem: meson
    config-opts:
      - --buildtype=release
      - -Dbuild-demos=false
      - -Dbuild-tests=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gtkmm/3.24/gtkmm-3.24.9.tar.xz
        sha256: 30d5bfe404571ce566a8e938c8bac17576420eb508f1e257837da63f14ad44ce

  - name: chrono-date
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_TZ_LIB=ON
      - -DUSE_SYSTEM_TZ_DB=ON
      - -DENABLE_DATE_TESTING=OFF
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: archive
        url: https://github.com/HowardHinnant/date/archive/v3.0.1.tar.gz
        sha256: 7a390f200f0ccd207e8cff6757e04817c1a0aec3e327b006b7eb451c57ee3538

  - name: fmt
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: archive
        url: https://github.com/fmtlib/fmt/archive/8.1.1.tar.gz
        sha256: 3d794d3cf67633b34b2771eb9f073bde87e846e0d395d254df7b211ef1ec7346

  - name: spdlog
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DSPDLOG_BUILD_BENCH=OFF
      - -DSPDLOG_FMT_EXTERNAL=ON
      - -DSPDLOG_BUILD_SHARED=ON
    sources:
      - type: archive
        url: https://github.com/gabime/spdlog/archive/v1.10.0.tar.gz
        sha256: 697f91700237dbae2326b90469be32b876b2b44888302afbc7aceb68bcfe8224

  - name: jsoncpp
    buildsystem: meson
    config-opts:
      - --buildtype=release
      - --default-library=shared
    sources:
      - type: archive
        url: https://github.com/open-source-parsers/jsoncpp/archive/1.9.4/jsoncpp-1.9.4.tar.gz
        sha256: e34a628a8142643b976c7233ef381457efad79468c67cb1ae0b83a33d7493999

  - name: libmpdclient
    buildsystem: meson
    config-opts:
      - --buildtype=release
    sources:
      - type: archive
        url: https://www.musicpd.org/download/libmpdclient/2/libmpdclient-2.19.tar.xz
        sha256: 158aad4c2278ab08e76a3f2b0166c99b39fae00ee17231bd225c5a36e977a189

  - name: libnl
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/thom311/libnl/releases/download/libnl3_7_0/libnl-3.7.0.tar.gz
        sha256: 9fe43ccbeeea72c653bdcf8c93332583135cda46a79507bfd0a483bb57f65939

  - name: playerctl
    buildsystem: meson
    config-opts:
      - --buildtype=release
    sources:
      - type: archive
        url: https://github.com/altdesktop/playerctl/archive/v2.4.1.tar.gz
        sha256: 75957ad5071956f563542c7557af16a57e40b4a7f66bc9b6373d022ec5eef548

  - name: gtk-layer-shell
    buildsystem: meson
    build-options:
      append-path: /usr/lib/sdk/vala/bin
      env:
        VALAC: /usr/lib/sdk/vala/bin/valac
    config-opts:
      - --buildtype=release
    sources:
      - type: archive
        url: https://github.com/wmww/gtk-layer-shell/archive/v0.9.0.tar.gz
        sha256: 3809e5565d9ed02e44bb73787ff218523e8760fef65830afe60ea7322e22da1c

  - name: intltool
    buildsystem: autotools
    sources:
      - type: archive
        url: https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz
        sha256: 67c74d94196b153b774ab9f89b2fa6c6ba79352407037c8c14d5aeb334e959cd

  - name: lua
    buildsystem: simple
    build-commands:
      - make linux CFLAGS=-fPIC
      - make echo INSTALL_TOP=/app
      - make install INSTALL_TOP=/app
      - mkdir -pv /app/lib/pkgconfig
      - |
        eval "$(make pc INSTALL_TOP=/app)"
        cat > /app/lib/pkgconfig/lua.pc <<HERE
        Name: Lua
        Description: Lua programming language
        Version: ${version}
        Libs: -L${libdir} -llua -lm
        Cflags: -I${includedir}
        HERE
    sources:
      - type: archive
        url: https://www.lua.org/ftp/lua-5.4.7.tar.gz
        sha256: 9fbf5e28ef86c69858f6d3d34eccc32e911c1a28b4120ff3e84aaa70cfbf1e30

  - name: wireplumber
    buildsystem: meson
    config-opts:
      - --buildtype=release
      - -Delogind=disabled
      - -Dintrospection=disabled
      - -Dsystem-lua=true
      - -Ddoc=disabled
      - -Ddaemon=false
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/pipewire/wireplumber/-/archive/0.5.8/wireplumber-0.5.8.tar.gz
        sha256: 234667497c6b1dd2457e7f4566567fad6cde31e4cb8990c7d0f149cb45a3894a

  # TODO: Needs more work to get these two working

  # - name: libdbusmenu
  #   buildsystem: autotools
  #   build-options:
  #     # autoreconf: true
  #     config-opts:
  #       - --disable-nls
  #       - --disable-gtk
  #       - --enable-gtk-doc-html=false
  #   sources:
  #     - type: archive
  #       # url: https://launchpad.net/libdbusmenu/16.04/16.04.1+22.10.20220928.1/+download/libdbusmenu_16.04.1+22.10.20220928.1.orig.tar.gz
  #       # url: https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/libdbusmenu/16.04.1+16.04.20160927-0ubuntu1/libdbusmenu_16.04.1+16.04.20160927.orig.tar.gz
  #       url: https://launchpad.net/libdbusmenu/16.04/16.04.0/+download/libdbusmenu-16.04.0.tar.gz
  #       # sha256: 06a3279d431bec21f1b402afb8e29a534a07db5f53295ba2d22bf9e0b73e03e6
  #       sha256: b9cc4a2acd74509435892823607d966d424bd9ad5d0b00938f27240a1bfa878a

  # - name: upower
  #   buildsystem: meson
  #   build-options:
  #     config-opts:
  #       - -Dman=false
  #       # - -Dgtk_doc=false
  #       - -Dintrospection=disabled
  #       # - -Dudev=true
  #       - -Dsystemdsystemunitdir=/app/lib/systemd/system   # install service file in app (not used)
  #   sources:
  #     - type: archive
  #       url: https://gitlab.freedesktop.org/upower/upower/-/archive/v0.99.19/upower-v0.99.19.tar.bz2
  #       sha256: e5bda2f5837ee311f5b7b6ec9549b029c88f4958011c6a8f5550b54408ee06ae

  - name: waybar
    buildsystem: meson
    config-opts:
      - --buildtype=release
      - --wrap-mode=nodownload
      - -Dsystemd=disabled
      - -Dman-pages=disabled
      - -Dexperimental=false
      - -Djack=disabled
      - -Dsndio=disabled
      - -Dwireplumber=enabled
    sources:
      - type: archive
        url: https://github.com/Alexays/Waybar/archive/refs/tags/0.12.0.tar.gz
        sha256: 80454a0778176f575c112bdef9107f272621b578aa629bcc257ad9844a6c7165
