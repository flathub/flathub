app-id: app.comaps.comaps
runtime: org.kde.Platform
runtime-version: '6.9'
sdk: org.kde.Sdk
command: CoMaps
finish-args:
  - --share=network
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --system-talk-name=org.freedesktop.GeoClue2.*

modules:
  - name: optipng
    cleanup:
      - '*'
    sources:
     - type: archive
       url: https://prdownloads.sourceforge.net/optipng/optipng-7.9.1.tar.gz
       sha256: c2579be58c2c66dae9d63154edcb3d427fef64cb00ec0aff079c9d156ec46f29

  - name: python-protobuf
    buildsystem: simple
    cleanup:
      - '*'
    build-commands:
      - pip3 install --no-index --no-build-isolation --prefix="${FLATPAK_DEST}"
        .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/55/5b/e3d951e34f8356e5feecacd12a8e3b258a1da6d9a03ad1770f28925f29bc/protobuf-3.20.3.tar.gz
        sha256: 2e3427429c9cffebf259491be0af70189607f365c2f41c7c3764af6f337105f2

  - name: comaps
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    cleanup:
      - '/lib' # static libraries and build configs
      - '/include'
    sources:
      - type: git
        url: https://codeberg.org/comaps/comaps
        tag: 2025.08.10-linux
        commit: 1e358375c6704357c4b0eaaf9bc3a08fd3feb9fe
      - type: patch
        path: ./disable-world-feed-integration-test.patch
      - type: shell
        commands:
          - SKIP_MAP_DOWNLOAD=1 ./configure.sh
          - install -Dm644 "qt/res/logo.png" "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/${FLATPAK_ID}.png"
