id: com.adobe.Reader

command: acroread

sdk: org.gnome.Sdk
runtime: org.gnome.Platform
runtime-version: '3.28'

rename-desktop-file: AdobeReader.desktop
rename-icon: AdobeReader9

separate-locales: false
tags:
  - proprietary
finish-args:
  #X11, MIT-SHM and OpenGL
  - --socket=x11
  - --share=ipc
  - --device=dri
  
  - --socket=pulseaudio
  
  - --filesystem=xdg-documents:rw
  - --filesystem=xdg-download:rw
  - --filesystem=xdg-desktop:rw
  
  #Required for printing - CUPS socket
  - --share=network
  
  - --persist=.adobe
modules:
  - name: gdk-pixbuf
    buildsystem: meson
    cleanup:
      - /include
      - /lib/debug
    config-opts:
      - -Dman=false
      - -Dinstalled_tests=false
    sources:
      - type: archive
        url: https://ftp.gnome.org/pub/GNOME/sources/gdk-pixbuf/2.38/gdk-pixbuf-2.38.0.tar.xz
        sha256: dd50973c7757bcde15de6bcd3a6d462a445efd552604ae6435a0532fbbadae47
        
  #libcups.so.2 provided by GNOME Platform gives SIGSEGV
  - name: cups
    no-make-install: true
    post-install:
      - install cups/libcups.so.2 /app/lib
    cleanup:
      - /include
      - /lib/debug
    sources:
      - type: git
        tag: v2.2.8
        url: https://github.com/apple/cups.git
        
  - name: acroread
    buildsystem: simple
    only-arches:
      - i386
    build-commands:
      - install -D apply_extra /app/bin/apply_extra
      - install -D acroread /app/bin/acroread
      - install -D AdobeReader9.desktop /app/share/applications/AdobeReader.desktop
      - install -D com.adobe.Reader.appdata.xml /app/share/metainfo/com.adobe.Reader.appdata.xml
      - install -D AdobeReader9-8.png /app/share/icons/hicolor/8x8/apps/AdobeReader9.png
      - install -D AdobeReader9-16.png /app/share/icons/hicolor/16x16/apps/AdobeReader9.png
      - install -D AdobeReader9-22.png /app/share/icons/hicolor/22x22/apps/AdobeReader9.png
      - install -D AdobeReader9-24.png /app/share/icons/hicolor/24x24/apps/AdobeReader9.png
      - install -D AdobeReader9-32.png /app/share/icons/hicolor/32x32/apps/AdobeReader9.png
      - install -D AdobeReader9-48.png /app/share/icons/hicolor/48x48/apps/AdobeReader9.png
      - install -D AdobeReader9-64.png /app/share/icons/hicolor/64x64/apps/AdobeReader9.png
      - install -D AdobeReader9-96.png /app/share/icons/hicolor/96x96/apps/AdobeReader9.png
      - install -D AdobeReader9-256.png /app/share/icons/hicolor/256x256/apps/AdobeReader9.png
      - install -D AdobeReader9-512.png /app/share/icons/hicolor/512x512/apps/AdobeReader9.png
    sources:
      - type: script
        dest-filename: apply_extra
        commands:
          - tar -xf acroread.tar.bz2
          - rm -f acroread.tar.bz2
          - ( 
          - '  cd AdobeReader || exit'
          - '  ./INSTALL --install_path=/app/extra'
          - )
          - rm -r AdobeReader
          - sed -i '373i#Set installation directory for Flatpak' /app/extra/Adobe/Reader9/bin/acroread
          - sed -i "374iinstall_dir=\'/app/extra/Adobe/Reader9/Reader/\'\n" /app/extra/Adobe/Reader9/bin/acroread
      - type: script
        dest-filename: acroread
        commands:
          - /app/extra/Adobe/Reader9/bin/acroread "$@"
      - type: extra-data
        filename: acroread.tar.bz2
        url: http://download.adobe.com/pub/adobe/reader/unix/9.x/9.5.5/enu/AdbeRdr9.5.5-1_i486linux_enu.tar.bz2
        sha256: ee0ea9c65b38abd40ec7c92654e767dc138757f02aef5ae92f74e2dc75ac6540
        size: 57127348
        installed-size: 141719183
      - type: file
        path: files/AdobeReader9.desktop
      - type: file
        path: com.adobe.Reader.appdata.xml
      - type: file
        path: files/icons/AdobeReader9-8.png
      - type: file
        path: files/icons/AdobeReader9-16.png
      - type: file
        path: files/icons/AdobeReader9-22.png
      - type: file
        path: files/icons/AdobeReader9-24.png
      - type: file
        path: files/icons/AdobeReader9-32.png
      - type: file
        path: files/icons/AdobeReader9-48.png
      - type: file
        path: files/icons/AdobeReader9-64.png
      - type: file
        path: files/icons/AdobeReader9-96.png
      - type: file
        path: files/icons/AdobeReader9-256.png
      - type: file
        path: files/icons/AdobeReader9-512.png
        
