app-id: io.github.erenseymen.android-tv-remote
runtime: org.gnome.Platform
runtime-version: "49"
sdk: org.gnome.Sdk
command: tv-remote

finish-args:
  - --share=network
  - --socket=wayland
  - --share=ipc
  - --socket=fallback-x11
  - --device=dri

build-options:
  env:
    PIP_DISABLE_PIP_VERSION_CHECK: "1"
    PIP_NO_CACHE_DIR: "1"
    PYTHONNOUSERSITE: "1"

modules:
  # Android Platform Tools (adb) - x86_64 only
  - name: android-tools
    buildsystem: simple
    build-commands:
      - install -Dm755 platform-tools/adb /app/bin/adb
    sources:
      - type: archive
        url: https://dl.google.com/android/repository/platform-tools_r35.0.2-linux.zip
        sha256: acfdcccb123a8718c46c46c059b2f621140194e5ec1ac9d81715be3d6ab6cd0a
        strip-components: 0

  # scrcpy-server (pre-built, Java bytecode - architecture agnostic)
  - name: scrcpy-server
    buildsystem: simple
    build-commands:
      - install -Dm644 scrcpy-server /app/share/scrcpy/scrcpy-server
    sources:
      - type: file
        url: https://github.com/Genymobile/scrcpy/releases/download/v3.1/scrcpy-server-v3.1
        sha256: 958f0944a62f23b1f33a16e9eb14844c1a04b882ca175a738c16d23cb22b86c0
        dest-filename: scrcpy-server

  - name: python3-adb-shell
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps --no-build-isolation adb_shell-0.4.4.tar.gz
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/8f/73/d246034db6f3e374dad9a35ee3f61345a6b239d4febd2a41ab69df9936fe/adb_shell-0.4.4.tar.gz
        sha256: 04c305f30a2ca25d5c54b3cd6ce9bb64c36e5f07967b23b3fb6aaecc851b90b6

  # Python dependencies generated with flatpak-pip-generator
  - python3-dependencies.yaml

  - name: android-tv-remote
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps --no-build-isolation .
    sources:
      - type: git
        url: https://github.com/erenseymen/android-tv-remote.git
        tag: v1.0.4
