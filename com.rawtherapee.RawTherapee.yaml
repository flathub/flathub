app-id: com.rawtherapee.RawTherapee
runtime: org.gnome.Platform
runtime-version: '3.32'
sdk: org.gnome.Sdk
command: rawtherapee
rename-desktop-file: rawtherapee.desktop
rename-icon: rawtherapee
copy-icon: true
finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=x11
  # Wayland access
  - --socket=wayland
  # Audio access
  # Play sound notifications
  - --socket=pulseaudio
  # Filesystem access
  - --filesystem=home
  # Dconf access
  - --filesystem=xdg-run/dconf
  - --filesystem=~/.config/dconf:ro
  - --talk-name=ca.desrt.dconf
  - --env=DCONF_USER_CONFIG_DIR=.config/dconf
  # OpenGL access
  - --device=dri
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/gtk-doc
  - /share/man
  - '*.a'
  - '*.la'
modules:
  - name: mm-common
    rm-configure: true
    config-opts:
      - --enable-maintainer-mode
      - --disable-network
    cleanup: ['*']
    sources:
      - type: archive
        url: https://ftp.gnome.org/pub/GNOME/sources/mm-common/0.9/mm-common-0.9.12.tar.xz
        sha256: ceffdcce1e5b52742884c233ec604bf6fded12eea9da077ce7a62c02c87e7c0b
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} .;

  - name: libsigc++
    rm-configure: true
    config-opts:
      - --disable-static
      - --disable-documentation
      - --enable-maintainer-mode
    sources:
      - type: archive
        url: https://ftp.gnome.org/pub/GNOME/sources/libsigc++/2.10/libsigc++-2.10.2.tar.xz
        sha256: b1ca0253379596f9c19f070c83d362b12dfd39c0a3ea1dd813e8e21c1a097a98
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} "build/";

  - name: cairomm
    rm-configure: true
    config-opts:
      - --disable-static
      - --disable-documentation
      - --enable-maintainer-mode
    sources:
      - type: archive
        url: https://ftp.gnome.org/pub/GNOME/sources/cairomm/1.12/cairomm-1.12.0.tar.xz
        sha256: a54ada8394a86182525c0762e6f50db6b9212a2109280d13ec6a0b29bfd1afe6
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} "build/";

  - name: glibmm
    rm-configure: true
    config-opts:
      - --disable-static
      - --disable-documentation
      - --enable-maintainer-mode
    sources:
      - type: archive
        url: https://ftp.gnome.org/pub/GNOME/sources/glibmm/2.60/glibmm-2.60.0.tar.xz
        sha256: a3a1b1c9805479a16c0018acd84b3bfff23a122aee9e3c5013bb81231aeef2bc
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} "build/";

  - name: pangomm
    rm-configure: true
    config-opts:
      - --disable-static
      - --disable-documentation
      - --enable-maintainer-mode
    sources:
      - type: archive
        url: https://ftp.gnome.org/pub/GNOME/sources/pangomm/2.42/pangomm-2.42.0.tar.xz
        sha256: ca6da067ff93a6445780c0b4b226eb84f484ab104b8391fb744a45cbc7edbf56
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} "build/";

  - name: atkmm
    rm-configure: true
    config-opts:
      - --disable-static
      - --disable-documentation
      - --enable-maintainer-mode
    sources:
      - type: archive
        url: https://ftp.gnome.org/pub/GNOME/sources/atkmm/2.28/atkmm-2.28.0.tar.xz
        sha256: 4c4cfc917fd42d3879ce997b463428d6982affa0fb660cafcc0bc2d9afcedd3a
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} "build/";

  - name: gtkmm
    rm-configure: true
    config-opts:
      - --disable-static
      - --disable-documentation
      - --enable-maintainer-mode
    sources:
      - type: archive
        url: https://ftp.gnome.org/pub/GNOME/sources/gtkmm/3.24/gtkmm-3.24.1.tar.xz
        sha256: ddfe42ed2458a20a34de252854bcf4b52d3f0c671c045f56b42aa27c7542d2fd
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} "build/";

  - name: lensfun
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/lensfun/lensfun-0.3.2.tar.gz
        sha256: ae8bcad46614ca47f5bda65b00af4a257a9564a61725df9c74cb260da544d331
      - type: patch
        path: lensfun-0.3.2-Only-use-proper-C-new-and-delete-syntax-for-object-c.patch
      - type: patch
        path: lensfun-0.3.2-respect-DESTDIR-when-installing-python-stuf.patch
      - type: patch
        path: lensfun-0.3.2-Various-CMake-patches-from-the-mailing-list.patch
      - type: patch
        path: lensfun-0.3.2-Added-std-namespace-to-isnan.patch
      - type: patch
        path: lensfun-0.3.2-Pull-isnan-into-std-namespace-include-cmath-not-math.patch

  - name: exiv2
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DEXIV2_BUILD_DOC:BOOL=OFF
      - -DEXIV2_BUILD_SAMPLES:BOOL=OFF
      - -DEXIV2_BUILD_EXIV2_COMMAND:BOOL=OFF
    sources:
      - type: archive
        url: https://github.com/Exiv2/exiv2/archive/v0.27.2.tar.gz
        sha256: 3dbcaf01fbc5b98d42f091d1ff0d4b6cd9750dc724de3d9c0d113948570b2934

  - name: libiptcdata
    config-opts:
      - --disable-static
      - --disable-gtk-doc
      - --enable-maintainer-mode
    sources:
      - type: archive
        url: https://github.com/ianw/libiptcdata/archive/release_1_0_5.tar.gz
        sha256: 78a5c49b646cb610c84bc4dfc730caad9a06e9b4e295600908782f4abb25316e
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} .;

  - name: fftw3f
    rm-configure: true
    config-opts:
      - --enable-shared
      - --disable-static
      - --disable-doc
      - --enable-threads
      - --enable-float
      - --enable-openmp
      - --enable-maintainer-mode
    cleanup:
      - /bin
    sources:
      - type: archive
        url: http://www.fftw.org/fftw-3.3.8.tar.gz
        sha256: 6113262f6e92c5bd474f2875fa1b01054c4ad5040f6b0da7c03c98821d9ae303
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} .;

  - name: RawTherapee
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://github.com/Beep6581/RawTherapee/archive/5.6.tar.gz
        sha256: bd1d1a8cee698dc8a4129c5f671ba507511ac3cdfe8346c5cf76fc7dc286dcfd
      # https://patch-diff.githubusercontent.com/raw/Beep6581/RawTherapee/pull/5304.patch
      - type: patch
        path: RawTherapee-5.6-appdata.patch
