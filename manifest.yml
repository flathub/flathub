app-id: com.zanzlanz.mine-blocks
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: script.sh

finish-args:
  - --share=network
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio 
  - --device=dri
  - --persist=.wine

modules:
  - name: wine
    buildsystem: simple
    sources:
      - type: file
        url: https://github.com/Kron4ek/Wine-Builds/releases/download/10.18/wine-10.18-amd64-wow64.tar.xz
        sha256: 1281ccade12e94db0c48cd4d755bd6b90b63a2be451af3a25d7a43bf90fe7496
    build-commands:
      - mkdir -p $FLATPAK_DEST/bin
      - tar -xf *.tar.xz -C $FLATPAK_DEST/bin
      - rm -f *.tar.xz
      - mv $FLATPAK_DEST/bin/wine-10.18-amd64-wow64 $FLATPAK_DEST/bin/wine
    
  - name: wine-mono
    buildsystem: simple
    sources:
      - type: file
        url: https://dl.winehq.org/wine/wine-mono/10.3.0/wine-mono-10.3.0-x86.msi
        sha256: cece5c63180094dffdf01d0fbe362a4b606e5280b98cdfd1b8568cdf9b572f98
    build-commands:
      - mkdir -p $FLATPAK_DEST/bin/wine/share/wine/mono
      - mv *.msi $FLATPAK_DEST/bin/wine/share/wine/mono/wine-mono.msi

  - name: wine-gecko
    buildsystem: simple
    sources:
      - type: file
        url: https://dl.winehq.org/wine/wine-gecko/2.47.4/wine-gecko-2.47.4-x86_64.msi
        sha256: e590b7d988a32d6aa4cf1d8aa3aa3d33766fdd4cf4c89c2dcc2095ecb28d066f
      - type: file
        url: https://dl.winehq.org/wine/wine-gecko/2.47.4/wine-gecko-2.47.4-x86.msi
        sha256: 26cecc47706b091908f7f814bddb074c61beb8063318e9efc5a7f789857793d6
    build-commands:
      - mkdir -p $FLATPAK_DEST/bin/wine/share/wine/gecko
      - mv wine-gecko-2.47.4-x86_64.msi $FLATPAK_DEST/bin/wine/share/wine/gecko/wine-gecko-x86_64.msi
      - mv wine-gecko-2.47.4-x86.msi $FLATPAK_DEST/bin/wine/share/wine/gecko/wine-gecko-x86.msi

  - name: game
    buildsystem: simple
    sources:
      - type: file
        url: https://mineblocks.com/1/Mine-Blocks.zip
        sha256: c136364de13f924adaa7762e1ea1fa15e4523be727c697d5c8624e2d60c75a0e
    build-commands: 
      - mkdir -p $FLATPAK_DEST/bin
      - unzip *.zip -d $FLATPAK_DEST/bin/game
      - rm -f *.zip
      
  - name: others
    buildsystem: simple
    sources:
      - type: file
        path: script.sh
      - type: file
        path: icon.svg
      - type: file
        path: app.desktop
    build-commands:
      - mkdir -p $FLATPAK_DEST/bin
      - install -Dm755 script.sh $FLATPAK_DEST/bin/script.sh
      - install -Dm644 icon.svg /app/share/icons/hicolor/scalable/apps/com.zanzlanz.mine-blocks.svg
      - install -Dm644 	app.desktop /app/share/applications/com.zanzlanz.mine-blocks.desktop
