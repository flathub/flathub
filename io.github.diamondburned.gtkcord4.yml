id: io.github.diamondburned.gtkcord4
runtime: org.gnome.Platform
runtime-version: '43'
sdk: org.gnome.Sdk
command: gtkcord4

sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --share=ipc
  - --share=network
  - --own-name=com.github.diamondburned.gtkcord4
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher
  - --filesystem=xdg-run/keyring
  - --device=dri

modules:
  - name: gtkcord4
    build-commands:
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/golang/bin
      env:
        GOBIN: /app/bin
        DESKTOP_ID: com.github.diamondburned.gtkcord4
    build-commands:
      - go install -v -tags libadwaita -mod=vendor ./...
      - desktop-file-edit --set-icon=$FLATPAK_ID --remove-key=DBusActivatable .nix/$DESKTOP_ID.desktop
      - install -Dm644 .nix/$DESKTOP_ID.desktop /app/share/applications/$FLATPAK_ID.desktop
      - install -Dm644 internal/icons/svg/logo.svg /app/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg
      - install -Dm644 $FLATPAK_ID.metainfo.xml /app/share/metainfo/$FLATPAK_ID.metainfo.xml
    sources:
      - type: git
        url: https://github.com/diamondburned/gtkcord4
        tag: v0.0.6

      - type: file
        path: io.github.diamondburned.gtkcord4.metainfo.xml
        sha256: eb7bdba19a7831ae80ccd890925e3158bd5b8bf347c0b04f24a48d9e6aa73032

      # Workaround for Go modules generated by github.com/dennwc/flatpak-go-mod
      - type: file
        path: modules.txt
        dest: vendor

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/adaptive/@v/v0.0.2-0.20220328111603-4f867d7948b2.zip
        strip-components: 3
        dest: vendor/github.com/diamondburned/adaptive
        sha256: 1bc7f5dc0f655c4a5a548be4ada425ca4170e444a76dcb31be2d101d563c52fd

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/arikawa/v3/@v/v3.1.1-0.20221103093025-87c479a2dcd4.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/arikawa/v3
        sha256: 50785f3071efc4bfce6e54b7de82b675bc1b069376b835fd794bd17005477333

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/chatkit/@v/v0.0.0-20220926193033-273b48e93b96.zip
        strip-components: 3
        dest: vendor/github.com/diamondburned/chatkit
        sha256: 629547270bef65d728c4b4045760e7da61d9be58fca1d94be8ef8ad4dc4bc319

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/gotk4/pkg/@v/v0.0.0-20220925114733-8c5529b9df15.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/gotk4/pkg
        sha256: 0818b5004f02d836f0888b464576cb48864b6945cf2667b329bdd61e4d3ce997

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/gotkit/@v/v0.0.0-20220927204852-c6db6b04288f.zip
        strip-components: 3
        dest: vendor/github.com/diamondburned/gotkit
        sha256: 3e645d4c48646dc091bce69a42d483ab0c6409287796e1f7f90be925505a30ba

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/ningen/v3/@v/v3.0.0-20221109004709-fed56ccbcd19.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/ningen/v3
        sha256: 125b939670a1e6e017cfbcb11d7ba7f61acbe10ac7e839f31a0b4fdc8d089cad

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/gotk4-adwaita/pkg/@v/v0.0.0-20220417101956-dcc3707dc307.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/gotk4-adwaita/pkg
        sha256: bbceecd26e4a77a4b53a658658697aa191b6884ced740b065748ae863fb63de9

      - type: archive
        url: https://proxy.golang.org/github.com/dustin/go-humanize/@v/v1.0.0.zip
        strip-components: 3
        dest: vendor/github.com/dustin/go-humanize
        sha256: e01916e082a6646ea12d7800d77af43045c27284ff2a0a77e3484509989cc107

      - type: archive
        url: https://proxy.golang.org/github.com/enescakir/emoji/@v/v1.0.0.zip
        strip-components: 3
        dest: vendor/github.com/enescakir/emoji
        sha256: 139773b47fe8132ccb980ae91e1c146dc6f0f430633ece25db4bb385baba4867

      - type: archive
        url: https://proxy.golang.org/github.com/ianlancetaylor/cgosymbolizer/@v/v0.0.0-20220405231054-a1ae3e4bba26.zip
        strip-components: 3
        dest: vendor/github.com/ianlancetaylor/cgosymbolizer
        sha256: a5bda5bbba9e412463eb4800e7c28f575c3743d211f5ffc40a652254b6d6c00f

      - type: archive
        url: https://proxy.golang.org/github.com/pkg/errors/@v/v0.9.1.zip
        strip-components: 3
        dest: vendor/github.com/pkg/errors
        sha256: d4c36b8bcd0616290a3913215e0f53b931bd6e00670596f2960df1b44af2bd07

      - type: archive
        url: https://proxy.golang.org/github.com/sahilm/fuzzy/@v/v0.1.0.zip
        strip-components: 3
        dest: vendor/github.com/sahilm/fuzzy
        sha256: 82c8b592ff10966ec1639dea6b5f925706a4901583dc15060ac00392e6693498

      - type: archive
        url: https://proxy.golang.org/github.com/yuin/goldmark/@v/v1.4.11.zip
        strip-components: 3
        dest: vendor/github.com/yuin/goldmark
        sha256: 5eeffa86e84f336c5b3bc03170219baf35437d07ba9a8b57934f227c5f35d7b5

      - type: archive
        url: https://proxy.golang.org/github.com/alecthomas/chroma/@v/v0.10.0.zip
        strip-components: 3
        dest: vendor/github.com/alecthomas/chroma
        sha256: beb07b996ee33bc052fe039c93d1c0726e61bcc4819ca39f7bf63304f2ae8c49

      - type: archive
        url: https://proxy.golang.org/github.com/alessio/shellescape/@v/v1.4.1.zip
        strip-components: 3
        dest: vendor/github.com/alessio/shellescape
        sha256: e28d444e73b803a15cf83e6179149d34c6c132baa60cb8137e5f0aea50a543bf

      - type: archive
        url: https://proxy.golang.org/github.com/danieljoos/wincred/@v/v1.1.0.zip
        strip-components: 3
        dest: vendor/github.com/danieljoos/wincred
        sha256: 24f8b136d30eeea7af02e33c26a83c73c8f70dea30cb1c889e8a674f380587aa

      - type: archive
        url: https://proxy.golang.org/github.com/dlclark/regexp2/@v/v1.4.0.zip
        strip-components: 3
        dest: vendor/github.com/dlclark/regexp2
        sha256: 02e1eab44b19362c7c04ea41dffa66a3f7d3239d4e5bebe44db94116455ee561

      - type: archive
        url: https://proxy.golang.org/github.com/godbus/dbus/v5/@v/v5.0.6.zip
        strip-components: 4
        dest: vendor/github.com/godbus/dbus/v5
        sha256: 0097f9b4608dc4bf5ca63cd3a9f3334e5cff6be2cab6170cdef075ef97075d89

      - type: archive
        url: https://proxy.golang.org/github.com/gorilla/schema/@v/v1.2.0.zip
        strip-components: 3
        dest: vendor/github.com/gorilla/schema
        sha256: f47ffecf97cffd0f557c6ed2b541234fa10a1a3d51ae769216987ff7e07c23a9

      - type: archive
        url: https://proxy.golang.org/github.com/gorilla/websocket/@v/v1.4.2.zip
        strip-components: 3
        dest: vendor/github.com/gorilla/websocket
        sha256: d0d1728deaa06dac190bf4964c9c6395923403eae337cb3305d6dda18ef07337

      - type: archive
        url: https://proxy.golang.org/github.com/kylelemons/godebug/@v/v1.1.0.zip
        strip-components: 3
        dest: vendor/github.com/kylelemons/godebug
        sha256: dbbd0ce8c2f4932bb03704d73026b21af12bd68d5b8f4798dbf10a487a2b6d13

      - type: archive
        url: https://proxy.golang.org/github.com/twmb/murmur3/@v/v1.1.3.zip
        strip-components: 3
        dest: vendor/github.com/twmb/murmur3
        sha256: 5a36acf51b1d82db1f8a0bbd5b7c4ed5e97416d2b2a57ef14ccaeb52e5d35b96

      - type: archive
        url: https://proxy.golang.org/github.com/zalando/go-keyring/@v/v0.2.1.zip
        strip-components: 3
        dest: vendor/github.com/zalando/go-keyring
        sha256: 53f2a7ef46f9fcd73b6880f532d9ffa41b55a9244d8e8b1ce73cdbbdec2b9df2

      - type: archive
        url: https://proxy.golang.org/go4.org/@v/v0.0.0-20200411211856-f5505b9728dd.zip
        strip-components: 1
        dest: vendor/go4.org
        sha256: 709687824a6f7d7d130c50dab26cd12a74ba0220833916bb0acdf39b0375cd13

      - type: archive
        url: https://proxy.golang.org/go4.org/unsafe/assume-no-moving-gc/@v/v0.0.0-20220617031537-928513b29760.zip
        strip-components: 3
        dest: vendor/go4.org/unsafe/assume-no-moving-gc
        sha256: 9798c920f1f226220c5479278c868ebeda8e1b94b6947adedae4b56789adcb7c

      - type: archive
        url: https://proxy.golang.org/golang.org/x/crypto/@v/v0.0.0-20220321153916-2c7772ba3064.zip
        strip-components: 3
        dest: vendor/golang.org/x/crypto
        sha256: 2e70cba75331ef56b47154ced1dcce584cc60af43761135864ac3ccf5155960f

      - type: archive
        url: https://proxy.golang.org/golang.org/x/image/@v/v0.0.0-20220902085622-e7cb96979f69.zip
        strip-components: 3
        dest: vendor/golang.org/x/image
        sha256: 0169cad235a87dc82f3b24303bcc7f1c25b9d4993d9a503ce7310815dba86f0f

      - type: archive
        url: https://proxy.golang.org/golang.org/x/sync/@v/v0.0.0-20210220032951-036812b2e83c.zip
        strip-components: 3
        dest: vendor/golang.org/x/sync
        sha256: 92a8663af035a6831dcc9cc9d895a1f4bb51fc21efe97f04fa0676fc14992a46

      - type: archive
        url: https://proxy.golang.org/golang.org/x/text/@v/v0.3.7.zip
        strip-components: 3
        dest: vendor/golang.org/x/text
        sha256: e1a9115e61a38da8bdc893d0ba83b65f89cc1114f152a98eb572c5ea6551e8d4

      - type: archive
        url: https://proxy.golang.org/golang.org/x/time/@v/v0.0.0-20210723032227-1f47c861a9ac.zip
        strip-components: 3
        dest: vendor/golang.org/x/time
        sha256: e5d8ade42804ec7d96a632c031dde7db087e8bc4cd5dfd6f38df03ce4f16d9b6

      - type: archive
        url: https://proxy.golang.org/golang.org/x/tools/@v/v0.0.0-20200212150539-ea181f53ac56.zip
        strip-components: 3
        dest: vendor/golang.org/x/tools
        sha256: 13d9d7e0233532d9519b49fb4fa99819704caaab8a6d9139827db58058493162
