app-id: io.github.sigmasd.recordapps
runtime: org.gnome.Platform
runtime-version: "47"
sdk: org.gnome.Sdk
command: run.sh
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=all # audio + grpahics
  - --filesystem=xdg-music # for saving recordings
  - --share=network # local server
modules:
  - name: recordapps
    buildsystem: simple
    build-commands:
      - DENORT_BIN=$PWD/denort ./deno compile -o record -A --include dist/ dist/webview.ts
      - install -Dm755 record /app/bin/record
      - install -Dm755 distro/run.sh /app/bin/run.sh

      - mkdir -p /app/share/applications/
      - install -D distro/io.github.sigmasd.recordapps.desktop /app/share/applications/
      - install -D distro/io.github.sigmasd.recordapps.metainfo.xml /app/share/applications/
      
      - install -D distro/icons/64x64/io.github.sigmasd.recordapps.png /app/share/icons/hicolor/64x64/apps/
      - install -D distro/icons/128x128/io.github.sigmasd.recordapps.png /app/share/icons/hicolor/128x128/apps/
      - install -D distro/icons/256x256/io.github.sigmasd.recordapps.png /app/share/icons/hicolor/256x256/apps/

    sources:
      - type: archive
        url: https://github.com/sigmaSd/recordapps/archive/refs/tags/1.5.0.tar.gz
        sha256: 6ac864d4dd13160b61a8815e0ceff45235c8a97034b4afeaa7deae495e247ad2
      - type: archive
        url: https://github.com/denoland/deno/releases/download/v2.1.7/deno-x86_64-unknown-linux-gnu.zip
        sha256: 8ea47ace85a2daadb60165d2aa519e11aef023d74441a24c4dc1d106dffdd19b
        only-arches:
          - x86_64
      - type: archive
        url: https://github.com/denoland/deno/releases/download/v2.1.7/denort-x86_64-unknown-linux-gnu.zip
        sha256: f00adc493667d5e414165d102d537023109dbd35d62b254566caa1485e0d2bd0
        only-arches:
          - x86_64
      - type: archive
        url: https://github.com/denoland/deno/releases/download/v2.1.7/deno-aarch64-unknown-linux-gnu.zip
        sha256: fb37f230b55898660807247ea28a37afead40bc3713e2ee022a5c1e9476ac9aa
        only-arches:
          - aarch64
      - type: archive
        url: https://github.com/denoland/deno/releases/download/v2.1.7/denort-aarch64-unknown-linux-gnu.zip
        sha256: 0773c54ab7a76658a6d32067cec41d87f2845f1eaca1a057a35ad2590028e8e9
        only-arches:
          - aarch64
