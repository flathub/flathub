app-id: org.tinymediamanager.tinyMediaManager
runtime: org.freedesktop.Platform
runtime-version: "25.08"
sdk: org.freedesktop.Sdk
command: tinyMediaManager.sh
separate-locales: false
finish-args:
  # allow access to media files (mounted and local) and settings (configurable by user - per default in ~/.local/share/tinyMediaManager)
  - --filesystem=/mnt
  - --filesystem=/media
  - --filesystem=/run/media
  - --filesystem=/srv
  - --filesystem=xdg-data
  - --filesystem=xdg-download
  - --filesystem=xdg-pictures
  - --filesystem=xdg-videos  
  - --share=ipc
  - --share=network
  - --socket=x11
  - --env=LC_ALL=C.UTF-8
  - --env=LANG=C.UTF-8  

modules:
  - name: libzen
    subdir: Project/GNU/Library
    config-opts:
      - --enable-shared
      - --disable-static
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /lib/*.la
    sources:
      - type: archive
        url: https://mediaarea.net/download/source/libzen/0.4.41/libzen_0.4.41.tar.xz
        sha256: 933bad3b7ecd29dc6bdc88a83645c83dfd098c15b0b90d6177a37fa1536704e8
        x-checker-data:
          type: anitya
          project-id: 1810
          url-template: https://mediaarea.net/download/source/libzen/$version/libzen_$version.tar.xz
          
  - name: libmediainfo
    subdir: Project/GNU/Library
    config-opts:
      - --enable-shared
      - --disable-static
      - --with-libcurl
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /lib/*.la
    sources:
      - type: archive
        url: https://mediaarea.net/download/source/libmediainfo/25.10/libmediainfo_25.10.tar.xz
        sha256: ad13d9797b046ce39d0c65a6f81d2aef2429734c21865a6a4c592c7c01f249dd
        x-checker-data:
          type: anitya
          project-id: 16249
          url-template: https://mediaarea.net/download/source/libmediainfo/$version/libmediainfo_$version.tar.xz

  - name: tinyMediaManager
    buildsystem: simple
    build-commands:
      # Create necessary directories
      - mkdir -p /app/tmm
      - cp -r * /app/tmm
      - install -Dm755 tinyMediaManager.sh /app/bin/tinyMediaManager.sh
      
      # Install the embedded .desktop file
      - install -Dm644 org.tinymediamanager.tinyMediaManager.desktop /app/share/applications/org.tinymediamanager.tinyMediaManager.desktop

      # Install the icon
      - install -Dm644 org.tinymediamanager.tinyMediaManager.svg /app/share/icons/hicolor/scalable/apps/org.tinymediamanager.tinyMediaManager.svg

    sources:
      - type: archive
        url: https://archive.tinymediamanager.org/v5.2.4/tinyMediaManager-5.2.4-linux-amd64.tar.xz
        sha256: ba6fc0a80a366b08cbd0d67cbcaea16f35da42e002ba3f1de7b9fb5329f304c9
        only-arches:
          - x86_64
      
      - type: archive
        url: https://archive.tinymediamanager.org/v5.2.4/tinyMediaManager-5.2.4-linux-arm64.tar.xz
        sha256: c79772375e097a79ff464a95dd6d8e9d0036cc22601749bf1f1f0e9a187dd631
        only-arches:
          - aarch64

      - type: file
        path: org.tinymediamanager.tinyMediaManager.svg

      - type: file
        path: tinyMediaManager.sh
          
      - type: file
        path: org.tinymediamanager.tinyMediaManager.desktop
