app-id: net.zdechov.app.C_evo
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.freepascal
command: c-evo
rename-appdata-file: net.zdechov.app.C-evo.appdata.xml
rename-desktop-file: net.zdechov.app.C-evo.desktop
rename-icon: net.zdechov.app.C-evo
finish-args:
  - --socket=x11
  - --socket=pulseaudio
  - --share=ipc
  - --device=dri

modules:
  - shared-modules/gtk2/gtk2.json

  - name: c-evo
    buildsystem: simple
    build-commands:
      - |
        . /usr/lib/sdk/freepascal/enable.sh
        lazbuild Integrated.lpr
    post-install:
      - mkdir -p $FLATPAK_DEST/share/c-evo
      - cp -r AI $FLATPAK_DEST/share/c-evo
      - cp -r "AI Template" $FLATPAK_DEST/share/c-evo
      - cp -r Graphics $FLATPAK_DEST/share/c-evo
      - cp -r Help $FLATPAK_DEST/share/c-evo
      - cp -r Localization $FLATPAK_DEST/share/c-evo
      - cp -r Maps $FLATPAK_DEST/share/c-evo
      - cp -r Saved $FLATPAK_DEST/share/c-evo
      - cp -r Sounds $FLATPAK_DEST/share/c-evo
      - cp -r Tribes $FLATPAK_DEST/share/c-evo
      - cp Fonts.txt $FLATPAK_DEST/share/c-evo
      - cp Language.txt $FLATPAK_DEST/share/c-evo
      - cp Language2.txt $FLATPAK_DEST/share/c-evo
      - cp c-evo $FLATPAK_DEST/share/c-evo
      - install -Dm644 Install/flatpak/net.zdechov.app.C-evo.desktop $FLATPAK_DEST/share/applications/net.zdechov.app.C-evo.desktop
      - install -Dm644 icon.png $FLATPAK_DEST/share/icons/hicolor/128x128/apps/net.zdechov.app.C-evo.png
      - install -Dm644 Install/flatpak/net.zdechov.app.C-evo.appdata.xml $FLATPAK_DEST/share/metainfo/net.zdechov.app.C-evo.appdata.xml
      - mkdir -p $FLATPAK_DEST/bin/
      - install -Dm755 start.sh $FLATPAK_DEST/bin/c-evo
    sources:
      - type: svn
        url: https://svn.zdechov.net/c-evo/tags/1.3.6
        revision: 628
      - type: file
        path: icon.png
      - type: patch
        path: appdata.patch
      - type: script
        commands:
          - cd /app/share/c-evo
          - ./c-evo "$@"
        dest-filename: start.sh
