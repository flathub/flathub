app-id: io.github.zeemzha.vibrantLinux
runtime: org.kde.Platform
runtime-version: '5.15-21.08'
sdk: org.kde.Sdk
command: vibrantLinux
finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=x11
  - --device=dri
modules:
  - name: libXNVCtrl
    buildsystem: simple
    build-commands:
      - make OUTPUTDIR=out PREFIX=/app -C src/libXNVCtrl
      - install -Dm 644 src/libXNVCtrl/*.h -t "/app/include/NVCtrl"
      - install -d "/app/lib"
      - cp -Pr src/libXNVCtrl/out/libXNVCtrl.* -t "/app/lib"
    sources:
      - type: archive
        url: https://github.com/NVIDIA/nvidia-settings/archive/refs/tags/495.46.tar.gz
        sha256: a368070d496ee24303a10ded2fc9395e10c92694db46fdd6e094dddbd37b10c3
      - type: patch
        path: libxnvctrl_so.patch
        strip-components: 0
  - name: libvibrant
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://gitlab.com/Scrumplex/vibrant/-/archive/1.0.3/vibrant-1.0.3.tar.gz
        sha256: ef910212a312d03138b884fda4ed2a63f09150c00a4422aac3833df75e834d96
  - name: vibrantLinux
    buildsystem: qmake
    build-options:
      env:
        PREFIX: /app
    config-opts:
      - QMAKE_LIBDIR=/app/lib
    sources:
      - type: archive
        url: https://github.com/zee-mzha/vibrantLinux/archive/refs/tags/v2.1.6.tar.gz
        sha256: bc1d1f637be7a456a248e0b9405670bd1ea93e72ad1d6f1597d0895773558b96
      - type: patch  # pending PR at https://github.com/zee-mzha/vibrantLinux/pull/35 
        path: 0001-refactor-packaging-adjust-application-data-to-FreeDe.patch
      - type: patch  # pending PR at https://github.com/zee-mzha/vibrantLinux/pull/35
        path: 0002-feat-build-respect-PREFIX-env-var.patch
