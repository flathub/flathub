id: ch.dragondreams.deigde
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: deigde

finish-args:
  - --device=dri
  - --share=network
  - --socket=pulseaudio
  - --socket=x11
  - --share=ipc
  - --filesystem=host
  # required for input devices (gamepad) 
  - --device=all

modules:
  - name: scons
    buildsystem: simple
    cleanup: ['*']
    sources:
      - type: archive
        sha256: 61e2fc42e0e2c750105d61f26cc1dfebcae9f4103d3dc0e9aeb373016b0d208c
        url: https://downloads.sourceforge.net/project/scons/scons/4.10.0/SCons-4.10.0.tar.gz
    build-commands:
      - pip3 install --no-index --no-build-isolation --prefix=${FLATPAK_DEST} .

  - name: patchelf
    buildsystem: autotools
    cleanup: ['*']
    sources:
      - type: archive
        sha256: b94cd3ce2361fbbbf7bb055a9d90d1a33878a594191a7c4a60370b7c320fde08
        url: https://github.com/NixOS/patchelf/releases/download/0.15.5/patchelf-0.15.5.tar.gz

  - name: deigde
    buildsystem: simple
    build-options:
      env:
        ReleaseVersion: '1.29'
    only-arches:
      - x86_64

    build-commands:
      - |
          scons \
            -j $FLATPAK_BUILDER_N_JOBS \
            prefix=$FLATPAK_DEST \
            with_debug=no \
            with_debug_symbols=yes \
            with_verbose=no \
            with_threads=$FLATPAK_BUILDER_N_JOBS \
            with_engine_module_checks=no \
            version="$ReleaseVersion" \
              install_engine_runtime \
              install_igde_runtime \
              delauncher_runtime \
              deigde_data \
              deigde_shared_runtime \
              deigde
    
    cleanup:
      - '/bin/delauncher*'
      - '/share/applications/ch.dragondreams.delauncher.desktop'
      - '/share/icons/hicolor/*/apps/ch.dragondreams.delauncher.png'
      - '/share/icons/hicolor/*/mimetypes/ch.dragondreams.delauncher-*.png'
      - '/share/man/man1/delauncher-*.1'
      - '/share/metainfo/ch.dragondreams.delauncher.metainfo.xml'
      - '/share/mime/packages/ch.dragondreams.delauncher-mime.xml'
      - '/share/mime/packages/dragonscript-dragonscript.xml'
      - '/share/pixmaps/ch.dragondreams.delauncher.png'
      - '/share/katepart5/syntax'

    sources:
      - type: git
        url: https://github.com/LordOfDragons/dragengine.git
        tag: 'v1.29.0.3'

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/eossdk/eossdk-1.17.0.zip
        sha256: bc28ad0eb75c8bd4ecc39c9ff22e0aa4051477e014930c947cf1b2bd196df0af
        dest: extern/eossdk
        dest-filename: eossdk-1.17.0.zip

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/eossdk/eossdk_bin_linux-1.17.0.tar.xz
        sha256: 28d5f34820f47fcfcd8b09783bc5e3309a93903b9735919a4ce077ced4b91d44
        dest: extern/eossdk
        dest-filename: eossdk_bin_linux-1.17.0.tar.xz

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/fox/fox-1.7.67.tar.bz2
        sha256: ae4d0ffbb466cb976b726f8042388ac033cee869876932a3dba30d865f78b017
        dest: extern/fox
        dest-filename: fox-1.7.67.tar.bz2

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/liburing/liburing-liburing-2.6.tar.bz2
        sha256: 6e34c1e32f9b9db6dd7ed151ec6b474692135a2fd1e5060832808e8626df8c68
        dest: extern/liburing
        dest-filename: liburing-liburing-2.6.tar.bz2

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/modio/modio-sdk-2025_10.tar.xz
        sha256: 1d95634477e069f4214868356886c44ad1880e60f9971eaa8da19c26a9c1a1ac
        dest: extern/modio
        dest-filename: modio-sdk-2025_10.tar.xz

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/openxr/OpenXR-SDK-release-1.1.46.tar.xz
        sha256: 79064753995cdbdc8c4c56f39755a18ca1ca477362b3045efee323c865990079
        dest: extern/openxr
        dest-filename: OpenXR-SDK-release-1.1.46.tar.xz

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/steamsdk/steamsdk160.tar.xz
        sha256: 59aa51bce4e67fe955ca800fb81c423cfa729caf8b4207da2bbbe2def073bda2
        dest: extern/steamsdk
        dest-filename: steamsdk160.tar.xz

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/libapng/libpng-1.6.29.tar.bz2
        sha256: de8b8c0d4260d200211b6213d0b88e01984c17ac337bb8f87fd86b1006146905
        dest: extern/libapng
        dest-filename: libpng-1.6.29.tar.bz2

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/jsoncpp/jsoncpp-1.9.6.tar.xz
        sha256: feb3effd86587e2ba8d4574226b54cbffb084172374d9403b1c197ea0c643f3d
        dest: extern/jsoncpp
        dest-filename: jsoncpp-1.9.6.tar.xz

      - type: file
        url: https://github.com/LordOfDragons/denetwork/releases/download/v1.2/denetworkcpp-unix-x64-1.2.tar.bz2
        sha256: a2e748945704b8bd011d8127c0cb41a248888350df38b57b5e408ecce32e62ad
        dest: extern/denetwork
        dest-filename: denetworkcpp-unix-x64-1.2.tar.bz2

      - type: file
        url: https://github.com/LordOfDragons/deremotelauncher/releases/download/v1.1/deremotelauncher-unix-x64-1.1.tar.bz2
        sha256: 8ada70860bb015ee34883cd7d7f710f76070272d7eedee57021bccec1924d705
        dest: extern/deremotelauncher
        dest-filename: deremotelauncher-unix-x64-1.1.tar.bz2

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/libwebm/libwebm-libwebm-1.0.0.32.tar.xz
        sha256: 8232204a0b24886295dee892595141775fc391b6e3b51335b05035c3eeba131f
        dest: extern/libwebm
        dest-filename: libwebm-libwebm-1.0.0.32.tar.xz

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/libevdev/libevdev-1.5.6.tar.bz2
        sha256: ba55edfcbfa15208b932e5abb6b1ad6a58f10777226b848e2e19c2ee7cd76d92
        dest: extern/libevdev
        dest-filename: libevdev-1.5.6.tar.bz2

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/dragonscript/dragonscript-1.5.tar.xz
        sha256: 4369ff880d0e4f42e9556be5600013b4cd370151123cd5cc3aa622de6593ef58
        dest: extern/dragonscript
        dest-filename: dragonscript-1.5.tar.xz

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/soundtouch/soundtouch-2.1.1.tar.bz2
        sha256: f4b70ddf4d6203487702ceaa475baef42f71a5b1ae4a90578f5d46f775c60fe1
        dest: extern/soundtouch
        dest-filename: soundtouch-2.1.1.tar.bz2

      - type: file
        url: https://dragondreams.s3.eu-central-1.amazonaws.com/dragengine/extern/openal/openal-soft-1.24.2.tar.xz
        sha256: e7d36c4b818cf5ac525be1e043c85b60108998417bb972b17dcdb9d5d8c1d7cc
        dest: extern/openal
        dest-filename: openal-soft-1.24.2.tar.xz
