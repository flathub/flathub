{
    "app-id": "org.kde.k3b",
    "runtime": "org.kde.Platform",
    "runtime-version": "5.15-23.08",
    "sdk": "org.kde.Sdk",
    "base": "io.qt.qtwebengine.BaseApp",
    "base-version": "5.15-23.08",
    "command": "k3b",
    "rename-icon": "k3b",
    "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/lib/*.a",
        "/lib/*.la",
        "/share/man"
    ],
    "cleanup-commands": [
        "/app/cleanup-BaseApp.sh"
    ],
    "finish-args": [
        "--device=all",
        "--share=ipc",
        "--share=network",
        "--socket=wayland",
        "--socket=fallback-x11",
        "--socket=pulseaudio",
        "--filesystem=home",
        "--system-talk-name=org.freedesktop.UDisks2"
    ],
    "modules": [
        "shared-modules/libmad/libmad.json",
        {
            "name": "libmusicbrainz",
            "buildsystem": "cmake",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/metabrainz/libmusicbrainz/releases/download/release-5.1.0/libmusicbrainz-5.1.0.tar.gz",
                    "sha256": "6749259e89bbb273f3f5ad7acdffb7c47a2cf8fcaeab4c4695484cef5f4c6b46"
                }
            ],
            "modules": [
                {
                    "name": "libneon",
                    "config-opts": [
                        "--enable-shared",
                        "--with-gssapi",
                        "--with-libxml2"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "http://www.webdav.org/neon/neon-0.30.2.tar.gz",
                            "sha256": "db0bd8cdec329b48f53a6f00199c92d5ba40b0f015b153718d1b15d3d967fbca"
                        }
                    ]
                }
            ]
        },
        {
            "name": "libkcddb",
            "buildsystem": "cmake-ninja",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.kde.org/stable/release-service/24.05.2/src/libkcddb-24.05.2.tar.xz",
                    "sha256": "36310f6401524c3f247fcb62e5a5996ae4363ec05a52905524ccca511d83532c",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 1486,
                        "stable-only": true,
                        "url-template": "https://download.kde.org/stable/release-service/$version/src/libkcddb-$version.tar.xz"
                    }
                }
            ]
        },
        {
            "name": "libdvdread",
            "config-opts": [
                "--enable-shared",
                "--disable-static"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://code.videolan.org/videolan/libdvdread.git",
                    "tag": "6.1.0",
                    "commit": "d413571ce39acd404523b6742ba361215f6ada68"
                },
                {
                    "type":"script",
                    "commands":[
                        "autoreconf -fiv"
                    ],
                    "dest-filename":"autogen.sh"
                }
            ]
        },
        {
            "name": "k3b",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DBUILD_TESTING=OFF",
                "-DK3B_BUILD_API_DOCS=OFF",
                "-DQt5WebKitWidgets_DIR=/app/lib/cmake/Qt5WebKitWidgets/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.kde.org/stable/release-service/24.05.2/src/k3b-24.05.2.tar.xz",
                    "sha256": "926d685782f6b63b81f39bacf8762dcfafc06ebc2b758d42ba49ca3654b32687",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 1486,
                        "stable-only": true,
                        "url-template": "https://download.kde.org/stable/release-service/$version/src/k3b-$version.tar.xz"
                    }
                },
                {
                    "type": "shell",
                    "commands": [
                        "sed -i '/add_subdirectory( helper )/d' src/CMakeLists.txt"
                    ]
                }
            ]
        },
        {
            "name": "cdrdao",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://downloads.sourceforge.net/cdrdao/cdrdao-1.2.4.tar.bz2",
                    "sha256": "358d9cb83370ceaecdc60564cbf14c2ea2636eac60a966e2461c011ba09853b4"
                }
            ],
            "modules": [
                {
                    "name": "ao",
                    "sources": [
                        {
                            "type": "archive",
                            "url": "http://downloads.xiph.org/releases/ao/libao-1.2.0.tar.gz",
                            "sha256": "03ad231ad1f9d64b52474392d63c31197b0bc7bd416e58b1c10a329a5ed89caf"
                        }
                    ]
                }
            ]
        },
        {
            "name": "dvd+rw-tools",
            "buildsystem": "simple",
            "build-commands": [
                "make -j${FLATPAK_BUILDER_N_JOBS} CC=\"gcc\" CXX=\"g++\"",
                "make rpl8 btcflash -j${FLATPAK_BUILDER_N_JOBS} CC=\"gcc\" CXX=\"g++\"",
                "make prefix=${FLATPAK_DEST} manprefix=${FLATPAK_DEST}/share/man install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://fy.chalmers.se/~appro/linux/DVD+RW/tools/dvd+rw-tools-7.1.tar.gz",
                    "sha256": "f8d60f822e914128bcbc5f64fbe3ed131cbff9045dca7e12c5b77b26edde72ca"
                },
                {
                    "type": "patch",
                    "path": "utf8ize.patch",
                    "strip-components": 0
                },
                {
                    "type": "patch",
                    "path": "growisofs-dvd-dl-undersized.patch"
                },
                {
                    "type": "patch",
                    "path": "growisofs-genisoimage.patch",
                    "strip-components": 0
                },
                {
                    "type": "patch",
                    "path": "dvd+rw-tools-gcc43.patch",
                    "strip-components": 0
                },
                {
                    "type": "patch",
                    "path": "dvd+rw-tools-buffer.patch",
                    "strip-components": 0
                },
                {
                    "type": "patch",
                    "path": "fix-build-with-recent-glibc.patch"
                }
            ]
        },
        {
            "name": "libburn",
            "config-opts:": [
                "- --disable-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://files.libburnia-project.org/releases/libburn-1.5.6.tar.gz",
                    "sha256": "7295491b4be5eeac5e7a3fb2067e236e2955ffdc6bbd45f546466edee321644b"
                }
            ]
        },
        {
            "name": "cdrtools",
            "buildsystem": "simple",
            "build-commands": [
                "make GMAKE_NOWARN=true RUNPATH=\"\" CCCC=cc LDCC=\"cc -L${FLATPAK_DEST}/lib\" DYNLD=cc COPTX=\"-fno-strict-aliasing -fno-omit-frame-pointer -fPIE -ggdb -finput-charset=ISO-8859-1\" LDOPTX=\"-pie -Wl,-pie -ggdb\" RUNPATH=\"\"",
                "make GMAKE_NOWARN=true RUNPATH=\"\" INS_BASE=\"${FLATPAK_DEST}\" install -j1"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://downloads.sf.net/cdrtools/cdrtools-3.02a09.tar.bz2",
                    "sha256": "aa28438f458ef3f314b79f2029db27679dae1d5ffe1569b6de57742511915e81"
                },
                {
                    "type": "patch",
                    "path": "gcc48wa.diff"
                },
                {
                    "type": "patch",
                    "path": "fix_chrp_boot.patch"
                },
                {
                    "type": "patch",
                    "path": "large_mac_iso.patch"
                },
                {
                    "type": "patch",
                    "path": "fix_junk_in_partition.patch"
                }
            ]
        }
    ]
}
