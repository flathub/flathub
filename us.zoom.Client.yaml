app-id: us.zoom.Client
branch: stable
runtime: org.freedesktop.Platform
runtime-version: 1.6
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk9
command: /app/bin/zoom
tags:
    - proprietary
finish-args:
  - --socket=x11
  - --share=ipc
  # For playing and recording sound
  - --socket=pulseaudio
  # For the webcam :-/ We need to grant whole-sale access until we have a portal
  - --device=all
  #- --filesystem=~/JDownloader:create
  - --share=network
  - --env=PATH=/usr/bin:/app/bin:/app/jre/bin
  - --env=JAVA_HOME=/app/jre

build-options:
    env:
        JAVA_HOME: /usr/lib/sdk/openjdk9/
modules:
  - name: openjdk
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk9/install.sh

  - name: zoom
    buildsystem: simple
    build-commands:
        # - mkdir -p /app/bin
        - tar -C /app/ -xvf zoom_x86_64.pkg.tar.xz
        #- install -D /app/usr/bin/zoom /app/bin/zoom
        - ln -sf /app//opt/zoom/ZoomLauncher /app/usr/bin/zoom
        - cp -ar /app/usr/* /app/
        - install /app/share/applications/Zoom.desktop  /app/share/applications/com.zoom.Client.desktop
        - install /app/share/applications/Zoom.desktop  /app/usr/share/applications/com.zoom.Client.desktop
        - install com.zoom.Client.desktop  /app/usr/share/applications/com.zoom.Client.desktop
        - install com.zoom.Client.desktop  /app/share/applications/com.zoom.Client.desktop
        - install -d /app/share/icons/hicolor/96x96/apps/ /app/share/pixmaps
        - install -d /app/usr/share/icons/hicolor/96x96/apps/ /app/usr/share/pixmaps
        - install /app/share/pixmaps/Zoom.png   /app/share/icons/Zoom.png
        - install /app/share/pixmaps/Zoom.png   /app/share/pixmaps/com.zoom.Client.png
        - install /app/share/pixmaps/Zoom.png   /app/share/icons/hicolor/96x96/apps/com.zoom.Client.png
        - install /app/share/pixmaps/Zoom.png   /app/usr/share/icons/hicolor/96x96/apps/com.zoom.Client.png
        - install /app/share/pixmaps/Zoom.png   /app/share/icons/hicolor/96x96/apps/Zoom.png
        - install -d /app/share/metainfo/
        - install us.zoom.Client.appdata.xml  /app/share/metainfo/
        
    sources:
      - type: file
        url: https://d11yldzmag5yn.cloudfront.net/prod/2.4.121350.0816/zoom_x86_64.pkg.tar.xz
        sha256: 06d18c0ba8fc0adf86edc473717da533f0b479e12b86b560131cdc3032a2aa17

      - type: file
        path: com.zoom.Client.appdata.xml
        dest-filename: com.zoom.Client.appdata.xml

      - type: file
        path: com.zoom.Client.desktop
        dest-filename: com.zoom.Client.desktop
