app-id: us.zoom.Client
branch: stable
runtime: org.freedesktop.Platform
runtime-version: '18.08'
sdk: org.freedesktop.Sdk
#sdk-extensions:
#  - org.freedesktop.Sdk.Extension.openjdk9
command: zoom
rename-icon: Zoom
tags:
    - proprietary
finish-args:
  - --socket=x11
  - --share=ipc
  # For playing and recording sound
  - --socket=pulseaudio
  # For the webcam :-/ We need to grant whole-sale access until we have a portal
  - --device=all
  #- --filesystem=~/JDownloader:create
  - --share=network
  - --env=PATH=/usr/bin:/app/bin:/app/jre/bin
  - --env=JAVA_HOME=/app/jre

build-options:
    env:
        JAVA_HOME: /usr/lib/sdk/openjdk9/
modules:
  - name: openjdk
    disabled: true
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk9/install.sh

  - name: zoom
    buildsystem: simple

    sources:
      - type: extra-data
        url: https://d11yldzmag5yn.cloudfront.net/prod/2.4.121350.0816/zoom_x86_64.pkg.tar.xz
        filename: zoom_x86_64.pkg.tar.xz
        size: 65360872
        sha256: 06d18c0ba8fc0adf86edc473717da533f0b479e12b86b560131cdc3032a2aa17

      - type: file
        path: us.zoom.Client.appdata.xml
        dest-filename: us.zoom.Client.appdata.xml

      - type: file
        path: us.zoom.Client.desktop
        dest-filename: us.zoom.Client.desktop

      - type: file
        path: Zoom.png
        dest-filename: Zoom.png

      - type: script
        dest-filename: apply_extra
        commands:
            - tar -xvf zoom_x86_64.pkg.tar.xz
            #- install -D /app/usr/bin/zoom /app/bin/zoom
            - find
            - mkdir -p /app/extra/bin/
            - ln -sf /app/extra/opt/zoom/ZoomLauncher /app/extra/bin/zoom
            #- cp -ar /app/usr/* /app/

      - type: script
        dest-filename: zoom
        commands:
            - exec /app/extra/bin/zoom "$@"

    build-commands:
        - install -D zoom /app/bin/zoom
        - install -D apply_extra /app/bin/apply_extra
        - install -Dm 644 us.zoom.Client.appdata.xml  -t /app/share/metainfo/
        - install -Dm 644 us.zoom.Client.desktop  -t /app/usr/share/applications/
        - install -Dm 644 us.zoom.Client.desktop  -t /app/share/applications/
        - install -Dm 644 Zoom.png  -t  /app/share/icons/
        - install -Dm 644 Zoom.png  -t  /app/share/pixmaps/
        - install -Dm 644 Zoom.png  -t  /app/share/icons/hicolor/96x96/apps/
        
