app-id: net.sourceforge.GrandOrgue
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: '20.08'
command: GrandOrgue
rename-desktop-file: GrandOrgue.desktop
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --device=all
  - --filesystem=home
  - --socket=system-bus
  - --filesystem=xdg-run/pipewire-0
cleanup:
  - /lib/debug
  - /share/pixmaps
modules:
  - shared-modules/linux-audio/fftw3f-static.json
  - shared-modules/linux-audio/jack2.json
  - name: wxWidgets
    rm-configure: true
    cleanup:
      - /bin,
      - /include
      - /lib/wx/include
      - /share/bakefile
      - /share/man
      - '*.la'
      - '*.so'
    config-opts:
      - --disable-webkit
      - --disable-webview
      - --enable-markup
      - --disable-sdltest
      - --with-gtk=3
    build-options:
      cxxflags: -std=c++11
    sources:
      - type: archive
        url: https://github.com/wxWidgets/wxWidgets/releases/download/v3.1.4/wxWidgets-3.1.4.tar.bz2
        sha256: 3ca3a19a14b407d0cdda507a7930c2e84ae1c8e74f946e0144d2fa7d881f1a94
  - name: grandorgue
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_SKIP_RPATH=ON
      - -DVERSION_REVISION=2338
    post-install:
      - sed -i -e "s/Icon=GrandOrgue/Icon=${FLATPAK_ID}/" ${FLATPAK_DEST}/share/applications/GrandOrgue.desktop
      - mkdir -p ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps
      - mkdir -p ${FLATPAK_DEST}/share/icons/hicolor/64x64/apps
      - mkdir -p ${FLATPAK_DEST}/share/icons/hicolor/32x32/apps
      - install -m644 grandorgue-128x128.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
      - install -m644 grandorgue-64x64.png ${FLATPAK_DEST}/share/icons/hicolor/64x64/apps/${FLATPAK_ID}.png
      - mv ${FLATPAK_DEST}/share/pixmaps/GrandOrgue.png ${FLATPAK_DEST}/share/icons/hicolor/32x32/apps/${FLATPAK_ID}.png
      - rmdir ${FLATPAK_DEST}/share/pixmaps
      - mv ${FLATPAK_DEST}/share/mime/packages/grandorgue.xml ${FLATPAK_DEST}/share/mime/packages/${FLATPAK_ID}.xml
      - rm ${FLATPAK_DEST}/share/metainfo/GrandOrgue.appdata.xml
      - install -m644 ${FLATPAK_ID}.appdata.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.appdata.xml
    sources:
      - type: svn
        url: svn://svn.code.sf.net/p/ourorgan/svn/trunk
        revision: '2338'
      - type: file
        path: net.sourceforge.GrandOrgue.appdata.xml
      - type: file
        path: grandorgue-128x128.png
      - type: file
        path: grandorgue-64x64.png
