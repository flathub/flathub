{
    "app-id": "org.qutebrowser.qutebrowser",
    "branch": "stable",
    "runtime": "org.kde.Platform",
    "runtime-version": "5.10",
    "sdk": "org.kde.Sdk",
    "command": "qutebrowser-wrapper",
    "finish-args": [
        /* Nested sandboxes are currently not support by flatpak */
        "--env=QTWEBENGINE_DISABLE_SANDBOX=1",
        /* Allow direct rendering to use OpenGL and access to webcams */
        "--device=all",
        /* Allow to read all files from the home directory */
        "--filesystem=home:ro",
        /* Allow to save downloads */
        "--filesystem=xdg-download",
        /* Allow IPC access for performance reasons (X shared memory extension) */
        "--share=ipc",
        /* Allow network access */
        "--share=network",
        /* Allow to play sounds using pulseaudio */
        "--socket=pulseaudio",
        /* Allow to provide a graphical UI */
        "--socket=wayland",
        "--socket=x11"
    ],
    "rename-desktop-file": "qutebrowser.desktop",
    "rename-appdata-file": "qutebrowser.appdata.xml",
    "rename-icon": "qutebrowser",
    "cleanup": [
        "/bin/a2x",
        "/bin/a2x.py",
        "/bin/asciidoc",
        "/bin/asciidoc.py",
        "/bin/pylupdate5",
        "/bin/pyrcc5",
        "/bin/pyuic5",
        "/bin/sip",
        "/etc/asciidoc",
        "/include",
        "/lib/debug",
        "/share/man/man1/asciidoc.1"
    ],
    "modules": [
        {
            "name": "PyQt5",
            "buildsystem": "simple",
            "build-commands": [
                "python3 configure.py --confirm-license --assume-shared --verbose --sip=/app/bin/sip --sip-incdir=/app/include/python3.5 --destdir /app/lib/python3.5/site-packages --bindir /app/bin --qml-plugindir=/app/lib/plugins/PyQt5 --no-sip-files --no-stubs --no-tools --no-qml-plugin",
                "make",
                "make install"
            ],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/pyqt/files/PyQt5/PyQt-5.10.1/PyQt5_gpl-5.10.1.tar.gz",
                    "sha256": "9932e971e825ece4ea08f84ad95017837fa8f3f29c6b0496985fa1093661e9ef"
                }
            ],
            "modules": [
                {
                    "name": "sip",
                    "buildsystem": "simple",
                    "build-commands": [
                        "python3 configure.py -d /app/lib/python3.5/site-packages -b /app/bin -e /app/include/python3.5 -v /app/share/sip",
                        "make",
                        "make install"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://sourceforge.net/projects/pyqt/files/sip/sip-4.19.8/sip-4.19.8.tar.gz",
                            "sha256": "7eaf7a2ea7d4d38a56dd6d2506574464bddf7cf284c960801679942377c297bc"
                        }
                    ]
                }
            ]
        },
        {
            "name": "MarkupSafe",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/4d/de/32d741db316d8fdb7680822dd37001ef7a448255de9699ab4bfcbdf4172b/MarkupSafe-1.0.tar.gz",
                    "sha256": "a6be69091dac236ea9c6bc7d012beab42010fa914c459791d627dad4910eb665"
                }
            ]
        },
        {
            "name": "attrs",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/8b/0b/a06cfcb69d0cb004fde8bc6f0fd192d96d565d1b8aa2829f0f20adb796e5/attrs-17.4.0.tar.gz",
                    "sha256": "1c7960ccfd6a005cd9f7ba884e6316b5e430a3f1a6c37c5f87d8b43f83b54ec9"
                }
            ]
        },
        {
            "name": "cssutils",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "cleanup": [ "/bin" ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/5c/0b/c5f29d29c037e97043770b5e7c740b6252993e4b57f029b3cd03c78ddfec/cssutils-1.0.2.tar.gz",
                    "sha256": "a2fcf06467553038e98fea9cfe36af2bf14063eb147a70958cfcaa8f5786acaf"
                }
            ]
        },
        {
            "name": "Jinja2",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/56/e6/332789f295cf22308386cf5bbd1f4e00ed11484299c5d7383378cf48ba47/Jinja2-2.10.tar.gz",
                    "sha256": "f84be1bb0040caca4cea721fcbbbbd61f9be9464ca236387158b0feea01914a4"
                }
            ]
        },
        {
            "name": "Pygments",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "cleanup": [ "/bin" ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/71/2a/2e4e77803a8bd6408a2903340ac498cb0a2181811af7c9ec92cb70b0308a/Pygments-2.2.0.tar.gz",
                    "sha256": "dbae1046def0efb574852fab9e90209b23f556367b5a320c0bcb871c77c3e8cc"
                }
            ]
        },
        {
            "name": "pyPEG2",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/f9/bd/10398e2c2d2070cc8a9c7153abfbd4ddb2895a2c52a32722ab8689e0cc7d/pyPEG2-2.15.2.tar.gz",
                    "sha256": "2b2d4f80d8e1a9370b2a91f4a25f4abf7f69b85c8da84cd23ec36451958a1f6d"
                }
            ]
        },
        {
            "name": "PyYAML",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://pyyaml.org/download/pyyaml/PyYAML-3.12.tar.gz",
                    "sha256": "592766c6303207a20efc445587778322d7f73b161bd994f227adaa341ba212ab"
                }
            ]
        },
        {
            "name": "asciidoc",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://kent.dl.sourceforge.net/project/asciidoc/asciidoc/8.6.9/asciidoc-8.6.9.tar.gz",
                    "sha256": "78db9d0567c8ab6570a6eff7ffdf84eadd91f2dfc0a92a2d0105d323cab4e1f0"
                }
            ]
        },
        {
            "name": "qutebrowser",
            "buildsystem": "simple",
            "build-commands": [
                "make --file misc/Makefile install PREFIX=/app",
                "install qutebrowser.sh /app/bin/qutebrowser-wrapper"
            ],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/qutebrowser/qutebrowser/releases/download/v1.2.1/qutebrowser-1.2.1.tar.gz",
                    "sha256": "1ce6cf2634f06d3e715c53b50e4d042ba04aa39207ec318039a2a333e2d46beb"
                },
                {
                    "type": "patch",
                    "path": "makefile.patch"
                },
                {
                    "type": "script",
                    "dest-filename": "qutebrowser.sh",
                    "commands": [
                        "exec env PYTHON_EGG_CACHE=$XDG_CACHE_HOME /app/bin/qutebrowser \"$@\""
                    ]
                }
             ]
         }
    ]
}
