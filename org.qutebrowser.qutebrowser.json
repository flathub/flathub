{
    "app-id": "org.qutebrowser.qutebrowser",
    "branch": "stable",
    "runtime": "org.kde.Platform",
    "runtime-version": "5.11",
    "sdk": "org.kde.Sdk",
    "command": "qutebrowser-wrapper",
    "finish-args": [
        /* Nested sandboxes are currently not support by flatpak */
        "--env=QTWEBENGINE_DISABLE_SANDBOX=1",
        /* Allow direct rendering to use OpenGL and access to webcams */
        "--device=all",
        /* Allow to read all files from the home directory */
        "--filesystem=home:ro",
        /* Allow to save downloads */
        "--filesystem=xdg-download",
        /* Allow IPC access for performance reasons (X shared memory extension) */
        "--share=ipc",
        /* Allow network access */
        "--share=network",
        /* Allow to play sounds using pulseaudio */
        "--socket=pulseaudio",
        /* Allow to provide a graphical UI */
        "--socket=wayland",
        "--socket=x11"
    ],
    "rename-desktop-file": "qutebrowser.desktop",
    "rename-appdata-file": "qutebrowser.appdata.xml",
    "rename-icon": "qutebrowser",
    "cleanup": [
        "/bin/a2x",
        "/bin/a2x.py",
        "/bin/asciidoc",
        "/bin/asciidoc.py",
        "/bin/pylupdate5",
        "/bin/pyrcc5",
        "/bin/pyuic5",
        "/bin/sip",
        "/etc/asciidoc",
        "/include",
        "/lib/debug",
        "/share/man/man1/asciidoc.1"
    ],
    "modules": [
        {
            "name": "PyQt5",
            "buildsystem": "simple",
            "build-commands": [
                "python3 configure.py --confirm-license --assume-shared --verbose --sip=/app/bin/sip --sip-incdir=/app/include/python3.5 --destdir /app/lib/python3.5/site-packages --bindir /app/bin --qml-plugindir=/app/lib/plugins/PyQt5 --no-sip-files --no-stubs --no-tools --no-qml-plugin",
                "make",
                "make install"
            ],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/pyqt/files/PyQt5/PyQt-5.11.2/PyQt5_gpl-5.11.2.tar.gz",
                    "sha256": "7caa581155c3433716b7e6aba71fe1378cd7d92f4155c266d60e5cffb64e9603"
                },
                {
                    "type": "patch",
                    "path": "public_sip.diff"
                }

            ],
            "modules": [
                {
                    "name": "sip",
                    "buildsystem": "simple",
                    "build-commands": [
                        "python3 configure.py -d /app/lib/python3.5/site-packages -b /app/bin -e /app/include/python3.5 -v /app/share/sip",
                        "make",
                        "make install"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://sourceforge.net/projects/pyqt/files/sip/sip-4.19.12/sip-4.19.12.tar.gz",
                            "sha256": "24617fc31b983df075500ecac0e99d2fb48bf63ba82d4a17518659e571923822"
                        }
                    ]
                }
            ]
        },
        {
            "name": "MarkupSafe",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/4d/de/32d741db316d8fdb7680822dd37001ef7a448255de9699ab4bfcbdf4172b/MarkupSafe-1.0.tar.gz",
                    "sha256": "a6be69091dac236ea9c6bc7d012beab42010fa914c459791d627dad4910eb665"
                }
            ]
        },
        {
            "name": "attrs",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/e4/ac/a04671e118b57bee87dabca1e0f2d3bda816b7a551036012d0ca24190e71/attrs-18.1.0.tar.gz",
                    "sha256": "e0d0eb91441a3b53dab4d9b743eafc1ac44476296a2053b6ca3af0b139faf87b"
                }
            ]
        },
        {
            "name": "cssutils",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "cleanup": [ "/bin" ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/5c/0b/c5f29d29c037e97043770b5e7c740b6252993e4b57f029b3cd03c78ddfec/cssutils-1.0.2.tar.gz",
                    "sha256": "a2fcf06467553038e98fea9cfe36af2bf14063eb147a70958cfcaa8f5786acaf"
                }
            ]
        },
        {
            "name": "Jinja2",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/56/e6/332789f295cf22308386cf5bbd1f4e00ed11484299c5d7383378cf48ba47/Jinja2-2.10.tar.gz",
                    "sha256": "f84be1bb0040caca4cea721fcbbbbd61f9be9464ca236387158b0feea01914a4"
                }
            ]
        },
        {
            "name": "Pygments",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "cleanup": [ "/bin" ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/71/2a/2e4e77803a8bd6408a2903340ac498cb0a2181811af7c9ec92cb70b0308a/Pygments-2.2.0.tar.gz",
                    "sha256": "dbae1046def0efb574852fab9e90209b23f556367b5a320c0bcb871c77c3e8cc"
                }
            ]
        },
        {
            "name": "pyPEG2",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/f9/bd/10398e2c2d2070cc8a9c7153abfbd4ddb2895a2c52a32722ab8689e0cc7d/pyPEG2-2.15.2.tar.gz",
                    "sha256": "2b2d4f80d8e1a9370b2a91f4a25f4abf7f69b85c8da84cd23ec36451958a1f6d"
                }
            ]
        },
        {
            "name": "PyYAML",
            "buildsystem": "simple",
            "build-commands": ["python3 setup.py install --prefix=/app"],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/9e/a3/1d13970c3f36777c583f136c136f804d70f500168edc1edea6daa7200769/PyYAML-3.13.tar.gz",
                    "sha256": "3ef3092145e9b70e3ddd2c7ad59bdd0252a94dfe3949721633e41344de00a6bf"
                }
            ]
        },
        {
            "name": "asciidoc",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://kent.dl.sourceforge.net/project/asciidoc/asciidoc/8.6.9/asciidoc-8.6.9.tar.gz",
                    "sha256": "78db9d0567c8ab6570a6eff7ffdf84eadd91f2dfc0a92a2d0105d323cab4e1f0"
                }
            ]
        },
        {
            "name": "qutebrowser",
            "buildsystem": "simple",
            "build-commands": [
                "make --file misc/Makefile install PREFIX=/app",
                "install qutebrowser.sh /app/bin/qutebrowser-wrapper"
            ],
            "ensure-writable": ["easy-install.pth"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/qutebrowser/qutebrowser/releases/download/v1.4.1/qutebrowser-1.4.1.tar.gz",
                    "sha256": "a3f2de0e1178d9c00abd96dcc6fb5ef9a52cc2a99aa7da2073f785b4b6485f58"
                },
                {
                    "type": "patch",
                    "path": "appdata.patch"
                },
                {
                    "type": "script",
                    "dest-filename": "qutebrowser.sh",
                    "commands": [
                        "exec env PYTHON_EGG_CACHE=$XDG_CACHE_HOME /app/bin/qutebrowser \"$@\""
                    ]
                }
             ]
         }
    ]
}
