app-id: cz.krupkat.Xpano
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: Xpano
rename-icon: xpano
rename-desktop-file: xpano.desktop

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --device=dri

modules:
  - shared-modules/SDL2/SDL2-with-libdecor.json

  - name: spdlog
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://github.com/gabime/spdlog/archive/refs/tags/v1.11.0.zip
        sha256: 33f83c6b86ec0fbbd0eb0f4e980da6767494dc0ad063900bcfae8bc3e9c75f21
    cleanup:
      - /lib
      - /include
    post-install:
      - install -D -m 644 -T ../LICENSE $FLATPAK_DEST/share/xpano/licenses/spdlog-license.txt

  - name: opencv
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://github.com/opencv/opencv/archive/refs/tags/4.7.0.zip
        sha256: db6fb5e7dc76829d738fdbcdba11a810c66ca0a4752e531eaf3d793361e96de8
    cleanup:
      - /bin
      - /include
      - /lib
      - /share/opencv4
    post-install:
      - install -D -m 644 -T ../LICENSE $FLATPAK_DEST/share/xpano/licenses/opencv-license.txt
      - mv $FLATPAK_DEST/share/licenses/opencv4/* $FLATPAK_DEST/share/xpano/licenses
    config-opts:
      - -DBUILD_SHARED_LIBS=OFF
      - -DBUILD_opencv_apps=OFF
      - -DBUILD_opencv_dnn=OFF
      - -DBUILD_opencv_gapi=OFF
      - -DBUILD_opencv_highgui=OFF
      - -DBUILD_opencv_java_bindings_generator=OFF
      - -DBUILD_opencv_js=OFF
      - -DBUILD_opencv_js_bindings_generator=OFF
      - -DBUILD_opencv_ml=OFF
      - -DBUILD_opencv_objc_bindings_generator=OFF
      - -DBUILD_opencv_objdetect=OFF
      - -DBUILD_opencv_python3=OFF
      - -DBUILD_opencv_python_bindings_generator=OFF
      - -DBUILD_opencv_python_tests=OFF
      - -DBUILD_opencv_ts=OFF
      - -DBUILD_opencv_video=OFF
      - -DBUILD_opencv_videoio=OFF
      - -DBUILD_opencv_world=OFF
      - -DBUILD_IPP_IW=OFF
      - -DBUILD_ITT=OFF
      - -DBUILD_JASPER=OFF
      - -DBUILD_OPENEXR=OFF
      - -DBUILD_OPENJPEG=OFF
      - -DBUILD_PROTOBUF=OFF
      - -DBUILD_WEBP=OFF
      - -DCV_TRACE=OFF
      - -DWITH_ADE=OFF
      - -DWITH_FFMPEG=OFF
      - -DWITH_IMGCODEC_HDR=OFF
      - -DWITH_IMGCODEC_PFM=OFF
      - -DWITH_IMGCODEC_PXM=OFF
      - -DWITH_IMGCODEC_SUNRASTER=OFF
      - -DWITH_IPP=OFF
      - -DWITH_ITT=OFF
      - -DWITH_JASPER=OFF
      - -DWITH_OPENEXR=OFF
      - -DWITH_OPENJPEG=OFF
      - -DWITH_PROTOBUF=OFF
      - -DWITH_QUIRC=OFF
      - -DWITH_WEBP=OFF
      - -DWITH_WIN32UI=OFF
      - -DWITH_OPENCL=OFF

  - name: xpano
    buildsystem: cmake-ninja
    builddir: true
    sources: 
      - type: git
        url: https://github.com/krupkat/xpano
        tag: "v0.9.1"
        commit: 7c57e9521ce02da1d5394b571266d82d877a110f
    config-opts:
      - -DNFD_PORTAL=ON
    post-install:
      - install -D -m 644 -T /usr/share/licenses/SDL2/LICENSE.txt $FLATPAK_DEST/share/xpano/licenses/sdl2-license.txt
