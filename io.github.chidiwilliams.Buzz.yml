app-id: io.github.chidiwilliams.Buzz
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: run-buzz.sh
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --talk-name=org.freedesktop.secrets
  - --device=dri
  # TODO Switch 'all' to 'input' when it is widely available
  #- --device=input
  - --device=all
  - --share=network
  - --share=ipc
  - --filesystem=xdg-documents

modules:
  - buzz-pip-dependencies.json

  # Borrowed from https://github.com/flathub/org.audacityteam.Audacity/blob/master/org.audacityteam.Audacity.yaml
  - name: portaudio
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://github.com/PortAudio/portaudio/archive/refs/tags/v19.7.0.tar.gz
        sha256: 5af29ba58bbdbb7bbcefaaecc77ec8fc413f0db6f4c4e286c40c3e1b83174fa0

  # Borrowed from https://github.com/flathub/org.freedownloadmanager.Manager/pull/20/files
  - name: kerberos
    subdir: src
    sources:
      - type: archive
        url: https://kerberos.org/dist/krb5/1.21/krb5-1.21.tar.gz
        sha256: 69f8aaff85484832df67a4bbacd99b9259bd95aab8c651fbbe65cdc9620ea93b

  - name: Buzz
    buildsystem: simple
    build-commands:
      - install -Dm755 run-buzz.sh ${FLATPAK_DEST}/bin/run-buzz.sh

      - install -Dm644 ${FLATPAK_ID}.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg
      - install -Dm644 ${FLATPAK_ID}.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 ${FLATPAK_ID}.metainfo.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml

    sources:
      - type: dir
        path: .
