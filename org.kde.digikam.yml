id: org.kde.digikam
branch: beta
base: io.qt.qtwebengine.BaseApp
base-version: '5.14'
runtime: org.kde.Platform
runtime-version: '5.14'
sdk: org.kde.Sdk
command: digikam
desktop-file-name-suffix: ' (Beta)'
finish-args:
  - --device=all
  - --filesystem=host
  - --share=ipc
  - --share=network
  - --socket=cups
  - --socket=wayland
  - --socket=x11
  - --system-talk-name=org.freedesktop.UDisks2
  # Set proper path for digiKam plugins
  - --env=DK_PLUGIN_PATH=/app/lib/plugins/digikam
rename-icon: digikam
cleanup:
  - /include
  - /lib/cmake
  - /lib/libexec
  - /lib/pkgconfig
  - /share/doc
  - /share/eigen3
  - /share/man
  - /share/pkgconfig
cleanup-commands:
  - /app/cleanup-BaseApp.sh
modules:
  - name: digikam
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCMAKE_INSTALL_PREFIX=/app
      - -DDIGIKAMSC_CHECKOUT_PO=ON
      - -DDIGIKAMSC_CHECKOUT_DOC=OFF
      - -DDIGIKAMSC_COMPILE_PO=ON
      - -DDIGIKAMSC_COMPILE_DOC=OFF
      - -DENABLE_MYSQLSUPPORT=ON
      - -DENABLE_INTERNALMYSQL=ON
      # Currently disabled due compile error, will be fixed in the future
      - -DENABLE_MEDIAPLAYER=OFF
      - -DENABLE_DBUS=ON
      - -DENABLE_APPSTYLES=ON
      - -DENABLE_QWEBENGINE=ON
      - -DENABLE_FACESENGINE_DNN=ON
    sources:
      - type: archive
        url: https://download.kde.org/unstable/digikam/digikam-7.0.0-beta3.tar.xz
        sha256: 97b2f768674afaaca6feb6e661d5c8fc6b88b08f4d4bbab8a6bcc94c19914893
    modules:
      - boost.yml
      - name: eigen
        buildsystem: cmake-ninja
        builddir: true
        sources:
          - type: git
            url: https://gitlab.com/libeigen/eigen.git
            tag: 3.3.7
            commit: 21ae2afd4edaa1b69782c67a54182d34efe43f9c
      - name: opencv
        buildsystem: cmake-ninja
        builddir: true
        config-opts:
          - -DCMAKE_BUILD_TYPE=ReleaseWithDebInfo
          - -DBUILD_EXAMPLES=OFF
          - -DBUILD_TESTS=OFF
          - -DBUILD_DOCS=OFF
          - -DBUILD_PERF_TESTS=OFF
          - -DBUILD_NEW_PYTHON_SUPPORT=OFF
          - -DBUILD_ZLIB=OFF
          - -DOPENCV_BUILD_3RDPARTY_LIBS=OFF
          - -DINSTALL_C_EXAMPLES=OFF
          - -DINSTALL_PYTHON_EXAMPLES=OFF
          - -DBUILD_opencv_core=ON
          - -DBUILD_opencv_imgproc=ON
          - -DBUILD_opencv_imgcodecs=ON
          - -DBUILD_opencv_objdetect=ON
          - -DBUILD_opencv_calib3d=ON
          - -DBUILD_opencv_features2d=ON
          - -DBUILD_opencv_flann=ON
          - -DBUILD_opencv_dnn=ON
          - -DBUILD_opencv_photo=OFF
          - -DBUILD_opencv_java=OFF
          - -DBUILD_opencv_java_bindings_generator=OFF
          - -DBUILD_opencv_js=OFF
          - -DBUILD_opencv_python2=OFF
          - -DBUILD_opencv_python3=OFF
          - -DBUILD_opencv_python_bindings_generator=OFF
          - -DBUILD_opencv_ml=OFF
          - -DBUILD_opencv_shape=OFF
          - -DBUILD_opencv_highgui=OFF
          - -DBUILD_opencv_superres=OFF
          - -DBUILD_opencv_stitching=OFF
          - -DBUILD_opencv_videostab=OFF
          - -DBUILD_opencv_videoio=OFF
          - -DBUILD_opencv_video=OFF
          - -DBUILD_opencv_apps=OFF
          - -DBUILD_opencv_gapi=OFF
          - -DWITH_PROTOBUF=ON
          - -DWITH_1394=OFF
          - -DWITH_VTK=OFF
          - -DWITH_DIRECTX=OFF
          - -DWITH_DSHOW=OFF
          - -DWITH_EIGEN=OFF
          - -DWITH_FFMPEG=OFF
          - -DWITH_GSTREAMER=OFF
          - -DWITH_GTK=OFF
          - -DWITH_IPP=OFF
          - -DWITH_JASPER=OFF
          - -DWITH_JPEG=OFF
          - -DWITH_MATLAB=OFF
          - -DWITH_OPENEXR=OFF
          - -DWITH_OPENNI=OFF
          - -DWITH_OPENMP=OFF
          - -DWITH_PNG=OFF
          - -DWITH_PVAPI=OFF
          - -DWITH_WIN32UI=OFF
          - -DWITH_QT=OFF
          - -DWITH_QUICKTIME=OFF
          - -DWITH_QT_OPENGL=OFF
          - -DWITH_TBB=OFF
          - -DWITH_TIFF=OFF
          - -DWITH_UNICAP=OFF
          - -DWITH_V4L=OFF
          - -DWITH_VFW=OFF
          - -DWITH_VIDEOINPUT=OFF
          - -DWITH_XINE=OFF
          - -DWITH_VA_INTEL=OFF
          - -DWITH_GPHOTO2=OFF
          - -DWITH_WEBP=OFF
          - -DWITH_IMGCODEC_HDR=OFF
          - -DWITH_IMGCODEC_SUNRASTER=OFF
          - -DWITH_IMGCODEC_PXM=OFF
          - -DWITH_CUDA=OFF
          - -DWITH_CUFFT=OFF
          - -DWITH_CUBLAS=OFF
          - -DWITH_NVCUVID=OFF
          - -DWITH_OPENCL=OFF
          - -DWITH_OPENCL_SVM=OFF
          - -DWITH_OPENCLAMDFFT=OFF
          - -DWITH_OPENCLAMDBLAS=OFF
          - -DCV_ENABLE_INTRINSICS=OFF
          - -DCV_DISABLE_OPTIMIZATION=OFF
          - -DCV_TRACE=OFF
          - -DWITH_OPENJPEG=OFF
        cleanup:
          - /bin
        sources:
          - type: git
            url: https://github.com/Itseez/opencv.git
            tag: 4.3.0
            commit: 01b2c5a77ca6dbef3baef24ebc0a5984579231d9
      - name: exiv2
        buildsystem: cmake-ninja
        builddir: true
        config-opts:
          - -DBUILD_SHARED_LIBS=ON
          - -DEXIV2_ENABLE_XMP=ON
          - -DEXIV2_ENABLE_EXTERNAL_XMP=OFF
          - -DEXIV2_ENABLE_PNG=ON
          - -DEXIV2_ENABLE_HEIF=ON
          - -DEXIV2_ENABLE_NLS=ON
          - -DEXIV2_ENABLE_PRINTUCS2=ON
          - -DEXIV2_ENABLE_LENSDATA=ON
          - -DEXIV2_ENABLE_VIDEO=OFF
          - -DEXIV2_ENABLE_WEBREADY=OFF
          - -DEXIV2_ENABLE_DYNAMIC_RUNTIME=OFF
          - -DEXIV2_ENABLE_CURL=OFF
          - -DEXIV2_ENABLE_SSH=OFF
          - -DEXIV2_BUILD_SAMPLES=OFF
          - -DEXIV2_BUILD_PO=OFF
          - -DEXIV2_BUILD_EXIV2_COMMAND=OFF
          - -DEXIV2_BUILD_UNIT_TESTS=OFF
          - -DEXIV2_BUILD_DOC=OFF
          - -DEXIV2_TEAM_EXTRA_WARNINGS=OFF
          - -DEXIV2_TEAM_WARNINGS_AS_ERRORS=OFF
          - -DEXIV2_TEAM_USE_SANITIZERS=OFF
          - -DEXIV2_ENABLE_WIN_UNICODE=OFF
        sources:
          - type: git
            url: https://github.com/Exiv2/exiv2.git
            tag: v0.27.2
            commit: 70f9405fafbe19c7bab94b36a1267c4332dc8a8a
      - name: marble
        buildsystem: cmake-ninja
        builddir: true
        config-opts:
          - -DWITH_DESIGNER_PLUGIN=OFF
          - -DBUILD_MARBLE_TESTS=OFF
          - -DBUILD_MARBLE_TOOLS=OFF
          - -DBUILD_MARBLE_EXAMPLES=OFF
          - -DBUILD_MARBLE_APPS=OFF
          - -DBUILD_WITH_DBUS=ON
          - -DBUILD_TESTING=OFF
        cleanup:
          - /mkspecs
        sources:
          - type: git
            url: https://invent.kde.org/education/marble.git
            tag: v20.04.1
            commit: e3483bec0a7e79b7685055512712f79efaf19deb
      - name: lensfun
        buildsystem: cmake-ninja
        builddir: true
        config-opts:
          - -DCMAKE_BUILD_TYPE=RelWithDebInfo
          - -DBUILD_STATIC=OFF
          - -DBUILD_WITH_MSVC_STATIC_RUNTIME=OFF
          - -DBUILD_TESTS=OFF
          - -DBUILD_LENSTOOL=OFF
          - -DBUILD_DOC=OFF
          - -DINSTALL_PYTHON_MODULE=OFF
          - -DINSTALL_HELPER_SCRIPTS=OFF
        sources:
          - type: git
            url: https://github.com/lensfun/lensfun.git
            tag: v0.3.95
            commit: b7c7e49a3601690f3225b99a0acbe7272fe68bfa
      - name: ImageMagick
        builddir: true
        config-opts:
          - --enable-shared
          - --disable-static
          - --disable-docs
          - --with-modules
          - --with-threads
          - --with-png
        cleanup:
          - /bin
          - /etc
          - /share/ImageMagick-*
        sources:
          - type: git
            url: https://github.com/ImageMagick/ImageMagick.git
            tag: 7.0.10-13
            commit: 718905fbd1236b9f063f634cae11b604f0b4edcd
