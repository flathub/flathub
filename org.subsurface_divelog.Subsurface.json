{
	"app-id": "org.subsurface_divelog.Subsurface",
	"runtime": "org.kde.Platform",
	"runtime-version": "5.9",
	"sdk": "org.kde.Sdk",
	"command": "subsurface",
	"rename-icon": "subsurface-icon",
	"rename-appdata-file": "subsurface.appdata.xml",
	"rename-desktop-file": "subsurface.desktop",
	"finish-args":[
		"--socket=wayland",
		"--socket=x11",
		"--share=network",
		"--device=dri",
		"--filesystem=home",
		"--device=all",
		"--env=QTWEBENGINE_DISABLE_SANDBOX=1"
	],
	"build-options": {
		"cflags": "-O2",
		"cxxflags": "-O2"
	},
	"cleanup": [
		"/include",
		"/lib/pkgconfig",
		"/lib64/pkgconfig",
		"/lib/debug",
		"/lib/cmake",
		"/share/doc",
		"/share/man",
		"*.a",
		"*.la",
		"*.cmake"
	],
	"modules":[
		"shared-modules/udev/udev-175.json",
		{
			"name":"libssh2",
			"buildsystem":"cmake",
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/libssh2/libssh2.git"
				}
			]
		},
		{
			"name":"grantlee",
			"buildsystem":"cmake",
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/steveire/grantlee.git"
				}
			]
		},
		{
			"name":"libzip",
			"no-autogen":true,
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/nih-at/libzip.git"
				},
				{
					"type":"shell",
					"commands":["autoreconf -vfi", "./configure --prefix=/app", "make"]
				}
			]
		},
		{
			"name": "subsurface",
			"buildsystem":"simple",
			"builddir":true,
			"sources":[
				{
					"type":"git",
					"url": "https://github.com/Subsurface-divelog/subsurface.git",
					"dest": "subsurface"
				},
				{
					"type":"git",
					"url":"https://github.com/libgit2/libgit2.git",
					"dest": "libgit2"
				},
				{
					"type":"git",
					"url":"https://github.com/Subsurface-divelog/libdc.git",
					"branch": "Subsurface-branch",
					"dest": "libdivecomputer"
				},
				{
					"type":"git",
					"url":"https://github.com/Subsurface-divelog/marble.git",
					"branch": "Subsurface-branch",
					"dest": "marble-source"
				},
				{
					"type": "shell",
					"commands": [
						"perl -pi -e 's/BUILDGRANTLEE=1/BUILDGRANTLEE=0/' subsurface/scripts/build.sh",
						"perl -pi -e 's/BUILDMARBLE=1/BUILDMARBLE=0/' subsurface/scripts/build.sh"
					]
				},
				{
					"type": "patch",
					"path": "subsurface.patch"
				},
				{
					"type": "shell",
					"commands": [
						"mkdir -p /app/share/metainfo && cp  ./subsurface/appdata/subsurface.appdata.xml /app/share/metainfo"
					]
				}
			],
			"build-commands": [
				"ln -s /app/lib64/libssh2.a /app/lib/libssh2.a",
				"subsurface/scripts/build.sh",
				"cd subsurface/build && LIBRARY_PATH=/app/lib make install prefix=/app"
			]
		}
	]
}
