{
	"app-id": "org.subsurface_divelog.Subsurface",
	"runtime": "org.kde.Platform",
	"runtime-version": "5.9",
	"sdk": "org.kde.Sdk",
	"command": "subsurface",
	"rename-icon": "subsurface-icon",
	"rename-appdata-file": "subsurface.appdata.xml",
	"rename-desktop-file": "subsurface.desktop",
	"finish-args":[
		"--socket=wayland",
		"--socket=x11",
		"--share=network",
		"--device=dri",
		"--filesystem=home",
		"--device=all",
		"--env=QTWEBENGINE_DISABLE_SANDBOX=1"
	],
	"build-options": {
		"cflags": "-O2",
		"cxxflags": "-O2"
	},
	"cleanup": [
		"/include",
		"/lib/pkgconfig",
		"/lib64/pkgconfig",
		"/lib/cmake",
		"/share/doc",
		"/share/man",
		"*.a",
		"*.la",
		"*.cmake"
	],
	"modules":[
		"shared-modules/udev/udev-175.json",
		{
			"name":"libssh2",
			"buildsystem":"cmake",
			"config-opts":[
				"-DCMAKE_INSTALL_LIBDIR=/app/lib",
				"-DCMAKE_C_FLAGS=-fPIC"
			],
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/libssh2/libssh2.git",
					"branch": "libssh2-1.8.0",
					"commit": "72274af7f901315c1d47e43620c5bcb5f40c2b20"
				}
			]
		},
		{
			"name":"grantlee",
			"buildsystem":"cmake",
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/steveire/grantlee.git",
					"branch": "v5.1.0",
					"commit": "8f66fa86a24775e245df560771f313fa59770096"
				}
			]
		},
		{
			"name":"libzip",
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/nih-at/libzip.git",
					"branch": "rel-1-2-0",
					"commit": "a23ac8a766c556827255111eb35ba928641efbc8"
				},
				{
					"type":"script",
					"commands":["autoreconf -vfi", "./configure --prefix=/app", "make"],
					"dest-filename": "autogen.sh"
				}
			]
		},
		{
			"name": "subsurface",
			"buildsystem":"simple",
			"sources":[
				{
					"type":"git",
					"url": "https://github.com/Subsurface-divelog/subsurface.git",
					"dest": "subsurface"
				},
				{
					"type":"git",
					"url":"https://github.com/libgit2/libgit2.git",
					"branch": "v0.26.0",
					"commit": "15e119375018fba121cf58e02a9f17fe22df0df8",
					"dest": "libgit2"
				},
				{
					"type":"git",
					"url":"https://github.com/Subsurface-divelog/libdc.git",
					"branch": "v4.6.4",
					"commit": "82c7bc82aa1ff5110b3f8dd8a0a31581a1fb085c",
					"dest": "libdivecomputer"
				},
				{
					"type":"git",
					"url":"https://github.com/Subsurface-divelog/marble.git",
					"branch": "v4.6.4",
					"commit": "df3576addbb71e03aa6dcbae6779c1943927823a",
					"dest": "marble-source"
				},
				{
					"type": "shell",
					"commands": [
						"sed -i \"s|BUILDGRANTLEE=1|BUILDGRANTLEE=0|g\" subsurface/scripts/build.sh",
						"sed -i \"s|BUILDMARBLE=1|BUILDMARBLE=0|g\" subsurface/scripts/build.sh",
						"sed -i \"s|-DNO_PRINTING=OFF|-DNO_PRINTING=ON -DNO_MARBLE=ON -DUSE_WEBENGINE=ON|g\" subsurface/scripts/build.sh"
					]
				}
			],
			"build-commands":
			[
				"mkdir -p /app/share/metainfo && cp ./subsurface/appdata/subsurface.appdata.xml /app/share/metainfo",
				"subsurface/scripts/build.sh",
				"cd subsurface/build && sed -i \"s|/usr/local|/app|g\" cmake_install.cmake && make && make install"
			]
		},
		{
			"name":"libgit2",
			"buildsystem":"cmake",
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/libgit2/libgit2.git",
					"branch": "v0.26.0",
					"commit": "15e119375018fba121cf58e02a9f17fe22df0df8"
				}
			]
		}
	]
}
