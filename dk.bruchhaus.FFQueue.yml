id: dk.bruchhaus.FFQueue
runtime: org.gnome.Platform
sdk: org.gnome.Sdk
runtime-version: '48'
command: ffqueue
rename-icon: ffqueue
rename-desktop-file: ffqueue.desktop
rename-appdata-file: ffqueue.xml

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
  - --share=ipc
  - --filesystem=xdg-documents
  - --filesystem=xdg-download
  - --filesystem=xdg-music
  - --filesystem=xdg-pictures
  - --filesystem=xdg-videos
  - --filesystem=/media
  - --filesystem=/mnt

cleanup:
  - /wxWidgets
  - /lib/pkgconfig
  - /lib/debug

modules:

  - name: wxWidgets
    buildsystem: simple
    build-commands:
      - ./wx-make.sh
    sources:
      - type: archive
        dest: wxWidgets
        url: https://github.com/wxWidgets/wxWidgets/releases/download/v3.2.8/wxWidgets-3.2.8.tar.bz2
        sha256: c74784904109d7229e6894c85cfa068f1106a4a07c144afd78af41f373ee0fe6
      - type: script
        dest-filename: wx-make.sh
        commands:
          - cd wxWidgets
          - if [ ! -d gtk-build ]; then
          -   mkdir -p gtk-build
          -   cd gtk-build
          -   ../configure --enable-unicode --disable-shared --with-libpng --with-gtk=3
          -   make -j$FLATPAK_BUILDER_N_JOBS BUILD=release SHARED=0
          -   cd ..
          - fi
          - mkdir -p $FLATPAK_DEST/wxWidgets
          - cp -rf gtk-build $FLATPAK_DEST/wxWidgets/
          - cp -rf include $FLATPAK_DEST/wxWidgets/
          - sed -ie 's@'"$FLATPAK_BUILDER_BUILDDIR"'@'"$FLATPAK_DEST"'@' $FLATPAK_DEST/wxWidgets/gtk-build/wx-config
        
  - name: FFmpeg
    buildsystem: simple
    build-commands:
      - mkdir -p $FLATPAK_DEST/bin
      - mkdir -p $FLATPAK_DEST/lib
      - cp -Pr bin/* $FLATPAK_DEST/bin/
      - cp -Pr lib/* $FLATPAK_DEST/lib/
    sources:
      - type: archive
        url: https://github.com/BtbN/FFmpeg-Builds/releases/download/autobuild-2025-09-30-13-19/ffmpeg-N-121271-g74115b017c-linux64-gpl-shared.tar.xz
        sha256: cdbf038e1156dcd7c652cb784276699af4810c453c56292b3b142cc8a3dffaa0
        
  - name: FFQueue
    buildsystem: simple
    build-commands:
      - ./ffq-make.sh
    sources:
      - type: archive
        dest: FFQueue
        url: https://github.com/bswebdk/FFQueue/archive/refs/tags/V1.7.69.tar.gz
        sha256: 651acecc7bdcaac913bf5ca0bd5e8ec6beef9e7ef3b9e14f583e55b23fec595b
      - type: script
        dest-filename: ffq-make.sh
        commands:
          - cd FFQueue
          - sed -ie 's@^WX\:.*gtk-build$@WX\:\=\'"$FLATPAK_DEST"'/wxWidgets/gtk-build@' Makefile.lin
          - make -j$FLATPAK_BUILDER_N_JOBS -f Makefile.lin
          - install -Dm755 build/FFQueue $FLATPAK_DEST/bin/ffqueue
          - icp=$FLATPAK_DEST/share/icons/hicolor
          - install -Dm644 res/MainLogo16.png $icp/16x16/apps/ffqueue.png
          - install -Dm644 res/MainLogo32.png $icp/32x32/apps/ffqueue.png
          - install -Dm644 res/MainLogo64.png $icp/64x64/apps/ffqueue.png
          - install -Dm644 res/MainLogo128.png $icp/128x128/apps/ffqueue.png
          - install -Dm644 res/MainLogo256.png $icp/256x256/apps/ffqueue.png
          - install -Dm644 res/MainLogo512.png $icp/512x512/apps/ffqueue.png
          - install -Dm755 res/ffqueue.desktop $FLATPAK_DEST/share/applications/ffqueue.desktop
          - install -Dm644 res/metainfo.xml $FLATPAK_DEST/share/metainfo/ffqueue.xml
          - cd ..
          - # Following cmd should not be necessary..
          - cp -P /usr/lib/x86_64-linux-gnu/libslang.so* $FLATPAK_DEST/lib/
