{
	"app-id": "org.gnu.Octave",
	"runtime": "org.kde.Sdk",
	"runtime-version": "5.9",
	"sdk": "org.kde.Sdk",
	"command": "octave",
	"rename-icon": "octave",
	"rename-desktop-file": "www.octave.org-octave.desktop",
	"rename-appdata-file": "www.octave.org-octave.appdata.xml",
	"finish-args":
	[
		"--socket=wayland",
		"--socket=x11",
		"--socket=pulseaudio",
		"--share=network",
		"--device=dri",
		"--filesystem=home",
		"--env=LIBGL_ALWAYS_SOFTWARE=1"
	],
	"build-options":
	{
		"cflags": "-O2",
		"cxxflags": "-O2"
	},
	"modules":
	[
		{
			"name": "gcc-fortran",
			"build-options":
			{
				"ldflags": "--static-libgcc"
			},
			"config-opts":
			[
				"--enable-languages=c,c++,fortran",
				"--disable-multilib",
				"--disable-bootstrap",
				"--with-system-zlib",
				"--enable-checking=release",
				"--disable-stage1-checking",
				"--disable-libsanitizer",
				"--disable-libssp"
			],
			"sources":
			[
				{
					"type": "archive",
					"url": "http://mirrors.kernel.org/gnu/gcc/gcc-7.1.0/gcc-7.1.0.tar.gz",
					"sha256": "3c187ef42e4cf657eec0ed641aac7f7e46261bcb1cea31b72dcf2dedddbbdea5"
				},
				{
					"type": "shell",
					"commands":
					[
						"sed -e '/m64=/s/lib64/lib/' -i.orig gcc/config/i386/t-linux64"
					]
				}
			]
		},
		{
			"name": "openblas",
			"no-autogen": true,
			"build-options":
			{
				"ldflags": "-L/app/lib64"
			},
			"make-args":
			[
				"FC=gfortran",
				"TARGET=PRESCOTT"
			],
			"make-install-args":
			[
				"PREFIX=/app"
			],
			"sources":
			[
				{
					"type": "archive",
					"url": "https://github.com/xianyi/OpenBLAS/archive/v0.2.19.tar.gz",
					"sha256": "9c40b5e4970f27c5f6911cb0a28aa26b6c83f17418b69f8e5a116bb983ca8557"
				}
			]
		},
		{
			"name": "qscintilla",
			"buildsystem": "simple",
			"sources":
			[
				{
					"type": "archive",
					"url": "https://sourceforge.net/projects/pyqt/files/QScintilla2/QScintilla-2.10/QScintilla_gpl-2.10.tar.gz",
					"sha256": "16be30577bc178470936c458551f2512cc068aff6e7a7de6ed244e28c045f6ec"
				},
				{
					"type": "patch",
					"path": "qscintilla.patch"
				},
				{
					"type": "script",
					"commands":
					[
						"cd Qt4Qt5",
						"qmake"
					],
					"dest-filename": "configure"
				}
			],
			"build-commands":
			[
				"./configure --prefix=/app",
				"make -C Qt4Qt5 install",
				"ln -s /app/lib/libqscintilla2_qt5.so /app/lib/libqscintilla2-qt5.so"
			]
		},
		"shared-modules/glu/glu-9.0.0.json",
		{
			"name": "gnuplot",
			"sources":
			[
				{
					"type": "archive",
					"url": "https://sourceforge.net/projects/gnuplot/files/gnuplot/5.0.6/gnuplot-5.0.6.tar.gz",
					"sha256": "5bbe4713e555c2e103b7d4ffd45fca69551fff09cf5c3f9cb17428aaacc9b460"
				}
			]
		},
		{
			"name": "fontconfig",
			"sources":
			[
				{
					"type": "archive",
					"url": "https://www.freedesktop.org/software/fontconfig/release/fontconfig-2.12.1.tar.gz",
					"sha256": "a9f42d03949f948a3a4f762287dbc16e53a927c91a07ee64207ebd90a9e5e292"
				}
			]
		},
		{
			"name": "freetype",
			"sources":
			[
				{
					"type": "archive",
					"url": "http://download.savannah.gnu.org/releases/freetype/freetype-2.8.tar.gz",
					"sha256": "33a28fabac471891d0523033e99c0005b95e5618dc8ffa7fa47f9dadcacb1c9b"
				}
			]
		},
		{
			"name": "fltk",
			"config-opts":
			[
				"--enable-shared"
			],
			"build-options":
			{
				"cflags": "-fPIC",
				"cxxflags": "-fPIC"
			},
			"sources":
			[
				{
					"type": "archive",
					"url": "http://fltk.org/pub/fltk/1.3.4/fltk-1.3.4-1-source.tar.gz",
					"sha256": "7fb2c8882433ce694e6900c94fda505e8f4ed3fa9c7e597007098a33b85c53f4"
				}
			]
		},
		{
			"name": "cups",
			"config-opts":
			[
				"--disable-static",
				"--disable-dbus",
				"--without-php",
				"--disable-gssapi",
				"--disable-ssl",
				"--disable-cdsassl",
				"--disable-gnutls",
				"--disable-pam",
				"--disable-dnssd",
				"--disable-launchd",
				"--libdir=/app/lib"
			],
			"make-args":
			[
				"libs"
			],
			"no-make-install": true,
			"sources":
			[
				{
					"type": "archive",
					"url": "https://github.com/apple/cups/archive/v2.2.3.tar.gz",
					"sha256": "7aa7e8d581f0eb204f75203082403bfa931f8c058bffae71b210800102e5feb5"
				}
			],
			"post-install":
			[
				"make install-libs", "chmod +w /app/lib/libcups*"
			]
		},
		{
			"name": "ghostscript",
			"build-options":
			{
				"ldflags": "-L/app/lib"
			},
			"sources":
			[
				{
					"type": "archive",
					"url": "https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs921/ghostscript-9.21.tar.gz",
					"sha256": "02bceadbc4dddeb6f2eec9c8b1623d945d355ca11b8b4df035332b217d58ce85"
				}
			]
		},
		{
			"name": "gl2ps",
			"buildsystem": "cmake",
			"sources":
			[
				{
					"type": "archive",
					"url": "http://geuz.org/gl2ps/src/gl2ps-1.4.0.tgz",
					"sha256": "03cb5e6dfcd87183f3b9ba3b22f04cd155096af81e52988cc37d8d8efe6cf1e2"
				}
			]
		},
		{
			"name": "qhull",
			"buildsystem": "cmake",
			"sources":
			[
				{
					"type": "archive",
					"url": "http://www.qhull.org/download/qhull-2015-src-7.2.0.tgz",
					"sha256": "78b010925c3b577adc3d58278787d7df08f7c8fb02c3490e375eab91bb58a436"
				}
			]
		},
		{
			"name": "epstool",
			"no-autogen": true,
			"make-args": ["PREFIX=/app"],
			"sources":
			[
				{
					"type": "archive",
					"url": "http://pkgs.fedoraproject.org/repo/pkgs/epstool/epstool-3.08.tar.gz/465a57a598dbef411f4ecbfbd7d4c8d7/epstool-3.08.tar.gz",
					"sha256": "f3f14b95146868ff3f93c8720d5539deef3b6531630a552165664c7ee3c2cfdd"
				},
				{
					"type": "patch",
					"path": "epstool.patch"
				}
			]
		},
		{
			"name": "octave",
			"config-opts":
			[
				"--enable-shared",
				"--disable-static",

				"--with-blas=\"-lopenblas\"",
				"--with-lapack=\"-lopenblas\"",

				"--disable-docs"
			],
			"make-install-args": [
				"prefix=/app"
			],
			"sources":
			[
				{
					"type": "archive",
					"url": "https://ftp.gnu.org/gnu/octave/octave-4.2.1.tar.gz",
					"sha256": "80c28f6398576b50faca0e602defb9598d6f7308b0903724442c2a35a605333b"
				},
				{
					"type": "patch",
					"path": "appdata.patch"
				},
				{
					"type": "patch",
					"path": "pcre.patch"
				},
				{
					"type": "shell",
					"commands": ["autoreconf -i"]
				}
			]
		}
	]
}
