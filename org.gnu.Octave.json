{
	"app-id": "org.gnu.Octave",
	"runtime": "org.kde.Sdk",
	"runtime-version": "master",
	"sdk": "org.kde.Sdk",
	"command": "octave",
	"rename-icon": "octave",
	"rename-desktop-file": "www.octave.org-octave.desktop",
	"rename-appdata-file": "www.octave.org-octave.appdata.xml",
	"finish-args": [
		"--socket=wayland",
		"--socket=x11",
		"--socket=pulseaudio",
		"--share=network",
		"--device=dri",
		"--filesystem=home"
	],
	"build-options": {
		"cflags": "-O2",
		"cxxflags": "-O2"
	},
	"modules": [
		{
			"name": "gcc-fortran",
			"build-options": {
				"ldflags": "--static-libgcc"
			},
			"config-opts": [
				"--enable-languages=c,c++,fortran",
				"--disable-multilib",
				"--disable-bootstrap",
				"--with-system-zlib",
				"--enable-checking=release",
				"--disable-stage1-checking",
				"--disable-libsanitizer",
				"--disable-libssp"
			],
			"sources": [
				{
					"type": "archive",
					"url": "http://mirrors.kernel.org/gnu/gcc/gcc-7.1.0/gcc-7.1.0.tar.gz",
					"sha256": "3c187ef42e4cf657eec0ed641aac7f7e46261bcb1cea31b72dcf2dedddbbdea5"
				},
				{
					"type": "shell",
					"commands": ["sed -e '/m64=/s/lib64/lib/' -i.orig gcc/config/i386/t-linux64"]
				}
			]
		},
		{
			"name": "openblasblas",
			"no-autogen": true,
			"build-options": {
				"ldflags": "-L/app/lib64"
			},
			"make-args": ["FC=gfortran", "TARGET=PRESCOTT"],
			"make-install-args": ["PREFIX=/app"],
			"sources": [
				{
					"type": "archive",
					"url": "https://github.com/xianyi/OpenBLAS/archive/v0.2.19.tar.gz",
					"sha256": "9c40b5e4970f27c5f6911cb0a28aa26b6c83f17418b69f8e5a116bb983ca8557"
				}
			]
		},
		{
			"name": "qscintilla",
			"buildsystem": "simple",
			"sources": [
				{
					"type": "archive",
					"url": "https://sourceforge.net/projects/pyqt/files/QScintilla2/QScintilla-2.10/QScintilla_gpl-2.10.tar.gz",
					"sha256": "16be30577bc178470936c458551f2512cc068aff6e7a7de6ed244e28c045f6ec"
				},
				{
					"type": "patch",
					"path": "qscintilla.patch"
				},
				{
					"type": "script",
					"commands": [
						"cd Qt4Qt5",
						"qmake"
					],
					"dest-filename": "configure"
				}
			],
			"build-commands": [
				"./configure --prefix=/app && \
				cd Qt4Qt5 && \
				make && \
				make install && \
				ln -s /app/lib/libqscintilla2_qt5.so /app/lib/libqscintilla2-qt5.so"
			]
		},
		"shared-modules/glu/glu-9.0.0.json",
		{
			"name": "gnuplot",
			"sources": [
				{
					"type": "archive",
					"url": "https://sourceforge.net/projects/gnuplot/files/gnuplot/5.0.6/gnuplot-5.0.6.tar.gz",
					"sha256": "5bbe4713e555c2e103b7d4ffd45fca69551fff09cf5c3f9cb17428aaacc9b460"
				}
			]
		},
		{
			"name": "pcre",
			"config-opts": [
				"--enable-shared"
			],
			"sources": [
				{
					"type": "archive",
					"url": "https://ftp.pcre.org/pub/pcre/pcre-8.40.tar.gz",
					"sha256": "1d75ce90ea3f81ee080cdc04e68c9c25a9fb984861a0618be7bbf676b18eda3e"
				}
			]
		},
		{
			"name": "octave",
			"config-opts": [
				"--enable-shared",
				"--disable-static",

				"--with-blas=\"-lopenblas\"",
				"--with-lapack=\"-lopenblas\"",

				"--disable-docs"
			],
			"make-install-args": [
				"prefix=/app"
			],
			"sources": [
				{
					"type": "archive",
					"url": "https://ftp.gnu.org/gnu/octave/octave-4.2.1.tar.gz",
					"sha256": "80c28f6398576b50faca0e602defb9598d6f7308b0903724442c2a35a605333b"
				},
				{
					"type": "patch",
					"path": "appdata.patch"
				}
			]
		}
	]
}
