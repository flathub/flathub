app-id: com.github.TheThirdOne.rars

command: /app/bin/rars

finish-args:
  - --env=PATH=/app/jre/bin:/usr/bin
  - --socket=x11
  - --socket=fallback-x11
  - --filesystem=xdg-desktop:rw
  - --filesystem=xdg-documents:rw

runtime: org.freedesktop.Platform
runtime-version: '22.08'

sdk: org.freedesktop.Sdk
sdk-extensions:
  # See https://github.com/flathub/org.freedesktop.Sdk.Extension.openjdk17#usage
  - org.freedesktop.Sdk.Extension.openjdk17

modules:
  # See https://github.com/flathub/org.freedesktop.Sdk.Extension.openjdk17#usage
  - name: openjdk
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk17/install.sh

  - name: rars
    buildsystem: simple
    sources:
      # See https://github.com/TheThirdOne/rars/releases
      - type: file
        url: https://github.com/TheThirdOne/rars/releases/download/continuous/rars_27a7c1f.jar
        dest-filename: rars.jar
        sha512: f64bf6afe59ca82b0ddb32eb741279426b92a6e744d5f3ee494bbeed6e4b75953e5750ea6955e628e467e442ce57bd767b86516a0551454897898ed9d40acac6
      - type: script
        commands:
          - /app/jre/bin/java -Dsun.java2d.uiScale=${RARS_UISCALE:-1.0} -jar /app/rars/rars.jar $@
        dest-filename: rars
      - type: file
        path: com.github.TheThirdOne.rars.desktop
      - type: file
        path: com.github.TheThirdOne.rars.metainfo.xml
      - type: file
        path: icons/com.github.TheThirdOne.rars-16.png
      - type: file
        path: icons/com.github.TheThirdOne.rars-24.png
      - type: file
        path: icons/com.github.TheThirdOne.rars-32.png
      - type: file
        path: icons/com.github.TheThirdOne.rars-48.png
      - type: file
        path: icons/com.github.TheThirdOne.rars-64.png
      - type: file
        path: icons/com.github.TheThirdOne.rars-128.png
      - type: file
        path: icons/com.github.TheThirdOne.rars-256.png
      - type: file
        path: icons/com.github.TheThirdOne.rars-512.png
    build-commands:
      # Copy files
      - install -Dm 755 rars.jar /app/rars/rars.jar
      - install -Dm 755 rars /app/bin/rars
      - install -Dm 644 -t /app/share/applications com.github.TheThirdOne.rars.desktop
      - install -Dm 644 -t /app/share/metainfo com.github.TheThirdOne.rars.metainfo.xml
      - |
        for size in 16 24 32 48 64 128 256 512; do
          install -Dm 644 com.github.TheThirdOne.rars-${size}.png /app/share/icons/hicolor/${size}x${size}/apps/com.github.TheThirdOne.rars.png
        done