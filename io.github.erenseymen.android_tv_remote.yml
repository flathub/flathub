app-id: io.github.erenseymen.android_tv_remote
runtime: org.gnome.Platform
runtime-version: "49"
sdk: org.gnome.Sdk
command: android-tv-remote

finish-args:
  - --share=network
  - --socket=wayland
  - --share=ipc
  - --socket=fallback-x11
  - --device=dri

build-options:
  env:
    PIP_DISABLE_PIP_VERSION_CHECK: "1"
    PIP_NO_CACHE_DIR: "1"
    PYTHONNOUSERSITE: "1"

modules:
  # Android Platform Tools (adb) - x86_64 only
  - name: android-tools
    buildsystem: simple
    build-commands:
      - install -Dm755 platform-tools/adb /app/bin/adb
    sources:
      - type: archive
        url: https://dl.google.com/android/repository/platform-tools_r35.0.2-linux.zip
        sha256: acfdcccb123a8718c46c46c059b2f621140194e5ec1ac9d81715be3d6ab6cd0a
        strip-components: 0

  # scrcpy-server (pre-built, Java bytecode - architecture agnostic)
  - name: scrcpy-server
    buildsystem: simple
    build-commands:
      - install -Dm644 scrcpy-server /app/share/scrcpy/scrcpy-server
    sources:
      - type: file
        url: https://github.com/Genymobile/scrcpy/releases/download/v3.1/scrcpy-server-v3.1
        sha256: 958f0944a62f23b1f33a16e9eb14844c1a04b882ca175a738c16d23cb22b86c0
        dest-filename: scrcpy-server

  - name: python3-psutil
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps --no-build-isolation psutil-5.9.8.tar.gz
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/90/c7/6dc0a455d111f68ee43f27793971cf03fe29b6ef972042549db29eec39a2/psutil-5.9.8.tar.gz
        sha256: 6be126e3225486dff286a8fb9a06246a5253f4c7c53b475ea5f5ac934e64194c

  - name: python3-adb-shell
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps --no-build-isolation adb_shell-0.4.4.tar.gz
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/8f/73/d246034db6f3e374dad9a35ee3f61345a6b239d4febd2a41ab69df9936fe/adb_shell-0.4.4.tar.gz
        sha256: 04c305f30a2ca25d5c54b3cd6ce9bb64c36e5f07967b23b3fb6aaecc851b90b6

  - name: python3-pyasn1
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps --no-build-isolation pyasn1-0.6.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c8/f1/d6a797abb14f6283c0ddff96bbdd46937f64122b8c925cab503dd37f8214/pyasn1-0.6.1-py3-none-any.whl
        sha256: 0d632f46f2ba09143da3a8afe9e33fb6f92fa2320ab7e886e2d0f7672af84629

  - name: python3-rsa
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps --no-build-isolation rsa-4.9.1-py3-none-any.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/64/8d/0133e4eb4beed9e425d9a98ed6e081a55d195481b7632472be1af08d2f6b/rsa-4.9.1-py3-none-any.whl
        sha256: 68635866661c6836b8d39430f97a996acbd61bfa49406748ea243539fe239762

  - name: android-tv-remote
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps --no-build-isolation .
      - |
        if [ -d /app/share/glib-2.0/schemas ] && [ "$(ls -A /app/share/glib-2.0/schemas/*.xml 2>/dev/null)" ]; then
          glib-compile-schemas /app/share/glib-2.0/schemas
        fi
    sources:
      - type: git
        url: https://github.com/erenseymen/android-tv-remote.git
        tag: v1.0.1
