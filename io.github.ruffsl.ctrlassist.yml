app-id: io.github.ruffsl.ctrlassist
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: ctrlassist
finish-args:
  - --device=all
  - --filesystem=~/.local/share/Steam/config:rw
  - --own-name=org.kde.StatusNotifierItem-2-1
  - --talk-name=org.kde.StatusNotifierWatcher
modules:
  - name: ctrlassist
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/rust-stable/bin
      env:
        CARGO_HOME: /run/build/ctrlassist/cargo
        CARGO_NET_OFFLINE: 'true'
    build-commands:
      - cargo --offline fetch --verbose
      - cargo --offline build --release --all-features
      - install -Dm0755 target/release/ctrlassist ${FLATPAK_DEST}/bin/ctrlassist
      - install -Dm0644 flatpak/io.github.ruffsl.ctrlassist.metainfo.xml ${FLATPAK_DEST}/share/metainfo/io.github.ruffsl.ctrlassist.metainfo.xml
      - install -Dm0644 flatpak/io.github.ruffsl.ctrlassist.desktop ${FLATPAK_DEST}/share/applications/io.github.ruffsl.ctrlassist.desktop
      - install -Dm0644 docs/artwork/icon_48.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/io.github.ruffsl.ctrlassist.svg
    sources:
      - type: git
        url: https://github.com/ruffsl/CtrlAssist.git
        tag: "v0.3.0"
        commit: "73e85e70e8e8d9263ac4019fa6042cb46f9d6091"
      - cargo-sources.json
