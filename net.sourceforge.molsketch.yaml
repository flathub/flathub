app-id: net.sourceforge.molsketch
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '5.15-21.08'
command: molsketch
rename-icon: molsketch
rename-desktop-file: molsketch.desktop
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --share=network
  - --filesystem=host
  - --filesystem=home
modules:
  - name: InChi
    buildsystem: simple
    #build-options:
      #cflags: -flto -fno-fat-lto-objects
      #cxxflags: -flto -fno-fat-lto-objects
    build-commands:
      - cd INCHI_EXE/inchi-1/gcc && make
      - install -Dm755 "INCHI_EXE/bin/Linux/inchi-1" "/app/bin/inchi-1"
      #- install -dm644 INCHI_BASE/src/{ichisize,inchi_api,ixa}.h ${FLATPAK_DEST}/include/inchi
    sources:
      - type: archive
        url: https://www.inchi-trust.org/download/106/INCHI-1-SRC.zip
        sha256: 4874e310c0f2f81b881e90dd0c534752e1b9421d7d92ccfb037710022c7e7efd
        #x-checker-data:
          #type: anitya
          #project-id:
          #stable-only: true
          #url-template:

  - name: OpenBabel
    buildsystem: cmake
    builddir: true
    #build-options:
      #cflags: -flto -fno-fat-lto-objects
      #cxxflags: -flto -fno-fat-lto-objects
    config-opts:
      - -DBUILD_GUI=FALSE
      - -DENABLE_TESTS=OFF
    sources:
      - type: archive
        url: https://github.com/openbabel/openbabel/releases/download/openbabel-3-1-1/openbabel-3.1.1-source.tar.bz2
        sha256: a6ec8381d59ea32a4b241c8b1fbd799acb52be94ab64cdbd72506fb4e2270e68
        x-checker-data:
          type: anitya
          project-id: 2539
          stable-only: true
          url-template: https://github.com/openbabel/openbabel/releases/download/openbabel-3-1-1/openbabel-$version-source.tar.bz2

  - name: Molsketch
    buildsystem: cmake
    builddir: true
    #build-options:
      #cflags: -flto -fno-fat-lto-objects
      #cxxflags: -flto -fno-fat-lto-objects
    config-opts:
      - -DMSK_PREFIX=/app
      - -DOPENBABEL_INCLUDE_DIRS=/app/include/openbabel3
      - -DOB_LIBRARY_DIRS=/app/lib
    sources:
      - type: archive
        url: https://sourceforge.net/projects/molsketch/files/Molsketch/Molsketch-0.7.2-src.tar.gz
        sha256: 1c6911163f7648aa0e0e4cafc1709cb1d30328c3c0131d6ad2e44e25e1c48f3f
      #- type: shell
        #commands:
          #- sed -i 's/usr/app/g' obabeliface/findOpenBabel.cmake
          #- cat obabeliface/findOpenBabel.cmake

  #- name: install-metainfo
    #buildsystem: simple
    #build-commands:
      #- install -Dm644 ${FLATPAK_ID}.metainfo.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml
    #sources:
      #- type: file
        #path: net.sourceforge.Molsketch.metainfo.xml
