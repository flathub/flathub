id: dev.sparcles.engine
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: srengine -resources /app/share/SREngine/Resources

build-options:
  build-args:
    - --share=network

modules:
#   - name: Prepare
#     buildsystem: simple
#     build-commands:
#       - git clone https://github.com/SpaRcle-Studio/SREngine /var/SREngine --depth 1
#       - cd /var/SREngine
#       - git checkout dev
#       - git submodule update --init --recursive --depth 1
#       - mkdir build

   - name: SREngine
     buildsystem: cmake-ninja
     config-opts:
       - -DCMAKE_BUILD_TYPE=Debug
       - -DSR_ENGINE_FLATPAK_BUILD=ON
       - -DSR_ENGINE_EXTENDED_NAME=OFF

     build-commands:
       - pwd
       - cmake --build . -j ${FLATPAK_BUILDER_N_JOBS}
       - install -Dm755 ${FLATPAK_BUILDER_BUILDDIR}/Engine/srengine /app/bin/srengine
       - mkdir /app/share/SREngine
       - cp -r ../Resources /app/share/SREngine
     builddir: true
     sources:
       - type: git
         url: https://github.com/SpaRcle-Studio/SREngine
         branch: dev


finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --socket=pulseaudio
  - --share=network
