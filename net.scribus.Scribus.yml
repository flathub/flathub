app-id:              net.scribus.Scribus

runtime:             org.kde.Platform
runtime-version:     '5.9'
sdk:                 org.kde.Sdk

command:             scribus
rename-desktop-file: scribus.desktop
rename-appdata-file: scribus.appdata.xml
rename-icon:         scribus

# Mark as snapshot
tags:
  - snapshot
desktop-file-name-prefix: '(Development) '

finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=x11
  # Wayland
  - --socket=wayland
  # Acceleration
  - --device=dri
  # Sound
  - --socket=pulseaudio
  # Ability to edit/save files anywhere
  - --filesystem=host

modules:
  - name: podofo
    buildsystem: cmake-ninja
    config-opts:
      - -DPODOFO_BUILD_LIB_ONLY=1
      - -DPODOFO_BUILD_SHARED=1
      - -DPODOFO_BUILD_STATIC=0
    sources:
      - type:   archive
        url:    https://downloads.sourceforge.net/project/podofo/podofo/0.9.6/podofo-0.9.6.tar.gz
        sha256: e9163650955ab8e4b9532e7aa43b841bac45701f7b0f9b793a98c8ca3ef14072
    cleanup:
      - /include
      - /lib/pkgconfig
      - /bin


  - name: graphicsmagick
    config-opts:
      - --enable-shared
      - --disable-static
      - --with-modules
      - --with-quantum-depth=16
      - --without-jpeg
      - --without-png
      - --without-tiff
      - --without-wmf
    sources:
      - type:   archive
        url:    https://downloads.sourceforge.net/project/graphicsmagick/graphicsmagick/1.3.30/GraphicsMagick-1.3.30.tar.xz
        sha256: d965e5c6559f55eec76c20231c095d4ae682ea0cbdd8453249ae8771405659f1
    cleanup:
      - /include
      - '*.la'
      - /lib/pkgconfig
      - /bin
      - /share/man
      - /share/doc


  - name: poppler
    buildsystem: cmake-ninja
    config-opts:
      - -DENABLE_XPDF_HEADERS=ON
      - -DBUILD_GTK_TESTS=OFF
      - -DBUILD_QT5_TESTS=OFF
      - -DENABLE_UTILS=OFF
      - -DENABLE_GLIB=OFF
      - -DENABLE_QT5=OFF
    sources:
      - type:   archive
        url:    https://poppler.freedesktop.org/poppler-0.68.0.tar.xz
        sha256: f90d04f0fb8df6923ecb0f106ae866cf9f8761bb537ddac64dfb5322763d0e58
    cleanup:
      - /include
      - '*.la'
      - /lib/pkgconfig
    modules:
      - name: popplerdata
        no-autogen: true
        make-install-args:
          - prefix=/app
        sources:
          - type:   archive
            url:    https://poppler.freedesktop.org/poppler-data-0.4.9.tar.gz
            sha256: 1f9c7e7de9ecd0db6ab287349e31bf815ca108a5a175cf906a90163bdbe32012
        cleanup:
          - /share/pkgconfig

      - name: openjpeg2
        buildsystem: cmake-ninja
        config-opts:
          - -DBUILD_CODEC=OFF
        sources:
          - type:   archive
            url:    https://github.com/uclouvain/openjpeg/archive/v2.3.0.tar.gz
            sha256: 3dc787c1bb6023ba846c2a0d9b1f6e179f1cd255172bde9eb75b01f1e6c7d71a
        cleanup:
          - /include
          - '*.a'
          - /lib/pkgconfig
          - /lib/openjpeg-2.3


  - name: ghostscript
    config-opts:
      - --with-system-libtiff
      - --disable-cups
      - --disable-dbus
      - --disable-gtk
      - --enable-dynamic
      - --with-drivers=FILES
    sources:
      - type:   archive
        url:    https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs924/ghostscript-9.24.tar.xz
        sha256: d44917df24979a05e0cb3916531928cc2adc91f5b17b419ee023d16ab31069d6
      - type: shell
        commands:
          - rm -rf libpng/pngread.c
    cleanup:
      - /share/man
      - /share/ghostscript/9.24/doc
      - /share/ghostscript/9.24/examples
      # This is horrible, all we want to do is leave one file
      - dvipdf
      - font2c
      - gsbj
      - gsdj500
      - gslp
      - lprsetup.sh
      - pdf2ps
      - pf2afm
      - printafm
      - ps2epsi
      - ps2pdfwr
      - ps2pdf13
      - ps2ps
      - wftopfa
      - eps2eps
      - gsdj
      - gslj
      - gsnd
      - pdf2dsc
      - pfbtopfa
      - pphs
      - ps2ascii
      - ps2pdf
      - ps2pdf12
      - ps2pdf14
      - ps2ps2
      - unix-lpr.sh


  - name: tkinter
    disabled: true
    subdir: unix
    config-opts:
      - --enable-64bit
    sources:
      - type:   archive
        url:    https://downloads.sourceforge.net/project/tcl/Tcl/8.6.7/tcl8.6.7-src.tar.gz
        sha256: 7c6b8f84e37332423cfe5bae503440d88450da8cc1243496249faa5268026ba5
    post-install:
      - chmod 0755 /app/lib/libtcl8.6.so
      - ln -s /app/bin/tclsh8.6 /app/bin/tclsh


  - name: boost
    buildsystem: simple
    build-commands:
      - mkdir -p /app/include
      - mv boost /app/include
    sources:
      - type:   archive
        url:    https://dl.bintray.com/boostorg/release/1.68.0/source/boost_1_68_0.tar.bz2
        sha256: 7f6130bc3cf65f56a618888ce9d5ea704fa10b462be126ad053e80e553d6d8b7
    cleanup:
      - /include


  - name: cppunit
    config-opts:
      - --disable-static
    sources:
      - type:   archive
        url:    https://dev-www.libreoffice.org/src/cppunit-1.14.0.tar.gz
        sha256: 3d569869d27b48860210c758c4f313082103a5e58219a7669b52bfd29d674780
    cleanup:
      - '*'

  - name: librevenge
    config-opts:
      - --without-docs
    sources:
      - type:   archive
        url:    https://downloads.sourceforge.net/project/libwpd/librevenge/librevenge-0.0.4/librevenge-0.0.4.tar.xz
        sha256: 933f0729f04267cc354b9a02bc3e9afefa5512a3bdd0b45f159ee14a3e3347b2
    cleanup:
      - /include
      - '*.la'
      - /lib/pkgconfig


  - name: libmspub
    config-opts:
      - --without-docs
      - --disable-tools
    sources:
      - type:   archive
        url:    https://dev-www.libreoffice.org/src/libmspub/libmspub-0.1.4.tar.xz
        sha256: ef36c1a1aabb2ba3b0bedaaafe717bf4480be2ba8de6f3894be5fd3702b013ba
    cleanup:
      - /include
      - '*.la'
      - /lib/pkgconfig


  - name: libcdr
    config-opts:
      - --without-docs
      - --disable-tools
    sources:
      - type:   archive
        url:    https://dev-www.libreoffice.org/src/libcdr/libcdr-0.1.4.tar.xz
        sha256: e7a7e8b00a3df5798110024d7061fe9d1c3330277d2e4fa9213294f966a4a66d
      - type: shell
        commands:
          # config.guess is too old
          - cp -p /usr/share/automake-*/config.{sub,guess} .
    cleanup:
      - /include
      - '*.la'
      - /lib/pkgconfig


  - name: libvisio
    config-opts:
      - --without-docs
      - --disable-tools
    sources:
      - type:   archive
        url:    https://dev-www.libreoffice.org/src/libvisio/libvisio-0.1.6.tar.xz
        sha256: fe1002d3671d53c09bc65e47ec948ec7b67e6fb112ed1cd10966e211a8bb50f9
      - type: shell
        commands:
          # config.guess is too old
          - cp -p /usr/share/automake-*/config.{sub,guess} .
    cleanup:
      - /include
      - '*.la'
      - /lib/pkgconfig


  - name: libpagemaker
    config-opts:
      - --without-docs
      - --disable-tools
    sources:
      - type:   archive
        url:    https://dev-www.libreoffice.org/src/libpagemaker/libpagemaker-0.0.4.tar.xz
        sha256: 66adacd705a7d19895e08eac46d1e851332adf2e736c566bef1164e7a442519d
    cleanup:
      - /include
      - '*.la'
      - /lib/pkgconfig


  - name: libfreehand
    config-opts:
      - --without-docs
      - --disable-tools
    sources:
      - type:   archive
        url:    https://dev-www.libreoffice.org/src/libfreehand/libfreehand-0.1.2.tar.xz
        sha256: 0e422d1564a6dbf22a9af598535425271e583514c0f7ba7d9091676420de34ac
    cleanup:
      - /include
      - '*.la'
      - /lib/pkgconfig


  - name: libqxp
    config-opts:
      - --without-docs
      - --disable-tools
    sources:
      - type:   archive
        url:    https://dev-www.libreoffice.org/src/libqxp/libqxp-0.0.1.tar.xz
        sha256: 8c257f6184ff94aefa7c9fa1cfae82083d55a49247266905c71c53e013f95c73
    cleanup:
      - /include
      - '*.la'
      - /lib/pkgconfig


  - name: libzmf
    config-opts:
      - --without-docs
      - --disable-tools
      - --disable-werror
    sources:
      - type:   archive
        url:    https://dev-www.libreoffice.org/src/libzmf/libzmf-0.0.2.tar.xz
        sha256: 27051a30cb057fdb5d5de65a1f165c7153dc76e27fe62251cbb86639eb2caf22
    cleanup:
      - /include
      - '*.la'
      - /lib/pkgconfig


  - name: scribus
    buildsystem: cmake-ninja
    config-opts:
      - -DWANT_GRAPHICSMAGICK=1
    post-install:
      - mv /app/share/mime/packages/scribus.xml /app/share/mime/packages/net.scribus.Scribus.xml
      # Use system hyphen
      - rm -rf /app/share/scribus/dicts/hyph
      - ln -sf /usr/share/hyphen /app/share/scribus/dicts/hyph
    sources:
      - type:   archive
        url:    https://sourceforge.net/projects/scribus/files/scribus-devel/1.5.4/scribus-1.5.4.tar.xz
        sha256: 6480925250b2bb07028e2f378c02b67fe3e33206743671e03c07c701cd05da03
      - type:   patch
        path:   fix-15289.patch
      - type:   patch
        path:   fix-15289-2.patch
