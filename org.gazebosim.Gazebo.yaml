app-id: org.gazebosim.Gazebo
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '5.15'
command: gazebo
#rename-icon: gazebo.png
#rename-desktop-file: gazebo.desktop
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
  - --filesystem=home
cleanup:
  - /include
  - /lib/cmake
  - /share/doc
  - "*.la"
  - "*.a"

modules:
  - shared-modules/glew/glew.json
  #- shared-modules/glu/glu-9.json
  
  - name: glu-static
    sources:
      - type: archive
        url: https://mesa.freedesktop.org/archive/glu/glu-9.0.1.tar.xz
        sha256: fb5a4c2dd6ba6d1c21ab7c05129b0769544e1d68e1e3b0ffecb18e73c93055bc

  #- name: python3-numpy
    #buildsystem: simple
    #build-commands:
      #- rm pyproject.toml
      #- pip3 install --prefix=${FLATPAK_DEST} .
    #sources:
      #- type: archive
        #url: https://files.pythonhosted.org/packages/d2/48/f445be426ccd9b2fb64155ac6730c7212358882e589cd3717477d739d9ff/numpy-1.20.1.zip
        #sha256: 3bc63486a870294683980d76ec1e3efc786295ae00128f9ea38e2c6e74d5a60a

  #- name: Eigen3
    #buildsystem: cmake-ninja
    #builddir: true
    #sources:
      #- type: archive
        #url: https://gitlab.com/libeigen/eigen/-/archive/3.3.9/eigen-3.3.9.tar.bz2
        #sha256: 0fa5cafe78f66d2b501b43016858070d52ba47bd9b1016b0165a7b8e04675677
    #cleanup: 
      #- "*"

  - name: HDF5
    sources:
      - type: archive
        url: https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.12/hdf5-1.12.0/src/hdf5-1.12.0.tar.gz
        sha256: a62dcb276658cb78e6795dd29bf926ed7a9bc4edf6e77025cd2c689a8f97c17a
    cleanup:
      - "/share/hdf5_examples"

  - name: Protobuf
    buildsystem: cmake
    subdir: cmake
    config-opts:
      - -Dprotobuf_BUILD_TESTS:BOOL=OFF
      - -Dprotobuf_BUILD_EXAMPLES:BOOL=OFF
    sources:
      - type: archive
        url: https://github.com/protocolbuffers/protobuf/releases/download/v3.15.6/protobuf-cpp-3.15.6.tar.gz
        sha256: bbdfb7455431d7d58666e8a2996d14b236718ff238eecde10646581e4c87f168
        
  - name: lapack
    buildsystem: cmake
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_SHARED_LIBS=ON
      - -DBUILD_TESTING=OFF
      - -DLAPACKE=ON
      - -DCBLAS=ON
    sources:
      - type: archive
        url: https://github.com/Reference-LAPACK/lapack/archive/v3.9.0.tar.gz
        sha256: 106087f1bb5f46afdfba7f569d0cbe23dacb9a07cd24733765a0e89dbe1ad573
    cleanup:
      - /lib/cmake

  - name: Simbody
    buildsystem: cmake
    config-opts:
      - -DINSTALL_DOCS:BOOL=OFF
      - -DBUILD_TESTS_AND_EXAMPLES_STATIC:BOOL=OFF
    sources:
      - type: archive
        url: https://github.com/simbody/simbody/archive/refs/tags/Simbody-3.7.tar.gz
        sha256: d371a92d440991400cb8e8e2473277a75307abb916e5aabc14194bea841b804a
        
  - name: ORGE
    buildsystem: cmake
    config-opts:
      - -DOGRE_INSTALL_DOCS:BOOL=OFF
      - -DOGRE_BUILD_COMPONENT_OVERLAY_IMGUI:BOOL=OFF
      - -DOGRE_BUILD_SAMPLES:BOOL=OFF
      - -DOGRE_BUILD_TESTS:BOOL=OFF
    sources:
      - type: archive
        url: https://github.com/OGRECave/ogre/archive/v1.12.12.zip
        sha256: 87cef6258d65bb03207e150fcd89b9b94ef94609ef657c29ef4991d0777de741
      #- type: git
        #url: https://github.com/OGRECave/ogre
        #tag: v1.12.12
    modules:
      - name: pugixml
        buildsystem: cmake
        sources:
          - type: archive
            url: https://github.com/zeux/pugixml/releases/download/v1.11.4/pugixml-1.11.4.tar.gz
            sha256: 8ddf57b65fb860416979a3f0640c2ad45ddddbbafa82508ef0a0af3ce7061716
            
  - name: gperftools
    sources:
      - type: archive
        url: https://github.com/gperftools/gperftools/archive/refs/tags/gperftools-2.9.1.tar.gz
        sha256: ea566e528605befb830671e359118c2da718f721c27225cbbc93858c7520fee3
        
  - name: Eigen3
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://gitlab.com/libeigen/eigen/-/archive/3.3.9/eigen-3.3.9.tar.bz2
        sha256: 0fa5cafe78f66d2b501b43016858070d52ba47bd9b1016b0165a7b8e04675677
    cleanup: 
      - "*"
        
  - name: DART
    buildsystem: cmake
    build-options:
      env:
        LIBRARY_PATH: "/app/lib:/usr/lib"
        LD_LIBRARY_PATH: "/app/lib:/usr/lib"
    sources:
      - type: archive
        url: https://github.com/dartsim/dart/archive/refs/tags/v6.6.2.tar.gz
        sha256: 3ac648fdac0633a2ea4dac37f78e37e5ced6edc2d82c3e2e9b7d8b7793df0845
    modules:
      - name: libccd
        buildsystem: cmake-ninja
        sources:
          - type: archive
            url: https://github.com/danfis/libccd/archive/refs/tags/v2.1.tar.gz
            sha256: 542b6c47f522d581fbf39e51df32c7d1256ac0c626e7c2b41f1040d4b9d50d1e
      - name: libQGLViewer
        buildsystem: qmake
        subdir: QGLViewer
        build-options:
          env:
            LIBRARY_PATH: "/app/lib:/usr/lib"
            LD_LIBRARY_PATH: "/app/lib:/usr/lib"
        config-opts:
          - LIB_DIR=/app/lib
          - INCLUDE_DIR=/app/include
          - PREFIX=/app
        sources:
          - type: archive
            url: http://www.libqglviewer.com/src/libQGLViewer-2.7.2.tar.gz
            sha256: e2d2799dec5cff74548e951556a1fa06a11d9bcde2ce6593f9c27a17543b7c08
        # Optional dep for FCL    
      - name: OctoMap
        builddir: true
        buildsystem: cmake
        sources:
          - type: archive
            url: https://github.com/OctoMap/octomap/archive/refs/tags/v1.9.6.tar.gz
            sha256: 0f88c1c024f0d29ab74c7fb9f6ebfdddc8be725087372c6c4d8878be95831eb6
      - name: FCL
        buildsystem: cmake
        config-opts:
          - -DBUILD_TESTING:BOOL=OFF
          - -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON
        sources:
          - type: archive
            url: https://github.com/flexible-collision-library/fcl/archive/refs/tags/v0.6.1.tar.gz
            sha256: c8a68de8d35a4a5cd563411e7577c0dc2c626aba1eef288cb1ca88561f8d8019
      - name: ASSIMP
        buildsystem: cmake-ninja
        config-opts:
          - -DASSIMP_BUILD_TESTS:BOOL=OFF
          - -DASSIMP_BUILD_DOCS:BOOL=OFF
        sources:
          - type: archive
            url: https://github.com/assimp/assimp/archive/refs/tags/v5.0.1.tar.gz
            sha256: 11310ec1f2ad2cd46b95ba88faca8f7aaa1efe9aa12605c55e3de2b977b3dbfc
      - name: Boost
        buildsystem: simple
        build-commands:
          - ./bootstrap.sh --prefix=/app
          - ./b2 install --build-type=complete link=shared --layout=versioned runtime-link=shared cxxflags="$CXXFLAGS" linkflags="$LDFLAGS" -j $FLATPAK_BUILDER_N_JOBS
        sources:
          - type: archive
            url: https://dl.bintray.com/boostorg/release/1.75.0/source/boost_1_75_0.tar.gz
            sha256: aeb26f80e80945e82ee93e5939baebdca47b9dee80a07d3144be1e1a6a66dd6a

  - name: Gazebo
    buildsystem: cmake
    config-opts:
      - -DHDF5_INCLUDE_DIRS:PATH=/app/include
      #- -DENABLE_TESTING:BOOL=OFF
      #- -DBUILD_DOCUMENTATION:BOOL=OFF
      #- -DCMAKE_BUILD_TYPE:STRING=Release
    #post-install:
      #- install -Dm644 avogadro/icons/avogadro2_64.png ${FLATPAK_DEST}/share/icons/hicolor/64x64/apps/$FLATPAK_ID.png
      #- install -Dm644 avogadro/icons/avogadro2_128.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/$FLATPAK_ID.png
      #- install -Dm644 avogadro/icons/avogadro2_256.png ${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/$FLATPAK_ID.png
      #- install -Dm644 avogadro/icons/avogadro2_512.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/$FLATPAK_ID.png
      #- desktop-file-edit --set-key=Icon --set-value=$FLATPAK_ID ${FLATPAK_DEST}/share/applications/avogadro2.desktop
      #- install -Dm644 $FLATPAK_ID.metainfo.xml ${FLATPAK_DEST}/share/metainfo/$FLATPAK_ID.metainfo.xml
    sources:
      - type: archive
        url: https://github.com/osrf/gazebo/archive/refs/tags/gazebo11_11.5.0.tar.gz
        sha256: cd46d85e01aa40ad181a7b0afcbe23dfd13ecdfb6ea37b881655205d8fc1aec0
      - type: file
        path: org.gazebosim.Gazebo.metainfo.xml
    modules:
      - name: libxml2
        buildsystem: cmake-ninja
        sources:
          - type: archive
            url: https://gitlab.gnome.org/GNOME/libxml2/-/archive/v2.9.10/libxml2-v2.9.10.tar.gz
            sha256: f07dab13bf42d2b8db80620cce7419b3b87827cc937c8bb20fe13b8571ee9501
