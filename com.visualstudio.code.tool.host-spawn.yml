id: com.visualstudio.code.tool.host-spawn
branch: "22.08"
build-extension: true
sdk: org.freedesktop.Sdk//22.08
runtime: com.visualstudio.code
runtime-version: stable
separate-locales: false
appstream-compose: false
build-options:
  prefix: /app/tools/host-spawn
  strip: true
cleanup:
  - "*.a"
  - "*.la"
  - /share/man
modules:
  - name: host-spawn
    buildsystem: simple
    build-commands:
      - install -Dm755 host-spawn -t ${FLATPAK_DEST}/bin
    sources:
      - type: file
        only-arches: [x86_64]
        url: https://github.com/1player/host-spawn/releases/download/1.4.2/host-spawn-x86_64
        sha256: 1c6afd5365cea636397cb03dc8bce7a3c80d806f2199f40f22d3e57fb527dfe0
        dest-filename: host-spawn
        x-checker-data:
          type: json
          url: https://api.github.com/repos/1player/host-spawn/releases/latest
          version-query: .tag_name
          url-query: .assets[] | select(.name | contains("x86_64")) | .browser_download_url
      - type: file
        only-arches: [aarch64]
        url: https://github.com/1player/host-spawn/releases/download/1.4.2/host-spawn-aarch64
        sha256: 128044fbcc8bef27ac5d20b5c799900b48fcab674c46d9f2dd71c50a4d76fef5
        dest-filename: host-spawn
        x-checker-data:
          type: json
          url: https://api.github.com/repos/1player/host-spawn/releases/latest
          version-query: .tag_name
          url-query: .assets[] | select(.name | contains("aarch64")) | .browser_download_url
  - name: bundle-setup
    buildsystem: simple
    build-commands:
      - install -Dm644 ${FLATPAK_ID}.metainfo.xml -t ${FLATPAK_DEST}/share/metainfo
      - appstream-compose --basename=${FLATPAK_ID} --prefix=${FLATPAK_DEST} --origin=flatpak
        ${FLATPAK_ID}
    sources:
      - type: file
        path: com.visualstudio.code.tool.host-spawn.metainfo.xml
