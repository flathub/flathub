{
  "id": "org.keepassxc.KeePassXC",
  "runtime": "org.kde.Platform",
  "runtime-version": "5.9",
  "sdk": "org.kde.Sdk",
  "command": "keepassxc",
  "rename-icon": "keepassxc",
  "finish-args": [
    /* X11 + XShm access */
    "--share=ipc", "--socket=x11",
    /* Notification access */
    "--talk-name=org.freedesktop.Notifications",
    /* Screen Lock Listener */
    "--talk-name=org.freedesktop.login1.Manager",
    "--talk-name=org.freedesktop.ScreenSaver",
    "--talk-name=org.gnome.SessionManager",
    "--talk-name=org.gnome.SessionManager.Presence",
    "--talk-name=com.canonical.Unity.Session",
    /* KeePassHTTP */
    "--share=network",
    /* YubiKey USB access */
    "--device=all"
  ],
  "cleanup": [
    "*.a",
    "*.h",
    "*.la",
    "/include",
    "/lib/pkgconfig"
  ],
  "modules": [
    {
      "name": "keepassxc",
      "buildsystem": "cmake",
      "config-opts": [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DWITH_TESTS=OFF",
        "-DWITH_XC_AUTOTYPE=ON",
        "-DWITH_XC_HTTP=ON",
        "-DWITH_XC_YUBIKEY=ON"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/keepassxreboot/keepassxc/releases/download/2.2.2/keepassxc-2.2.2-src.tar.xz",
          "sha256": "2f55784f7e6d3a840575e1768a3e5ae03986c2f6a70029dd6b9f9bb0fa443473"
        },
        {
          /* Backport of upstream patch */
          "type": "patch",
          "path": "keepassxc-id-fix.patch"
        }
      ],
      "post-install": [
        "for f in COPYING LICENSE*; do install -Dm644 $f /app/share/licenses/org.keepassxc.KeePassXC/$f; done"
      ],
      "cleanup": [ "keepassxc-cli" ],
      "modules": [
        {
          "name": "libusb",
          "config-opts": [ "--disable-static", "--disable-udev", "--prefix=/app" ],
          "sources": [{
            "type": "git",
            "url": "https://github.com/libusb/libusb.git",
            "branch": "v1.0.21"
          }],
          "post-install": [
            "install -Dm644 COPYING /app/share/licenses/libusb/COPYING"
          ]
        },
        {
          "name": "libyubikey",
          "sources": [
            {
              "type": "git",
              "url": "https://github.com/Yubico/yubico-c.git",
              "branch": "libyubikey-1.13"
            },
            {
              "type": "script",
              "dest-filename": "autogen.sh",
              "commands": [ "autoreconf --install" ]
            }
          ],
          "post-install": [
            "install -Dm644 COPYING /app/share/licenses/libyubikey/COPYING"
          ],
          "cleanup": [ "/bin", "/share/man" ],
          "modules": [
            {
              "name": "a2x",
              "sources": [{
                "type": "archive",
                "url": "https://downloads.sourceforge.net/project/asciidoc/asciidoc/8.6.9/asciidoc-8.6.9.tar.gz",
                "sha256": "78db9d0567c8ab6570a6eff7ffdf84eadd91f2dfc0a92a2d0105d323cab4e1f0"
              }],
              "cleanup": [ "*" ]
            }
          ]
        },
        {
          "name": "libykpers-1",
          "sources": [
            {
              "type": "git",
              "url": "https://github.com/Yubico/yubikey-personalization.git",
              "branch": "v1.18.0"
            },
            {
              "type": "script",
              "dest-filename": "autogen.sh",
              "commands": [ "autoreconf --install" ]
            }
          ],
          "post-install": [
            "install -Dm644 COPYING /app/share/licenses/libykpers-1/COPYING"
          ],
          "cleanup": [ "/bin", "/share/man" ]
        }
      ]
    }
  ]
}
