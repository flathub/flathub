id: org.kde.discover
runtime: org.kde.Platform
runtime-version: '6.9'
sdk: org.kde.Sdk
command: plasma-discover
base: io.qt.qtwebengine.BaseApp
base-version: '6.9'
finish-args:
    - --share=ipc
    - --share=network
    - --socket=fallback-x11
    - --socket=wayland
    - --talk-name=org.freedesktop.Notifications
    - --talk-name=org.freedesktop.Flatpak
    - --filesystem=/var/lib/flatpak
    - --system-talk-name=org.freedesktop.Flatpak.SystemHelper
    - --filesystem=/var/tmp

modules:
  - name: discover
    config-opts:
      - -DBUILD_TESTING=OFF
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DWITH_KCM=OFF
      - -DWITH_NOTIFIER=OFF
    buildsystem: cmake-ninja
    sources:
      - type: archive
      #- type: git
        #url: https://invent.kde.org/plasma/discover
        #commit: db7bfb6c1e84970be11b33acae0eec7b17dab237
        url: https://download.kde.org/stable/plasma/6.4.5/discover-6.4.5.tar.xz
        sha256: 9208d4e37ad2ae4cd1da7cd3b01ede61071a13898ec4c14edffe983b972f8576
        #tag: "v6.4.5"
        x-checker-data:
          type: anitya
          project-id: 236343
          stable-only: true
          url-template: https://download.kde.org/stable/release-service/$version/src/discover-$version.tar.xz

    modules:
    - name: kuserfeedback
      config-opts:
        - -DBUILD_TESTING=OFF
        - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      buildsystem: cmake-ninja
      sources:
        #- type: git
        - type: archive
          #url: https://invent.kde.org/frameworks/kuserfeedback
          url: https://download.kde.org/stable/frameworks/6.17/kuserfeedback-6.17.0.tar.xz
          sha256: 0f1b5361ffa6fff12ec3dfd7a3e4b1b2aa6ebadc4afcc03a9d31c2d49bec7caf
          #commit: 2657c47a3e462c79d5686f256073cf7d749e28b5
          #tag: "v6.17.0"
    - name: appsream
      config-opts:
        - -Dqt=true
        - -Dstemming=false
        - -Dcompose=true
      buildsystem: meson
      builddir: true
      sources:
        - type: git
          url: https://github.com/ximion/appstream.git
          commit: 8af1b8b61c5682751cec21c5b644cb1b8d20d5c6
          x-checker-data:
            type: anitya
            project-id: 10385
            stable-only: true

      modules:
        - name: gi-docgen
          config-opts:
            - -Ddevelopment_tests=false
          buildsystem: meson
          builddir: true
          sources:
            - type: git
              url: https://gitlab.gnome.org/GNOME/gi-docgen
              commit: 0517026e0bf51b3776efa4689da44ea0c99e343e
              tag: "2025.4"
          modules:
            - python-deps.yaml



    - name: flatpak
      buildsystem: meson
      config-opts:
        - -Dgtkdoc=disabled
        - -Ddocbook_docs=disabled
        - -Dtests=false
        - -Dman=disabled
        - -Dseccomp=disabled
        - -Dselinux_module=disabled
        - -Dmalcontent=disabled
        - -Dsandboxed_triggers=false
        - -Dsystem_helper=enabled
        - -Dhttp_backend=curl
        - -Dsystemd=disabled
        - -Dsystem_install_dir=/var/lib/flatpak
        - -Dsystem_bubblewrap=bwrap
        - -Dsystem_dbus_proxy=xdg-dbus-proxy
        - --sysconfdir=/var/run/host/etc
      cleanup:
        - /bin/flatpak-bisect
        - /bin/flatpak-coredumpctl
        - /etc/profile.d
        - /lib/systemd
        - /share/dbus-1/interfaces/org.freedesktop.*
        - /share/dbus-1/services/org.freedesktop.*
        - /share/flatpak/triggers
        - /share/gdm
        - /share/zsh
      post-install:
        - install -Dpm0755 -t /app/bin /usr/bin/update-{mime,desktop}-database
      sources:
        - type: archive
          url: https://github.com/flatpak/flatpak/archive/refs/tags/1.16.1.tar.gz
          sha256: 281aa7e35efa0899fefaf7eba923e8ff117f7c03726c7f73b2ac296dae2daf37
          x-checker-data:
            type: anitya
            project-id: 6377
            url-template: https://github.com/flatpak/flatpak/archive/refs/tags/$version.tar.gz'
      modules:
         - shared-modules/intltool/intltool-0.51.json
         - name: polkit
           config-opts:
             - --disable-polkitd
             - --disable-man-pages
             - --disable-introspection
             - --disable-examples
             - --disable-gtk-doc
             - --disable-libelogind
             - --disable-libsystemd-login
             - --with-systemdsystemunitdir=no
             - --with-authdb=dummy
             - --with-authfw=none
           rm-configure: true
           build-options:
             cflags: -Wno-implicit-function-declaration
           cleanup:
             - /bin/*
             - /etc/pam.d
             - /etc/dbus-1
             - /share/dbus-1/system-services/*
             - /share/polkit-1
             - /lib/polkit-1
           sources:
             # TODO: update this version once patch is fully up-to-date with 126+ polkit
             - type: archive
               url: https://www.freedesktop.org/software/polkit/releases/polkit-0.116.tar.gz
               sha256: 88170c9e711e8db305a12fdb8234fac5706c61969b94e084d0f117d8ec5d34b1
             - type: patch
               path: polkit-build-Add-option-to-build-without-polkitd.patch
             - type: script
               dest-filename: autogen.sh
               commands:
                 - |
                   gtkdocize --flavour no-tmpl
                   autoreconf -if

         - name: libfuse
           build-options:
             env:
               MOUNT_FUSE_PATH: ../tmp/
           config-opts:
             - UDEV_RULES_PATH=/app/etc/udev/rules.d
             - INIT_D_PATH=/app/etc/init.d
           cleanup:
             - /bin/ulockmgr_server
           post-install:
             - install -Dpm0755 ./fusermount-wrapper.sh /app/bin/fusermount
           sources:
             - type: archive
               url: https://github.com/libfuse/libfuse/releases/download/fuse-2.9.9/fuse-2.9.9.tar.gz
               sha256: d0e69d5d608cc22ff4843791ad097f554dd32540ddc9bed7638cc6fea7c1b4b5
             - type: patch
               path: fuse-2.9.2-namespace-conflict-fix.patch
             - type: patch
               path: fuse-disable-sys-mount-under-flatpak.patch
             - type: patch
               path: fuse-2.9.2-closefrom.patch
             - type: file
               path: fusermount-wrapper.sh

         - name: ostree
           build-options:
             env:
               BASH_COMPLETIONSDIR: /app/share/bash-completion/completions
             config-opts:
               - --disable-man
               - --with-curl
               - --without-libsystemd
           cleanup:
             - /bin
             - /etc/grub.d
             - /etc/ostree
             - /share/ostree
             - /libexec
           sources:
             - type: git
               url: https://github.com/ostreedev/ostree
               tag: v2025.6
               commit: 82185d9aaf0a79b100378f13a54c3d5d3763a971
               x-checker-data:
                 type: anitya
                 project-id: 10899
                 tag-template: v$version

           modules:
             - pyparsing.yaml
         - name: bubblewrap
           buildsystem: meson
           config-opts:
             - -Dman=disabled
             - -Dselinux=disabled
             - -Dtests=false
           sources:
             - type: archive
               url: https://github.com/containers/bubblewrap/archive/refs/tags/v0.11.0.tar.gz
               sha256: cfeeb15fcc47d177d195f06fdf0847e93ee3aa6bf46f6ac0a141fa142759e2c3
               x-checker-data:
                 type: anitya
                 project-id: 10937
                 url-template: https://github.com/containers/bubblewrap/archive/refs/tags/v$version.tar.gz
         - name: xdg-dbus-proxy
           buildsystem: meson
           config-opts:
             - -Dman=disabled
             - -Dtests=false
           sources:
             - type: archive
               url: https://github.com/flatpak/xdg-dbus-proxy/archive/refs/tags/0.1.6.tar.gz
               sha256: ee9c1d665f4e3b025a83d522d478ff7930070f2817fc2cb446db0dca93c990b1
               x-checker-data:
                 type: anitya
                 project-id: 58434
                 url-template: https://github.com/flatpak/xdg-dbus-proxy/archive/refs/tags/$version.tar.gz

 






  







