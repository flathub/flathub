app-id: io.github.ceprogramming.cemu
runtime: org.kde.Platform
runtime-version: '5.15-23.08'
sdk: org.kde.Sdk
command: CEmu

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri

modules:
  - name: libpng
    sources:
      - type: git
        url: https://github.com/pnggroup/libpng.git
        commit: ed217e3e601d8e462f7fd1e04bed43ac42212429
        tag: v1.6.43
      - type: file
        url: https://downloads.sourceforge.net/sourceforge/libpng-apng/libpng-1.6.43-apng.patch.gz
        sha256: d107579e90d55386d00e6086ea750942f22a04b9ab476bba0c660770cefafe22
      - type: shell
        commands:
          - gzip -d libpng-1.6.43-apng.patch.gz
          - patch -Np1 -i libpng-1.6.43-apng.patch
        
  
  - name: cemu
    buildsystem: simple
    build-commands:
      - cd gui/qt && qmake -r CEmu.pro "PREFIX=${FLATPAK_DEST}" && make && make install
      - cp gui/qt/resources/linux/cemu.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - desktop-file-edit ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop --set-icon=${FLATPAK_ID}
      - |
        for res in 16x16 20x20 22x22 24x24 32x32 36x36 40x40 42x42 48x48 64x64 72x72 96x96 128x128 160x160 192x192 256x256 512x512
        do
          mkdir -p ${FLATPAK_DEST}/share/icons/hicolor/${res}/apps/ && cp gui/qt/resources/icons/linux/cemu-${res}.png ${FLATPAK_DEST}/share/icons/hicolor/${res}/apps/${FLATPAK_ID}.png
        done
      - install -Dm644 "${FLATPAK_ID}.metainfo.xml" -t ${FLATPAK_DEST}/share/metainfo
    sources:
      - type: git
        url: https://github.com/CE-Programming/CEmu.git
        commit: f3d4bb511beefb1de2c45166f9781939de1913d5
      - type: file
        path: io.github.ceprogramming.cemu.metainfo.xml
