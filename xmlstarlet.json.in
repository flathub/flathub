{
    "name": "xmlstarlet",
    // remove configure script to run autoreconf
    //"rm-configure": true,
    //"no-autogen": true,
    //"no-parallel-make": true,
    "config-opts": [
        // We don't need it after complete build
        "--disable-static-libs",
        "--with-libxml-libs-prefix=/usr/lib",
        "--with-libxml-include-prefix=/usr/include/libxml2",
        "--prefix=/app/opt/xmlstarlet",
        "--exec-prefix=/app/opt/xmlstarlet"
    ],
    "sources": [
        {
            // Source0
            "type": "archive",
            "url": "http://downloads.sourceforge.net/xmlstar/xmlstarlet-1.6.1.tar.gz",
            "sha256": "15d838c4f3375332fd95554619179b69e4ec91418a3a5296e7c631b7ed19e7ca"
        },
        {
            // Patch0
            // https://sourceforge.net/p/xmlstar/bugs/109/
            "type": "patch",
            "path": "xmlstarlet-1.6.1-nogit.patch",
            "strip-components": 1,
            "sha256": "c54485c5e2bd038219884250228333113a9751e999baa28a833a679f79421890"
        },
        // checking for xml2-config... /bin/xml2-config
        // ERROR: /usr/bin/xml2-config should not be used, use an alternative such as pkg-config
        // configure: error: xmlstarlet needs at least libxml version 2.6.27 (http://www.xmlsoft.org/)
        // Error: module xmlstarlet: Child process exited with code 1
        // checking for xslt-config... /bin/xslt-config
        // ERROR: /usr/bin/xslt-config should not be used, use an alternative such as pkg-config
        // configure: error: xmlstarlet needs at least libxslt version 1.1.9 (http://www.xmlsoft.org/)
        // Error: module xmlstarlet: Child process exited with code 1
        {
            "type": "patch",
            "path": "xmlstarlet-1.6.1-pkg-config.patch",
            "strip-components": 1,
            "sha256": "e89019f1e9da772245cb2dfba5e24c96878ba055822520bd4d66a33deeb3ac00"
        },
        //{
        //    "type": "shell",
        //    "commands": [
        //        "echo 'fix configure: xml2 & xslt';",
        //        "sed -r -i 's/^([[:blank:]]*XSTAR_LIB_CHECK[[:blank:]]*\\(\\[LIBXML\\],[[:blank:]]*\\[)xml2-config(\\]\\))/\\1pkg-config libxml-2.0\\2/' 'configure.ac';",
        //        "sed -r -i 's/^([[:blank:]]*XSTAR_LIB_CHECK[[:blank:]]*\\(\\[LIBXSLT\\],[[:blank:]]*\\[)xslt-config(\\]\\))/\\1pkg-config libxslt\\2/' 'configure.ac';",
        //        "grep -Ei 'XSTAR_LIB_CHECK' 'configure.ac' || :;"
        //    ]
        //},
        {
            "type": "patch",
            "path": "xmlstarlet-1.6.1-deps.patch",
            "strip-components": 1,
            "sha256": "b182fa395d3bf9b2777446db1ada35abd77bd7d1ef59823cde38c5b0c2f68267"
        },
        //{
        //    "type": "shell",
        //    "commands": [
        //        "echo 'fix configure: xml2 & xslt version';",
        //        "sed -r -i 's/^(\\[LIBXML_REQUIRED_VERSION=)/#\\1/' 'configure.ac';",
        //        "sed -r -i 's/^(\\[LIBXSLT_REQUIRED_VERSION=)/#\\1/' 'configure.ac';",
        //        "grep -Ei '_REQUIRED_VERSION' 'configure.ac' || :;"
        //    ]
        //},
        {
            "type": "shell",
            "commands": [
                "echo 'autoreconf';",
                "cp -p /usr/share/automake-*/config.{sub,guess} .;",
                "autoreconf -i;"
            ]
        }
    ],
    "post-install": [
        // symlink
        "echo 'post-install: symlink';",
        "[[ -f '/app/opt/xmlstarlet/bin/xmlstarlet' ]] || ln -s 'xml' '/app/opt/xmlstarlet/bin/xmlstarlet';",
        "echo 'post-install: docs';",
        "install -d '/app/opt/xmlstarlet/share/doc/xmlstarlet'; install -p -m 0644 'AUTHORS' 'ChangeLog' 'INSTALL' 'NEWS' 'README' 'TODO' '/app/opt/xmlstarlet/share/doc/xmlstarlet/';",
        "echo 'post-install: licenses';",
        "install -d '/app/opt/xmlstarlet/share/licenses/xmlstarlet'; install -p -m 0644 'COPYING' 'Copyright' '/app/opt/xmlstarlet/share/licenses/xmlstarlet/';"
    ],
    "cleanup": [
        "/opt/xmlstarlet/share/doc",
        "/opt/xmlstarlet/share/man"
    ]
}
