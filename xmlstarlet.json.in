{
    "name": "xmlstarlet",
    "config-opts": [
        // We don't need it after complete build
        "--prefix=/app/opt/xmlstarlet",
        "--exec-prefix=/app/opt/xmlstarlet",
        "--disable-static-libs",
        "--with-libxml-libs-prefix=/usr/lib",
        "--with-libxml-include-prefix=/usr/include/libxml2"
    ],
    // remove configure script to run autoreconf
    //"rm-configure": true,
    "sources": [
        {
            "type": "archive",
            "url": "http://downloads.sourceforge.net/xmlstar/xmlstarlet-1.6.1.tar.gz",
            "sha256": "15d838c4f3375332fd95554619179b69e4ec91418a3a5296e7c631b7ed19e7ca"
        },
        // checking for xml2-config... /bin/xml2-config
        // ERROR: /usr/bin/xml2-config should not be used, use an alternative such as pkg-config
        // configure: error: xmlstarlet needs at least libxml version 2.6.27 (http://www.xmlsoft.org/)
        // Error: module xmlstarlet: Child process exited with code 1
        // checking for xslt-config... /bin/xslt-config
        // ERROR: /usr/bin/xslt-config should not be used, use an alternative such as pkg-config
        // configure: error: xmlstarlet needs at least libxslt version 1.1.9 (http://www.xmlsoft.org/)
        // Error: module xmlstarlet: Child process exited with code 1
        {
            "type": "shell",
            "commands": [
                "sed -r -i 's/^([[:blank:]]*XSTAR_LIB_CHECK[[:blank:]]*\\(\\[LIBXML\\],[[:blank:]]*\\[)xml2-config(\\]\\))/\\1pkg-config libxml-2.0\\2/' 'configure.ac';",
                "sed -r -i 's/^([[:blank:]]*XSTAR_LIB_CHECK[[:blank:]]*\\(\\[LIBXSLT\\],[[:blank:]]*\\[)xslt-config(\\]\\))/\\1pkg-config libxslt\\2/' 'configure.ac';",
                "grep -Ei 'XSTAR_LIB_CHECK' 'configure.ac' || :;"
            ]
        },
        {
            "type": "shell",
            "commands": [
                "sed -r -i 's/^(\\[LIBXML_REQUIRED_VERSION=)/#\\1/' 'configure.ac';",
                "sed -r -i 's/^(\\[LIBXSLT_REQUIRED_VERSION=)/#\\1/' 'configure.ac';",
                "grep -Ei '_REQUIRED_VERSION' 'configure.ac' || :;"
            ]
        },
        {
            "type": "shell",
            "commands": [
                "autoreconf -i;"
            ]
        }
    ],
    "post-install": [
        // symlink
        "echo 'post-install: symlink';",
        "[[ -f '/app/opt/xmlstarlet/bin/xmlstarlet' ]] || ln -s 'xml' '/app/opt/xmlstarlet/bin/xmlstarlet';"
    ],
    "cleanup": [
        "/opt/xmlstarlet/share/doc",
        "/opt/xmlstarlet/share/man"
    ]
}
