id: org.freedesktop.Platform.GL.amf
branch: '24.08'
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
build-extension: true
separate-locales: false
modules:
  - name: amf
    buildsystem: simple
    build-commands:
      - install -Dm644 ${FLATPAK_ID}.metainfo.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml
      - install -Dm755 apply_extra ${FLATPAK_DEST}/bin/apply_extra
      - ln -s extra/lib/${FLATPAK_ARCH}-linux-gnu ${FLATPAK_DEST}/lib
    sources:
      - type: extra-data
        filename: amf-amdgpu-pro.deb
        size: 4624468
        only-arches:
          - x86_64
        url: https://repo.radeon.com/amdgpu/6.4.2.1/ubuntu/pool/proprietary/a/amf-amdgpu-pro/amf-amdgpu-pro_1.4.37-2187634.22.04_amd64.deb
        sha256: c6f5b80ef1a4b2ef24aaa5688679659038618dc4fb38378b1e3d96faee7c3541
      - type: extra-data
        size: 268664
        only-arches:
          - x86_64
        filename: libamdenc-amdgpu-pro.deb
        url: https://repo.radeon.com/amdgpu/6.4.2.1/ubuntu/pool/proprietary/liba/libamdenc-amdgpu-pro/libamdenc-amdgpu-pro_25.10-2187634.22.04_amd64.deb
        sha256: 6dc87bc1bed2caabbd2c29effc3e95c39590069f07c382809906bb9e232c78a9
      - type: script
        dest-filename: apply_extra
        commands:
          - bsdtar -O -xf amf-amdgpu-pro.deb data.tar.xz | bsdtar --strip-components=3 --no-same-owner -xf - opt/amdgpu-pro
          - bsdtar -O -xf libamdenc-amdgpu-pro.deb data.tar.xz | bsdtar --strip-components=3 --no-same-owner -xf - opt/amdgpu-pro
          - bsdtar -O -xf amf-amdgpu-pro.deb data.tar.xz | bsdtar --strip-components=3 --no-same-owner -xf - usr/share/doc
          - bsdtar -O -xf libamdenc-amdgpu-pro.deb data.tar.xz | bsdtar --strip-components=3 --no-same-owner -xf - usr/share/doc
          - rm libamdenc-amdgpu-pro.deb amf-amdgpu-pro.deb
      - type: file
        path: org.freedesktop.Platform.GL.amf.metainfo.xml
