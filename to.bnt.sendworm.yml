app-id: to.bnt.sendworm
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node24
  - org.freedesktop.Sdk.Extension.rust-stable
command: sendworm
rename-icon: sendworm
rename-desktop-file: Sendworm.desktop
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
  - --share=ipc
  - --share=network
  - --filesystem=xdg-download

modules:
  - name: sendworm
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/node24/bin:/usr/lib/sdk/rust-stable/bin
      env:
        CARGO_NET_OFFLINE: 'true'
        CARGO_HOME: /run/build/sendworm/cargo
        npm_config_offline: 'true'
        npm_config_cache: /run/build/sendworm/flatpak-node/npm-cache
    sources:
      - type: git
        url: https://github.com/ubuntuegor/sendworm
        tag: v1.0.3
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
      # generated with flatpak-node-generator
      - node-sources.json
      # generated with flatpak-cargo-generator
      - cargo-sources.json
    build-commands:
      - npm ci
      - cargo fetch --manifest-path src-tauri/Cargo.toml
      - npm run tauri build -- -b deb

      - install -Dm755 -t ${FLATPAK_DEST}/bin/ src-tauri/target/release/bundle/deb/*/data/usr/bin/sendworm
      - install -Dm644 -t ${FLATPAK_DEST}/share/metainfo/ src-tauri/target/release/bundle/deb/*/data/usr/share/metainfo/${FLATPAK_ID}.metainfo.xml
      - install -Dm644 -t ${FLATPAK_DEST}/share/applications/ src-tauri/target/release/bundle/deb/*/data/usr/share/applications/Sendworm.desktop

      - install -Dm644 src-tauri/icons/32x32.png ${FLATPAK_DEST}/share/icons/hicolor/32x32/apps/sendworm.png
      - install -Dm644 src-tauri/icons/128x128.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/sendworm.png
      - install -Dm644 src-tauri/icons/128x128@2x.png ${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/sendworm.png
      - install -Dm644 src-tauri/icons/icon.png ${FLATPAK_DEST}/share/icons/hicolor/256x256@2/apps/sendworm.png
