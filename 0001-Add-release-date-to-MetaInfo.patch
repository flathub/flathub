From 33b35e079d76b5af6296c3a9e21de5753569bfc0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Tau=20G=C3=A4rtli?= <git@tau.garden>
Date: Sat, 22 Nov 2025 11:53:31 +0100
Subject: [PATCH] Add release date to MetaInfo

---
 CMakeLists.txt                      | 6 ++++++
 resources/linux/tev.metainfo.xml.in | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 5cc6629..dfd5a4d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -60,6 +60,12 @@ if (TEV_SUPPORT_AVIF OR TEV_SUPPORT_HEIC)
     set(TEV_USE_LIBHEIF ON)
 endif()
 
+execute_process(
+    COMMAND git for-each-ref --format "%(creatordate:short)" "refs/tags/v${TEV_VERSION}"
+    WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}"
+    OUTPUT_STRIP_TRAILING_WHITESPACE
+    OUTPUT_VARIABLE TEV_RELEASE_DATE)
+
 # Set ourselves as the startup project in visual studio.
 # Not available until cmake 3.6, but doesn't break older versions.
 set_property(DIRECTORY PROPERTY VS_STARTUP_PROJECT tev)
diff --git a/resources/linux/tev.metainfo.xml.in b/resources/linux/tev.metainfo.xml.in
index 429a343..2c0b69e 100644
--- a/resources/linux/tev.metainfo.xml.in
+++ b/resources/linux/tev.metainfo.xml.in
@@ -28,7 +28,7 @@
     </requires>
 
     <releases>
-        <release version="@TEV_VERSION@">
+        <release version="@TEV_VERSION@" date="@TEV_RELEASE_DATE@">
             <url type="details">https://github.com/Tom94/tev/releases/tag/v@TEV_VERSION@</url>
         </release>
     </releases>
-- 
2.51.1

