{
  "app-id": "io.github.parsemonkey.PersonalHistoryTimeline",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "24.08",
  "sdk": "org.freedesktop.Sdk",
  "command": "personal-history-timeline",
  "finish-args": [
    "--share=ipc",
    "--socket=x11",
    "--socket=wayland",
    "--device=dri",
    "--filesystem=home",
    "--filesystem=xdg-documents",
    "--share=network"
  ],
  "modules": [
    {
      "name": "personal-history-timeline",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/parsemonkey/PersonalHistoryTimeline/releases/download/v2.2.2/PersonalHistoryTimeline-source-v2.2.2.zip",
          "sha256": "0aeadf573fb4442e710affe09f72e3e57ea96e0ce4b49b6a53b59685375f2fec"
        }
      ],
      "build-commands": [
        "pip3 install --no-index --find-links flatpak/wheels --prefix=${FLATPAK_DEST} PySide6==6.9.2 requests==2.32.5",
        "mkdir -p /app/src /app/bin /app/share/applications /app/share/icons/hicolor/512x512/apps",
        "cp -r src/* /app/src/",
        "cp io.github.parsemonkey.PersonalHistoryTimeline.png /app/share/icons/hicolor/512x512/apps/io.github.parsemonkey.PersonalHistoryTimeline.png || true",
        "cat > /app/share/applications/io.github.parsemonkey.PersonalHistoryTimeline.desktop << 'DESKTOP_EOF'\n[Desktop Entry]\nType=Application\nName=Personal History Timeline\nComment=A database application to manage family memories over a lifetime\nExec=personal-history-timeline\nIcon=io.github.parsemonkey.PersonalHistoryTimeline\nCategories=Education;Office;\nTerminal=false\nMimeType=text/csv;\nStartupNotify=true\nDESKTOP_EOF",
        "cat > /app/bin/personal-history-timeline << 'LAUNCHER_EOF'\n#!/bin/bash\nset -e\nexport PYTHONPATH=\"/app/src:/app:$PYTHONPATH\"\nQT_PLUGIN_PATH=$(find /app/lib -type d -path '*/PySide6/Qt/plugins' | head -1)\nif [ -n \"$QT_PLUGIN_PATH\" ]; then\n    export QT_QPA_PLATFORM_PLUGIN_PATH=\"$QT_PLUGIN_PATH\"\nfi\nmkdir -p \"$HOME/.local/share/personal-history-timeline\"\nmkdir -p \"$HOME/.config/personal-history-timeline\"\ncd \"$HOME/.local/share/personal-history-timeline\"\nif [ -f \"/app/src/main.py\" ]; then\n    exec python3 /app/src/main.py \"$@\"\nelse\n    echo \"Error: main.py not found in /app/src/\"\n    exit 1\nfi\nLAUNCHER_EOF",
        "chmod +x /app/bin/personal-history-timeline"
      ],
      "cleanup": [
        "/usr/share/doc",
        "/usr/share/man",
        "/usr/include",
        "/usr/lib/debug",
        "/usr/lib/pkgconfig",
        "/usr/share/pkgconfig"
      ]
    }
  ]
}

