{
  "app-id": "com.github.ThamerAlharbi.Baseer",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "24.08",
  "sdk": "org.freedesktop.Sdk",
  "command": "baseer",
  "finish-args": [
    "--share=network",
    "--share=ipc",
    "--socket=fallback-x11",
    "--socket=wayland",
    "--device=dri",
    "--filesystem=host"
  ],
  "modules": [
    {
      "name": "baseer",
      "buildsystem": "simple",
      "build-commands": [
        "cd $FLATPAK_BUILDER_SRC",
        "sed -i 's|#define RETDEC_DEFAULT_BIN .*|#define RETDEC_DEFAULT_BIN \"/app/opt/baseer/decompiler/bin/retdec-decompiler\"|' modules/bx_deElf/bx_deElf.c",
        "sed -i 's|char in_path.*|char in_path[] = \"/app/tmp/baseer_input_XXXXXX\";|' modules/bx_deElf/bx_deElf.c",
        "sed -i 's|char out_path.*|char out_path[] = \"/app/tmp/baseer_output_XXXXXX\";|' modules/bx_deElf/bx_deElf.c",
        "sed -i 's|\"\\[!\\] retdec-decompiler exited with status %d\\\\n\"|\"\\[!\\] retdec-decompiler exited with status %d\\\\n[!] you need to install decompiler : /app/opt/baseer/install_decompiler.sh\\\\n\"|' modules/bx_deElf/bx_deElf.c",
        "make",
        "install -Dm755 build/baseer /app/opt/baseer/baseer",
        "install -Dm755 /dev/stdin /app/opt/baseer/install_decompiler.sh <<'EOF'\n#!/usr/bin/env bash\nset -e\nURL=\"https://github.com/thxa/baseer/releases/download/v0.2.0/decompiler.tar.xz\"\nFILE=\"decompiler.tar.xz\"\nDEST=\"/app/opt/baseer\"\n\necho \"[*] Downloading decompiler...\"\ncurl -L --progress-bar -o \"$FILE\" \"$URL\"\n\necho \"[*] Creating target directory...\"\nmkdir -p \"$DEST\"\n\necho \"[*] Extracting...\"\ntar xf \"$FILE\" -C \"$DEST\"\n\necho \"[*] Cleaning up...\"\nrm \"$FILE\"\n\necho \"[+] Decompiler installed successfully!\"\nEOF",
        "install -Dm644 LICENSE /app/opt/baseer/LICENSE",
        "install -Dm644 README.md /app/opt/baseer/README.md",
        "mkdir -p /app/tmp /app/bin/",
        "ln -s /app/opt/baseer/baseer /app/bin/baseer"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/thxa/baseer/archive/refs/tags/v0.2.0.tar.gz",
          "sha256": "f501f54d4de920601955465aa4896095da16a52d6fa9bb56cbbd00cf1483feee"
        }
      ]
    }
  ]
}
