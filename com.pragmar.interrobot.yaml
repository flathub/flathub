app-id: com.pragmar.interrobot
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: interrobot

finish-args:

  # base permissions
  - --share=network
  - --filesystem=xdg-documents
  - --filesystem=xdg-download

  # graphics
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri

modules:
  - name: interrobot
    buildsystem: simple
    build-commands:
      - install -d /app/bin
      - install -d /app/lib
      - install -d /app/share/InterroBot

      # copy files (publish directory contents are extracted to current directory)
      - cp -r . /app/share/InterroBot/

      # copy .so files to /app/lib for LD_LIBRARY_PATH
      - find /app/share/InterroBot -name "*.so*" -type f -exec cp -t /app/lib {} + 2>/dev/null || true

      # main executable
      - chmod +x /app/share/InterroBot/InterroBot
      
      # wrapped executable (sets cwd)
      - install -Dm755 interrobot-wrapper.sh /app/bin/interrobot

      # install assets and icons
      - install -Dm644 com.pragmar.interrobot.desktop /app/share/applications/com.pragmar.interrobot.desktop
      - install -Dm644 LICENSE.txt /app/share/licenses/com.pragmar.interrobot/LICENSE.txt
      - |
        for size in 48 64 128 256; do
          icon_file="wwwroot/images/icons/appicon.${size}.png"
          if [ -f "$icon_file" ]; then
            install -Dm644 "$icon_file" "/app/share/icons/hicolor/${size}x${size}/apps/com.pragmar.interrobot.png"
          fi
        done

      # install metadata
      - install -Dm644 com.pragmar.interrobot.metainfo.xml /app/share/metainfo/com.pragmar.interrobot.metainfo.xml

    sources:

      # x86_64 InterroBot build
      - type: archive
        url: https://interro.bot/media/uploads/bin/interrobot-2.9.3.2.tar.gz
        sha256: 93e587a994734dc8005b297acb2535f7ba49f3a2e039eb0c29d787fd4909f974

      # wrapper shell script, set cwd and launch
      - type: file
        path: interrobot-wrapper.sh
