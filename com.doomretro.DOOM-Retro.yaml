app-id: com.doomretro.DOOM-Retro
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: "23.08"
command: doomretro

finish-args:
  - --device=dri
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --socket=pulseaudio

  # We redirect the original ~/.config/doomretro to work as a configuration folder and WAD storage folder
  - --env=DOOMWADDIR=.config/doomretro
  - --env=SDL_SOUNDFONTS=/app/share/sounds/sf2/gzdoom.sf2  # FIXME: This doesn't appear to work.
  - --persist=.config/doomretro

  # Allow controller support
  - --device=all

modules:

  - shared-modules/linux-audio/fluidsynth2.json

  - name: doomretro
    buildsystem: cmake-ninja
    config-opts:
      - "-DCMAKE_BUILD_TYPE=RelWithDebInfo"

    sources:
      - type: git
        url: https://github.com/bradharding/doomretro.git
        tag: v5.1
        commit: e991824829c97ed09cda799b74984a95cc0498c0
        x-checker-data:
          type: anitya
          project-id: 17531
          stable-only: true
          tag-template: v$version
      - type: file
        url: https://github.com/zdoom/gzdoom/raw/g4.11.3/soundfont/gzdoom.sf2
        sha256: a9058609b07c1f0e0c1f420e76c2e80ba78136e6173e836caab51ffb13e552f1

    post-install:
      - install -Dm 644 gzdoom.sf2 /app/share/sounds/sf2/gzdoom.sf2

    cleanup:
      - /include
      - /lib/*.a
      - /lib/*.la
      - /lib/pkgconfig

  - name: launcher
    buildsystem: simple
    sources:
      - type: file
        path: com.doomretro.DOOM-Retro.desktop
      - type: file
        path: com.doomretro.DOOM-Retro.appdata.xml
      - type: file
        path: com.doomretro.DOOM-Retro.256.png
    build-commands:
      - install -Dm 644 com.doomretro.DOOM-Retro.desktop -t /app/share/applications
      - install -Dm 644 com.doomretro.DOOM-Retro.appdata.xml -t /app/share/metainfo
      - install -Dm 644 com.doomretro.DOOM-Retro.256.png /app/share/icons/hicolor/256x256/apps/com.doomretro.DOOM-Retro.png
