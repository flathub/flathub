app-id: com.pizi.scrcpygui
runtime: org.gnome.Platform 
runtime-version: '47' 
sdk: org.gnome.Sdk 
command: scrcpygui
build-options:
  prepend-path: /app/scrcpygui

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --device=all
  - --socket=pulseaudio
  - --filesystem=xdg-data
  - --filesystem=home
  - --talk-name=org.kde.StatusNotifierWatcher
  - --system-talk-name=org.freedesktop.Avahi.*

modules:
  - shared-modules/libayatana-appindicator/libayatana-appindicator-gtk3.json
 
  - name: flutter-scrcpygui
    buildsystem: simple
    only-arches:
      - x86_64
    depends:
      - libayatana-appindicator
    sources:
      - type: file
        url: https://github.com/pizi-0/flutter-scrcpygui/releases/download/1.3.50/scrcpygui-1.3.50-linux.zip
        sha256: da82b0f40729eb2642fef0645c47251eb4233ce4f3054ab20d6bb4fd14e4fea7
        dest-filename: scrcpygui-1.3.50-linux.zip

      - type: file
        path: logo.png

      - type: file    
        path: com.pizi.scrcpygui.desktop

      - type: file    
        path: com.pizi.scrcpygui.metainfo.xml


    build-commands:
    
      - unzip -d scrcpygui scrcpygui-1.3.50-linux.zip
 
      - cp -r scrcpygui /app/scrcpygui
      - chmod +x /app/scrcpygui/scrcpygui
      - install -Dm644 logo.png /app/share/icons/hicolor/512x512/apps/com.pizi.scrcpygui.png
      - mkdir -p /app/bin
      - ln -s /app/scrcpygui/scrcpygui /app/bin/scrcpygui

      # - |
      #   cat > /app/bin/scrcpygui <<'EOF'
      #   #!/bin/sh
      #   export LD_PRELOAD=
      #   exec /app/scrcpygui/scrcpygui "$@"
      #   EOF
 
      # - chmod +x /app/bin/scrcpygui
      - install -Dm644 com.pizi.scrcpygui.desktop /app/share/applications/com.pizi.scrcpygui.desktop
      - install -Dm644 com.pizi.scrcpygui.metainfo.xml /app/share/appdata/com.pizi.scrcpygui.metainfo.xml
  
      - rm -r scrcpygui
      - rm scrcpygui-1.3.50-linux.zip
