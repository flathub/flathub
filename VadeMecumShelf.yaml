name: VadeMecumShelf
buildsystem: simple
build-options:
  env:
    electron_config_cache: /run/build/VadeMecumShelf/npm-cache
sources:
  - type: archive
    url: https://github.com/tonton-pixel/vade-mecum-shelf/archive/v1.9.0.tar.gz
    sha256: 12e5f635aff4dcd1a81dd565fb4cd0e05e5977ab62c45ba140497dab61d65092
    dest: main
  # This file is autogenerated by: npm install --package-lock-only
  - type: file
    path: package-lock.json
    dest: main
  # This file is autogenerated by: flatpak-npm-generator.py --recursive package-lock.json
  # prefixed to the "main" dir
  - generated-sources.json
  # Wrapper to launch the app
  - type: script
    commands:
      - npm start --prefix="/app/main";
    dest-filename: run.sh
  - type: file
    path: com.github.tonton_pixel.VadeMecumShelf.desktop
  - type: file
    path: com.github.tonton_pixel.VadeMecumShelf.appdata.xml
build-commands:
  - npm install --prefix="main" --offline --cache="${electron_config_cache}" --nodedir="${FLATPAK_DEST}";
  - install -d "${FLATPAK_DEST}/main";
  - cp -ra main/* "${FLATPAK_DEST}/main/";
  - install -d "${FLATPAK_DEST}/bin";
  - install -p -D -m 0755 "run.sh" "${FLATPAK_DEST}/bin/VadeMecumShelf";
post-install:
  - icon_in="main/icons/icon.png";
    icon_out="${FLATPAK_ID}.png";
    for s in {16,22,24,32,48,64,72,96,128,192,256,512}; do
    convert -background none -density 1024 -resize "${s}x${s}" "${icon_in}" "${icon_out}";
    install -p -D -m 0644 "${icon_out}" -t "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/";
    done;
  - install -p -D -m 0644 "${FLATPAK_ID}.desktop" -t "${FLATPAK_DEST}/share/applications/";
  - install -p -D -m 0644 "${FLATPAK_ID}.appdata.xml" -t "${FLATPAK_DEST}/share/appdata/";
  - install -p -D -m 0644 "main/LICENSE.txt" -t "${FLATPAK_DEST}/share/licenses/VadeMecumShelf/";
