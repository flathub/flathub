name: OCRFeeder
config-opts:
  - --enable-maintainer-mode
sources:
  #- type: archive
  #  url: https://gitlab.gnome.org/GNOME/ocrfeeder/-/archive/release_0.8.1/ocrfeeder-release_0.8.1.tar.bz2
  #  sha256: 44ff739e21593daca00ee7fe0d7acad4c8ab6c5ef546f9c837dcddf8e296c97b
  # Upstream patches
  # Fix unicode problems when generating a plain text file
  # https://bugzilla.gnome.org/show_bug.cgi?id=765847
  # https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=811571
  # https://git.gnome.org/browse/ocrfeeder/commit/?id=691f54618ed17a2553f154af07a6cfb4bf887e09
  #- type: patch
  #  path: ocrfeeder-0.8.1-plain-text-unicode.patch
  # Fix unicode issues when exporting files
  # These changes make sure that unicode is used in DataBox,
  # and that the document generators use it correctly when exporting the data to files.
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/b3e7ed735f241acd2b7d7aa97be7b26bffdbc9ed
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/8ed3dc500ef0d91c19a31dea35a39c87da4659c3
  #- type: patch
  #  path: ocrfeeder-0.8.1-databox-unicode.patch
  # Ensure LayoutAnalysis.readImage returns unicode
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/dbfd2bd4b2b9fde3e01b77eb2c7a2e7515b69bb2
  #- type: patch
  #  path: ocrfeeder-0.8.1-layoutanalysis-unicode.patch
  # Don't require python-gobject
  # OCRFeeder uses python-gi instead
  # https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=890160
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/2f00b413538e211e77a7179e6296aa5a41c5d04d
  #- type: patch
  #  path: ocrfeeder-0.8.1-skip-python-gobject.patch
  # Migrate user help to Yelp instead of Doc
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/13c913a9d4818b484204d874e85fe0f1be6d3353
  #- type: patch
  #  path: ocrfeeder-0.8.1-yelp.patch
  # Specify Gtk, GooCanvas and GtkSpell required versions
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/44c2edcafbf428d9f2a9cd499daabdf5dc6354ac
  #- type: patch
  #  path: ocrfeeder-0.8.1-gi-require-version.patch
  # Use Gtk.Paned with the orientation instead of Gtk.HPaned
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/77f25a21a579af25e2346fafad383768bdd5d89d
  #- type: patch
  #  path: ocrfeeder-0.8.1-paned.patch
  # Set the wide_handle in the Gtk.Paned widgets
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/5247d23153e41fbcd582cf063d8d623cf8da11e7.diff
  #- type: patch
  #  path: ocrfeeder-0.8.1-paned-wide-handle.patch
  # Fix the width for the boxes editor
  # This makes the box editor be 300px wide when it shows up
  # instead of having it expand to the parent GtkPaned's separator position.
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/c4d4c4afb4b73019c08e2d1ff66b780cb017f0b5
  #- type: patch
  #  path: ocrfeeder-0.8.1-box-editor-width.patch
  # Make the clip section of the BoxEditor expandible
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/636f9a518312fbc1a0ac44e2f69716c669c5a0c2
  #- type: patch
  #  path: ocrfeeder-0.8.1-clip-expandible.patch
  - type: git
    url: https://gitlab.gnome.org/GNOME/ocrfeeder.git
    commit: 51483c4b625c42b9bc04b2056b903a431b080935
  # Upstreamable patches
  # Update box image (clip preview) after unpapering page
  - type: patch
    path: ocrfeeder-0.8.1-update-box-image.patch
  # Set Tesseract as default engine
  - type: patch
    path: ocrfeeder-0.8.1-default-engine.patch
  # Set favorite engine as default engine for content area
  # If there is no favorite engine (or it is not available), use the last one (Tesseract)
  # Try to keep the previous choice
  - type: patch
    path: ocrfeeder-0.8.1-default-engine-content-area.patch
  # Package-specific patches
  # Set fixed width for both panes
  # Related:
  # Fix the width for the boxes editor:
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/c4d4c4afb4b73019c08e2d1ff66b780cb017f0b5
  - type: patch
    path: ocrfeeder-0.8.1-layout-fixed-width.patch
  # Fix (increase) window size
  - type: patch
    path: ocrfeeder-0.8.1-window-size.patch
  # Flatpak-specific patches
  # Disable unpaper frame (Path to unpaper)
  - type: patch
    path: ocrfeeder-0.8.1-disable-unpaper-frame.patch
  - type: file
    path: ocrfeeder.desktop.in
    dest: resources
  - type: file
    path: ocrfeeder.appdata.xml
    dest: resources
post-install:
  - icon_in="resources/icons/ocrfeeder.svg";
    icon_out="ocrfeeder.png";
    for s in {16,22,24,32,48,64,72,96,128,192,256,512}; do
    [[ ! -f "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/${icon_out}" ]] || continue;
    rsvg-convert "${icon_in}" -w "${s}" -h "${s}" -a -f png -o "${icon_out}";
    install -p -D -m 0644 "${icon_out}" -t "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/";
    done;
    install -p -D -m 0644 "${icon_in}" -t "${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/";
  - install -p -D -m 0644 "resources/ocrfeeder.appdata.xml" -t "${FLATPAK_DEST}/share/appdata/";
modules:
  - shared-modules/python2.7/python-2.7.15.json
  - sane-backends.yaml
  - ghostscript.yaml
  - tesseract.yaml
  - ocrad.yaml
  - gocr.yaml
  - cuneiform.yaml
  - unpaper.yaml
  - goocanvas.yaml
  - enchant.yaml
  - enchant2.yaml
  - gtkspell.yaml
  - iso-codes.yaml
  - dictionaries.yaml
  - python2-pyenchant.yaml
  - python2-PyGObject.yaml
  - python2-lxml.yaml
  - python2-reportlab.yaml
  - python2-python-sane.yaml
  - djvulibre.yaml
  - noto-fonts.yaml
  - noto-cjk.yaml
  - noto-emoji.yaml
  - jsmath-fonts.yaml
  - yelp.yaml
