name: OCRFeeder
config-opts:
  - --enable-maintainer-mode
sources:
  - type: git
    url: https://gitlab.gnome.org/GNOME/ocrfeeder.git
    commit: 51483c4b625c42b9bc04b2056b903a431b080935
  # Upstreamable patches
  # Update box image (clip preview) after unpapering page
  - type: patch
    path: ocrfeeder-0.8.1-update-box-image.patch
  # Set Tesseract as default engine
  - type: patch
    path: ocrfeeder-0.8.1-default-engine.patch
  # Set favorite engine as default engine for content area
  # If there is no favorite engine (or it is not available), use the last one (Tesseract)
  # Try to keep the previous choice
  - type: patch
    path: ocrfeeder-0.8.1-default-engine-content-area.patch
  # Package-specific patches
  # Set fixed width for both panes
  # Related:
  # Fix the width for the boxes editor:
  # https://gitlab.gnome.org/GNOME/ocrfeeder/commit/c4d4c4afb4b73019c08e2d1ff66b780cb017f0b5
  - type: patch
    path: ocrfeeder-0.8.1-layout-fixed-width.patch
  # Fix (increase) window size
  - type: patch
    path: ocrfeeder-0.8.1-window-size.patch
  # Flatpak-specific patches
  # Disable unpaper frame (Path to unpaper)
  - type: patch
    path: ocrfeeder-0.8.1-disable-unpaper-frame.patch
  - type: file
    path: ocrfeeder.desktop.in
    dest: resources
  - type: file
    path: ocrfeeder.appdata.xml
    dest: resources
post-install:
  - icon_in="resources/icons/ocrfeeder.svg";
    icon_out="ocrfeeder.png";
    for s in {16,22,24,32,48,64,72,96,128,192,256,512}; do
    [[ ! -f "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/${icon_out}" ]] || continue;
    rsvg-convert "${icon_in}" -w "${s}" -h "${s}" -a -f png -o "${icon_out}";
    install -p -D -m 0644 "${icon_out}" -t "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/";
    done;
    install -p -D -m 0644 "${icon_in}" -t "${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/";
  - install -p -D -m 0644 "resources/ocrfeeder.appdata.xml" "${FLATPAK_DEST}/share/appdata/${FLATPAK_ID}.appdata.xml";
modules:
  - shared-modules/python2.7/python-2.7.15.json
  - sane-backends.yaml
  - ghostscript.yaml
  - tesseract.yaml
  - ocrad.yaml
  - gocr.yaml
  - cuneiform.yaml
  - unpaper.yaml
  - goocanvas.yaml
  - enchant.yaml
  - enchant2.yaml
  - gtkspell.yaml
  - iso-codes.yaml
  - dictionaries.yaml
  - python2-pyenchant.yaml
  - python2-PyGObject.yaml
  - python2-lxml.yaml
  - python2-reportlab.yaml
  - python2-python-sane.yaml
  - djvulibre.yaml
  - noto-fonts.yaml
  - noto-cjk.yaml
  - noto-emoji.yaml
  - jsmath-fonts.yaml
  - yelp.yaml
