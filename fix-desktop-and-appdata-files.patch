From b7bfc2d80979c4b6ef09bb6df858472d106d3d10 Mon Sep 17 00:00:00 2001
From: Lukas Holecek <hluk@email.cz>
Date: Sun, 25 Feb 2018 15:29:05 +0100
Subject: [PATCH] Fix desktop and AppData files

---
 CMakeLists.txt                                           | 16 +++++++---------
 ...pyq.appdata.xml => com.github.hluk.copyq.appdata.xml} |  6 +++++-
 ...copyq.desktop.in => com.github.hluk.copyq.desktop.in} |  0
 3 files changed, 12 insertions(+), 10 deletions(-)
 rename shared/{copyq.appdata.xml => com.github.hluk.copyq.appdata.xml} (93%)
 rename shared/{copyq.desktop.in => com.github.hluk.copyq.desktop.in} (100%)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index f63b17e2..91c32931 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -25,12 +25,10 @@ if (UNIX AND NOT APPLE)
     set(ICON_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}/share/icons/hicolor/scalable/apps" CACHE PATH "Install path for icons")
     set(ICON_INSTALL_PREFIX_TEMPLATE "${CMAKE_INSTALL_PREFIX}/share/icons/hicolor/%SIZE%/apps" CACHE PATH "Install path for icons (%SIZE% is icon size)")
     set(THEME_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}/share/copyq/themes" CACHE PATH "Install path for themes")
-    set(DESKTOP_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}/share/applications" CACHE PATH "Install path for \"copyq.desktop\"")
-    set(APPDATA_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}/share/metainfo" CACHE PATH "Install path for \"copyq.appdata.xml\"")
+    set(DESKTOP_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}/share/applications" CACHE PATH "Install path for desktop file")
+    set(APPDATA_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}/share/metainfo" CACHE PATH "Install path for AppData file")
     set(MANPAGE_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}/share/man/man1" CACHE PATH "Install path for manual pages")
     set(TRANSLATION_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}/share/copyq/translations" CACHE PATH "Install path for translations")
-    set(DESKTOP_INSTALL_NAME "copyq.desktop" CACHE STRING "Name for desktop file")
-    set(APPDATA_INSTALL_NAME "copyq.appdata.xml" CACHE STRING "Name for appdata file")
     set(ICON_NAME "copyq" CACHE STRING "Name for icon files")
 endif()
 
@@ -60,8 +58,8 @@ endif()
 set(copyq_ICON_PREFIX src/images/icon)
 set(copyq_ICON_NORMAL src/images/icon.svg)
 set(copyq_ICON_BUSY   src/images/icon-running.svg)
-set(copyq_DESKTOP     shared/copyq.desktop)
-set(copyq_APPDATA     shared/copyq.appdata.xml)
+set(copyq_DESKTOP     shared/com.github.hluk.copyq.desktop)
+set(copyq_APPDATA     shared/com.github.hluk.copyq.appdata.xml)
 set(copyq_MANPAGE     debian/copyq.1)
 
 # Be more strict while compiling debugging version
@@ -176,11 +174,11 @@ endif()
 if (UNIX AND NOT APPLE)
     install(FILES ${copyq_ICON_NORMAL} DESTINATION ${ICON_INSTALL_PREFIX} RENAME ${ICON_NAME}-normal.svg)
     install(FILES ${copyq_ICON_BUSY}   DESTINATION ${ICON_INSTALL_PREFIX} RENAME ${ICON_NAME}-busy.svg)
-    install(FILES ${copyq_APPDATA}     DESTINATION ${APPDATA_INSTALL_PREFIX} RENAME ${APPDATA_INSTALL_NAME})
+    install(FILES ${copyq_APPDATA}     DESTINATION ${APPDATA_INSTALL_PREFIX})
     install(FILES ${copyq_MANPAGE}     DESTINATION ${MANPAGE_INSTALL_PREFIX})
 
     configure_file(${copyq_DESKTOP}.in ${copyq_DESKTOP})
-    install(FILES ${CMAKE_CURRENT_BINARY_DIR}/${copyq_DESKTOP} DESTINATION ${DESKTOP_INSTALL_PREFIX} RENAME ${DESKTOP_INSTALL_NAME})
+    install(FILES ${CMAKE_CURRENT_BINARY_DIR}/${copyq_DESKTOP} DESTINATION ${DESKTOP_INSTALL_PREFIX})
 
     foreach (copyq_ICON_EXTENT 16 22 24 32 48 64 128)
         set(copyq_ICON_SIZE "${copyq_ICON_EXTENT}x${copyq_ICON_EXTENT}")
@@ -197,7 +195,7 @@ if (UNIX AND NOT APPLE)
     add_definitions( -DCOPYQ_ICON_PREFIX="${ICON_INSTALL_PREFIX}/${ICON_NAME}" )
     add_definitions( -DCOPYQ_THEME_PREFIX="${THEME_INSTALL_PREFIX}" )
     add_definitions( -DCOPYQ_PLUGIN_PREFIX="${PLUGIN_INSTALL_PREFIX}" )
-    add_definitions( -DCOPYQ_DESKTOP_FILE="${DESKTOP_INSTALL_PREFIX}/${DESKTOP_INSTALL_NAME}" )
+    add_definitions( -DCOPYQ_DESKTOP_FILE="${DESKTOP_INSTALL_PREFIX}/${copyq_DESKTOP}" )
     add_definitions( -DCOPYQ_TRANSLATION_PREFIX="${TRANSLATION_INSTALL_PREFIX}" )
     add_definitions( -DCOPYQ_ICON_NAME="${ICON_NAME}" )
 endif()
diff --git a/shared/copyq.appdata.xml b/shared/com.github.hluk.copyq.appdata.xml
similarity index 93%
rename from shared/copyq.appdata.xml
rename to shared/com.github.hluk.copyq.appdata.xml
index 9f55f486..549cac2f 100644
--- a/shared/copyq.appdata.xml
+++ b/shared/com.github.hluk.copyq.appdata.xml
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="utf-8"?>
 <!-- Copyright 2018 Lukáš Holeček <hluk@email.cz> -->
 <component type="desktop">
-    <id>copyq.desktop</id>
+    <id>com.github.hluk.copyq.desktop</id>
     <metadata_license>CC0-1.0</metadata_license>
     <project_license>GPL-3.0+</project_license>
 
@@ -25,6 +25,10 @@
     <url type="donation">https://www.bountysource.com/teams/copyq</url>
     <url type="translate">https://hosted.weblate.org/engage/copyq/</url>
 
+    <releases>
+        <release version="3.2.0" date="2018-02-18" />
+    </releases>
+
     <screenshots>
         <screenshot type="default">
             <image>https://hluk.github.io/CopyQ/images/application.png</image>
diff --git a/shared/copyq.desktop.in b/shared/com.github.hluk.copyq.desktop.in
similarity index 100%
rename from shared/copyq.desktop.in
rename to shared/com.github.hluk.copyq.desktop.in
-- 
2.16.2

