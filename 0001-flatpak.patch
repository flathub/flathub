From 784688cf6c26c47d8c55b94457b4a2ca03f29372 Mon Sep 17 00:00:00 2001
From: Christoph Settgast <csett86@web.de>
Date: Sat, 5 Nov 2022 21:12:54 +0100
Subject: [PATCH] flatpak

---
 common.pri                              |  3 ---
 src/app/seamly2d/seamly2d.pro           | 12 ++++++------
 src/app/seamlyme/seamlyme.pro           |  2 +-
 src/libs/vmisc/vabstractapplication.cpp |  2 +-
 src/libs/vmisc/vcommonsettings.cpp      |  2 +-
 5 files changed, 9 insertions(+), 12 deletions(-)

diff --git a/common.pri b/common.pri
index fce91cc14..e3c88b5f1 100644
--- a/common.pri
+++ b/common.pri
@@ -268,19 +268,16 @@ ISYSTEM += \
 # Usefull GCC warnings keys.
 GCC_DEBUG_CXXFLAGS += \
     -O0 \ # Turn off oprimization.
-    $$ISYSTEM \ # Ignore warnings Qt headers.
     # Last gdb doesn't show debug symbols with Qt Creator (issue with Python 3 and debug scripts that use Python 2.7).
     # Solution to use older version gdb, that's why we use old standard of debug information.
     -gdwarf-3 \
     -Wall \
     -Wextra \
     -pedantic \
-    -Weffc++ \
     -Woverloaded-virtual \
     -Wctor-dtor-privacy \
     -Wnon-virtual-dtor \
     -Wold-style-cast \
-    -Wconversion \
     -Winit-self \
 #    -Wstack-protector \
     -Wunreachable-code \
diff --git a/src/app/seamly2d/seamly2d.pro b/src/app/seamly2d/seamly2d.pro
index f83e20950..5f3b8a01d 100644
--- a/src/app/seamly2d/seamly2d.pro
+++ b/src/app/seamly2d/seamly2d.pro
@@ -164,12 +164,12 @@ unix{
         seamlyme.files += $${OUT_PWD}/../seamlyme/$${DESTDIR}/seamlyme
 
         # .desktop file
-        desktop.path = /usr/share/applications/
+        desktop.path = $$PREFIX/share/applications/
         desktop.files += ../../../dist/$${TARGET}.desktop \
         desktop.files += ../../../dist/seamlyme.desktop
 
         # logo
-        pixmaps.path = /usr/share/pixmaps/
+        pixmaps.path = $$PREFIX/share/pixmaps/
         pixmaps.files += \
             ../../../dist/$${TARGET}.png \
             ../../../dist/seamlyme.png \
@@ -178,19 +178,19 @@ unix{
             ../../../dist/application-x-seamly2d-s-measurements.png \
 
         # Path to translation files after installation
-        translations.path = /usr/share/$${TARGET}/translations/
+        translations.path = $$PREFIX/share/$${TARGET}/translations/
         translations.files = $$INSTALL_TRANSLATIONS
 
         # Path to multisize measurement after installation
-        multisize.path = /usr/share/$${TARGET}/tables/multisize/
+        multisize.path = $$PREFIX/share/$${TARGET}/tables/multisize/
         multisize.files = $$INSTALL_MULTISIZE_MEASUREMENTS
 
         # Path to templates after installation
-        templates.path = /usr/share/$${TARGET}/tables/templates/
+        templates.path = $$PREFIX/share/$${TARGET}/tables/templates/
         templates.files = $$INSTALL_STANDARD_TEMPLATES
 
         # Path to label templates after installation
-        label.path = /usr/share/$${TARGET}/labels/
+        label.path = $$PREFIX/share/$${TARGET}/labels/
         label.files = $$INSTALL_LABEL_TEMPLATES
 
         INSTALLS += \
diff --git a/src/app/seamlyme/seamlyme.pro b/src/app/seamlyme/seamlyme.pro
index f7cb07527..e482cd8b5 100644
--- a/src/app/seamlyme/seamlyme.pro
+++ b/src/app/seamlyme/seamlyme.pro
@@ -214,7 +214,7 @@ unix{
         # Path to bin file after installation
         target.path = $$PREFIX/bin
 
-        rcc_diagrams.path = /usr/share/seamly2d/
+        rcc_diagrams.path = $$PREFIX/share/seamly2d/
         rcc_diagrams.files = $${OUT_PWD}/$${DESTDIR}/diagrams.rcc
         rcc_diagrams.CONFIG = no_check_exist
 
diff --git a/src/libs/vmisc/vabstractapplication.cpp b/src/libs/vmisc/vabstractapplication.cpp
index 93355229f..6a993b8f1 100644
--- a/src/libs/vmisc/vabstractapplication.cpp
+++ b/src/libs/vmisc/vabstractapplication.cpp
@@ -162,7 +162,7 @@ QString VAbstractApplication::translationsPath(const QString &locale) const
     }
 #else // Unix
     Q_UNUSED(locale)
-    return QCoreApplication::applicationDirPath() + QStringLiteral("/../share") + trPath;
+    return QStringLiteral("/app/share/seamly2d/translations");
 #endif
 }
 
diff --git a/src/libs/vmisc/vcommonsettings.cpp b/src/libs/vmisc/vcommonsettings.cpp
index 26ea1cc5c..4fa868854 100644
--- a/src/libs/vmisc/vcommonsettings.cpp
+++ b/src/libs/vmisc/vcommonsettings.cpp
@@ -212,7 +212,7 @@ QStringList ClearFormats(const QStringList &predefinedFormats, QStringList forma
 static const QString commonIniFilename = QStringLiteral("common");
 
 #if !defined(Q_OS_WIN)
-const QString VCommonSettings::unixStandardSharePath = QStringLiteral("/usr/share/seamly2d");
+const QString VCommonSettings::unixStandardSharePath = QStringLiteral("/app/share/seamly2d");
 #endif
 
 namespace
-- 
2.34.1

