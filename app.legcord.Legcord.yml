app-id: app.legcord.Legcord

runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk

base: org.electronjs.Electron2.BaseApp
base-version: '24.08'

command: startlegcord
separate-locales: false

finish-args: # We aren't trying to get tray icons working here for several reasons, mainly I'm too stressed to figure them out. -Oro
  - --socket=pulseaudio
  - --socket=x11
  - --share=ipc
  - --share=network
  - --talk-name=org.kde.StatusNotifierWatcher # Tray functionalities on KDE
  - --device=all # Needed for GPU acceleration and the webcam
  - --filesystem=xdg-videos:ro
  - --filesystem=xdg-pictures:ro
  - --filesystem=xdg-download # This and the above two are used for drag-n-drop, and download managing
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons # This is used to show the correct cursor on Wayland

modules:
  - name: minerals
    buildsystem: simple
    build-commands:
      - install -Dm755 minerals/startlegcord /app/bin/startlegcord
      - install -D minerals/app.legcord.Legcord.desktop -t /app/share/applications/
      - install -D app.legcord.Legcord.metainfo.xml -t /app/share/metainfo/
    sources:
      - type: dir
        path: .

  - name: Legcord
    buildsystem: simple
    build-commands:
      - chmod +x Legcord*.AppImage
      - ./Legcord*.AppImage --appimage-extract
      - install -D squashfs-root/usr/share/icons/hicolor/512x512/apps/legcord.png /app/share/icons/hicolor/512x512/apps/app.legcord.Legcord.png
      - mv squashfs-root /app/bin/legcord

    sources:
      - type: file
        url: https://github.com/Legcord/Legcord/releases/download/v1.0.6/Legcord-1.0.6-linux-x86_64.AppImage
        sha512: 293cf09a0eed1f7677b36340095f591e7561a2ceaab48f66820c3edf9a31d1bdc3eb01b5955ba75848a542194f78e35374f1856348995e41a453605313802cec
        only-arches: [x86_64]
        x-checker-data:
          type: electron-updater
          url: https://github.com/Legcord/Legcord/releases/latest/download/latest-linux.yml

      - type: file
        url: https://github.com/Legcord/Legcord/releases/download/v1.0.6/Legcord-1.0.6-linux-arm64.AppImage
        sha512: 48d7c908e6fdc59f87e1b202b0a7d35473b396ac2262da34fb7213b55d11ce9b7be87f0db656c48857000850365d3ced4ecc698d5d26575c725e500867889b31
        only-arches: [aarch64]
        x-checker-data:
          type: electron-updater
          url: https://github.com/Legcord/Legcord/releases/latest/download/latest-linux-arm64.yml

