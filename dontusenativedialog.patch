From 6af4cc70f9800a16b33541fecb2db28bf18d86a3 Mon Sep 17 00:00:00 2001
From: Radu Zaharia <raduzaharia@outlook.com>
Date: Tue, 24 May 2022 11:27:18 +0300
Subject: [PATCH] Enabled DontUseNativeDialog option for QFileDialog.

---
 puddlestuff/helperwin.py                  | 3 ++-
 puddlestuff/libraries/quodlibetlib.py     | 3 ++-
 puddlestuff/libraries/rhythmbox.py        | 3 ++-
 puddlestuff/m3u.py                        | 1 +
 puddlestuff/plugins/save_tags/__init__.py | 2 +-
 puddlestuff/puddleobjects.py              | 6 ++++--
 puddlestuff/puddletag.py                  | 7 +++++--
 restore_tag.py                            | 2 +-
 8 files changed, 18 insertions(+), 9 deletions(-)

diff --git a/puddlestuff/helperwin.py b/puddlestuff/helperwin.py
index 251eb85..91d357f 100644
--- a/puddlestuff/helperwin.py
+++ b/puddlestuff/helperwin.py
@@ -303,7 +303,8 @@ class ImportTextFile(QDialog):
 
         if not filename:
             selectedFile = QFileDialog.getOpenFileName(self,
-                                                       'OpenFolder', dirpath)
+                                                       'OpenFolder', dirpath,
+                                                       options=QFileDialog.DontUseNativeDialog)
             filename = selectedFile[0]
 
         if not filename:
diff --git a/puddlestuff/libraries/quodlibetlib.py b/puddlestuff/libraries/quodlibetlib.py
index 1e1766c..bc1c9d9 100755
--- a/puddlestuff/libraries/quodlibetlib.py
+++ b/puddlestuff/libraries/quodlibetlib.py
@@ -365,7 +365,8 @@ class InitWidget(QWidget):
     def select_db(self):
         selectedFile = QFileDialog.getOpenFileName(self,
                                                    translate("QuodLibet", 'Select QuodLibet library file...'),
-                                                   self.dbpath.text())
+                                                   self.dbpath.text(),
+                                                   options=QFileDialog.DontUseNativeDialog)
         filename = selectedFile[0]
         if filename:
             self.dbpath.setText(filename)
diff --git a/puddlestuff/libraries/rhythmbox.py b/puddlestuff/libraries/rhythmbox.py
index 0d2335c..0efca8b 100644
--- a/puddlestuff/libraries/rhythmbox.py
+++ b/puddlestuff/libraries/rhythmbox.py
@@ -513,7 +513,8 @@ class ConfigWindow(QWidget):
 
     def getFile(self):
         selectedFile = QFileDialog.getOpenFileName(self,
-                                                   'Select RhythmBox database file.', self.dbpath.text())
+                                                   'Select RhythmBox database file.', self.dbpath.text(),
+                                                   options=QFileDialog.DontUseNativeDialog)
         filename = selectedFile[0]
         if filename:
             self.dbpath.setText(filename)
diff --git a/puddlestuff/m3u.py b/puddlestuff/m3u.py
index 9a96c64..0fabe2f 100644
--- a/puddlestuff/m3u.py
+++ b/puddlestuff/m3u.py
@@ -132,6 +132,7 @@ if __name__ == '__main__':
     filedlg = QFileDialog()
     filedlg.setFileMode(QFileDialog.FileMode.Directory)
     filedlg.setOption(QFileDialog.Option.ShowDirsOnly)
+    filedlg.setOption(QFileDialog.Option.DontUseNativeDialog)
     filename = str(filedlg.getExistingDirectory(None,
                                                 'Open Folder'))
     tags = []
diff --git a/puddlestuff/plugins/save_tags/__init__.py b/puddlestuff/plugins/save_tags/__init__.py
index 83ea454..5018eeb 100644
--- a/puddlestuff/plugins/save_tags/__init__.py
+++ b/puddlestuff/plugins/save_tags/__init__.py
@@ -25,7 +25,7 @@ def save_tags(files, fn):
 
 
 def export_tags():
-    selectedFile = QFileDialog.getSaveFileName(None, "Save tags", last_fn['fn'], "*.*")
+    selectedFile = QFileDialog.getSaveFileName(None, "Save tags", last_fn['fn'], "*.*", options=QFileDialog.DontUseNativeDialog)
     fn = selectedFile[0]
     if fn:
         save_tags((f.filepath for f in status['selectedfiles']), fn)
diff --git a/puddlestuff/puddleobjects.py b/puddlestuff/puddleobjects.py
index d5f610f..00e6f83 100644
--- a/puddlestuff/puddleobjects.py
+++ b/puddlestuff/puddleobjects.py
@@ -1818,7 +1818,8 @@ class PicWidget(QWidget):
                 os.path.dirname(self.lastfilename), 'folder.jpg')
             selectedFile = QFileDialog.getOpenFileName(self,
                                                        translate("Artwork", 'Select Image...'), default_fn,
-                                                       translate("Artwork", "JPEG & PNG Images (*.jpg *.jpeg *.png);;JPEG Images (*.jpg *.jpeg);;PNG Images (*.png);;All Files(*.*)"))
+                                                       translate("Artwork", "JPEG & PNG Images (*.jpg *.jpeg *.png);;JPEG Images (*.jpg *.jpeg);;PNG Images (*.png);;All Files(*.*)"),
+                                                       options=QFileDialog.DontUseNativeDialog)
             filename = selectedFile[0]
 
         if not filename:
@@ -2014,7 +2015,8 @@ class PicWidget(QWidget):
                 self,
                 translate("Artwork", 'Save artwork as...'),
                 tempfilename,
-                translate("Artwork", "JPEG Images (*.jpg);;PNG Images (*.png);;All Files(*.*)"))
+                translate("Artwork", "JPEG Images (*.jpg);;PNG Images (*.png);;All Files(*.*)"),
+                options=QFileDialog.DontUseNativeDialog)
             filename = selectedFile[0]
             if not filename:
                 return
diff --git a/puddlestuff/puddletag.py b/puddlestuff/puddletag.py
index eae9502..ac6e1c8 100644
--- a/puddlestuff/puddletag.py
+++ b/puddlestuff/puddletag.py
@@ -452,6 +452,7 @@ class MainWin(QMainWindow):
         filedlg = QFileDialog()
         filedlg.setFileMode(QFileDialog.FileMode.Directory)
         filedlg.setOption(QFileDialog.Option.ShowDirsOnly)
+        filedlg.setOption(QFileDialog.Option.DontUseNativeDialog)
         filename = str(QFileDialog.getExistingDirectory(self,
                                                         translate("Main Window", 'Import directory...'),
                                                         dirname,
@@ -530,7 +531,8 @@ class MainWin(QMainWindow):
     def loadPlayList(self):
         dirname = self._lastdir[0] if self._lastdir else QDir.homePath()
         selectedFile = QFileDialog.getOpenFileName(self,
-                                                   translate("Playlist", translate("Playlist", 'Select m3u file...')), )
+                                                   translate("Playlist", translate("Playlist", 'Select m3u file...')), 
+                                                   options=QFileDialog.DontUseNativeDialog)
         filename = selectedFile[0]
         if not filename:
             return
@@ -689,7 +691,8 @@ class MainWin(QMainWindow):
         filepattern = settings.get('playlist', 'filepattern', 'puddletag.m3u')
         default = encode_fn(findfunc.tagtofilename(filepattern, tags[0]))
         selectedFile = QFileDialog.getSaveFileName(self,
-                                                   translate("Playlist", 'Save Playlist...'), os.path.join(dirname, default))
+                                                   translate("Playlist", 'Save Playlist...'), os.path.join(dirname, default),
+                                                   options=QFileDialog.DontUseNativeDialog)
         f = selectedFile[0]
         if f:
             if settings.get('playlist', 'extinfo', 1, True):
diff --git a/restore_tag.py b/restore_tag.py
index 1a84058..fff31dc 100644
--- a/restore_tag.py
+++ b/restore_tag.py
@@ -24,7 +24,7 @@ def save_tags(files, fn):
 
 
 def export_tags():
-    selectedFile = QFileDialog.getSaveFileName(None, "Save tags", last_fn['fn'], "*.*")
+    selectedFile = QFileDialog.getSaveFileName(None, "Save tags", last_fn['fn'], "*.*", options=QFileDialog.DontUseNativeDialog)
     fn = selectedFile[0]
     if fn:
         save_tags(f.filepath for f in status['all_tags'])
-- 
2.36.1
