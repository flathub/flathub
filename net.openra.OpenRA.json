{
  "app-id": "net.openra.OpenRA",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "1.6",
  "sdk": "org.freedesktop.Sdk",
  "command": "openra-ra",
  "rename-appdata-file": "openra-ra.appdata.xml",
  "rename-desktop-file": "openra-ra.desktop",
  "rename-icon": "openra-ra",
  "finish-args": [
    "--socket=x11",
    "--socket=pulseaudio",
    "--device=dri",
    "--share=network",
    "--persist=.openra"
  ],
  "modules": [
    {
      "name": "mono",
      "sources": [
        {
          "type": "archive",
          "url": "https://download.mono-project.com/sources/mono/mono-5.4.1.6.tar.bz2",
          "sha256": "bdfda0fe9ad5ce20bb2cf9e9bf28fed40f324141297479824e1f65d97da565df"
        }
      ],
      "cleanup": [
        "/include",
        "/lib/*.a",
        "/lib/*.la",
        "/lib/*.so",
        "/lib/*.so.*",
        "/lib/pkgconfig",
        "/share/man",
        "/bin/xsd",
        "/bin/xbuild",
        "/bin/wsdl2",
        "/bin/wsdl",
        "/bin/svcutil",
        "/bin/sqlsharp",
        "/bin/sqlmetal",
        "/bin/soapsuds",
        "/bin/sn",
        "/bin/signcode",
        "/bin/sgen-grep-binprot",
        "/bin/sgen",
        "/bin/setreg",
        "/bin/secutil",
        "/bin/resgen2",
        "/bin/resgen",
        "/bin/prj2make",
        "/bin/peverify",
        "/bin/permview",
        "/bin/pedump",
        "/bin/pdb2mdb",
        "/bin/nunit-console4",
        "/bin/nunit-console2",
        "/bin/nunit-console",
        "/bin/mozroots",
        "/bin/monop2",
        "/bin/monop",
        "/bin/monolinker",
        "/bin/monograph",
        "/bin/monodocs2slashdoc",
        "/bin/monodocs2html",
        "/bin/monodocer",
        "/bin/monodis",
        "/bin/mono-xmltool",
        "/bin/mono-test-install",
        "/bin/mono-symbolicate",
        "/bin/mono-shlib-cop",
        "/bin/mono-sgen-gdb.py",
        "/bin/mono-service2",
        "/bin/mono-service",
        "/bin/mono-package-runtime",
        "/bin/mono-heapviz",
        "/bin/mono-gdb.py",
        "/bin/mono-find-requires",
        "/bin/mono-find-provides",
        "/bin/mono-configuration-crypto",
        "/bin/mono-cil-strip",
        "/bin/mono-boehm",
        "/bin/mono-api-info",
        "/bin/mono-api-html",
        "/bin/mod",
        "/bin/mkbundle",
        "/bin/mdvalidater",
        "/bin/mdoc-validate",
        "/bin/mdoc-update",
        "/bin/mdoc-export-msxdoc",
        "/bin/mdoc-export-html",
        "/bin/mdoc-assemble",
        "/bin/mdoc",
        "/bin/mdbrebase",
        "/bin/mdassembler",
        "/bin/mcs",
        "/bin/mconfig",
        "/bin/makecert",
        "/bin/macpack",
        "/bin/lc",
        "/bin/installvst",
        "/bin/ilasm",
        "/bin/ikdasm",
        "/bin/httpcfg",
        "/bin/genxs",
        "/bin/gacutil2",
        "/bin/gacutil",
        "/bin/dtd2xsd",
        "/bin/dtd2rng",
        "/bin/dmcs",
        "/bin/disco",
        "/bin/csi",
        "/bin/csharp",
        "/bin/csc",
        "/bin/crlupdate",
        "/bin/chktrust",
        "/bin/certmgr",
        "/bin/cert2spc",
        "/bin/cert-sync",
        "/bin/ccrewrite",
        "/bin/cccheck",
        "/bin/caspol",
        "/bin/al2",
        "/bin/al"
      ],
      "config-opts": [
        "--enable-minimal=aot,profiler",
        "--with-mcs-docs=no",
        "--disable-dependency-tracking"
      ]
    },
    {
      "name": "libgdiplus",
      "sources": [
        {
          "type": "archive",
          "url": "https://download.mono-project.com/sources/libgdiplus/libgdiplus0-4.2.tar.gz",
          "sha256": "f332b9b8b44fd1c50b8d8d01a7296360b806c790b8297614739b3de1edbadfeb"
        }
      ],
      "cleanup": [ "/include", "/lib/*.a", "/lib/*.la", "/lib/pkgconfig", "/share/man" ]
    },
    {
      "name": "lua51",
      "sources": [
        {
          "type": "archive",
          "url": "https://www.lua.org/ftp/lua-5.1.5.tar.gz",
          "sha256": "2640fc56a795f29d28ef15e13c34a47e223960b0240e8cb0a82d9b0738695333"
        },
        {
          "type": "patch",
          "path": "lua51-cflags.patch"
        },
        {
          "type": "patch",
          "path": "lua51-prefix.patch"
        },
        {
          "type": "patch",
          "path": "lua51-so.patch"
        },
        {
          "type": "shell",
          "commands": [
            "sed -e 's:llua:llua5.1:' -e 's:/include:/include/lua5.1:' -i etc/lua.pc",
            "sed -r -e '/^LUA_(SO|A|T)=/ s/lua/lua5.1/' -e '/^LUAC_T=/ s/luac/luac5.1/' -i src/Makefile",
            "mv doc/lua.1 doc/lua5.1.1",
            "mv doc/luac.1 doc/luac5.1.1"
          ]
        }
      ],
      "cleanup": [ "/bin", "/include", "/lib/*.a", "/lib/*.la", "/lib/pkgconfig", "/share/man" ],
      "buildsystem": "simple",
      "build-commands": [
        "make CFLAGS='-O2 -Wall -fPIC' linux",
        "make TO_BIN='lua5.1 luac5.1' TO_LIB='liblua5.1.a liblua5.1.so liblua5.1.so.5.1 liblua5.1.so.5.1.5' INSTALL_TOP='/app' INSTALL_INC='/app/include/lua5.1' TO_MAN='lua5.1.1 luac5.1.1' INSTALL_MAN='/app/share/man/man1' install",
        "install -Dm0644 etc/lua.pc /app/lib/pkgconfig/lua51.pc",
        "ln -s liblua5.1.so /app/lib/liblua.so.5.1",
        "ln -s liblua5.1.so /app/lib/liblua.so.5.1.5"
      ]
    },
    {
      "name": "OpenRA",
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/OpenRA/OpenRA",
          "commit": "9ac7765a934248db90de2ba3c154fa5732b766f0",
          "branch": "release-20171014"
        },
        {
          "type": "shell",
          "commands": ["mkdir thirdparty/download"]
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/StyleCopPlus.MSBuild/4.7.49.5",
          "dest-filename": "thirdparty/download/StyleCopPlus.MSBuild.zip",
          "sha256": "b98a8ed20c5e82ff5fe6c2a52ecd45bffd4d4ab284611f35a25889c3bba364c3"
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/StyleCop.MSBuild/4.7.49.0",
          "dest-filename": "thirdparty/download/StyleCop.MSBuild.zip",
          "sha256": "6680dedaa5d27fb1ead475015de98e476e58fa9a27e4b7ad0f08d5f7d8f6ee66"
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/SharpZipLib/0.86.0",
          "dest-filename": "thirdparty/download/SharpZipLib.zip",
          "sha256": "5906c248bb986d50489192f490f94d2331d04e7d34337bc3c0d64df6d0008207"
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/MaxMind.Db/2.0.0",
          "dest-filename": "thirdparty/download/MaxMind.Db.zip",
          "sha256": "095d62c6ecda38c1e8fe79935b4eaf228d2637f9498caec48b8b48a0aba6d5aa"
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/SharpFont/4.0.1",
          "dest-filename": "thirdparty/download/SharpFont.zip",
          "sha256": "48eff311d5fb4fe88612352462317a7e6a73a148c755afc6141c02ce4965a3f9"
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/NUnit/3.0.1",
          "dest-filename": "thirdparty/download/NUnit.zip",
          "sha256": "17ac607de03c861b9595fe7063ea5fe7ed60b72d063fb9c3ba2aeff4f61c72bc"
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/NUnit.Console/3.0.1",
          "dest-filename": "thirdparty/download/NUnit.Console.zip",
          "sha256": "b744e7921a6d8e4fccd4c05cf50b040b6c8d11c4c7346ed1f6ba242b2ac78b94"
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/Open.Nat/2.1.0",
          "dest-filename": "thirdparty/download/Open.Nat.zip",
          "sha256": "93bb2ac468937855215ef28e77ae06df03e1bab8f09b3459e9bc31cf1d18cdcb"
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/FuzzyLogicLibrary/1.2.0",
          "dest-filename": "thirdparty/download/FuzzyLogicLibrary.zip",
          "sha256": "b464509236260f53d963771ed99410a7e1cdbd268a2bde43b189e7d15044a174"
        },
        {
          "type": "file",
          "url": "https://github.com/OpenRA/SDL2-CS/releases/download/20161223/SDL2-CS.dll",
          "dest-filename": "thirdparty/download/SDL2-CS.dll",
          "sha256": "b06c14a771d14cb37210f476dfd973d4e7d80d97f90566bd5bc78996ade4f7a0"
        },
        {
          "type": "file",
          "url": "https://github.com/OpenRA/SDL2-CS/releases/download/20161223/SDL2-CS.dll.config",
          "dest-filename": "thirdparty/download/SDL2-CS.dll.config",
          "sha256": "eff0594f7e86d40a94c1b28f8db87478f3de1cf0857f3d46e384bcc6744ce094"
        },
        {
          "type": "file",
          "url": "https://github.com/OpenRA/OpenAL-CS/releases/download/20151227/OpenAL-CS.dll",
          "dest-filename": "thirdparty/download/OpenAL-CS.dll",
          "sha256": "d33391fd954c670a3ba3db2d1553015f78652ea33ca3eaf949da6377ec947e53"
        },
        {
          "type": "file",
          "url": "https://github.com/OpenRA/OpenAL-CS/releases/download/20151227/OpenAL-CS.dll.config",
          "dest-filename": "thirdparty/download/OpenAL-CS.dll.config",
          "sha256": "58eaf46a749e466fce0a0ec43184073b0153aa8eb24c865219491bc1db989571"
        },
        {
          "type": "file",
          "url": "https://github.com/OpenRA/Eluant/releases/download/20160124/Eluant.dll",
          "dest-filename": "thirdparty/download/Eluant.dll",
          "sha256": "218c4ea5424b44d746b5343563123beebc652fd9731967dfd49fed071b58df31"
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/SmartIrc4net/0.4.5.1",
          "dest-filename": "thirdparty/download/SmartIrc4net.zip",
          "sha256": "4b58596540383f58a24a99cf73391b3e80e15d7498dec785ac7cbb34a40ea3b4"
        },
        {
          "type": "file",
          "url": "https://nuget.org/api/v2/package/rix0rrr.BeaconLib/1.0.1",
          "dest-filename": "thirdparty/download/rix0rrr.BeaconLib.zip",
          "sha256": "e8e126b98ae7676cb0434455aa8a41c17a927c1b40c4cf368f9527af6bc251f2"
        },
        {
          "type": "archive",
          "url": "https://geolite.maxmind.com/download/geoip/database/GeoLite2-Country_20171107.tar.gz",
          "dest": "thirdparty/download/",
          "sha256": "ad497e127835fd5af30aa512ab063e36b561aaa5f91281b1b92ad089b7c659ec"
        },
        {
          "type": "shell",
          "commands": ["gzip thirdparty/download/GeoLite2-Country.mmdb"]
        },
        {
          "type": "patch",
          "path": "OpenRA-lua-search-path.patch"
        }
      ],
      "buildsystem": "simple",
      "build-commands": [
        "make version",
        "make dependencies",
        "make",
        "make prefix=/app install",
        "make prefix=/app install-linux-shortcuts",
        "make prefix=/app install-linux-appdata"
      ]
    },
    {
      "name": "export-other-mods",
      "buildsystem": "simple",
      "build-commands": [
        "sed -i 's/<name>OpenRA - Red Alert/<name>OpenRA/' /app/share/appdata/openra-ra.appdata.xml",
        "sed -i 's/<id>openra/<id>net.openra.OpenRA.openra/' /app/share/appdata/openra-{cnc,d2k}.appdata.xml",
        "sed -i 's/Icon=openra/Icon=net.openra.OpenRA.openra/' /app/share/applications/openra-{cnc,d2k}.desktop",
        "for f in /app/share/icons/hicolor/*/apps/openra-{cnc,d2k}.* /app/share/applications/openra-{cnc,d2k}.desktop; do mv \"$f\" \"$(echo \"$f\" | sed 's/openra/net.openra.OpenRA.openra/')\"; done"
      ]
    }
  ]
}
