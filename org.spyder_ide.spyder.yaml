app-id: org.spyder_ide.spyder
runtime: org.kde.Sdk
runtime-version: '5.15-21.08'
sdk: org.kde.Sdk
command: spyder
rename-desktop-file: spyder.desktop
base: com.riverbankcomputing.PyQt.BaseApp
base-version: '5.15-21.08'
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: spyder
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --share=network
  #- --env=PYTHONPATH=/app/lib/python3/site-packages
  - --env=QTWEBENGINEPROCESS_PATH=/app/bin # fix QTWEBENGINEPROCESS not found
modules:
  #- name: python3-numpy
    #buildsystem: simple
    #build-commands:
      #- python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    #sources:
      #- type: archive
        #url: https://files.pythonhosted.org/packages/64/4a/b008d1f8a7b9f5206ecf70a53f84e654707e7616a771d84c05151a4713e9/numpy-1.22.3.zip
        #sha256: dbc7601a3b7472d559dc7b933b18b4b66f9aa7452c120e87dfb33d02008c8a18
        #x-checker-data:
          #type: pypi
          #name: numpy

  #- name: lapack
    #buildsystem: cmake-ninja
    #builddir: true
    #config-opts:
      #- -DCMAKE_BUILD_TYPE=Release
      #- -DBUILD_SHARED_LIBS=ON
      #- -DBUILD_TESTING=OFF
      #- -DLAPACKE=ON
      #- -DCBLAS=ON
    #sources:
      #- type: archive
        #url: https://github.com/Reference-LAPACK/lapack/archive/refs/tags/v3.10.1.tar.gz
        #sha256: cd005cd021f144d7d5f7f33c943942db9f03a28d110d6a3b80d718a295f7f714
        #x-checker-data:
          #type: anitya
          #project-id: 1534
          #stable-only: true
          #url-template: https://github.com/Reference-LAPACK/lapack/archive/refs/tags/v${version}.tar.gz

  # From org.thonny.Thonny
  # The cryptography Python library is handled specially since it has Rust code and dependencies.
  - python3-setuptools_rust.json

  - name: python3-cryptography
    build-options:
      append-path: /usr/lib/sdk/rust-stable/bin
      env:
        CARGO_HOME: /run/build/python3-cryptography/cargo
        CARGO_NET_OFFLINE: 'true'
        RUST_BACKTRACE: '1'
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/5e/0b/95d387f5f4433cb0f53ff7ad859bd2c6051051cebbb564f139a999ab46de/pycparser-2.21.tar.gz
        sha256: e644fdec12f7872f86c58ff790da456218b10f863970249516d60a5eaca77206
        x-checker-data:
          type: pypi
          name: pycparser
      - type: file
        url: https://files.pythonhosted.org/packages/00/9e/92de7e1217ccc3d5f352ba21e52398372525765b2e0c4530e6eb2ba9282a/cffi-1.15.0.tar.gz
        sha256: 920f0d66a896c2d99f0adbb391f990a84091179542c205fa53ce5787aff87954
        x-checker-data:
          type: pypi
          name: cffi
      - type: archive
        url: https://files.pythonhosted.org/packages/51/05/bb2b681f6a77276fc423d04187c39dafdb65b799c8d87b62ca82659f9ead/cryptography-37.0.2.tar.gz
        sha256: f224ad253cc9cea7568f49077007d2263efa57396a2f2f78114066fd54b5c68e
        x-checker-data:
          type: pypi
          name: cryptography
      # The Cargo sources should be updated whenever cryptography is updated.
      - cargo-sources.json

  - spyder-dependencies.json

  #- name: pybind11
    #buildsystem: simple
    #build-commands:
      #- python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
      #- cmake -DPYBIND11_INSTALL=ON -DPYBIND11_TEST=OFF -DCMAKE_INSTALL_INCLUDEDIR:PATH=${FLATPAK_DEST}/include
        #-DCMAKE_INSTALL_LIBDIR:PATH=${FLATPAK_DEST}/lib -DCMAKE_INSTALL_DATAROOTDIR:PATH=${FLATPAK_DEST}/share
        #.
      #- cmake --build .
      #- cmake --install .
    #sources:
      #- type: archive
        #url: https://github.com/pybind/pybind11/archive/v2.9.2.tar.gz
        #sha256: 6bd528c4dbe2276635dc787b6b1f2e5316cf6b49ee3e150264e455a0d68d19c1
        #x-checker-data:
          #type: anitya
          #project-id: 13384
          #stable-only: true
          #url-template: https://github.com/pybind/pybind11/archive/v$version.tar.gz

    ## version 1.4.2 need new setuptools 62
  #- name: python3-kiwisolver
    #buildsystem: simple
    #build-commands:
      #- python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    #sources:
      #- type: archive
        #url: https://files.pythonhosted.org/packages/8e/87/259fde8cf07d06677f0a749cb157d079ebd00d40fe52faaab1a882a66159/kiwisolver-1.3.2.tar.gz
        #sha256: fc4453705b81d03568d5b808ad8f09c77c47534f6ac2e72e733f9ca4714aa75c
        #x-checker-data:
          #type: pypi
          #name: kiwisolver

  #- name: qhull
    #buildsystem: cmake-ninja
    #sources:
      #- type: archive
        #url: http://www.qhull.org/download/qhull-2020-src-8.0.2.tgz
        #sha256: b5c2d7eb833278881b952c8a52d20179eab87766b00b865000469a45c1838b7e
    #cleanup:
      #- share/doc
      #- bin

  #- name: python3-matplotlib
    #buildsystem: simple
    #build-options:
      #env:
        #MPLSETUPCFG: /run/build/python-matplotlib/matplotlib-setup.cfg
    #build-commands:
      #- ls -l build
      #- python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    #sources:
      #- type: archive
        #dest: build/freetype-2.6.1
        #url: https://downloads.sourceforge.net/project/freetype/freetype2/2.6.1/freetype-2.6.1.tar.gz
        #sha256: 0a3c7dfbda6da1e8fce29232e8e96d987ababbbf71ebc8c75659e4132c367014
      #- type: archive
        #dest: build/qhull-2020.2
        #url: http://www.qhull.org/download/qhull-2020-src-8.0.2.tgz
        #sha256: b5c2d7eb833278881b952c8a52d20179eab87766b00b865000469a45c1838b7e
      #- type: file
        #path: matplotlib-setup.cfg
      #- type: archive
        #url: https://files.pythonhosted.org/packages/8a/46/425a44ab9a71afd2f2c8a78b039c1af8ec21e370047f0ad6e43ca819788e/matplotlib-3.5.1.tar.gz
        #sha256: b2e9810e09c3a47b73ce9cab5a72243a1258f61e7900969097a817232246ce1c
        #x-checker-data:
          #type: pypi
          #name: matplotlib
      #- type: inline
        #dest-filename: mplsetup.cfg
        #base64: false
        #contents: |
          #[libs]
          #system_freetype = True
          #system_qhull = True

  #- name: python3-scipy
    #buildsystem: simple
    #build-options:
      #env:
        #ATLAS: None
        #BLAS: "/app/lib"
        #LAPACK: "/app/lib"
    #build-commands:
      #- python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    #sources:
      #- type: archive
        #url: https://files.pythonhosted.org/packages/26/b5/9330f004b9a3b2b6a31f59f46f1617ce9ca15c0e7fe64288c20385a05c9d/scipy-1.8.1.tar.gz
        #sha256: 9e3fb1b0e896f14a85aa9a28d5f755daaeeb54c897b746df7a55ccb02b340f33
        #x-checker-data:
          #type: pypi
          #name: scipy

  - name: spyder-kernels
    buildsystem: simple
    build-commands:
      - python3 -mpip list
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/1a/16/92f8093074317dc059962267502b4ec86e34607db82a586520e9e5d2e0ad/spyder-kernels-2.3.1.tar.gz
        sha256: 98fb77717ee94b5a3c8069612fc438bb748597179a5b3ecba290faa922782e50
        x-checker-data:
          type: pypi
          name: spyder-kernels

  - name: python3-pyls-spyder
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/94/e0/17ebfbc3cdd9d2bed54f4904672d8c766b5f48c930d699e20566061b6720/pyls-spyder-0.4.0.tar.gz
        sha256: 45a321c83f64267d82907492c55199fccabda45bc872dd23bf1efd08edac1b0b
        x-checker-data:
          type: pypi
          name: pyls-spyder

  #- name: python3-Pytest
    #buildsystem: simple
    #build-commands:
      #- python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    #sources:
      #- type: git
        #url: https://github.com/pytest-dev/pytest
        #tag: 7.1.2
        #commit: 2f2f1a601e33aa1a77de42f164ba4b642252f1c0
        #x-checker-data:
          #type: pypi
          #name: pytest
    #modules:
      #- python3-pytest-dep.json

  - name: libspatialindex
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/libspatialindex/libspatialindex/releases/download/1.9.3/spatialindex-src-1.9.3.tar.bz2
        sha256: 4a529431cfa80443ab4dcd45a4b25aebbabe1c0ce2fa1665039c80e999dcc50a

  - name: python3-rtree
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: git
        url: https://github.com/Toblerity/rtree
        tag: 1.0.0

  - name: Spyder
    buildsystem: simple
    build-commands:
      - sed -i 's/\r$//' spyder/app/restart.py
      - sed -i 's/\r$//' LICENSE.txt CHANGELOG.md
      - sed -i -e '1 {s:/usr/bin/env bash.*:%{_bindir}/bash:}' spyder/plugins/ipythonconsole/scripts/conda-activate.sh
      - rm spyder/utils/check-git.sh
      - rm spyder/plugins/ipythonconsole/scripts/conda-activate.bat
      - rm -r external-deps/*
      - sed -r -e 's/(ipython.*),<8.0.0/\1/' -e 's/(IPython.*),<8.0.0/\1/' -e 's/(pyqt.*)<5.16/\1/' -i setup.py requirements/conda.txt binder/environment.yml
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
      #- export QT_DEBUG_PLUGINS=1
      #- export DISPLAY=:0.0
      #- python3 runtests.py
    post-install:
      - install -Dm0644 /app/share/icons/spyder.png /app/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png
      - desktop-file-edit --set-icon=${FLATPAK_ID} ${FLATPAK_DEST}/share/applications/spyder.desktop
    sources:
      - type: git
        url: https://github.com/spyder-ide/spyder
        #tag: v5.3.1
        commit: 2997237948498950406167d9ea1e1b0fa5d06672
        x-checker-data:
          type: pypi
          name: spyder

  #- python3-spyder-ter.json

  #- name: spyder-terminal
    #buildsystem: simple
    #build-commands:
      #- python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    #sources:
      #- type: archive
        #url: https://files.pythonhosted.org/packages/00/fe/a89d18983b9f7d881fa16089b418b7febfb9e1a2ea8f5a0ce39e59474859/spyder-terminal-1.2.2.tar.gz
        #sha256: 34235070276a0cb255a5c371cbef076a355059a8a8c71fa9805df229ea0335da
        #x-checker-data:
          #type: pypi
          #name: spyder-terminal

  #- name: spyder-unittest
    #buildsystem: simple
    #build-commands:
      #- python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    #sources:
      #- type: archive
        #url: https://files.pythonhosted.org/packages/73/67/86b2dfdd9550941bc893adfe986b3b6373a8fb69af2435061efcdfb95607/spyder_unittest-0.5.0.tar.gz
        #sha256: 34d0739258d28d663965207da855bdfb1f76af2269e0b18a1d2c582271186858
        #x-checker-data:
          #type: pypi
          #name: spyder-unittest
