app-id: org.spyder_ide.spyder
runtime: org.kde.Sdk
runtime-version: '5.15-21.08'
sdk: org.kde.Sdk
command: spyder
rename-desktop-file: spyder.desktop
base: com.riverbankcomputing.PyQt.BaseApp
base-version: '5.15-21.08'
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: spyder
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --share=network
  - --env=PYTHONPATH=/app/lib/python3.9/site-packages
  - --env=QTWEBENGINEPROCESS_PATH=/app/bin # fix QTWEBENGINEPROCESS not found
modules:
  # From org.thonny.Thonny
  # The cryptography Python library is handled specially since it has Rust code and dependencies.
  - python3-setuptools_rust.json

  - name: python3-cryptography
    build-options:
      append-path: /usr/lib/sdk/rust-stable/bin
      env:
        CARGO_HOME: /run/build/python3-cryptography/cargo
        CARGO_NET_OFFLINE: 'true'
        RUST_BACKTRACE: '1'
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/5e/0b/95d387f5f4433cb0f53ff7ad859bd2c6051051cebbb564f139a999ab46de/pycparser-2.21.tar.gz
        sha256: e644fdec12f7872f86c58ff790da456218b10f863970249516d60a5eaca77206
        x-checker-data:
          type: pypi
          name: pycparser
      - type: file
        url: https://files.pythonhosted.org/packages/00/9e/92de7e1217ccc3d5f352ba21e52398372525765b2e0c4530e6eb2ba9282a/cffi-1.15.0.tar.gz
        sha256: 920f0d66a896c2d99f0adbb391f990a84091179542c205fa53ce5787aff87954
        x-checker-data:
          type: pypi
          name: cffi
      - type: archive
        url: https://files.pythonhosted.org/packages/51/05/bb2b681f6a77276fc423d04187c39dafdb65b799c8d87b62ca82659f9ead/cryptography-37.0.2.tar.gz
        sha256: f224ad253cc9cea7568f49077007d2263efa57396a2f2f78114066fd54b5c68e
        x-checker-data:
          type: pypi
          name: cryptography
      # The Cargo sources should be updated whenever cryptography is updated.
      - cargo-sources.json

  - spyder-deps-no-PyQt.json

  #- name: zeromq
    #buildsystem: cmake-ninja
    #builddir: true
    #config-opts:
      #- -DCMAKE_BUILD_TYPE=Release
    #sources:
      #- type: archive
        #url: https://github.com/zeromq/libzmq/releases/download/v4.3.4/zeromq-4.3.4.tar.gz
        #sha256: c593001a89f5a85dd2ddf564805deb860e02471171b3f204944857336295c3e5
        #x-checker-data:
          #type: anitya
          #project-id: 16245
          #stable-only: true
          #url-template: https://github.com/zeromq/libzmq/releases/download/v$version/zeromq-$version.tar.gz

  #- name: python3-pyzmq
    #buildsystem: simple
    #build-commands:
      #- python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    #sources:
      #- type: archive
        #url: https://github.com/zeromq/pyzmq/archive/refs/tags/v23.0.0.tar.gz
        #sha256: 5b1a413c1b9b51b553bee678fef82e704804e061d26d0a78601f53f7aa0186f3

  - name: jupyter-client
    buildsystem: simple
    ensure-writable:
      - /bin/*
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/2c/d6/db61927064a9781d7e61163b3ea5f630d21a3af4bdeedb9d91738f9df487/jupyter_client-7.3.1.tar.gz
        sha256: 05d4ff6a0ade25138c6bb0fbeac7ddc26b5fe835e7dd816b64b4a45b931bdc0b
        x-checker-data:
          type: pypi
          name: jupyter-client

  - name: lapack
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_SHARED_LIBS=ON
      - -DBUILD_TESTING=OFF
      - -DLAPACKE=ON
      - -DCBLAS=ON
    sources:
      - type: archive
        url: https://github.com/Reference-LAPACK/lapack/archive/refs/tags/v3.10.1.tar.gz
        sha256: cd005cd021f144d7d5f7f33c943942db9f03a28d110d6a3b80d718a295f7f714
        x-checker-data:
          type: anitya
          project-id: 1534
          stable-only: true
          url-template: https://github.com/Reference-LAPACK/lapack/archive/refs/tags/v${version}.tar.gz

  - name: python3-numpy
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/64/4a/b008d1f8a7b9f5206ecf70a53f84e654707e7616a771d84c05151a4713e9/numpy-1.22.3.zip
        sha256: dbc7601a3b7472d559dc7b933b18b4b66f9aa7452c120e87dfb33d02008c8a18
        x-checker-data:
          type: pypi
          name: numpy

  - name: pybind11
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
      - cmake -DPYBIND11_INSTALL=ON -DPYBIND11_TEST=OFF -DCMAKE_INSTALL_INCLUDEDIR:PATH=${FLATPAK_DEST}/include
        -DCMAKE_INSTALL_LIBDIR:PATH=${FLATPAK_DEST}/lib -DCMAKE_INSTALL_DATAROOTDIR:PATH=${FLATPAK_DEST}/share
        .
      - cmake --build .
      - cmake --install .
    sources:
      - type: archive
        url: https://github.com/pybind/pybind11/archive/v2.9.2.tar.gz
        sha256: 6bd528c4dbe2276635dc787b6b1f2e5316cf6b49ee3e150264e455a0d68d19c1
        x-checker-data:
          type: anitya
          project-id: 13384
          stable-only: true
          url-template: https://github.com/pybind/pybind11/archive/v$version.tar.gz

  - name: python-matplotlib
    buildsystem: simple
    build-options:
      env:
        MPLSETUPCFG: /run/build/python-matplotlib/matplotlib-setup.cfg
    build-commands:
      - python3 -mpip list
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: file
        path: matplotlib-setup.cfg
      - type: archive
        url: https://files.pythonhosted.org/packages/8a/46/425a44ab9a71afd2f2c8a78b039c1af8ec21e370047f0ad6e43ca819788e/matplotlib-3.5.1.tar.gz
        sha256: b2e9810e09c3a47b73ce9cab5a72243a1258f61e7900969097a817232246ce1c
        x-checker-data:
          type: pypi
          name: matplotlib

  - name: python3-scipy
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/26/b5/9330f004b9a3b2b6a31f59f46f1617ce9ca15c0e7fe64288c20385a05c9d/scipy-1.8.1.tar.gz
        sha256: 9e3fb1b0e896f14a85aa9a28d5f755daaeeb54c897b746df7a55ccb02b340f33
        x-checker-data:
          type: pypi
          name: scipy

  - name: python3-sympy
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/65/39/fb448ba86935456b4e34106d4c5eb10bb9d891cfaa4426f016b4dedc8ed8/sympy-1.10.1.tar.gz
        sha256: 5939eeffdf9e152172601463626c022a2c27e75cf6278de8d401d50c9d58787b
        x-checker-data:
          type: pypi
          name: sympy

  - name: python3-pandas
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/5a/ac/b3b9aa2318de52e40c26ae7b9ce6d4e9d1bcdaf5da0899a691642117cf60/pandas-1.4.2.tar.gz
        sha256: 92bc1fc585f1463ca827b45535957815b7deb218c549b7c18402c322c7549a12
        x-checker-data:
          type: pypi
          name: pandas

  - name: spyder-kernels
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/1a/16/92f8093074317dc059962267502b4ec86e34607db82a586520e9e5d2e0ad/spyder-kernels-2.3.1.tar.gz
        sha256: 98fb77717ee94b5a3c8069612fc438bb748597179a5b3ecba290faa922782e50
        x-checker-data:
          type: pypi
          name: spyder-kernels

  - name: Spyder
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    post-install:
      - install -Dm0644 /app/share/icons/spyder.png /app/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png
      - desktop-file-edit --set-icon=${FLATPAK_ID} ${FLATPAK_DEST}/share/applications/spyder.desktop
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/65/d9/180fb345e6a3c08b8014636542e72ac10d6829ccd1898b24b71d9edbe451/spyder-5.3.1.tar.gz
        sha256: 3cd82cb7a2184568b606752be0f3da5e3b7e90171c1b08257659cd9fb2c440cb
        x-checker-data:
          type: pypi
          name: spyder
