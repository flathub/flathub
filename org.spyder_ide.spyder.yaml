app-id: org.spyder_ide.spyder
runtime: org.kde.Sdk
runtime-version: '5.15-22.08'
sdk: org.kde.Sdk
command: spyder
rename-desktop-file: spyder.desktop
base: com.riverbankcomputing.PyQt.BaseApp
base-version: '5.15-22.08'
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: spyder
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --share=network
  - --env=PYTHONPATH=/app/lib/python3.9/site-packages
  - --env=QTWEBENGINEPROCESS_PATH=/app/bin # fix QTWEBENGINEPROCESS not found
build-options:
    append-path: /usr/lib/sdk/rust-stable/bin
modules:
  - name: meson
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --prefix=/app --root=/
    sources:
      - type: git
        url: https://github.com/mesonbuild/meson.git
        tag: 1.1.1

  - name: openblas # dependency for scipy
    no-autogen: true
    make-args:
      - DYNAMIC_ARCH=1
      - DYNAMIC_OLDER=1
      - FC=gfortran
      - NO_CBLAS=1
      - NO_LAPACKE=1
      - TARGET=GENERIC
      - USE_OPENMP=0    # OpenMP off by default, this hack skips 'test_fork' which crashes on i386
    make-install-args:
      - PREFIX=/app
    sources:
      - type: archive
        url: https://github.com/xianyi/OpenBLAS/archive/v0.3.23.tar.gz
        sha256: 5d9491d07168a5d00116cdc068a40022c3455bf9293c7cb86a65b1054d7e5114
        x-checker-data:
          type: anitya
          project-id: 2540
          url-template: https://github.com/xianyi/OpenBLAS/archive/v$version.tar.gz

  - setuptools_rust.json

  - name: python3-maturin
    build-options:
      append-path: /usr/lib/sdk/rust-stable/bin
      env:
        CARGO_HOME: /run/build/python3-maturin/cargo
        CARGO_NET_OFFLINE: 'true'
        RUST_BACKTRACE: '1'
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/7b/78/2814bc0e46a96861aab337fd0404e7937acdb4ce187da239224ab4560d35/maturin-1.1.0.tar.gz
        sha256: 4650aeaa8debd004b55aae7afb75248cbd4d61cd7da2dcf4ead8b22b58cecae0
        x-checker-data:
          type: pypi
          name: maturin
        # wget https://raw.githubusercontent.com/PyO3/maturin/v1.1.0/Cargo.lock && python3 flatpak-builder-tools/cargo/flatpak-cargo-generator.py Cargo.lock -o maturin_cargo_deps.json && rm Cargo.lock
      - maturin_deps.json

  - name: python3-rdps-py
    build-options:
      append-path: /usr/lib/sdk/rust-stable/bin
      env:
        CARGO_HOME: /run/build/python3-rdps-py/cargo
        CARGO_NET_OFFLINE: 'true'
        RUST_BACKTRACE: '1'
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/94/23/d8bea781368626ce8d395d0e4654b085c5a546f857635ab6d3fd655473b9/rpds_py-0.8.11.tar.gz
        sha256: ef29fa64514a17bbc104693acf094e3fef5e98c2ddf58e9777f673fc6b0c5e97
        x-checker-data:
          type: pypi
          name: rdps-py
        # wget https://raw.githubusercontent.com/PyO3/maturin/v1.1.0/Cargo.lock && python3 flatpak-builder-tools/cargo/flatpak-cargo-generator.py Cargo.lock -o maturin_cargo_deps.json && rm Cargo.lock
      - rdps_cargo_deps.json

  # - name: python3-jellyfish
  #   build-options:
  #     append-path: /usr/lib/sdk/rust-stable/bin
  #     env:
  #       CARGO_HOME: /run/build/python3-jellyfish/cargo
  #       CARGO_NET_OFFLINE: 'true'
  #       RUST_BACKTRACE: '1'
  #   buildsystem: simple
  #   build-commands:
  #     - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
  #   sources:
  #     - type: archive
  #       url: https://files.pythonhosted.org/packages/8e/14/d72e01b3e3d5d9f1f5f12c8afafda88f068385c612d8aa517df2b88e2059/jellyfish-1.0.0.tar.gz
  #       sha256: 881aae3671999bb07ce50c27696f29ca7e842f3e123acc0db6525c9999881bd4
  #       x-checker-data:
  #         type: pypi
  #         name: jellyfish
  #       # cargo generate-lockfile && wget https://raw.githubusercontent.com/PyO3/maturin/v1.1.0/Cargo.lock && python3 flatpak-builder-tools/cargo/flatpak-cargo-generator.py Cargo.lock -o jellyfish_cargo_deps.json && rm Cargo.lock
  #     - jellyfish_cargo_deps.json

  - name: python3-cryptography
    build-options:
      append-path: /usr/lib/sdk/rust-stable/bin
      env:
        CARGO_HOME: /run/build/python3-cryptography/cargo
        CARGO_NET_OFFLINE: 'true'
        RUST_BACKTRACE: '1'
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/5e/0b/95d387f5f4433cb0f53ff7ad859bd2c6051051cebbb564f139a999ab46de/pycparser-2.21.tar.gz
        sha256: e644fdec12f7872f86c58ff790da456218b10f863970249516d60a5eaca77206
        x-checker-data:
          type: pypi
          name: pycparser
      - type: file
        url: https://files.pythonhosted.org/packages/00/9e/92de7e1217ccc3d5f352ba21e52398372525765b2e0c4530e6eb2ba9282a/cffi-1.15.0.tar.gz
        sha256: 920f0d66a896c2d99f0adbb391f990a84091179542c205fa53ce5787aff87954
        x-checker-data:
          type: pypi
          name: cffi
      - type: archive
        url: https://files.pythonhosted.org/packages/51/05/bb2b681f6a77276fc423d04187c39dafdb65b799c8d87b62ca82659f9ead/cryptography-37.0.2.tar.gz
        sha256: f224ad253cc9cea7568f49077007d2263efa57396a2f2f78114066fd54b5c68e
        x-checker-data:
          type: pypi
          name: cryptography
      # The Cargo sources should be updated whenever cryptography is updated.
      - cargo-sources.json

    # python3 flatpak-pip-generator tomli setuptools_scm_git_archive setuptools_scm pyparsing pybind11 certifi pyparsing pillow atomicwrites chardet cloudpickle cookiecutter diff-match-patch intervaltree ipython jedi jsonschema keyring nbconvert numpydoc parso pexpect pickleshare psutil pygments pylint pyls-spyder hatchling==1.17.1 python-lsp-black pyxdg pyzmq qdarkstyle qstylizer qtawesome qtconsole rtree sphinx textdistance three-merge watchdog alabaster astroid attrs autopep8 babel binaryornot black click dill docutils entrypoints flake8 importlib-metadata importlib-resources inflection ipykernel isort jeepney Jinja2 jinja2-time jupyter-client jupyter-core MarkupSafe matplotlib-inline mccabe mistune nbclient nbformat pandocfilters platformdirs pluggy poyo prompt-toolkit ptyprocess pycodestyle pydocstyle pyflakes pyrsistent python-lsp-jsonrpc python-lsp-server python-slugify requests rope SecretStorage six snowballstemmer sortedcontainers sphinxcontrib-htmlhelp sphinxcontrib-serializinghtml tinycss2 traitlets typing-extensions ujson wurlitzer backcall beautifulsoup4 bleach decorator defusedxml imagesize ipython-genutils jupyterlab-pygments packaging cppy sphinxcontrib-applehelp sphinxcontrib-devhelp sphinxcontrib-jsmath sphinxcontrib-qthelp yapf certifi charset-normalizer debugpy idna lazy-object-proxy mypy-extensions nest-asyncio pathspec pyparsing python-dateutil pytz soupsieve text-unidecode tornado urllib3 webencodings wrapt zipp arrow fastjsonschema wcwidth cffi pycparser numpy sympy kiwisolver fonttools cycler meson-python contourpy openpyxl versioneer pandas pythran scipy statsmodels -o spyder_deps && fb


    # python3 flatpak-pip-generator atomicwrites==1.4.1 chardet==5.1.0 cloudpickle==2.2.1 cookiecutter==2.2.3 arrow==1.2.3 python-dateutil==2.8.2 six==1.16.0 binaryornot==0.4.4 click==8.1.5 jinja2==3.1.2 markupsafe==2.1.3 python-slugify==8.0.1 text-unidecode==1.3 pyyaml==6.0 requests==2.31.0 certifi==2023.5.7 charset-normalizer==3.2.0 idna==3.4 urllib3==2.0.3 diff-match-patch==20230430 intervaltree==3.1.0 sortedcontainers==2.4.0 ipython==8.14.0 backcall==0.2.0 decorator==5.1.1 jedi==0.18.2 parso==0.8.3 matplotlib-inline==0.1.6 traitlets==5.9.0 pexpect==4.8.0 ptyprocess==0.7.0 pickleshare==0.7.5 prompt-toolkit==3.0.39 wcwidth==0.2.6 pygments==2.15.1 stack-data==0.6.2 asttokens==2.2.1 executing==1.2.0 pure-eval==0.2.2 jellyfish==1.0.0 jsonschema==4.18.3 attrs==23.1.0 jsonschema-specifications==2023.6.1 referencing==0.29.1 rpds-py==0.8.11 keyring==24.2.0 importlib-metadata==6.8.0 zipp==3.16.2 jaraco-classes==3.3.0 more-itertools==9.1.0 jeepney==0.8.0 secretstorage==3.3.3 cryptography==41.0.2 cffi==1.15.1 pycparser==2.21 nbconvert==7.7.1 beautifulsoup4==4.12.2 soupsieve==2.4.1 bleach==6.0.0 webencodings==0.5.1 defusedxml==0.7.1 jupyter-core==5.3.1 platformdirs==3.9.1 jupyterlab-pygments==0.2.2 mistune==3.0.1 nbclient==0.8.0 jupyter-client==8.3.0 pyzmq==25.1.0 tornado==6.3.2 nbformat==5.9.1 fastjsonschema==2.17.1 packaging==23.1 pandocfilters==1.5.0 tinycss2==1.2.1 numpydoc==1.5.0 sphinx==7.0.1 alabaster==0.7.13 babel==2.12.1 docutils==0.20.1 imagesize==1.4.1 snowballstemmer==2.2.0 sphinxcontrib-applehelp==1.0.4 sphinxcontrib-devhelp==1.0.2 sphinxcontrib-htmlhelp==2.0.1 sphinxcontrib-jsmath==1.0.1 sphinxcontrib-qthelp==1.0.3 sphinxcontrib-serializinghtml==1.1.5 psutil==5.9.5 pylint-venv==3.0.2 pylint==2.17.4 astroid==2.15.6 lazy-object-proxy==1.9.0 wrapt==1.15.0 dill==0.3.6 isort==5.12.0 mccabe==0.7.0 tomlkit==0.11.8 pyls-spyder==0.4.0 python-lsp-server==1.7.4 docstring-to-markdown==0.12 pluggy==1.2.0 python-lsp-jsonrpc==1.0.0 ujson==5.8.0 setuptools==68.0.0 python-lsp-black==1.3.0 black==23.7.0 mypy-extensions==1.0.0 pathspec==0.11.1 autopep8==2.0.2 pycodestyle==2.10.0 flake8==6.0.0 pyflakes==3.0.1 pydocstyle==6.3.0 rope==1.9.0 pytoolconfig==1.2.5 whatthepatch==1.0.5 yapf==0.40.1 tomli==2.0.1 pyxdg==0.28 qdarkstyle==3.1 qtpy==2.3.1 qstylizer==0.2.2 inflection==0.5.1 qtawesome==1.2.3 qtconsole==5.4.3 ipykernel==6.24.0 comm==0.1.3 debugpy==1.6.7 nest-asyncio==1.5.6 ipython-genutils==0.2.0 rtree==1.0.1 spyder-kernels==2.4.4 wurlitzer==3.0.3 textdistance==4.5.0 three-merge==0.1.1 watchdog==3.0.0 sympy kiwisolver fonttools cycler meson-python contourpy openpyxl versioneer pandas pythran scipy statsmodels -o spyder_deps && fb
  # - spyder_deps.json

    # pipgrip spyder > spyder_pipgrip.txt && sed -i '/^pyqt/d; /^spyder/d' spyder_pipgrip.txt && req2flatpak --requirements-file spyder_pipgrip.txt --target-platforms 310-x86_64 310-aarch64 --outfile spyder_requires.json
  - spyder_requires.json

    # python3 flatpak-pip-generator tomli setuptools_scm_git_archive setuptools_scm setuptools_rust pybind11 certifi pyparsing pillow packaging cppy kiwisolver fonttools cycler meson-python contourpy openpyxl versioneer pandas pythran scipy statsmodels -o spyder_optional && fb
  - spyder_optional.json

  - name: python3-matplotlib
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST}
        --no-build-isolation
    sources:
      - type: archive
        dest: build/freetype-2.6.1
        url: https://sourceforge.net/projects/freetype/files/freetype2/2.13.1/freetype-2.13.1.tar.gz
        sha256: 0b109c59914f25b4411a8de2a506fdd18fa8457eb86eca6c7b15c19110a92fa5
      - type: archive
        dest: build/qhull-2020.2
        url: http://www.qhull.org/download/qhull-2020-src-8.0.2.tgz
        sha256: b5c2d7eb833278881b952c8a52d20179eab87766b00b865000469a45c1838b7e
      - type: archive
        url: https://files.pythonhosted.org/packages/e5/59/b859fa2539b4121b016ea85758188203522fc12b0711de8b247cfec3cdac/matplotlib-3.7.2.tar.gz
        sha256: a8cdb91dddb04436bd2f098b8fdf4b81352e68cf4d2c6756fcc414791076569b
        x-checker-data:
          type: pypi
          name: matplotlib

  # From org.thonny.Thonny
  # The cryptography Python library is handled specially since it has Rust code and dependencies.
  # - python3-setuptools_rust.json

  # - name: python3-cryptography
  #   build-options:
  #     append-path: /usr/lib/sdk/rust-stable/bin
  #     env:
  #       CARGO_HOME: /run/build/python3-cryptography/cargo
  #       CARGO_NET_OFFLINE: 'true'
  #       RUST_BACKTRACE: '1'
  #   buildsystem: simple
  #   build-commands:
  #     - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
  #   sources:
  #     - type: file
  #       url: https://files.pythonhosted.org/packages/5e/0b/95d387f5f4433cb0f53ff7ad859bd2c6051051cebbb564f139a999ab46de/pycparser-2.21.tar.gz
  #       sha256: e644fdec12f7872f86c58ff790da456218b10f863970249516d60a5eaca77206
  #       x-checker-data:
  #         type: pypi
  #         name: pycparser
  #     - type: file
  #       url: https://files.pythonhosted.org/packages/00/9e/92de7e1217ccc3d5f352ba21e52398372525765b2e0c4530e6eb2ba9282a/cffi-1.15.0.tar.gz
  #       sha256: 920f0d66a896c2d99f0adbb391f990a84091179542c205fa53ce5787aff87954
  #       x-checker-data:
  #         type: pypi
  #         name: cffi
  #     - type: archive
  #       url: https://files.pythonhosted.org/packages/51/05/bb2b681f6a77276fc423d04187c39dafdb65b799c8d87b62ca82659f9ead/cryptography-37.0.2.tar.gz
  #       sha256: f224ad253cc9cea7568f49077007d2263efa57396a2f2f78114066fd54b5c68e
  #       x-checker-data:
  #         type: pypi
  #         name: cryptography
  #     # The Cargo sources should be updated whenever cryptography is updated.
  #     - cargo-sources.json

  # - name: python3-rtree
  #   buildsystem: simple
  #   build-commands:
  #     - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
  #   sources:
  #     - type: archive
  #       url: https://files.pythonhosted.org/packages/0c/fd/06d60621622952ba11155416128ef62f1690ae7ca710a10a49961786c05a/Rtree-1.0.0.tar.gz
  #       sha256: d0483482121346b093b9a42518d40f921adf445915b7aea307eb26768c839682
  #       x-checker-data:
  #         type: pypi
  #         name: rtree
  #   modules:
  #     - name: libspatialindex
  #       buildsystem: cmake-ninja
  #       sources:
  #         - type: archive
  #           url: https://github.com/libspatialindex/libspatialindex/releases/download/1.9.3/spatialindex-src-1.9.3.tar.bz2
  #           sha256: 4a529431cfa80443ab4dcd45a4b25aebbabe1c0ce2fa1665039c80e999dcc50a

  # - spyder-dependencies.json

  - name: python3-pyls-spyder
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/94/e0/17ebfbc3cdd9d2bed54f4904672d8c766b5f48c930d699e20566061b6720/pyls-spyder-0.4.0.tar.gz
        sha256: 45a321c83f64267d82907492c55199fccabda45bc872dd23bf1efd08edac1b0b
        x-checker-data:
          type: pypi
          name: pyls-spyder

  - name: spyder-kernels
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/5c/d8/16ebcde51466824478e646fcc0a348efb116a08262b3fe5505aa80166710/spyder-kernels-2.3.2.tar.gz
        sha256: bab23b024db9359cec5182e247e70875f71ddc40a8271fd1353de08f440f26dc
        x-checker-data:
          type: pypi
          name: spyder-kernels

  - name: Spyder
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    post-install:
      - install -Dm0644 /app/share/icons/spyder.png /app/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png
      - desktop-file-edit --set-icon=${FLATPAK_ID} ${FLATPAK_DEST}/share/applications/spyder.desktop
    sources:
      - type: git
        url: https://github.com/spyder-ide/spyder
        tag: v5.4.3
        #commit: 2997237948498950406167d9ea1e1b0fa5d06672
        x-checker-data:
          type: pypi
          name: spyder

  - name: spyder-terminal
    buildsystem: simple
    build-commands:
      - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/00/fe/a89d18983b9f7d881fa16089b418b7febfb9e1a2ea8f5a0ce39e59474859/spyder-terminal-1.2.2.tar.gz
        sha256: 34235070276a0cb255a5c371cbef076a355059a8a8c71fa9805df229ea0335da
        x-checker-data:
          type: pypi
          name: spyder-terminal

  # - name: spyder-unittest
  #   buildsystem: simple
  #   build-commands:
  #     - python3 -mpip list
  #     - python3 -mpip install . --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation
  #   sources:
  #     - type: archive
  #       url: https://files.pythonhosted.org/packages/73/67/86b2dfdd9550941bc893adfe986b3b6373a8fb69af2435061efcdfb95607/spyder_unittest-0.5.0.tar.gz
  #       sha256: 34d0739258d28d663965207da855bdfb1f76af2269e0b18a1d2c582271186858
  #       x-checker-data:
  #         type: pypi
  #         name: spyder-unittest

  #- name: pythonstart
    #buildsystem: simple
    #build-commands:
      #- cp pythonstart ${FLATPAK_DEST}/etc
      #- ls -l /app/etc
    #sources:
      #- type: file
        #path: pythonstart
