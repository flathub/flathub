app-id: io.sourceforge.klatexformula.klatexformula

runtime: org.kde.Platform
runtime-version: '5.15-24.08'
sdk: org.kde.Sdk

base: com.riverbankcomputing.PyQt.BaseApp
base-version: '5.15-24.08'
cleanup-commands:
  - /app/cleanup-BaseApp.sh
build-options:
  env:
    - BASEAPP_REMOVE_WEBENGINE=1

rename-desktop-file: klatexformula.desktop
command: klatexformula

finish-args:
  - --device=dri
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --env=PATH=/app/bin:/app/texlive/bin/x86_64-linux:/app/texlive/bin/aarch64-linux:/usr/bin:/bin

add-extensions:
  org.freedesktop.Sdk.Extension.texlive:
    directory: texlive
    subdirectories: true
    autodelete: true
    version: '24.08'
    no-autodownload: true

modules:
  - name: texlive-extension
    buildsystem: simple
    build-commands:
      - mkdir /app/texlive

  - name: ghostscript
    sources:
      - type: archive
        url: https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs10051/ghostscript-10.05.1.tar.gz
        sha256: 121861b6d29b2461dec6575c9f3cab665b810bd408d4ec02c86719fa708b0a49

  - name: klatexformula
    buildsystem: cmake-ninja
    config-opts:
      - -DKLF_INSTALL_DESKTOP_ICON=io.sourceforge.klatexformula.klatexformula
    sources:
      - type: archive
        url: http://downloads.sourceforge.net/project/klatexformula/klatexformula/klatexformula-4.1.0/klatexformula-4.1.0.tar.gz
        sha256: 7af0999eeee38176ea34f9f96b358e43e343c73edf6f56143f18794303ca8702
      - type: patch
        path: applied-suggested-patch-fixes-53.patch
      - type: file
        path: io.sourceforge.klatexformula.klatexformula.metainfo.xml
    post-install:
      - install -Dm0644 io.sourceforge.klatexformula.klatexformula.metainfo.xml -t $FLATPAK_DEST/share/metainfo
      - install -Dm0644 src/klatexformula.svg $FLATPAK_DEST/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg
