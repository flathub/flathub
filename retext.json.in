{
    "name": "retext",
    //"buildsystem": "simple",
    //"build-commands": [
    //    "python3 setup.py build; python3 setup.py install -O1 --skip-build --prefix=/app --root=/;"
    //],
    "no-autogen": true,
    "sources": [
        {
            "type": "archive",
            //"url": "https://github.com/retext-project/retext/archive/7.0.0.tar.gz",
            //"sha256": "7df3fcdad1d1f9a046ae33591b54dd7a6894de64eb0370f2dabf4cd75eb66586"
            //"url": "https://github.com/retext-project/retext/archive/7.0.1.tar.gz",
            //"sha256": "c32ccdbcf31094258c792bc0589ff3ff212dea85466d776b7f60fa7b39da4b6c"
            //"url": "https://pypi.python.org/packages/2a/ba/581591a8a8d48d02236b57633ae5f55247424885e143fe1d21fba904a1ed/ReText-7.0.1.tar.gz",
            //"sha256": "f5a2dbfb32b96423fd3e5ef00488440c36a2bcecbc6356f5c17674b265316eea"
            "url": "https://files.pythonhosted.org/packages/01/70/aa870c2222be0ffe6efc700d9eb4f9125164b04e017a00f9302774ad62b2/ReText-7.0.3.tar.gz",
            "sha256": "e549697c9b7254930c8529e5b1d44155980fcd3d182d95be39b01387af71673c"
        },
        {
            "type": "archive",
            "url": "https://github.com/mquinson/po4a/archive/v0.52.tar.gz",
            "sha256": "547c410ad3bb8e5fd3939a6acdd39713529187be05fca7235095d57d3f0c6cfc",
            "strip-components": 0
        },
        // https://koji.fedoraproject.org/koji/buildinfo?buildID=941463
        // The template for man page translations can be created with this command:
        // po4a-updatepo -v -M utf-8 -f man -m retext.1 -p retext-man.pot
        // English man pages are taken from the Debian package.
        {
            "type": "file",
            //"url": "https://mariobl.fedorapeople.org/Retext/retext-man-de.po",
            "path": "retext-man-de.po",
            "sha256": "9b00b30a693a3023b2f5619ab0586ddf9bd8f5bc9b75c2dabd5d6493558bb6f7"
        },
        {
            "type": "file",
            //"url": "https://mariobl.fedorapeople.org/Retext/retext.1",
            "path": "retext.1",
            "sha256": "300f04c1f808f63351b16ed0fa0f2d01b857c4d096ed71dcf54ab95281727d9a"
        },
        // Disable external web renderer due instability.
        // https://github.com/retext-project/retext/issues/359
        // [0506/073402.338198:WARNING:stack_trace_posix.cc(648)] Failed to open file: /tmp/.glvaG1Tp (deleted)
        // Error: No such file or directory
        // [3:29:0506/073402.410560:FATAL:udev_loader.cc(38)] Check failed: false. 
        // https://bugs.archlinux.org/task/57152
        // https://github.com/spyder-ide/spyder/issues/6471
        // https://github.com/qutebrowser/qutebrowser/issues/3459
        // https://github.com/qutebrowser/qutebrowser/issues/3511
        // https://bugreports.qt.io/browse/QTBUG-67023
        // https://bugreports.qt.io/browse/QTBUG-65682
        // [3:24:0507/024650.994409:FATAL:resource_scheduler.cc(733)] Check failed: client_map_.empty().
        // https://bugreports.qt.io/browse/QTBUG-59765
        // https://bugreports.qt.io/browse/QTBUG-56441
        // https://bugreports.qt.io/browse/QTBUG-50160
        {
            "type": "shell",
            "commands": [
                "echo 'disabling external renderer';",
                "cp 'ReText/window.py' 'ReText/window.py.bak';",
                "cp 'ReText/tab.py' 'ReText/tab.py.bak';",
                "sed -r -i 's/^([[:blank:]]*)(menuEdit\\.addAction\\(self\\.(actionWebKit|actionWebEngine)\\))([[:blank:]]*)$/\\1pass #\\2\\4/' 'ReText/window.py';",
                "sed -r -i 's/^([[:blank:]]*)(globalSettings\\.(useWebKit|useWebEngine)[[:blank:]]*=[[:blank:]]*)(enable)([[:blank:]]*)$/\\1\\2False\\5/' 'ReText/window.py';",
                "sed -r -i 's/^(([[:blank:]]*)(if ReTextWebKitPreview and globalSettings\\.useWebKit:)([[:blank:]]*))$/\\2return ReTextPreview\\(self\\)\\n\\1/' 'ReText/tab.py';",
                //"grep -HE 'WebKit|WebEngine' 'ReText/window.py' 'ReText/tab.py';",
                "echo 'ReText/window.py';",
                "diff 'ReText/window.py.bak' 'ReText/window.py' -C 4 || :;",
                "echo 'ReText/tab.py';",
                "diff 'ReText/tab.py.bak' 'ReText/tab.py' -C 4 || :;",
                "rm -f 'ReText/window.py.bak' 'ReText/tab.py.bak';"
            ]
        },
        {
            "type": "file",
            "path": "retext_setup.bash"
        },
        {
            "type": "file",
            "path": "retext_pre-install.bash"
        },
        {
            "type": "file",
            "path": "retext_post-install.bash"
        },
        {
            "type": "shell",
            "commands": [
                "echo 'flatpak scripts: create & edit';",
                "./retext_pre-install.bash;",
                "echo;"
            ]
        },
        {
            "type": "file",
            "path": "empty-Makefile",
            "dest-filename": "Makefile",
            "sha256": "700c973913ef94b5b9762617abb2b9be2e9b04b8a3e5ae98906f8299b826f9d4"
        },
        {
            "type": "shell",
            "commands": [
                "python3 setup.py build; python3 setup.py install -O1 --skip-build --prefix=/app --root=/;"
            ]
        }
    ],
    "post-install": [
        "echo 'flatpak scripts: install & check';",
        "cd '/run/build/retext'; ./retext_post-install.bash;",
        "echo;"
    ]
}
