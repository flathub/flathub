app-id: org.virt_manager.virt-viewer
runtime: org.gnome.Platform
runtime-version: "43"
sdk: org.gnome.Sdk
command: virt-viewer
finish-args:
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=ssh-auth
  - --device=all
  - --share=ipc
  - --share=network
build-options:
  cflags: "-O2 -g"
  cxxflags: "-O2 -g"
cleanup:
  - "/include"
  - "/sbin"
  - "/lib/pkgconfig"
  - "/share/man"
  - "/share/gtk-doc"
  - "/share/gir-*"
  - "/share/pkgconfig"
  - "*.la"
  - "*.a"
modules:
  - name: eudev
    config-opts:
      - "--disable-hwdb"
      - "--disable-logging"
      - "--disable-gudev"
      - "--disable-introspection"
      - "--disable-keymap"
      - "--disable-mtd_probe"
    cleanup:
      - "/include"
      - "/etc"
      - "/libexec"
      - "/sbin"
      - "/lib/pkgconfig"
      - "/man"
      - "/share/aclocal"
      - "/share/doc"
      - "/share/gtk-doc"
      - "/share/man"
      - "/share/pkgconfig"
      - "*.la"
      - "*.a"
    sources:
      - type: archive
        url: https://github.com/eudev-project/eudev/releases/download/v3.2.11/eudev-3.2.11.tar.gz
        sha256: 19847cafec67897da855fde56f9dc7d92e21c50e450aa79068a7e704ed44558b
      - type: script
        dest-filename: autogen.sh
        commands:
          - "autoreconf -vfi"
  - name: gcrypt-wrapper
    buildsystem: simple
    cleanup:
      - "*"
    build-commands:
      - "install -D libgcrypt-config /app/bin/libgcrypt-config"
    sources:
      - type: script
        dest-filename: libgcrypt-config
        commands:
          - "if [ $1 == '--version' ]; then set -- '--modversion' ${@:4}; fi"
          - "exec pkg-config $@ libgcrypt"
  - name: lz4
    build-options:
      env:
        PREFIX: "/app"
    buildsystem: simple
    build-commands:
      - "make -j $FLATPAK_BUILDER_N_JOBS"
      - "make install"
    cleanup:
      - "/bin"
    sources:
      - type: archive
        url: https://github.com/lz4/lz4/archive/refs/tags/v1.9.4.tar.gz
        sha256: 0b0e3aa07c8c063ddf40b082bdf7e37a1562bda40a0ff5272957f3e987e0e54b
  - shared-modules/libusb/libusb.json
  - name: usbutils
    cleanup:
      - "/bin"
    sources:
      - type: archive
        url: https://github.com/gregkh/usbutils/archive/refs/tags/v015.tar.gz
        sha256: 659669e08cbc3961bc085c33f328f950a9570400519c3213b6908f3cc5f44227
  - name: usbredir
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/spice/usbredir/-/archive/usbredir-0.13.0/usbredir-usbredir-0.13.0.tar.bz2
        sha256: f8281022a7ede923b532dd1f869e5348898d44ccf1ccb4af22e8bf20810d9737
  - name: libcacard
    cleanup:
      - "/bin"
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/spice/libcacard/-/archive/v2.8.1/libcacard-v2.8.1.tar.bz2
        sha256: 982b2676f999450352f51e6e6cfeba097feb00a5e9060443c0f0977ce5250785
  - name: libnl
    config-opts:
      - "--enable-cli=no"
    cleanup:
      - "/etc"
    sources:
      - type: archive
        url: https://github.com/thom311/libnl/archive/refs/tags/libnl3_7_0.tar.gz
        sha256: 10d6cca2d5a7ebd63ad3027a7aae701abf335e4ee850fd14f96d5141120b60f0
  - name: gtk-vnc
    buildsystem: meson
    cleanup:
      - "/bin"
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gtk-vnc/1.3/gtk-vnc-1.3.1.tar.xz
        sha256: 512763ac4e0559d0158b6682ca5dd1a3bd633f082f5e4349d7158e6b5f80f1ce
  - name: spice-protocol
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/spice/spice-protocol/-/archive/v0.14.4/spice-protocol-v0.14.4.tar.bz2
        sha256: 2ecedae6c626e112a60e30226124f84637a59fa87b87e3c742db5388249f92e6
  - name: phodav
    buildsystem: meson
    cleanup:
      - "/bin"
    sources:
      - type: archive
        url: https://download.gnome.org/sources/phodav/3.0/phodav-3.0.tar.xz
        sha256: 392ec2d06d50300dcff1ef269a2a985304e29bce3520002fca29f2edc1d138d1
  - name: libvirt
    cleanup:
      - "/bin"
      - "/share"
      - "/libexec"
      - "/etc"
    config-opts:
      - "--prefix=/app"
      - "--sysconfdir=/etc"
      - "--localstatedir=/var"
      - "--without-html-dir"
      - "--without-bash-completion"
      - "--without-test"
      - "--without-html-subdir"
      - "--without-storage-dir"
      - "--without-storage-fs"
      - "--without-storage-lvm"
      - "--without-storage-iscsi"
      - "--without-storage-scsi"
      - "--without-storage-mpath"
      - "--without-storage-disk"
      - "--without-storage-rbd"
      - "--without-storage-sheepdog"
      - "--without-storage-gluster"
      - "--without-storage-zfs"
      - "--without-storage-vstorage"
    sources:
      - type: archive
        url: https://libvirt.org/sources/libvirt-8.10.0.tar.xz
        sha256: bb07b7b00f08f826dd4f623f8b233e4e8b221b8859bb5937ff45355f0ae29952
  - name: libvirt-glib
    buildsystem: meson
    cleanup:
      - "/bin"
    sources:
      - type: archive
        url: https://libvirt.org/sources/glib/libvirt-glib-4.0.0.tar.xz
        sha256: 8423f7069daa476307321d1c11e2ecc285340cd32ca9fc05207762843edeacbd
  - name: spice-gtk
    buildsystem: meson
    cleanup:
      - "/bin"
    config-opts:
      - "--disable-gtk-doc"
      - "--disable-gtk-doc-html"
      - "--disable-gtk-doc-pdf"
      - "--enable-usbredir"
    sources:
      - type: archive
        url: https://www.spice-space.org/download/gtk/spice-gtk-0.41.tar.xz
        sha256: d8f8b5cbea9184702eeb8cc276a67d72acdb6e36e7c73349fb8445e5bca0969f
  - name: virt-viewer
    buildsystem: meson
    sources:
      - type: archive
        url: https://virt-manager.org/download/sources/virt-viewer/virt-viewer-11.0.tar.xz
        sha256: a43fa2325c4c1c77a5c8c98065ac30ef0511a21ac98e590f22340869bad9abd0
