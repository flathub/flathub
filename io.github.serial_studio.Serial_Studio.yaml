app-id: io.github.serial_studio.Serial_Studio
runtime: org.kde.Platform
runtime-version: '6.8'
sdk: org.kde.Sdk
command: serial-studio
separate-locales: false

finish-args:
  - --share=ipc
  - --share=network
  - --socket=x11
  - --device=dri
  - --device=all
  - --filesystem=home
modules:
  - name: serial-studio
    buildsystem: simple
    build-commands:
      - install -Dpm644 io.github.serial_studio.Serial_Studio.desktop -t $FLATPAK_DEST/share/applications
      - install -Dpm644 io.github.serial_studio.Serial_Studio.png -t $FLATPAK_DEST/share/icons/hicolor/256x256/apps
      - install -Dpm644 io.github.serial_studio.Serial_Studio.metainfo.xml -t $FLATPAK_DEST/share/metainfo
      - bsdtar -O -xf Serial-Studio*.deb data.* | bsdtar --no-same-owner -xf -
      - install -Dpm755 opt/serial-studio.AppDir/usr/bin/serial-studio -t $FLATPAK_DEST/bin
      - mkdir -p $FLATPAK_DEST/lib
      - cp -r opt/serial-studio.AppDir/usr/lib/* $FLATPAK_DEST/lib
      - cp -r opt/serial-studio.AppDir/usr/qml $FLATPAK_DEST/lib
      - cp -r opt/serial-studio.AppDir/usr/plugins $FLATPAK_DEST/lib
      - cp -r opt/serial-studio.AppDir/usr/translations $FLATPAK_DEST
    sources:
      - type: file
        path: io.github.serial_studio.Serial_Studio.desktop
      - type: file
        path: io.github.serial_studio.Serial_Studio.png
      - type: file
        path: io.github.serial_studio.Serial_Studio.metainfo.xml
      - type: file
        only-arches:
          - x86_64
        url: https://github.com/Serial-Studio/Serial-Studio/releases/download/v3.0.6/Serial-Studio-3.0.6-Linux-x86_64.deb
        sha256: a0454bc4c8410892a1da77ca09f34e27cff9284bf2f996be5452bbaa7932bdfb
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Serial-Studio/Serial-Studio/releases/latest
          tag-query: .tag_name
          version-query: $tag | sub("^v"; "")
          url-query: .assets[] | select(.name=="Serial-Studio-" + $version + "-Linux-x86_64.deb") | .browser_download_url