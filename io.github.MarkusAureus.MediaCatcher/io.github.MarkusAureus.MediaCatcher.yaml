# io.github.MarkusAureus.MediaCatcher.yaml

app-id: io.github.MarkusAureus.MediaCatcher
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: media-catcher
finish-args:
  - --share=network
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=dri
  - --filesystem=xdg-download
  - --talk-name=org.freedesktop.Notifications
  - --env=QT_QPA_PLATFORM=xcb
  # Pridané pre podporu MimeType v .desktop súbore
  - --own-name=org.freedesktop.portal.OpenURI
  - --talk-name=org.freedesktop.portal.OpenURI

modules:
  # Modul pre PyQt5 a PyQt5-sip
  - name: python3-PyQt5
    buildsystem: simple
    build-commands:
      # pip3 nainštaluje balíky z lokálne stiahnutých súborov
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} PyQt5 PyQt5-sip
    sources:
      # AKTUALIZOVANÉ pre PyQt5-5.15.10.tar.gz (overené a funkčné)
      - type: file
        url: https://files.pythonhosted.org/packages/4d/81/b9a66a28fb6e18c5117de02a6dc525de2a23b074d336ec957b8a83c7ec2a/PyQt5-5.15.10.tar.gz
        sha256: d46b7804b1b10a4ff91753f8113e5b192a2b174454086e15cbe1e20c6f3bb38a
      # AKTUALIZOVANÉ pre PyQt5_sip-12.17.0.tar.gz (overené a funkčné)
      - type: file
        url: https://files.pythonhosted.org/packages/68/2d/dadcbd2239af9fdc0c0628e2776b820e128bec88b49b8d692fe682f90b4f/PyQt5_sip-12.17.0.tar.gz
        sha256: 682dadcdbd2239af9fdc0c0628e2776b820e128bec88b49b8d692fe682f90b4f

  # Modul pre yt-dlp
  - name: yt-dlp
    buildsystem: simple
    build-commands:
      # pip3 nainštaluje balík z lokálne stiahnutého súboru
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} yt-dlp
    sources:
      # AKTUALIZOVANÉ pre yt_dlp-2024.5.27-py3-none-any.whl (overené a funkčné)
      # Použitý .whl súbor, pip3 by s ním mal fungovať.
      - type: file
        url: https://files.pythonhosted.org/packages/f5/63/1f1a5ee7a304892c906a524a877e6e2f11197779d71597843d162986422d/yt_dlp-2024.5.27-py3-none-any.whl
        sha256: 1850109a909405d51848b992f9d8541e21b8d68d184497e742a1b94548d1d867

  # Modul pre FFmpeg a jeho závislosť libwebp
  - name: ffmpeg
    config-opts:
      - --enable-shared
      - --disable-static
      - --enable-gnutls
      - --disable-doc
      - --disable-programs
      - --enable-encoder=png,libwebp
      - --enable-libwebp
    sources:
      - type: archive
        url: https://ffmpeg.org/releases/ffmpeg-6.1.1.tar.xz
        sha256: 8684f4b00f94b85461884c3719382f1261f0d9eb3d59640a1f4ac0873616f968
    modules:
      - name: libwebp
        config-opts:
          - --disable-static
          - --enable-libwebpmux
          - --enable-libwebpdemux
        sources:
          - type: archive
            url: https://storage.googleapis.com/downloads.webmproject.org/releases/webp/libwebp-1.3.2.tar.gz
            sha256: 2a499607df669e40258e53d0ade8035ba4ec0175244869d1025d460562aa09b4

  # Hlavný modul tvojej aplikácie MediaCatcher
  - name: media-catcher
    buildsystem: simple
    build-commands:
      - install -Dm755 media-catcher.py ${FLATPAK_DEST}/bin/media-catcher
      - install -Dm644 themes.json ${FLATPAK_DEST}/share/media-catcher/themes.json
      - install -Dm644 io.github.MarkusAureus.MediaCatcher.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/io.github.MarkusAureus.MediaCatcher.svg
      - install -Dm644 io.github.MarkusAureus.MediaCatcher.desktop ${FLATPAK_DEST}/share/applications/io.github.MarkusAureus.MediaCatcher.desktop
      - install -Dm644 io.github.MarkusAureus.MediaCatcher.metainfo.xml ${FLATPAK_DEST}/share/metainfo/io.github.MarkusAureus.MediaCatcher.metainfo.xml
      - install -Dm644 README.md ${FLATPAK_DEST}/share/doc/io.github.MarkusAureus.MediaCatcher/README.md
      - install -Dm644 LICENSE ${FLATPAK_DEST}/share/doc/io.github.MarkusAureus.MediaCatcher/LICENSE
    sources:
      - type: git
        url: .
        tag: v1.0.0
