app-id: com.pixelomer.ShijimaQt
runtime: org.kde.Platform
runtime-version: '6.8'
sdk: org.kde.Sdk
command: shijima-qt
finish-args:
  - --device=dri
  - --socket=x11
  - --share=ipc
  - --env=SHIJIMA_FLATPAK=1
  - --socket=pulseaudio
  - --env=QT_QPA_PLATFORM=xcb
  # Disable window tracking
  - --env=SHIJIMA_NO_WINDOW_TRACKING=1
  # To be able to listen to and communicate with port 32456 for HTTP API and CLI
  - --share=network
  # Required for activating/deactivating shell extensions and detecting desktop environment
  #- --talk-name=org.gnome.Shell
  - --talk-name=org.kde.KWin
  # Required for running gnome-extensions install
  #- --talk-name=org.freedesktop.Flatpak

modules:
  - name: shijima-qt
    buildsystem: simple
    build-commands:
      - make -j`nproc` CONFIG=release
      - make install CONFIG=release PREFIX=/app
    sources:
      - type: git
        url: https://github.com/pixelomer/Shijima-Qt.git
        # v0.1.0 + Makefile changes for make install + KDE fix
        commit: 5f8be6b9a0fbe1517e73be701954efef7fc7473c
