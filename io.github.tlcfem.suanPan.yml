app-id: io.github.tlcfem.suanPan
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: suanPan
finish-args:
  - '--filesystem=home'
  - '--socket=fallback-x11'
  - '--device=dri'
  - '--socket=wayland'
  - '--share=ipc'
cleanup:
  - /vtk
modules:
  - name: suanPan
    buildsystem: cmake
    builddir: true
    config-opts:
      - '-DCMAKE_BUILD_TYPE=Release'
      - '-DBUILD_MULTITHREAD=ON'
      - '-DUSE_HDF5=ON'
      - '-DUSE_EXTERNAL_VTK=ON'
      - '-DVTK_DIR=/app/vtk/lib/cmake/vtk-9.2/'
    sources:
      - type: git
        url: 'https://github.com/TLCFEM/suanPan.git'
        tag: 'suanPan-v2.6.1'
    modules:
      - name: vtk
        buildsystem: cmake-ninja
        builddir: true
        config-opts:
          - '-DCMAKE_BUILD_TYPE=Release'
          - '-DBUILD_SHARED_LIBS=OFF'
          - '-DCMAKE_INSTALL_PREFIX=/app/vtk'
        sources:
          - type: archive
            url: >-
              https://www.vtk.org/files/release/9.2/VTK-9.2.2.tar.gz
            sha256: 1c5b0a2be71fac96ff4831af69e350f7a0ea3168981f790c000709dcf9121075
      - name: metadata
        buildsystem: simple
        build-commands:
          - install -Dm644 io.github.tlcfem.suanPan.metainfo.xml /app/share/metainfo/io.github.tlcfem.suanPan.metainfo.xml
          - install -Dm644 io.github.tlcfem.suanPan.svg /app/share/icons/hicolor/128x128/apps/io.github.tlcfem.suanPan.svg
          - install -Dm644 io.github.tlcfem.suanPan.desktop /app/share/applications/io.github.tlcfem.suanPan.desktop
        sources:
          - type: file
            url: >-
              https://raw.githubusercontent.com/TLCFEM/suanPan/179121ba75c30bfe378e18c9ba2e63dc40badde0/Resource/io.github.tlcfem.suanPan.metainfo.xml
            sha256: 8af61fa3414c73e899c873f121bc7cd45b54645915ef4f3ad2b98b11d20b2b9e
          - type: file
            url: >-
              https://raw.githubusercontent.com/TLCFEM/suanPan/179121ba75c30bfe378e18c9ba2e63dc40badde0/Resource/io.github.tlcfem.suanPan.svg
            sha256: 9da83ab50ece570b71c5eca0ded844f860b187d64988f4dd3fa0b1d49fe45cc9
          - type: file
            url: >-
              https://raw.githubusercontent.com/TLCFEM/suanPan/179121ba75c30bfe378e18c9ba2e63dc40badde0/Resource/io.github.tlcfem.suanPan.desktop
            sha256: 520fbbcd11bdcdb4fe1d790a0a4bbffd1a5221a303da2311417b14db01d978f2
