app-id: com.github.powertab.powertabeditor
runtime: org.kde.Platform
runtime-version: '5.15-21.08'
sdk: org.kde.Sdk
command: powertabeditor
rename-desktop-file: powertabeditor.desktop
rename-appdata-file: powertabeditor.metainfo.xml
rename-icon: powertabeditor
finish-args:
  # Standard Qt stuff.
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  # For MIDI devices
  - --device=all

modules:
  - shared-modules/linux-audio/jack2.json

  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app
      - ./b2 --with-date_time --with-iostreams variant=release link=shared runtime-link=shared -j $FLATPAK_BUILDER_N_JOBS install
    sources:
      - type: archive
        url: https://boostorg.jfrog.io/artifactory/main/release/1.78.0/source/boost_1_78_0.tar.bz2
        sha256: 8681f175d4bdb26c52222665793eef08490d7758529330f98d3b29dd0735bccc

  - name: minizip
    subdir: contrib/minizip
    buildsystem: simple
    sources:
      - type: archive
        url: https://zlib.net/zlib-1.2.11.tar.xz
        sha256: 4ff941449631ace0d4d203e3483be9dbc9da454084111f97ea0a2114e19bf066
    build-commands:
      - autoreconf -fi
      - ./configure --prefix=/app
      - make install

  - name: pugixml
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: git
        url: https://github.com/zeux/pugixml.git
        tag: v1.11.4
        commit: 08b3433180727ea2f78fe02e860a08471db1e03c

  - name: nlohmann-json
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DJSON_BuildTests=OFF
    sources:
      - type: git
        url: https://github.com/nlohmann/json.git
        tag: v3.10.4
        commit: fec56a1a16c6e1c1b1f4e116a20e79398282626c

  - name: rtmidi
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: git
        url: https://github.com/thestk/rtmidi.git
        tag: 5.0.0
        commit: 84a99422a3faf1ab417fe71c0903a48debb9376a

  - name: powertabeditor
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_TESTING=OFF
    sources:
      - type: git
        url: https://github.com/powertab/powertabeditor.git
        # This will be replaced with tags after the next upstream release.
        # The master branch has many packaging-related changes that are required.
        commit: d1597efc2d4ac6e1293c40f5eec5c954f63276ce
    post-install:
      - mv /app/share/mime/packages/powertabeditor.xml /app/share/mime/packages/com.github.powertab.powertabeditor.xml
