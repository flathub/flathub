{
	"id": "com.davidmorais.kuro",
	"base": "org.electronjs.Electron2.BaseApp",
	"base-version": "25.08",
	"runtime": "org.freedesktop.Platform",
	"runtime-version": "25.08",
	"sdk": "org.freedesktop.Sdk",
	"sdk-extensions": [
		"org.freedesktop.Sdk.Extension.node24"
	],
	"separate-locales": false,
	"rename-desktop-file": "kuro.desktop",
	"command": "run.sh",
	"finish-args": [
		"--socket=x11",
		"--device=dri",
		"--share=ipc",
		"--share=network",
		"--socket=pulseaudio"
	],
	"modules": [
		{
			"name": "kuro",
			"buildsystem": "simple",
			"build-options": {
				"append-path": "/usr/lib/sdk/node24/bin",
				"env": {
					"NPM_CONFIG_LOGLEVEL": "info",
					"XDG_CACHE_HOME": "/run/build/kuro/flatpak-node/cache",
					"npm_config_cache": "/run/build/kuro/flatpak-node/npm-cache",
					"npm_config_offline": "true"
				}
			},
			"build-commands": [
				"HOME=$PWD yarn config --offline set yarn-offline-mirror $FLATPAK_BUILDER_BUILDDIR/flatpak-node/yarn-mirror",
				"cd main && yarn install --offline --ignore-scripts",
				"flatpak-node/electron-builder-arch-args.sh",
				"cd main && yarn run --offline electron-builder --linux dir $ELECTRON_BUILDER_ARCH_ARGS",
				"cd main && yarn run --offline electron-icon-maker --input=static/Icon.png",
				"cp -a main/dist/linux*unpacked /app/main",
				"install -Dm755 -t /app/bin run.sh",
				"install -Dm644 $FLATPAK_ID.metainfo.xml -t /app/share/metainfo",
				"chmod +x generate-desktop.sh && ./generate-desktop.sh",
				"desktop-file-edit --set-name=Kuro --set-icon=$FLATPAK_ID --set-key=Exec --set-value=run.sh kuro.desktop",
				"install -Dm644 kuro.desktop -t /app/share/applications",
				"for size in 16 24 32 48 64 128 256 512; do install -Dm644 main/icons/png/${size}x${size}.png /app/share/icons/hicolor/${size}x${size}/apps/$FLATPAK_ID.png; done"
			],
			"sources": [
				{
					"type": "archive",
					"url": "https://github.com/davidsmorais/kuro/archive/refs/tags/v9.1.1.tar.gz",
					"sha256": "4dfbb890a4276bf4e449f1fb549a39e325076cc268c9c2a8cc25d5f311225071",
					"dest": "main"
				},
				{
					"type": "file",
					"path": "com.davidmorais.kuro.metainfo.xml"
				},
				{
					"type": "file",
					"path": "generate-desktop.sh"
				},
				{
					"type": "script",
					"dest-filename": "run.sh",
					"commands": [
						"zypak-wrapper /app/main/kuro"
					]
				},
				"generated-sources.json"
			]
		}
	]
}
