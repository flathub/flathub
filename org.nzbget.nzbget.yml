id: org.nzbget.nzbget
runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
command: nzbget-launcher.sh
finish-args:
  - --share=ipc
  - --share=network
  - --filesystem=xdg-download
  - --filesystem=/mnt
  - --filesystem=/media
  - --filesystem=/run/media
  - --persist=.nzbget
modules:
  - name: nzbget
    buildsystem: simple
    build-commands:
      - sh nzbget-24.8-bin-linux.run --arch ${FLATPAK_ARCH} --destdir ${FLATPAK_DEST}/bin
      - rm ${FLATPAK_DEST}/bin/nzbget.conf
      - >
        sed -i ${FLATPAK_DEST}/bin/webui/nzbget.conf.template
        -e "s|^MainDir=.*|MainDir=~/Downloads|"
        -e "s|^ScriptDir=.*|ScriptDir=~/.nzbget/scripts|g"
        -e 's|^LogFile=.*|LogFile=~/.nzbget/nzbget.log|'
        -e 's|^LockFile=.*|LockFile=~/.nzbget/nzbget.lock|'
      - install -Dm 0644 ${FLATPAK_ID}.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - install -Dm 0644 ${FLATPAK_ID}.128x128.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
      - install -Dm 0755 nzbget-launcher.sh /app/bin/nzbget-launcher.sh
    sources:
      - type: file
        url: https://github.com/nzbgetcom/nzbget/releases/download/v24.8/nzbget-24.8-bin-linux.run
        sha256: 35e6c8c4f28ef052d72cb65771e748263d926c6cd2b75bf17dccebfe8f6568e7
      - type: file
        path: org.nzbget.nzbget.desktop
      - type: file
        path: org.nzbget.nzbget.128x128.png
      - type: file
        path: nzbget-launcher.sh
