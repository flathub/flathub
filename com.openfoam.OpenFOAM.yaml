app-id: com.openfoam.OpenFOAM
runtime: org.freedesktop.Sdk
sdk: org.freedesktop.Sdk
runtime-version: 24.08
command: openfoam
finish-args:
  - --share=ipc
  - --device=dri
  - --filesystem=home
modules:
  - name: openmpi
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://download.open-mpi.org/release/open-mpi/v4.1/openmpi-4.1.4.tar.bz2
        sha256: 92912e175fd1234368c8730c03f4996fe5942e7479bb1d10059405e7f2b3930d

  - name: OpenFOAM
    build-options:
      env:
        WM_PROJECT_DIR: /run/build/OpenFOAM
    buildsystem: simple
    build-commands:
      - echo $WM_PROJECT_DIR
      - source etc/bashrc && echo $WM_PROJECT_DIR && ./Allwmake -j
      - ls -l
      - cp -r bin/* /app/bin
      - cp -rp etc /app
      - cp -rp platforms /app
    sources:
      - type: archive
        # dest: OpenFOAM-v2212
        url: https://dl.openfoam.com/source/v2506/OpenFOAM-v2506.tgz
        sha256: 63d26f48ae7ee9a7806a0ceb339ef8a0ba485a4714d54fbfb31e78e1a4849965
