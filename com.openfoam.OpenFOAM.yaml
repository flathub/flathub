app-id: com.openfoam.OpenFOAM
runtime: org.freedesktop.Sdk
sdk: org.freedesktop.Sdk
runtime-version: 22.08
command: openfoam
finish-args:
  - --share=ipc
  # Broke in Wayland
  #- --socket=wayland
  # - --socket=x11
  - --device=dri
  - --filesystem=home
cleanup:
  # - /include
  # - /lib/cmake
  # - /share/doc
  # - '*.la'
  # - '*.a'

modules:
  - name: openmpi
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://download.open-mpi.org/release/open-mpi/v4.1/openmpi-4.1.4.tar.bz2
        sha256: 92912e175fd1234368c8730c03f4996fe5942e7479bb1d10059405e7f2b3930d

  - name: OpenFOAM
    build-options:
      env:
        WM_PROJECT_DIR: /run/build/OpenFOAM
    buildsystem: simple
    build-commands:
      # - echo $FLATPAK_ID
      # - echo ${FLATPAK_BUILDER_BUILDDIR}
      # - ls -l ${FLATPAK_BUILDER_BUILDDIR}
      # - ls -l OpenFOAM-v2212
      # - echo $SHELL
      # - pwd
      - source etc/bashrc && ./Allwmake -j
      # - pwd -L
      # - export WM_PROJECT_DIR=OpenFOAM-v2212
      # - echo $WM_PROJECT_DIR
      # - env
      # - bash -c "ls -l || source etc/bashrc
      #   ./Allwmake || exit 1
      #   wclean all || exit 1
      #   wmakeLnIncludeAll || exit 1"
      # - export FOAM_INST_DIR=${FLATPAK_BUILDER_BUILDDIR}
      # - foamDotFile=etc/bashrc
      # - bash -c "source OpenFOAM-v2212/etc/bashrc"
      # - export WM_PROJECT_DIR=OpenFOAM-v2212
      # - echo $WM_PROJECT_DIR
      # - ./Allwmake
    sources:
      - type: archive
        # dest: OpenFOAM-v2212
        url: https://dl.openfoam.com/source/v2212/OpenFOAM-v2212.tgz
        sha256: 0a3ddbfea9abca04c3a811e72fcbb184c6b1f92c295461e63b231f1a97e96476
        # x-checker-data:
        #   type: anitya
        #   project-id: 13590
        #   stable-only: true
        #   url-template: https://dl.openfoam.org/source/$version
