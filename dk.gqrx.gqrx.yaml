id: dk.gqrx.gqrx
runtime: org.kde.Platform
runtime-version: '6.9'
sdk: org.kde.Sdk
command: gqrx
rename-icon: gqrx
finish-args:
  - --device=all
  - --share=network
  - --share=ipc
  - --socket=pulseaudio
  - --socket=fallback-x11
  - --socket=wayland

cleanup:
  - /include
  - /lib/pkgconfig
  - /share/aclocal
  - /share/doc
  - /share/man
  - /man
  - "*.a"
  - "*.la"

modules:
  - shared-modules/linux-audio/fftw3f.json
  - shared-modules/libusb/libusb.json

  - name: hidapi
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/libusb/hidapi.git
        tag: hidapi-0.15.0
        commit: d6b2a974608dec3b76fb1e36c189f22b9cf3650c

  - name: airspy
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/airspy/airspyone_host.git
        tag: v1.0.10
        commit: 229d5a5045b890621cd9cc200a19b1541c6021ae

  - name: airspyhf
    buildsystem: cmake-ninja
    config-opts:
      - -DINSTALL_UDEV_RULES=OFF
    sources:
      - type: git
        url: https://github.com/airspy/airspyhf.git
        tag: 1.6.8
        commit: 8891387edddcd185e2949e9814e9ef35f46f0722

  - name: bladerf
    buildsystem: cmake-ninja
    build-options:
      cflags: "-Wno-calloc-transposed-args"
    sources:
      - type: git
        url: https://github.com/Nuand/bladeRF.git
        tag: '2023.02'
        commit: 41ef63460956e833c9b321252245257ab3946055

  - name: hackrf
    buildsystem: cmake-ninja
    subdir: host
    config-opts:
      - -DINSTALL_UDEV_RULE=OFF
    sources:
      - type: git
        url: https://github.com/greatscottgadgets/hackrf.git
        tag: v2024.02.1
        commit: 18b485e3b6d2031c15a79ba89cdb42b5fa245f24

  - name: limesdr
    buildsystem: cmake-ninja
    config-opts:
      - -DENABLE_QUICKTEST=OFF
      - -DENABLE_GUI=OFF
      - -DENABLE_SOAPY_LMS7=OFF
      - -DENABLE_EXAMPLES=OFF
      - -DENABLE_UTILITIES=OFF
      - -DENABLE_HEADERS=ON
    sources:
      - type: git
        url: https://github.com/myriadrf/LimeSuite.git
        tag: v23.11.0
        commit: c2d9e87754586304577beff4dc5b16fb9b72c826

  - name: rtlsdr
    buildsystem: cmake-ninja
    config-opts:
      - -DDETACH_KERNEL_DRIVER=ON
    sources:
      - type: git
        url: https://github.com/steve-m/librtlsdr.git
        tag: v2.0.2
        commit: 619ac3186ea0ffc092615e1f59f7397e5e6f668c

  - name: volk
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/gnuradio/volk.git
        tag: v3.2.0
        commit: 308948abf8384bb4bf6467e14b585df708789782

  - name: boost
    buildsystem: simple
    sources:
      - type: archive
        # 1.88.0 brings breaking changes for uhd
        url: https://sourceforge.net/projects/boost/files/boost/1.87.0/boost_1_87_0.tar.bz2
        sha256: af57be25cb4c4f4b413ed692fe378affb4352ea50fbe294a11ef548f4d527d89
    build-commands:
      - ./bootstrap.sh --prefix=/app --with-libraries=system,chrono,date_time,filesystem,program_options,serialization,thread,test,regex
      - ./b2 -j $FLATPAK_BUILDER_N_JOBS install

  - name: uhd
    buildsystem: cmake-ninja
    subdir: host
    config-opts:
      - -DENABLE_DOXYGEN=OFF
      - -DENABLE_MANUAL=OFF
      - -DENABLE_MAN_PAGES=OFF
      - -DENABLE_PYTHON_API=OFF
      - -DENABLE_TESTS=OFF
      - -DINSTALL_UDEV_RULES=OFF
    sources:
      - type: git
        url: https://github.com/EttusResearch/uhd.git
        # 4.9.0.0 has possible breaking API changes
        tag: v4.8.0.0
        commit: 308126a479ca19dfaebfe4784b375e608788d763
      - type: patch
        paths:
          - patches/uhd-disable-ascii-art-dft.patch
          - patches/uhd-disable-latency-utils.patch

  - name: spdlog
    buildsystem: cmake-ninja
    build-options:
      cflags: "-fPIC"
      cxxflags: "-fPIC"
    sources:
      - type: git
        url: https://github.com/gabime/spdlog.git
        tag: v1.15.3
        commit: 6fa36017cfd5731d617e1a934f0e5ea9c4445b13

  - name: pybind11
    buildsystem: cmake-ninja
    config-opts:
      - -DPYBIND11_INSTALL=ON
      - -DPYBIND11_TEST=OFF
    sources:
      - type: git
        url: https://github.com/pybind/pybind11.git
        tag: v3.0.1
        commit: f5fbe867d2d26e4a0a9177a51f6e568868ad3dc8

  - name: cli11
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: git
        url: https://github.com/CLIUtils/CLI11.git
        tag: v2.5.0
        commit: 4160d259d961cd393fd8d67590a8c7d210207348

  - name: refl-cpp
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: git
        url: https://github.com/veselink1/refl-cpp.git
        tag: v0.12.4
        commit: 27fbd7d2e6d86bc135b87beef6b5f7ce53afd4fc

  - name: meson-python
    buildsystem: simple
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/28/58/66db620a8a7ccb32633de9f403fe49f1b63c68ca94e5c340ec5cceeb9821/meson_python-0.18.0-py3-none-any.whl
        sha256: 3b0fe051551cc238f5febb873247c0949cd60ded556efa130aa57021804868e2
      - type: file
        url: https://files.pythonhosted.org/packages/7e/b1/8e63033b259e0a4e40dd1ec4a9fee17718016845048b43a36ec67d62e6fe/pyproject_metadata-0.9.1-py3-none-any.whl
        sha256: ee5efde548c3ed9b75a354fc319d5afd25e9585fa918a34f62f904cc731973ad
    build-commands:
      - pip3 install --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} "meson-python" --no-build-isolation

  - name: python-numpy
    buildsystem: simple
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/65/6e/09db70a523a96d25e115e71cc56a6f9031e7b8cd166c1ac8438307c14058/numpy-1.26.4.tar.gz
        sha256: 2a02aba9ed12e4ac4eb3ea9421c420301a0c6460d9830d74a9df87efa4912010
    build-commands:
      - pip3 install --no-index --find-links=file://${PWD} --prefix=${FLATPAK_DEST} --no-build-isolation .

  - name: pmt
    buildsystem: meson
    config-opts:
      - -Denable_testing=false
    sources:
      - type: git
        url: https://github.com/gnuradio/pmt.git
        # there are no tags
        commit: 5960738cd35827acceb5a4de9e1c4005d2d02305
      - type: patch
        path: patches/pmt-refl-cpp.patch

  - name: soapy
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/pothosware/SoapySDR.git
        tag: soapy-sdr-0.8.1
        commit: 1cf5a539a21414ff509ff7d0eedfc5fa8edb90c6

  - name: soapy_remote
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/pothosware/SoapyRemote.git
        tag: soapy-remote-0.5.2
        commit: f920d9bf10f62f67c8e31b7dc25090bc784e5210

  - name: soapy_uhd
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/pothosware/SoapyUHD.git
        # latest master for multiple fixes
        commit: 6b521393cc45c66770f3d4bc69eac7dda982174c

  - name: portaudio
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/PortAudio/portaudio.git
        tag: v19.7.0
        commit: 147dd722548358763a8b649b3e4b41dfffbcfbb6

  - name: gnuradio
    buildsystem: cmake-ninja
    config-opts:
      - -DENABLE_DEFAULT=OFF
      - -DENABLE_EXAMPLES=OFF
      - -DENABLE_TESTING=OFF
      - -DENABLE_PYTHON=OFF
      - -DENABLE_POSTINSTALL=ON
      - -DENABLE_DOXYGEN=OFF
      - -DENABLE_MANPAGES=OFF
      - -DENABLE_GNURADIO_RUNTIME=ON
      - -DENABLE_COMMON_PCH=OFF
      - -DENABLE_GR_CTRLPORT=OFF
      - -DENABLE_GRC=OFF
      - -DENABLE_GR_BLOCKS=ON
      - -DENABLE_GR_FEC=OFF
      - -DENABLE_GR_FFT=ON
      - -DENABLE_GR_FILTER=ON
      - -DENABLE_GR_ANALOG=ON
      - -DENABLE_GR_DIGITAL=ON
      - -DENABLE_GR_DTV=OFF
      - -DENABLE_GR_AUDIO=ON
      - -DENABLE_GR_CHANNELS=OFF
      - -DENABLE_GR_PDU=OFF
      - -DENABLE_GR_IIO=OFF
      - -DENABLE_GR_QTGUI=OFF
      - -DENABLE_GR_TRELLIS=OFF
      - -DENABLE_GR_UHD=ON
      - -DENABLE_UHD_RFNOC=ON
      - -DENABLE_GR_UTILS=OFF
      - -DENABLE_GR_MODTOOL=OFF
      - -DENABLE_GR_BLOCKTOOL=OFF
      - -DENABLE_GR_VIDEO_SDL=OFF
      - -DENABLE_GR_VOCODER=OFF
      - -DENABLE_GR_WAVELET=OFF
      - -DENABLE_GR_ZEROMQ=OFF
      - -DENABLE_GR_NETWORK=ON
      - -DENABLE_GR_SOAPY=ON
    builddir: true
    sources:
      - type: git
        url: https://github.com/gnuradio/gnuradio.git
        tag: v3.10.12.0
        commit: ec7a3239645162ffea1925e6f1e6e62bf1349d03

  - name: gr-osmosdr
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://gitea.osmocom.org/sdr/gr-osmosdr.git
        tag: v0.2.6
        commit: a6afeaa3a1038e64751616d769537cd22ace015d

  - name: gqrx
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/gqrx-sdr/gqrx.git
        tag: v2.17.7
        commit: 1a8ab3a3cc02db3bf4c9058ed4b60ddad06fe9d1
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
      - type: patch
        path: patches/gqrx-metainfo.patch
