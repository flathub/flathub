app-id: io.github.totoshko88.RustConn
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: rustconn

finish-args:
  # Wayland/X11 access
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  # Audio for RDP sessions
  - --socket=pulseaudio
  # Network access for SSH/RDP/VNC/SPICE connections
  - --share=network
  # Home directory access for SSH keys
  - --filesystem=home/.ssh:ro
  # SSH agent socket
  - --socket=ssh-auth

build-options:
  append-path: /usr/lib/sdk/rust-stable/bin
  env:
    CARGO_HOME: /run/build/rustconn/cargo
    RUST_BACKTRACE: '1'

modules:
  - name: vte
    buildsystem: meson
    config-opts:
      - -Dglade=false
      - -Dgtk3=false
      - -Dgtk4=true
      - -Dvapi=false
      - -Dicu=false
      - -Dgir=false
      - -Ddocs=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/vte/0.78/vte-0.78.4.tar.xz
        sha256: 2dea4e412266592b6460a3fe4488f5e3d50712f139815790c0ecb44710f7e17e

  - name: rustconn
    buildsystem: simple
    build-options:
      env:
        CARGO_NET_OFFLINE: 'true'
    build-commands:
      - cargo build --release -p rustconn -p rustconn-cli
      - install -Dm755 target/release/rustconn /app/bin/rustconn
      - install -Dm755 target/release/rustconn-cli /app/bin/rustconn-cli
      - install -Dm644 rustconn/assets/io.github.totoshko88.RustConn.desktop /app/share/applications/io.github.totoshko88.RustConn.desktop
      - install -Dm644 rustconn/assets/io.github.totoshko88.RustConn.metainfo.xml /app/share/metainfo/io.github.totoshko88.RustConn.metainfo.xml
      - install -Dm644 rustconn/assets/icons/hicolor/scalable/apps/io.github.totoshko88.RustConn.svg /app/share/icons/hicolor/scalable/apps/io.github.totoshko88.RustConn.svg
    sources:
      - type: git
        url: https://github.com/totoshko88/RustConn.git
        tag: v0.5.0
        commit: a77ee53742bcd66ca39d6edb5fb68f3011e91149
      - cargo-sources.json
