app-id: com.getmailspring.Mailspring
base: org.electronjs.Electron2.BaseApp
base-version: stable
runtime: org.gnome.Platform
runtime-version: '3.30'
sdk: org.gnome.Sdk
command: start-mailspring
rename-icon: mailspring
rename-appdata-file: mailspring.appdata.xml
rename-desktop-file: mailspring.desktop
separate-locales: false
tags: [proprietary]
finish-args:
  - '--share=ipc'
  - '--socket=x11'
  - '--socket=wayland'
  - '--socket=pulseaudio'
  - '--share=network'
  - '--device=dri'
  - '--filesystem=home'
  - '--env=XDG_CURRENT_DESKTOP=Unity'
  - '--talk-name=org.freedesktop.Notifications'
  - '--talk-name=org.freedesktop.secrets'
  - '--talk-name=org.kde.StatusNotifierWatcher'
modules:
  - name: mailspring
    buildsystem: simple
    build-commands:
      - 'ar x mailspring.deb data.tar.xz'
      - 'tar xvf data.tar.xz'
      - 'cp -r usr/* /app'
      - "desktop-file-edit --set-key=Exec --set-value='start-mailspring %U' --remove-category=Productivity --remove-category=Communication /app/share/applications/mailspring.desktop"
      - 'install -Dm 755 start-mailspring /app/bin/start-mailspring'
    sources:
      - type: file
        only-arches: [x86_64]
        url: https://github.com/Foundry376/Mailspring/releases/download/1.5.1/mailspring-1.5.1-amd64.deb
        sha256: d5faef2ec702b57fc0b8715908e7fee17017f20204787f29f2a5685449bfe98f
        dest-filename: mailspring.deb
      - type: script
        dest-filename: start-mailspring
        commands:
          - 'exec env TMPDIR="$XDG_CACHE_HOME" mailspring "$@"'
