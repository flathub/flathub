app-id: com.getmailspring.Mailspring
base: org.electronjs.Electron2.BaseApp
base-version: stable
runtime: org.gnome.Platform
runtime-version: '3.30'
sdk: org.gnome.Sdk
command: start-mailspring
rename-icon: mailspring
rename-desktop-file: mailspring.desktop
separate-locales: false
tags: [proprietary]
finish-args:
  - '--share=ipc'
  - '--socket=x11'
  - '--socket=wayland'
  - '--socket=pulseaudio'
  - '--share=network'
  - '--device=dri'
  - '--filesystem=home'
  - '--env=XDG_CURRENT_DESKTOP=Unity'
  - '--talk-name=org.freedesktop.Notifications'
  - '--talk-name=org.freedesktop.secrets'
  - '--talk-name=org.kde.StatusNotifierWatcher'
modules:
  - name: mailspring
    buildsystem: simple
    build-commands:
      - 'ar x mailspring.deb data.tar.xz'
      - 'tar xvf data.tar.xz'
      - 'cp -r usr/* /app'
      - "desktop-file-edit --set-key=Exec --set-value='start-mailspring %U' /app/share/applications/mailspring.desktop"
      - 'install -Dm 755 start-mailspring /app/bin/start-mailspring'
      - 'install -Dm 644 com.getmailspring.Mailspring.appdata.xml /app/share/appdata/com.getmailspring.Mailspring.appdata.xml'
    sources:
      - type: file
        url: https://github.com/Foundry376/Mailspring/releases/download/1.4.2/mailspring-1.4.2-amd64.deb
        sha256: a32c8d4673763f7dc3edde481e68b2c3d178614fdf497b5c032c4f3b6a023b23
        dest-filename: mailspring.deb
      - type: file
        path: com.getmailspring.Mailspring.appdata.xml
      - type: script
        dest-filename: start-mailspring
        commands:
          - 'exec env TMPDIR="$XDG_CACHE_HOME" mailspring "$@"'
