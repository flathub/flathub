app-id: com.getmailspring.Mailspring
base: org.electronjs.Electron2.BaseApp
base-version: stable
runtime: org.gnome.Platform
runtime-version: 3.28
sdk: org.gnome.Sdk
command: start-mailspring
rename-icon: mailspring
rename-desktop-file: mailspring.desktop
separate-locales: false
tags: [proprietary]
finish-args:
  - '--share=ipc'
  - '--socket=x11'
  - '--socket=wayland'
  - '--share=network'
  - '--filesystem=home'
  - '--env=XDG_CURRENT_DESKTOP=Unity'
  - '--talk-name=org.freedesktop.Notifications'
  - '--talk-name=org.freedesktop.secrets'
  - '--talk-name=org.kde.StatusNotifierWatcher'
modules:
  - name: mailspring
    buildsystem: simple
    build-commands:
      - 'cp -r * /app'
      - "desktop-file-edit --set-key=Exec --set-value='start-mailspring %U' /app/share/applications/mailspring.desktop"
      - 'install -Dm 755 start-mailspring /app/bin/start-mailspring'
      - 'install -Dm 644 com.getmailspring.Mailspring.appdata.xml /app/share/appdata/com.getmailspring.Mailspring.appdata.xml'
    sources:
      - type: archive
        url: https://github.com/Foundry376/Mailspring/releases/download/1.4.2/mailspring-1.4.2-0.1.x86_64.rpm
        sha256: 299c33ee935a8d3aa8f2771f035764c75f6779f3aa23b40553972e5325d7d3bb
      - type: file
        path: com.getmailspring.Mailspring.appdata.xml
      - type: script
        dest-filename: start-mailspring
        commands:
          - 'exec env TMPDIR="$XDG_CACHE_HOME" mailspring "$@"'
