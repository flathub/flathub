app-id: io.github.kprakesh1984.Symphonie

runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk

command: Symphonie

finish-args:
  - --filesystem=xdg-music:ro
  - --socket=pulseaudio
  - --socket=wayland
  - --socket=x11
  - --share=network

modules:
  - name: symphonie
    buildsystem: simple

    build-options:
      build-args:
        - --share=network

    build-commands:
      # 1. Setup Environment
      - |
        export PATH="./bin:$PATH"

      # 2. Install Dependencies & Build
      - |
        npm install -g yarn
        yarn install --frozen-lockfile
        yarn dist:linux

      # 3. Install Application Files
      - cp -r dist_electron/linux-unpacked/* /app/
      
      # Install the AppStream Metadata
      - install -D io.github.kprakesh1984.Symphonie.metainfo.xml /app/share/metainfo/io.github.kprakesh1984.Symphonie.metainfo.xml

      # NEW: Install the Icon (This belongs here in build-commands!)
      - install -D io.github.kprakesh1984.Symphonie.png /app/share/icons/hicolor/128x128/apps/io.github.kprakesh1984.Symphonie.png

      # 4. Wrapper Script Setup
      - |
        mkdir -p /app/bin
        mv /app/Symphonie /app/Symphonie.bin
        cat <<EOF > /app/bin/Symphonie
        #!/bin/sh
        export LD_LIBRARY_PATH=/app:\$LD_LIBRARY_PATH
        exec /app/Symphonie.bin --no-sandbox "\$@"
        EOF
        chmod +x /app/bin/Symphonie

    sources:
      # Source 1: Source Code
      - type: archive
        url: https://github.com/kprakesh1984/symphonie/archive/refs/tags/linux-release-v1.0.17.tar.gz
        sha256: 8d67e94f9821446d0be921506f68fdb203d34e4288d7b86306810058aa019198

      # Source 2: Node.js
      - type: archive
        url: https://nodejs.org/dist/v20.10.0/node-v20.10.0-linux-x64.tar.xz
        sha256: 3fe4ec5d70c8b4ffc1461dec83ab23fc70124e137c4cbbe1ccc9d6ae6ec04a7d

      # Source 3: AppStream Metadata
      - type: file
        path: io.github.kprakesh1984.Symphonie.metainfo.xml

      # Source 4: The Icon (This is how you list it in sources)
      - type: file
        path: io.github.kprakesh1984.Symphonie.png
