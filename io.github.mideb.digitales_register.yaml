app-id: io.github.mideb.digitales_register
runtime: org.gnome.Platform
runtime-version: "41"
sdk: org.gnome.Sdk
command: digitales_register
finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  # Needs to talk to the network:
  - --share=network
  - --device=dri
  # Needs to save files locally
  - --filesystem=xdg-documents
    # Secrets access
  - "--talk-name=org.freedesktop.secrets"

modules:
  - name: libjsoncpp
    buildsystem: cmake-ninja
    config_opts:
      - -DCMAKE_BUILD_TYPE=release
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: archive
        url: https://github.com/open-source-parsers/jsoncpp/archive/refs/tags/1.7.5.tar.gz
        sha256: 4338c6cab8af8dee6cdfd54e6218bd0533785f552c6162bb083f8dd28bf8fbbe

  # Not the newest libsecret version; needed until https://gitlab.gnome.org/GNOME/libsecret/-/issues/58 is fixed.
  - name: libsecret
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libsecret/0.19/libsecret-0.19.1.tar.xz
        sha256: 8583e10179456ae2c83075d95455f156dc08db6278b32bf4bd61819335a30e3a

  - name: digitales_register
    buildsystem: simple
    build-commands:
      - ls -R digitales_register
      - cp -r digitales_register /app/digitales_register
      - chmod +x /app/digitales_register/digitales_register
      - ln -s /app/digitales_register/digitales_register /app/bin/digitales_register
      - install -Dm644 io.github.mideb.digitales_register.desktop /app/share/applications/io.github.mideb.digitales_register.desktop
      - install -Dm644 io.github.mideb.digitales_register.metainfo.xml /app/share/appdata/io.github.mideb.digitales_register.metainfo.xml
      - install -Dm644 icon.png /app/share/icons/hicolor/scalable/apps/io.github.mideb.digitales_register.svg
    sources:
      - type: archive
        url: https://github.com/miDeb/digitales_register/releases/download/v8.2.2/digitales_register-linux-x86_64.tar.gz
        dest: digitales_register
        sha256: fc8e77d5a697a128cb79ad241d386b7bdea8445c7f51c2d1136285e4076753d7
      - type: file
        path: io.github.mideb.digitales_register.desktop
      - type: file
        path: io.github.mideb.digitales_register.metainfo.xml
      - type: file
        path: icon.png
