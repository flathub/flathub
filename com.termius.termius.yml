app-id: com.termius.termius

runtime: org.gnome.Platform
runtime-version: "3.32"
sdk: org.gnome.Sdk

command: /app/opt/Termius/termius-app

finish-args:
  # X11/Wayland
  - --socket=x11
  - --share=ipc
  - --socket=wayland
  - --device=dri
  # Sync
  - --share=network
  # Filesystem access
  - --filesystem=host
  # Allow access to keyring
  - --talk-name=org.freedesktop.secrets
  # SSH
  - --socket=ssh-auth
  - --own-name=org.KDE.*

modules:
  - dependencies/openssl.json
  - dependencies/openssh.json
  #- dependencies/libfuse.json

  - name: terminus
    buildsystem: simple
    build-commands:
        - ar x Termius.deb
        - tar -xvf data.tar.xz
        - mv opt /app/
        - mv etc /app/
        - install -D src/usr/share/icon/hicolor/24x24/apps/termius-app.png /app/share/icons/hicolor/24x24/apps/com.termius.termius.png
        - install -D src/usr/share/icon/hicolor/32x32/apps/termius-app.png /app/share/icons/hicolor/32x32/apps/com.termius.termius.png
        - install -D src/usr/share/icon/hicolor/48x48/apps/termius-app.png /app/share/icons/hicolor/48x48/apps/com.termius.termius.png
        - install -D src/usr/share/icon/hicolor/64x64/apps/termius-app.png /app/share/icons/hicolor/64x64/apps/com.termius.termius.png
        - install -D src/usr/share/icon/hicolor/128x128/apps/termius-app.png /app/share/icons/hicolor/128x128/apps/com.termius.termius.png
        - install -D src/usr/share/icon/hicolor/256x256/apps/termius-app.png /app/share/icons/hicolor/256x256/apps/com.termius.termius.png
        - install -D src/usr/share/icon/hicolor/512x512/apps/termius-app.png /app/share/icons/hicolor/512x512/apps/com.termius.termius.png
        - install -D com.termius.termius.appdata.xml /app/share/metainfo/com.termius.termius.appdata.xml
        - install -D com.termius.termius.desktop  /app/share/applications/com.termius.termius.desktop
        #- chmod +x /app/opt/Termius/termius-app
    
    cleanup:
      - /app/share/applications/termius-app.desktop
    sources:
        - type: file
          url: https://raw.githubusercontent.com/liberodark/flathub/com.termius.termius/com.termius.termius.appdata.xml
          sha256: 5f3b164b364b1fbc15cf228266c0f3872f8d28c21350a613daec6e2a52f14375

        - type: file
          url: https://raw.githubusercontent.com/liberodark/flathub/com.termius.termius/com.termius.termius.desktop
          sha256: d8a6b85f6365c958308cfba1bb540925a477d7913e8ee192e9f79996e69824ac

        - type: script
          commands:
             Yes. This is dirty. The tarball contains a Firefox profile directory which Firefox expects to be able to write...
             The tmp directory is, at least when following this manifest and not overwriting the settings, a tmpfs, so we can (or have to) copy over everytime we launch.
            - cp -ar --reflink=auto /app/opt/Termius /tmp/
            - cd /tmp/
            - cd Termius
            - ./termius-app
          dest-filename: launch.sh

        - type: file
          url: https://www.termius.com/download/linux/Termius.deb
          sha256: 57dd27dbbe351d5f8539c0bac4db1e6f84b88c2de02a11d32f3e5f0474c3309b
