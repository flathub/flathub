app-id: net.sonobus.SonoBus
runtime: org.gnome.Platform
sdk: org.gnome.Sdk
runtime-version: '40'
command: sonobus
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --share=network
  - --socket=pulseaudio
  - --filesystem=xdg-download
  - --filesystem=xdg-music
# Jack
  - --filesystem=xdg-run/pipewire-0
  - --system-talk-name=org.freedesktop.RealtimeKit1
cleanup:
  - /lib/libjack*
  - /lib/jack

modules:
  - shared-modules/linux-audio/jack2.json

  - name: SonoBus
    buildsystem: cmake-ninja
    post-install:
      - install -Dm755 SonoBus_artefacts/Standalone/sonobus /app/bin/sonobus
      - install -D images/SonoBus-Icon.svg /app/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg
      - install -Dm644 $FLATPAK_ID.metainfo.xml /app/share/metainfo/$FLATPAK_ID.metainfo.xml
      - install -Dm644 linux/sonobus.desktop /app/share/applications/${FLATPAK_ID}.desktop
      - desktop-file-edit --set-icon=${FLATPAK_ID} /app/share/applications/${FLATPAK_ID}.desktop
    sources:
      - type: git
        url: https://github.com/sonosaurus/sonobus/
        tag: '1.4.5'
        commit: 52cb09f046b94ba2d5d9d47e85c8d9789d86c96e
      - type: file
        path: net.sonobus.SonoBus.metainfo.xml
