app-id: net.sonobus.SonoBus
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: '20.08'
command: sonobus
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --share=network
  - --socket=pulseaudio
  - --filesystem=xdg-download
  - --filesystem=xdg-music
# Jack
  - --filesystem=xdg-run/pipewire-0
  - --system-talk-name=org.freedesktop.RealtimeKit1
cleanup:
  - /lib/libjack*
  - /lib/jack

modules:
  - shared-modules/linux-audio/jack2.json

  - name: SonoBus
    buildsystem: simple
    build-commands:
      - cmake -DCMAKE_BUILD_TYPE=Release -B build
      - cmake --build build --config $CONFIG $OPTS
      #- CONFIG=Release make -j$FLATPAK_BUILDER_N_JOBS -C Builds/LinuxMakefile Standalone
      - install -D "${FLATPAK_BUILDER_BUILDDIR}/images/SonoBus-Icon.svg" "${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg"
      - install -Dm644 "${FLATPAK_BUILDER_BUILDDIR}/$FLATPAK_ID.metainfo.xml" "${FLATPAK_DEST}/share/metainfo/$FLATPAK_ID.metainfo.xml"
      - install -Dm755 -t ${FLATPAK_DEST}/bin/ Builds/LinuxMakefile/build/sonobus
      - install -Dm644 "Builds/LinuxMakefile/sonobus.desktop" "${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop"
      - desktop-file-edit --set-icon=${FLATPAK_ID} /app/share/applications/${FLATPAK_ID}.desktop
    sources:
      - type: git
        url: https://github.com/sonosaurus/sonobus/
        tag: '1.4.5'
        commit: 52cb09f046b94ba2d5d9d47e85c8d9789d86c96e
      - type: file
        path: net.sonobus.SonoBus.metainfo.xml
        
        #cmake -DCMAKE_BUILD_TYPE=$CONFIG $DEPS -B build
        #cmake --build build --config $CONFIG $OPTS
