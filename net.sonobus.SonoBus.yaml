app-id: net.sonobus.SonoBus
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: '20.08'
command: sonobus
rename-desktop-file: sonobus.desktop
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --share=network
  - --socket=pulseaudio
  - --filesystem=home
# Jack
  - --filesystem=xdg-run/pipewire-0
  - --system-talk-name=org.freedesktop.RealtimeKit1

modules:
  - name: jack2
    buildsystem: simple
    build-commands:
      - ./waf configure --prefix=/app --htmldir=/app/share/doc/jack/ --classic
      - ./waf build -j $FLATPAK_BUILDER_N_JOBS
      - ./waf install
    cleanup:
      - '*'
    sources:
      - type: archive
        url: https://github.com/jackaudio/jack2/archive/refs/tags/v1.9.17.tar.gz
        sha256: 38f674bbc57852a8eb3d9faa1f96a0912d26f7d5df14c11005ad499c8ae352f2

  - name: SonoBus
    buildsystem: simple
    build-commands:
      - CONFIG=Release make -j$(nproc) -C Builds/LinuxMakefile Standalone VST3
      - install -d ${FLATPAK_DEST}/lib/vst3/
      - install -Dm755 -t ${FLATPAK_DEST}/bin/ Builds/LinuxMakefile/build/sonobus
      - cp -a Builds/LinuxMakefile/build/sonobus.vst3 ${FLATPAK_DEST}/lib/vst3/
      - install -Dm644 -t ${FLATPAK_DEST}/share/applications/ Builds/LinuxMakefile/sonobus.desktop
    sources:
      - type: git
        url: https://github.com/sonosaurus/sonobus/
        tag: 1.4.2
        commit: 91c59a3bf5a7fe77b8424259c8271bbd6ad57dca
