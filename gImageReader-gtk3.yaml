name: gImageReader-gtk3
buildsystem: cmake-ninja
builddir: true
config-opts:
  - -DINTERFACE_TYPE:STRING=gtk
  # disable update checker
  - -DENABLE_VERSIONCHECK:BOOL=0
sources:
  - type: archive
    url: https://github.com/manisandro/gImageReader/archive/v3.3.0.tar.gz
    sha256: 9fbc33f0bb0479f0c65fbc6307dd57795bc3128d0349a2a017653c80f6089157
  - type: patch
    path: gImageReader-3.3.0-fetchLanguageList.patch
  # http://gtk.10911.n7.nabble.com/dynamic-menus-td93355.html
  # https://bugzilla.gnome.org/show_bug.cgi?id=791175
  # https://gitlab.gnome.org/GNOME/gtk/issues/987
  - type: patch
    path: gImageReader-3.3.0-ManageLanguages-gtk.patch
  - type: shell
    commands:
      - find * -xtype f -name '*.cc' | while read -r file; do
        sed -i -re 's!/usr/share!/app/share!g' "${file}";
        done;
  - type: file
    path: gimagereader.appdata.xml.in
    dest: data
  - type: shell
    commands:
      - echo "StartupWMClass=gimagereader-@INTERFACE_TYPE@" >> "data/gimagereader.desktop.in";
modules:
  # There is no gvfs module in the Freedesktop/KDE runtime
  #- gvfs.yaml
  - gtkmm.yaml
  - gtksourceviewmm.yaml
  - gtkspellmm.yaml
  - libxml++.yaml
  - pygobject.yaml
