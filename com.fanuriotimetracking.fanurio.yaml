id: com.fanuriotimetracking.fanurio
runtime: org.freedesktop.Platform
runtime-version: "25.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk11
command: fanurio

modules:
  - name: openjdk
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk11/install.sh
  - name: fanurio
    buildsystem: simple
    build-commands:
      - |
        mkdir -p /app/fanurio
        cp -a . /app/fanurio

        # Launcher    
        mkdir -p /app/bin
        cat > /app/bin/fanurio << 'EOF'
        #!/usr/bin/env bash
        export JAVA_HOME=/app/jre
        export PATH="$JAVA_HOME/bin:$PATH"
        exec "$JAVA_HOME/bin/java" -cp "/app/fanurio/lib/*:/app/fanurio/fanurio.jar" com.fanurio.Launcher "$@"
        EOF
        chmod +x /app/bin/fanurio

    sources:
      - type: archive
        url: https://www.fanuriotimetracking.com/files/releases/3.4/fanurio-3.4.tar.gz
        sha256: 38c41bb1acc5f92f96982277c081c4adefec74ba7ed04557c3d3106d5ec4a3cc

finish-args:
  - --env=PATH=/usr/lib/sdk/openjdk11/jvm/openjdk-11/bin:/app/bin:/usr/bin
  - --socket=x11
  - --share=ipc
  - --share=network
  - --filesystem=~/.fanurio:create
  - --device=dri
