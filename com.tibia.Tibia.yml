id: com.tibia.Tibia
branch: stable
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: tibia
tags:
  - proprietary

finish-args:
  - --device=dri # OpenGL rendering
  - --share=ipc # share IPC namespace with the host (necessary for X11)
  - --share=network # access the network
  - --socket=pulseaudio # play sound with PulseAudio
  - --filesystem=xdg-run/pipewire-0:ro # play sound with PipeWire
  - --socket=x11 # show windows using X11

modules:
  - name: tibia
    buildsystem: simple

    build-commands:
      - install -Dm755 -t ${FLATPAK_DEST}/bin apply_extra
      - install -Dm644 -t ${FLATPAK_DEST}/share/applications com.tibia.Tibia.desktop
      - install -Dm644 -t ${FLATPAK_DEST}/share/icons/hicolor/256x256/apps ${FLATPAK_ID}.png
      - install -Dm644 -t ${FLATPAK_DEST}/share/metainfo ${FLATPAK_ID}.metainfo.xml
      - ln -s ${FLATPAK_DEST}/extra/Tibia ${FLATPAK_DEST}/bin/tibia

    sources:
      - type: extra-data
        filename: tibia.tar.gz
        url: https://static.tibia.com/download/tibia.x64.tar.gz
        sha256: 1899643d256bbca47c4b81f5fd89725a9d74dc7b59546ea19484d66d056e8936
        size: 27631795

      - type: file
        path: com.tibia.Tibia.desktop

      - type: file
        path: com.tibia.Tibia.metainfo.xml

      - type: file
        path: com.tibia.Tibia.png

      - type: script
        dest-filename: apply_extra
        commands:
          - tar xf tibia.tar.gz --strip-components 1
