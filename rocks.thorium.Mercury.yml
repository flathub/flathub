id: rocks.thorium.Mercury
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
base: org.mozilla.firefox.BaseApp
base-version: '23.08'
add-extensions:
  org.freedesktop.Platform.ffmpeg-full:
    version: '23.08'
    directory: lib/ffmpeg
    add-ld-path: .
cleanup-commands:
  - mkdir -p $FLATPAK_DEST/lib/ffmpeg
command: mercury-browser
rename-desktop-file: mercury-browser.desktop
rename-icon: mercury

finish-args:
  - --share=ipc
  - --share=network
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pcsc
  - --socket=pulseaudio
  - --socket=cups
  - --persist=.mercury
  - --filesystem=xdg-download:rw
  - --filesystem=xdg-run/pipewire-0
  - --device=dri
  - --talk-name=org.freedesktop.FileManager1
  - --system-talk-name=org.freedesktop.NetworkManager
  - --talk-name=org.a11y.Bus
  - --talk-name=org.gtk.vfs.*
  - --env=MOZ_USE_XINPUT2=1
  - --own-name=org.mpris.MediaPlayer2.firefox.*

modules:
  - name: mercury
    buildsystem: simple
    build-commands:
      - mkdir -p $FlATPAK_DEST/lib/ $FLATPAK_DEST/share/
      - bsdtar --to-stdout -xf mercury.deb data.* | bsdtar -xf -
      - mv usr/lib/mercury $FLATPAK_DEST/lib/
      - mv usr/share/applications/ $FLATPAK_DEST/share/
      - mv usr/share/icons/ $FLATPAK_DEST/share/
      - install -Dm644 rocks.thorium.Mercury.metainfo.xml -t $FLATPAK_DEST/share/metainfo/
      - install -Dm755 mercury.sh $FLATPAK_DEST/bin/mercury-browser
    sources:
      - type: file
        url: https://github.com/Alex313031/Mercury/releases/download/v.123.0.1/mercury-browser_123.0.1_SSE3.deb
        sha256: f7e3987c41c6176694468bc3c21e0563a3be624bb354bdc90f576895549be0fc
        dest-filename: mercury.deb
        only-arches: [x86_64]
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Alex313031/Mercury/releases/latest
          version-query: ".tag_name | sub(\"^v.\"; \"\")"
          url-query: ".assets[] | select(.name==\"mercury-browser_\" + $version + \"_SSE3.deb\") | .browser_download_url"

      - type: file
        url: https://github.com/Alex313031/Mercury/releases/download/v.123.0.1/mercury-browser_123.0.1_ARM64.deb
        sha256: 98822d1f584c717407986ceecf599ae6c9012f7444f3500fdc85244b5fc0d0ba
        dest-filename: mercury.deb
        only-arches: [aarch64]
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Alex313031/Mercury/releases/latest
          version-query: ".tag_name | sub(\"^v.\"; \"\")"
          url-query: ".assets[] | select(.name==\"mercury-browser_\" + $version + \"_ARM64.deb\") | .browser_download_url"

      - type: file
        path: rocks.thorium.Mercury.desktop

      - type: file
        path: rocks.thorium.Mercury.png

      - type: file
        path: rocks.thorium.Mercury.metainfo.xml

      - type: file
        path: mercury.sh
