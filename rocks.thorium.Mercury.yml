id: rocks.thorium.Mercury
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
base: org.mozilla.firefox.BaseApp
base-version: '23.08'
add-extensions:
  org.freedesktop.Platform.ffmpeg-full:
    version: '23.08'
    directory: lib/ffmpeg
    add-ld-path: .
cleanup-commands:
  - mkdir -p $FLATPAK_DEST/lib/ffmpeg
command: mercury-browser

finish-args:
  - --share=ipc
  - --share=network
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pcsc
  - --socket=pulseaudio
  - --socket=cups
  - --persist=.mercury
  - --filesystem=xdg-download:rw
  - --filesystem=xdg-run/pipewire-0
  - --device=dri
  - --talk-name=org.freedesktop.FileManager1
  - --system-talk-name=org.freedesktop.NetworkManager
  - --talk-name=org.a11y.Bus
  - --talk-name=org.gtk.vfs.*
  - --env=MOZ_USE_XINPUT2=1
  - --own-name=org.mpris.MediaPlayer2.firefox.*

modules:
  - name: mercury
    buildsystem: simple
    build-commands:
      - mkdir -p $FlATPAK_DEST/lib/
      - mv mercury $FLATPAK_DEST/lib/
      - install -Dm644 rocks.thorium.Mercury.desktop -t $FLATPAK_DEST/share/applications/
      - install -Dm644 rocks.thorium.Mercury.png -t $FLATPAK_DEST/share/icons/hicolor/512x512/apps/
      - install -Dm644 rocks.thorium.Mercury.metainfo.xml -t $FLATPAK_DEST/share/metainfo/
      - install -Dm755 mercury.sh $FLATPAK_DEST/bin/mercury-browser
    sources:
      - type: archive
        url: https://github.com/Alex313031/Mercury/releases/download/v.123.0.1/mercury_123.0.1_linux_SSE3.zip
        sha256: e77391fe6c1d8163ea6bda82b0b308c7377c682c7acc301f2f8366c5b16eed43
        strip-components: 1
        only-arches: [x86_64]
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Alex313031/Mercury/releases/latest
          version-query: ".tag_name | sub(\"^v.\"; \"\")"
          url-query: ".assets[] | select(.name==\"mercury_\" + $version + \"_linux_SSE3.zip\") | .browser_download_url"

      - type: archive
        url: https://github.com/Alex313031/Mercury/releases/download/v.123.0.1/mercury_123.0.1_linux_ARM64.zip
        sha256: b3b31d52dd35de1ed02725a9bdfdb960620dcedfe5595b08c22304d8b1c6b6a2
        strip-components: 1
        only-arches: [aarch64]
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Alex313031/Mercury/releases/latest
          version-query: ".tag_name | sub(\"^v.\"; \"\")"
          url-query: ".assets[] | select(.name==\"mercury_\" + $version + \"_linux_ARM64.zip\") | .browser_download_url"

      - type: file
        path: rocks.thorium.Mercury.desktop

      - type: file
        path: rocks.thorium.Mercury.png

      - type: file
        path: rocks.thorium.Mercury.metainfo.xml

      - type: file
        path: mercury.sh
