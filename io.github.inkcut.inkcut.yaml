# yaml-language-server: $schema=https://raw.githubusercontent.com/flatpak/flatpak-builder/refs/heads/main/data/flatpak-manifest.schema.json
app-id: io.github.inkcut.inkcut
runtime: org.kde.Platform
runtime-version: "6.9"
sdk: org.kde.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: "6.9"
cleanup-commands:
  - /app/cleanup-BaseApp.sh
cleanup:
  - /cache
  - /man
  - /share/aclocal
  - /share/devhelp
  - /include
  - /lib/pkgconfig
  - /share/gtk-doc
  - /share/man
  - /lib/*.a
  - /lib/*.la
command: inkcut
finish-args:
  - --device=dri
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio

  #  For USB, until there is a better way in flatpak
  - --device=all

  # XDG commons folders
  - --filesystem=xdg-download
  - --filesystem=xdg-pictures
  - --filesystem=xdg-videos

  # notifications
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher

  # file chooser
  - --talk-name=org.freedesktop.portal.FileChooser

modules:
  - name: python-pygments
    # available in the sdk but not in the runtime
    buildsystem: simple
    build-commands:
      - pip3 install --ignore-installed --exists-action=i --no-index --find-links=file://$PWD
        --prefix=$FLATPAK_DEST Pygments --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c7/21/705964c7812476f378728bdf590ca4b771ec72385c533964653c68e86bdc/pygments-2.19.2-py3-none-any.whl
        sha256: 86540386c03d588bb81d44bc3928634ff26449851e99741617ecb9037ee5ec0b
        x-checker-data:
          type: pypi
          name: Pygments
          packagetype: wheel

  - requirements-pypi-dependencies.json

  - name: inkcut
    buildsystem: simple
    build-commands:
      - pip install --no-deps --no-build-isolation --prefix=$FLATPAK_DEST .
    sources:
      - type: git
        url: https://github.com/inkcut/inkcut
        tag: v2.1.6
        commit: 39b2753f3be447ffb8367fd74f9482c06b71b8e3
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
# /usr/bin/flatpak run --branch=master --arch=x86_64 --command=RimSort io.github.rimsort.RimSort
