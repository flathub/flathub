app-id: com.github.Kitware.TeleSculptor
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '5.15'
command: TeleSculptor
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri

modules:
  - shared-modules/glew/glew.json
  - shared-modules/glu/glu-9.json
      
  - name: python3-numpy
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/66/03/818876390c7ff4484d5a05398a618cfdaf0a2b9abb3a7c7ccd59fe181008/numpy-1.21.0.zip
        sha256: e80fe25cba41c124d04c662f33f6364909b985f2eb5998aaa5ae4b9587242cce
        x-checker-data:
          type: pypi
          name: numpy
        
  - name: pybind11
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - cmake -DPYBIND11_INSTALL=ON -DPYBIND11_TEST=OFF -DCMAKE_INSTALL_INCLUDEDIR:PATH=${FLATPAK_DEST}/include -DCMAKE_INSTALL_LIBDIR:PATH=${FLATPAK_DEST}/lib -DCMAKE_INSTALL_DATAROOTDIR:PATH=${FLATPAK_DEST}/share .
      - python3 setup.py install --prefix=${FLATPAK_DEST}
      - cmake --build .
      - cmake --install .
    sources:
      - type: archive
        url: https://github.com/pybind/pybind11/archive/v2.6.2.tar.gz
        sha256: 8ff2fff22df038f5cd02cea8af56622bc67f5b64534f1b83b9f133b8366acff2
        x-checker-data:
          type: anitya
          project-id: 13384
          stable-only: true
          url-template: https://github.com/pybind/pybind11/archive/v$version.tar.gz

  - name: lapack
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_SHARED_LIBS=ON
      - -DBUILD_TESTING=OFF
      - -DLAPACKE=ON
      - -DCBLAS=ON
    sources:
      - type: archive
        url: https://github.com/Reference-LAPACK/lapack/archive/refs/tags/v3.10.0.tar.gz
        sha256: 328c1bea493a32cac5257d84157dc686cc3ab0b004e2bea22044e0a59f6f8a19
        x-checker-data:
          type: anitya
          project-id: 1534
          stable-only: true
          url-template: https://github.com/Reference-LAPACK/lapack/archive/refs/tags/v$version.tar.gz

    # TeleSculptor need libicui18n.so.60
  - name: ICU-60
    subdir: source
    config-opts:
      - --disable-static
      - --enable-shared
      - --disable-samples
    sources:
      - type: archive
        url: https://github.com/unicode-org/icu/releases/download/release-60-3/icu4c-60_3-src.tgz
        sha256: 476287b17db6e0b7da230dce4b58e8e5669b1510847f82cab3647920f1374390
        
    # Install the binary instead of building from source, I can't figured it out.
    # Use source file only for LICENSE and icon file, self-extract file does not extract LICENSE.
  - name: TeleSculptor
    buildsystem: simple
    ensure-writable:
      - /lib
      - /share
    build-commands:
      - chmod +x TeleSculptor-1.1.2-Linux-x86_64.sh
      - yes | ./TeleSculptor-1.1.2-Linux-x86_64.sh
      - cd TeleSculptor-1.1.2-Linux-x86_64 && cp -r {bin,lib,share} ${FLATPAK_DEST}
      - cp -r sourcefile/LICENSE ${FLATPAK_DEST}/share/telesculptor
      - mkdir -p /app/share/icons/hicolor/512x512/apps
      - cp -r sourcefile/gui/icons/512x512/telesculptor.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png
      - install -Dm0644 $FLATPAK_ID.metainfo.xml ${FLATPAK_DEST}/share/metainfo/$FLATPAK_ID.metainfo.xml
      - install -Dm0644 $FLATPAK_ID.desktop ${FLATPAK_DEST}/share/applications/$FLATPAK_ID.desktop
    sources:
      - type: file
        url: https://github.com/Kitware/TeleSculptor/releases/download/v1.1.2/TeleSculptor-1.1.2-Linux-x86_64.sh
        sha256: da4e498045b746f61a559504a3894fa5e536184cda7c5a10f036e5694e3ba13b
      - type: archive
        url: https://github.com/Kitware/TeleSculptor/archive/refs/tags/v1.1.2.tar.gz
        sha256: ec37981b4ba065b51faef44b482a5f6198eaf9f0d7bb47fed3f45aecb8f13cee
        dest: sourcefile
      - type: file
        path: com.github.Kitware.TeleSculptor.metainfo.xml
      - type: file
        path: com.github.Kitware.TeleSculptor.desktop
        
