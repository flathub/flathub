{
    "id": "com.gitlab.librebob.Athenaeum",
    "runtime": "org.kde.Platform",
    "runtime-version": "5.12",
    "sdk": "org.kde.Sdk",
    "command": "athenaeum",
    "finish-args": [
        "--socket=pulseaudio",
        "--socket=x11",
        "--device=dri",
        "--share=network",
        "--filesystem=xdg-data/athenaeum:create",
        "--filesystem=xdg-data/flatpak:ro",
        "--talk-name=org.freedesktop.Notifications",
        "--talk-name=org.freedesktop.Flatpak"
    ],
    "modules": [
        {
            "name" : "pyqt5",
            "config-opts" : [
                "--disable-static",
                "--enable-x11"
            ],
            "sources" : [
                {
                    "type" : "archive",
                    "url" : "https://sourceforge.net/projects/pyqt/files/PyQt5/PyQt-5.11.3/PyQt5_gpl-5.11.3.zip",
                    "sha256" : "7cacf0712d76a702e0e2102a65f411fd72e7f64a851a47a72c03fbafbe447aae"
                },
                {
                    "type": "script",
                    "commands": [
                        "python3 configure.py --assume-shared --confirm-license --no-designer-plugin --no-qml-plugin --sysroot=/app --qsci-api --qsci-api-destdir=/app/qsci --sipdir=/app/share/sip --sip=/app/bin/sip --sip-incdir=/app/include QMAKE_CFLAGS_RELEASE='-I/usr/include/python3.7m/' QMAKE_CXXFLAGS_RELEASE='-I/usr/include/python3.7m/'"
                    ],
                    "dest-filename": "configure"
                }
            ],
            "modules" : [
                {
                    "name" : "sip",
                    "sources" : [
                        {
                            "type" : "archive",
                            "url" : "https://sourceforge.net/projects/pyqt/files/sip/sip-4.19.12/sip-4.19.12.tar.gz",
                            "sha256" : "24617fc31b983df075500ecac0e99d2fb48bf63ba82d4a17518659e571923822"
                        },
                        {
                            "type": "script",
                            "commands": [
                                "python3 configure.py --sip-module PyQt5.sip -b ${FLATPAK_DEST}/bin -d ${FLATPAK_DEST}/lib/python3.7/site-packages -e ${FLATPAK_DEST}/include -v ${FLATPAK_DEST}/share/sip --stubsdir=${FLATPAK_DEST}/lib/python3.7/site-packages"
                            ],
                            "dest-filename": "configure"
                        }
                    ],
                    "cleanup" : [
                        "/bin",
                        "/include"
                    ]
                }
            ]
        },
        {
            "name": "python3-peewee",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} peewee"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/c9/e4/f82bd273a7c88e7a2f71652324039c7e382f2f88eced01b9799d6c936ad2/peewee-3.9.3.tar.gz",
                    "sha256": "603337153536b85c3c5b5e84df4ae0f9cbaff09163a3739451d167e0ad3fe1f7"
                }
            ]
        },
        {
            "name": "python-setuptools_scm",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app --root=/"
            ],
            "sources": [
                {
                "type": "archive",
                "url": "https://files.pythonhosted.org/packages/09/b4/d148a70543b42ff3d81d57381f33104f32b91f970ad7873f463e75bf7453/setuptools_scm-3.1.0.tar.gz",
                "sha256": "1191f2a136b5e86f7ca8ab00a97ef7aef997131f1f6d4971be69a1ef387d8b40"
                },
                {
                "type": "shell",
                "commands": [
                    "sed -i 's/if not platform_/if not dirs/' setup.py"
                ]
                }
            ]
        },
        {
            "name": "python3-python-dateutil",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app --root=/"
            ],
            "sources": [
                {
                "type": "archive",
                "url": "https://files.pythonhosted.org/packages/0e/01/68747933e8d12263d41ce08119620d9a7e5eb72c876a3442257f74490da0/python-dateutil-2.7.5.tar.gz",
                "sha256": "88f9287c0174266bb0d8cedd395cfba9c58e87e5ad86b2ce58859bc11be3cf02"
                },
                {
                "type": "shell",
                "commands": [
                    "sed -i 's/if not platform_/if not dirs/' setup.py"
                ]
                }
            ]
        },
        {
            "name": "athenaeum",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "git",
                    "url": "https://gitlab.com/librebob/athenaeum.git",
                    "tag": "v0.2.0",
                    "commit": "4145750a1be319f397b0b0e05bae1b3428a69766"
                }
            ],
            "build-commands": [
                "for i in 32 48 64 96 128 256 512; do
                    install -Dm644 athenaeum/resources/icons/hicolor/${i}x${i}/com.gitlab.librebob.Athenaeum.png -t ${FLATPAK_DEST}/share/icons/hicolor/${i}x${i}/apps/
                done",
                "install -Dm644 athenaeum/resources/com.gitlab.librebob.Athenaeum.appdata.xml -t ${FLATPAK_DEST}/share/appdata/",
                "install -Dm644 athenaeum/resources/com.gitlab.librebob.Athenaeum.desktop -t ${FLATPAK_DEST}/share/applications/",
                "python3 setup.py install --optimize=1 --prefix=${FLATPAK_DEST}"
            ]
        }
    ]
}
