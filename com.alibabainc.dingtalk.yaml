id: com.alibabainc.dingtalk
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: Elevator.sh
finish-args:
  - --share=ipc
  - --share=network
  - --socket=x11
  - --socket=pulseaudio
  - --talk-name=org.freedesktop.FileManager1
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher
  - --device=all
  - --filesystem=xdg-download

modules:
  - name: libxcrypt
    buildsystem: autotools
    config-opts: ["--enable-obsolete-api=glibc"]
    sources:
      - type: git
        url: https://github.com/besser82/libxcrypt.git
        tag: v4.4.38 
  - name: dingtalk
    buildsystem: simple
    build-commands:
      - ar x com.alibabainc.dingtalk_7.6.45.5032501_amd64.deb
      - rm com.alibabainc.dingtalk_7.6.45.5032501_amd64.deb
      - tar -xf data.tar.xz
      - rm data.tar.xz
      - rm opt/apps/com.alibabainc.dingtalk/files/7.6.45-Release.5032501/libm.so.6
      - mv opt/apps/com.alibabainc.dingtalk/files /app/bin
      - install -Dm644 com.alibabainc.dingtalk.metainfo.xml -t $FLATPAK_DEST/share/metainfo
      - install -Dm644 com.alibabainc.dingtalk.desktop -t $FLATPAK_DEST/share/applications/
      - install -Dm644 com.alibabainc.dingtalk.png -t $FLATPAK_DEST/share/icons/hicolor/512x512/apps/
      - install -Dm755 Elevator.sh -t $FLATPAK_DEST/bin/
    sources:
      - type: file
        url: https://dtapp-pub.dingtalk.com/dingtalk-desktop/xc_dingtalk_update/linux_deb/Release/com.alibabainc.dingtalk_7.6.45.5032501_amd64.deb
        sha256: c41dd0c9f5e958710ebb4fb2ec5be7acf8e2c515ff1803071aa4232192fab199
      - type: file
        path: com.alibabainc.dingtalk.desktop
      - type: file
        path: com.alibabainc.dingtalk.png
      - type: file
        path: Elevator.sh
      - type: file
        path: com.alibabainc.dingtalk.metainfo.xml
