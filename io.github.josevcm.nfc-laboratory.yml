id: io.github.josevcm.nfc-laboratory
runtime: org.kde.Platform
runtime-version: '6.9'
sdk: org.kde.Sdk
command: nfc-lab

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --device=all  # Required for USB access to SDR receivers and logic analyzers (includes dri)
  - --filesystem=xdg-run/documents
  - --persist=.nfc-lab

cleanup:
  - /lib/*.la

modules:
  - shared-modules/libusb/libusb.json

  - name: libairspy
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_INSTALL_PREFIX=/app
      - -DINSTALL_UDEV_RULES=OFF
    sources:
      - type: git
        url: https://github.com/airspy/airspyone_host.git
        tag: v1.0.10
        commit: 229d5a5045b890621cd9cc200a19b1541c6021ae
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$

  - name: librtlsdr
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_INSTALL_PREFIX=/app
      - -DINSTALL_UDEV_RULES=OFF
      - -DDETACH_KERNEL_DRIVER=ON
    sources:
      - type: git
        url: https://github.com/osmocom/rtl-sdr.git
        tag: v2.0.2
        commit: 619ac3186ea0ffc092615e1f59f7397e5e6f668c
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$

  - name: nfc-laboratory
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_INSTALL_PREFIX=/app
      - -DBUILD_PROJECT_VERSION=3.4.0
      - -DCMAKE_C_FLAGS_RELEASE=-O3 -DNDEBUG
      - -DCMAKE_CXX_FLAGS_RELEASE=-O3 -DNDEBUG
      - -DFLATPAK_BUILD=ON
    sources:
      - type: git
        url: https://github.com/josevcm/nfc-laboratory.git
        tag: '3.4.0'
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$
