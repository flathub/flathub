name: UnicodePlus
buildsystem: simple
build-options:
  env:
    electron_config_cache: /run/build/UnicodePlus/npm-cache
sources:
  - type: archive
    url: https://github.com/tonton-pixel/unicode-plus/archive/v2.0.4.tar.gz
    sha256: 87bc7a5d4c1686bd3e7dd0f7707999443c5ba8c7a2fda24265e197dd8e855391
    dest: main
  # This file is autogenerated by: npm install --package-lock-only
  - type: file
    path: package-lock.json
    dest: main
  # This file is autogenerated by: flatpak-npm-generator.py --recursive package-lock.json
  # prefixed to the "main" dir
  - generated-sources.json
  # Wrapper to launch the app
  - type: script
    commands:
      - npm start --prefix="/app/main";
    dest-filename: run.sh
  - type: file
    path: com.github.tonton_pixel.UnicodePlus.desktop
  - type: file
    path: com.github.tonton_pixel.UnicodePlus.appdata.xml
build-commands:
  - npm install --prefix="main" --offline --cache="${electron_config_cache}" --nodedir="${FLATPAK_DEST}";
  - install -d "${FLATPAK_DEST}/main";
  - cp -ra main/* "${FLATPAK_DEST}/main/";
  - install -d "${FLATPAK_DEST}/bin";
  - install -p -D -m 0755 "run.sh" "${FLATPAK_DEST}/bin/UnicodePlus";
post-install:
  - icon_in="main/icons/icon.png";
    icon_out="${FLATPAK_ID}.png";
    for s in {16,22,24,32,48,64,72,96,128,192,256,512}; do
    convert -background none -density 1024 -resize "${s}x${s}" "${icon_in}" "${icon_out}";
    install -p -D -m 0644 "${icon_out}" -t "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/";
    done;
  - install -p -D -m 0644 "${FLATPAK_ID}.desktop" -t "${FLATPAK_DEST}/share/applications/";
  - install -p -D -m 0644 "${FLATPAK_ID}.appdata.xml" -t "${FLATPAK_DEST}/share/appdata/";
  - install -p -D -m 0644 "main/LICENSE.txt" -t "${FLATPAK_DEST}/share/licenses/UnicodePlus/";
