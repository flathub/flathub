app-id: com.kassindornelles.lolforlinuxinstaller
runtime: org.kde.Platform
runtime-version: '5.15-22.08'
sdk: org.kde.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: 5.15-22.08
cleanup-commands:
  - /app/cleanup-BaseApp.sh
build-options:
  env:
    - BASEAPP_REMOVE_WEBENGINE=1
finish-args:
  - --env=QTWEBENGINEPROCESS_PATH=/app/bin/QtWebEngineProcess
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --device=dri
  - --socket=pulseaudio
  - --filesystem=xdg-run/pipewire-0
command: com.kassindornelles.lolforlinuxinstaller
modules:
    - name: lol-for-linux
      buildsystem: simple
      cleanup-commands:
        - 'rm -r .git'
        - 'rm -r .github'
        - 'rm .gitignore'
        - 'rm license.md'
        - 'rm -r ./src'
        - 'rm wine_build.json'
        - 'rm README.md'

      build-commands:
        #install the launcher to the correctly location
        - install -D ./src/com.kassindornelles.lolforlinuxinstaller.py /app/bin/com.kassindornelles.lolforlinuxinstaller

        # install the icon and .desktop to the correctly location
        - install -D ./src/com.kassindornelles.lolforlinuxinstaller.desktop /app/share/applications/com.kassindornelles.lolforlinuxinstaller.desktop
        - install -D ./src/lolforlinuxinstaller.svg /app/share/icons/hicolor/scalable/apps/com.kassindornelles.lolforlinuxinstaller.svg

        #edit the .desktop to point to the new icon name and launcher
        - desktop-file-edit --set-key="Icon" --set-value="com.kassindornelles.lolforlinuxinstaller" /app/share/applications/com.kassindornelles.lolforlinuxinstaller.desktop
        - desktop-file-edit --set-key="Exec" --set-value="com.kassindornelles.lolforlinuxinstaller %F" /app/share/applications/com.kassindornelles.lolforlinuxinstaller.desktop

        #install the libraries to the correctly location
        - install -D ./src/launch-script.py /app/usr/share/lol-for-linux-installer/launch-script.py
        - install -D ./src/vulkan_layers.py /app/usr/share/lol-for-linux-installer/vulkan_layers.py
        - install -D ./src/env_vars.json /app/usr/share/lol-for-linux-installer/env_vars.json
        - install -D ./src/leagueinstaller_code.py /app/usr/share/lol-for-linux-installer/leagueinstaller_code.py
        - install -D ./src/installer.ui /app/usr/share/lol-for-linux-installer/installer.ui

        - install -Dm644 ./com.kassindornelles.lolforlinuxinstaller.metainfo.xml /app/share/metainfo/${FLATPAK_ID}.metainfo.xml
      sources:
        - type: git
          url: https://github.com/kassindornelles/lol-for-linux-installer.git
          tag: v.2.5.6
        - type: file
          path: com.kassindornelles.lolforlinuxinstaller.metainfo.xml

    - name: wine-LoL
      buildsystem: simple
      build-commands:
        - install -d /app/league-of-legends/wine/wine-build/
        - mv ./bin /app/league-of-legends/wine/wine-build/
        - mv ./lib /app/league-of-legends/wine/wine-build/
        - mv ./lib64 /app/league-of-legends/wine/wine-build/
        - mv ./share /app/league-of-legends/wine/wine-build/

      sources:
        - type: git
          url: https://github.com/kassindornelles/lol-for-linux-installer-wine-builds.git
          tag: 8.7-4
    - name: PyQtApp
        - python3-modules.json
