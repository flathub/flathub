id: org.freedesktop.LinuxAudio.Plugins.Samplo
branch: '25.08'

runtime: org.freedesktop.LinuxAudio.BaseExtension
runtime-version: stable

sdk: org.freedesktop.Sdk//25.08
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable

build-extension: true
separate-locales: false

build-options:
  prefix: /app/extensions/Plugins/Samplo
  append-path: /usr/lib/sdk/rust-stable/bin
  env:
    CARGO_HOME: /run/build/samplo/cargo
    CARGO_NET_OFFLINE: 'true'

cleanup:
  - /include
  - /lib/pkgconfig
  - '*.a'
  - '*.la'

modules:
  - name: samplo
    buildsystem: simple
    build-commands:
      - cargo --offline fetch --manifest-path Cargo.toml --verbose
      - cargo --offline build --release --verbose
      
      - install -Dm755 target/release/libsamplo.so ${FLATPAK_DEST}/clap/Samplo.clap
      - strip ${FLATPAK_DEST}/clap/Samplo.clap
      
      - install -Dm644 packaging/org.freedesktop.LinuxAudio.Plugins.Samplo.metainfo.xml -t ${FLATPAK_DEST}/share/metainfo/
      
      
      - install -Dm644 LICENSE ${FLATPAK_DEST}/share/licenses/samplo/LICENSE

    sources:
      - type: git
        url: https://github.com/mlm-games/samplo-clap.git
        tag: v1.2.7
        commit: 6d25f801fbdf364307194695ee9643a1da466cbf

      - cargo-sources.json