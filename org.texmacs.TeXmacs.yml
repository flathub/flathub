app-id: org.texmacs.TeXmacs
runtime: org.kde.Platform
runtime-version: "5.15-23.08"
sdk: org.kde.Sdk
command: texmacs
# rename-desktop-file: lyx.desktop
# rename-icon: lyx
finish-args:
  - --socket=x11
  - --device=dri
  - --share=ipc
  - --filesystem=xdg-documents
  - --persist=.TeXmacs
  - --env=PATH=/app/texlive/bin/:/app/texlive/bin/x86_64-linux:/app/texlive/bin/aarch64-linux:/app/bin:/usr/bin
  - --env=ASPELL_CONF=dict-dir /app/share/dicts
  - --env=LD_LIBRARY_PATH=/app/texlive/lib:/app/texlive/lib/perl5/5.38.2/aarch64-linux/CORE:/app/texlive/lib/perl5/5.38.2/x86_64-linux/CORE
  - --env=PERL5LIB=/app/texlive/lib/perl5/5.38.2:/app/texlive/lib/perl5/site_perl/5.38.2

add-extensions:
  org.freedesktop.Sdk.Extension.texlive:
    version: "23.08"
    directory: texlive
    autodelete: false
  
modules:
  - name: texliveYextensions
    buildsystem: simple
    build-commands:
      - install -d /app/texlive
  - name: magick
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/ImageMagick/ImageMagick/archive/refs/tags/7.1.1-21.tar.gz
        sha256: 09402e5f17c6575ef9f010bb2e21ae1710f1f3426f115ad4317ee9129c32608e
  - name: guile
    buildsystem: simple
    build-commands:
      - ./configure --prefix=/app/ --disable-static --disable-error-on-warning
      - make
      - make install
    sources:
      - type: archive
        url: http://ftp.gnu.org/gnu/guile/guile-1.8.8.tar.gz
        sha256: c3471fed2e72e5b04ad133bbaaf16369e8360283679bcf19800bc1b381024050
      - type: patch
        path: guile-1.8.8-configure.patch
  - name: freetype
    buildsystem: autotools
    sources:
      - type: archive
        url: https://download.savannah.gnu.org/releases/freetype/freetype-2.13.2.tar.xz
        sha256: 12991c4e55c506dd7f9b765933e62fd2be2e06d421505d7950a132e4f1bb484d
  - name: libertinus-font
    buildsystem: simple
    build-commands:
      - mkdir /app/share/fonts
      - cp static/OTF/* /app/share/fonts/
    sources:
      - type: archive
        url: https://github.com/alerque/libertinus/releases/download/v7.040/Libertinus-7.040.tar.xz
        sha256: 7fe9f022722d1c1cc67dc2c28a110b3bb55bae3575196160d2422c89333b3850
  - name: dictEs-aspell
    buildsystem: simple
    build-commands:
      - ./configure
      - make datadir=/app/share/dicts dictdir=/app/share/dicts
      - make datadir=/app/share/dicts dictdir=/app/share/dicts install
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/aspell/dict/es/aspell6-es-1.11-2.tar.bz2
        sha256: ad367fa1e7069c72eb7ae37e4d39c30a44d32a6aa73cedccbd0d06a69018afcc
  - name: dictEn-aspell
    buildsystem: simple
    build-commands:
      - ./configure
      - make datadir=/app/share/dicts dictdir=/app/share/dicts
      - make datadir=/app/share/dicts dictdir=/app/share/dicts install
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/aspell/dict/en/aspell6-en-2020.12.07-0.tar.bz2
        sha256: 4c8f734a28a088b88bb6481fcf972d0b2c3dc8da944f7673283ce487eac49fb3
  - name: xdg # temporary
    buildsystem: simple
    build-commands:
      - ar x xdg-utils_1.1.3-4.1_all.deb
      - tar -xJf data.tar.xz
      - cp -ru ./usr/bin/* /app/bin/
    sources:
      - type: file
        url: http://ftp.de.debian.org/debian/pool/main/x/xdg-utils/xdg-utils_1.1.3-4.1_all.deb
        sha256: 0e31caa8c34643f7eedb4d373ee61943c09061275b5fa727524fc568d0a9e332
  - name: texmacs
    buildsystem: autotools
    post-install:
      - rm /app/bin/xdg-*
      - install -Dm644 org.texmacs.TeXmacs.appdata.xml /app/share/appdata/org.texmacs.TeXmacs.appdata.xml
    sources:
      - type: archive
        url: https://www.texmacs.org/Download/ftp/tmftp/source/TeXmacs-2.1.4-src.tar.gz
        sha256: 87a6922ee0ddac0b55cce9cd54fa8c1165fd58b0c7b640a33f2f495d69c18186
      - type: archive
        path: org.texmacs.TeXmacs.appdata.xml
