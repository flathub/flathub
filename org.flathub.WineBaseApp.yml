id: org.flathub.WineBaseApp
branch: "20.08"
sdk: org.freedesktop.Sdk
runtime: org.freedesktop.Platform
runtime-version: "20.08"
sdk-extensions:
  - org.freedesktop.Sdk.Compat.i386
  - org.freedesktop.Sdk.Extension.toolchain-i386
separate-locales: false
cleanup:
  - /lib/*.a
  - /lib/*.la
  - /lib32/*.a
  - /lib32/*.la
  - /share/man
  - /share/doc
cleanup-commands:
  - mkdir -p ${FLATPAK_DEST}/lib{,32}/ffmpeg
add-extensions:
  org.freedesktop.Platform.Compat.i386:
    directory: lib/i386-linux-gnu
    version: "20.08"

  org.freedesktop.Platform.Compat.i386.Debug:
    directory: lib/debug/lib/i386-linux-gnu
    version: "20.08"
    no-autodownload: true

  org.freedesktop.Platform.GL32:
    directory: lib/i386-linux-gnu/GL
    version: "1.4"
    versions: "20.08;1.4"
    subdirectories: true
    no-autodownload: true
    autodelete: false
    add-ld-path: lib
    merge-dirs: vulkan/icd.d;glvnd/egl_vendor.d;OpenCL/vendors;lib/dri;lib/d3d;vulkan/explicit_layer.d
    download-if: active-gl-driver
    enable-if: active-gl-driver

  org.freedesktop.Platform.VAAPI.Intel.i386:
    directory: lib/i386-linux-gnu/dri/intel-vaapi-driver
    version: "20.08"
    subdirectories: true
    no-autodownload: true
    autodelete: false
    add-ld-path: lib
    download-if: active-gl-driver
    enable-if: active-gl-driver

  org.freedesktop.Platform.ffmpeg-full:
    directory: lib/ffmpeg
    add-ld-path: "."
    version: "20.08"
    autodelete: false

  org.freedesktop.Platform.ffmpeg_full.i386:
    directory: lib32/ffmpeg
    add-ld-path: "."
    version: "20.08"
    autodelete: false

modules:
  - name: bundle-setup
    buildsystem: simple
    build-commands:
      - mkdir -p /app{,/lib/debug}/lib/i386-linux-gnu
      - install -D -m 0644 ld.so.conf -t /app/etc
    sources:
      - type: file
        path: ld.so.conf

  - generated/gl-libs.json
  - generated/wine-deps.json

  - name: check-build
    buildsystem: simple
    build-commands:
      - bash check.sh
    sources:
      - type: file
        path: check.sh
