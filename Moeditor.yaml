name: Moeditor
buildsystem: simple
build-options:
  env:
    electron_config_cache: /run/build/Moeditor/npm-cache
sources:
  - type: archive
    url: https://github.com/Moeditor/Moeditor/archive/v0.2.0-beta.tar.gz
    sha256: 2f1780e4958a69937129d90c86a592c2334102c82dd60f79141e8904b3ae4207
    dest: main
  # This file is autogenerated by: npm install --package-lock-only
  - type: file
    path: package-lock.json
    dest: main
  # This file is autogenerated by: flatpak-npm-generator.py --recursive package-lock.json
  # prefixed to the "main" dir
  - generated-sources.json
  # Wrapper to launch the app
  - type: script
    commands:
      - npm start --prefix="/app/main";
    dest-filename: run.sh
  - type: file
    path: com.github.Moeditor.Moeditor.desktop
  - type: file
    path: com.github.Moeditor.Moeditor.appdata.xml
build-commands:
  - npm install --prefix="main" --offline --cache="${electron_config_cache}" --nodedir="${FLATPAK_DEST}";
  - install -d "${FLATPAK_DEST}/main";
  - cp -ra main/* "${FLATPAK_DEST}/main/";
  - install -d "${FLATPAK_DEST}/bin";
  - install -p -D -m 0755 "run.sh" "${FLATPAK_DEST}/bin/Moeditor";
post-install:
  - icon_in="main/icons/Moeditor.svg";
    icon_out="${FLATPAK_ID}.png";
    for s in {16,22,24,32,48,64,72,96,128,192,256,512}; do
    rsvg-convert "${icon_in}" -w "${s}" -h "${s}" -a -f png -o "${icon_out}";
    install -p -D -m 0644 "${icon_out}" -t "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/";
    done;
  - install -p -D -m 0644 "${FLATPAK_ID}.desktop" -t "${FLATPAK_DEST}/share/applications/";
  - install -p -D -m 0644 "${FLATPAK_ID}.appdata.xml" -t "${FLATPAK_DEST}/share/appdata/";
  - install -p -D -m 0644 "main/LICENSE" -t "${FLATPAK_DEST}/share/licenses/Moeditor/";
