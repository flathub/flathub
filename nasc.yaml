name: nasc
buildsystem: meson
sources:
  - type: archive
    url: https://github.com/parnold-x/nasc/archive/0.5.1.tar.gz
    sha256: 96304085f6082b14d9220c28d7823bcb59317b567f9bcfe09ab905e27f053859
  # 1. Application patches
  # 1.1 Use get_user_data_dir() instead of hardcoded path
  # https://github.com/scx/nasc/commit/b35559bd611335ee9b538d3d5b1e028f5e8d51e9
  - type: patch
    path: nasc-0.5.1-sheet_path.patch
  # 2. XDG patches
  # 2.1 Enhance desktop file
  # https://github.com/scx/nasc/commit/b0719fc779b3d3972ecaeb6bc40cb60b08bd5f55
  - type: patch
    path: nasc-0.5.1-desktop.patch
  # 2.2 Enhance AppData file
  # https://github.com/scx/nasc/commit/d00ac1002a6a16aca4a57ada0c304eba839a7523
  - type: patch
    path: nasc-0.5.1-appdata.patch
  # 3. CMake patches
  # 3.1 Fix linking
  # https://github.com/scx/nasc/commit/bebce8e7ea33e4479498796346e32afaf0318739
  - type: patch
    path: nasc-0.5.1-link.patch
  # 3.2 Remove --thread option for Vala Compiler
  # https://github.com/scx/nasc/commit/fdf40fa6828af6fffb5976f43c8f331eac8eafe7
  - type: patch
    path: nasc-0.5.1-vala-thread.patch
  # 4. Meson patches
  # 4.1 CMake: Reorganize files
  # https://github.com/scx/nasc/commit/19412dcdf1a9e868566f8030324b1ab903ca0a34
  - type: patch
    path: nasc-0.5.1-cmake.patch
  # 4.2 Port to Meson
  # https://github.com/scx/nasc/commit/989bff9a4cff609d98e564e33e1016762633ffde
  - type: patch
    path: nasc-0.5.1-meson-optional.patch
  # 5. Flatpak patches
  # 5.1 Change Application ID
  # sed_exp='s!com\.github\.parnold-x\.nasc!com.github.parnold_x.nasc!g'; find * -xtype f \( -name '*.vala' -o -name 'com.github.parnold-x.nasc.*' -o -name 'CMakeLists.txt' -o -name 'meson.build' \) | xargs -I{} sed -i -re "${sed_exp}" '{}'; find * -xtype f -name 'com.github.parnold-x.nasc.*' | while read -r file; do d="$( dirname "${file}" )"; f="$( basename "${file}" )"; g="$( sed -re "${sed_exp}" <<< "${f}" )"; git mv "${d}/${f}" "${d}/${g}"; done; desktop-file-edit --set-key='X-Flatpak-RenamedFrom' --set-value='nasc.desktop;com.github.parnold-x.nasc.desktop;' data/*.desktop;
  # https://github.com/scx/nasc/commit/f0142da2ce18e92ed976afcc30712508d946727e
  - type: patch
    path: nasc-0.5.1-change-id.patch
post-install:
  - ln -s "${FLATPAK_ID}" "${FLATPAK_DEST}/bin/nasc";
modules:
  - gtksourceview.yaml
  - libqalculate.yaml
