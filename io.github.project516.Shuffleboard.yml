app-id: io.github.project516.Shuffleboard
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: shuffleboard
finish-args:
  - --share=network
  - --socket=x11
 # - --socket=wayland
  - --share=ipc
  - --device=dri
  - --filesystem=~/Shuffleboard
  - --filesystem=xdg-documents

sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk17

modules:
  - name: shuffleboard
    buildsystem: simple
    build-commands:
      # 1. Install the Jar
      - install -D Shuffleboard.jar /app/share/java/Shuffleboard.jar
      
      # 2. Install the Icon
      - install -D wpilib-icon-128.png /app/share/icons/hicolor/128x128/apps/io.github.project516.Shuffleboard.png

      # 3. Install Metadata
      - install -D io.github.project516.Shuffleboard.desktop /app/share/applications/io.github.project516.Shuffleboard.desktop
      - install -D io.github.project516.Shuffleboard.metainfo.xml /app/share/metainfo/io.github.project516.Shuffleboard.metainfo.xml

      # 4. BUNDLE JAVA
      - cp -rL /usr/lib/sdk/openjdk17/jvm/openjdk-17 /app/jre
      - chmod -R +x /app/jre/bin
      
      # 5. Launch Script
      - mkdir -p /app/bin
      - |
        cat > /app/bin/shuffleboard <<EOF
        #!/bin/bash
        export JAVA_HOME=/app/jre
        exec /app/jre/bin/java -Djdk.gtk.version=3 -jar /app/share/java/Shuffleboard.jar "\$@"
        EOF
      - chmod +x /app/bin/shuffleboard

    sources:
      - type: file
        only-arches: [x86_64]
        url: https://frcmaven.wpi.edu/artifactory/release/edu/wpi/first/tools/Shuffleboard/2025.3.2/Shuffleboard-2025.3.2-linuxx64.jar
        dest-filename: Shuffleboard.jar
        sha256: 58ef231827a68c31eb45ac3ece17d233fa78b8412c35da9bf912c19a014c7698

      - type: file
        only-arches: [aarch64]
        url: https://frcmaven.wpi.edu/artifactory/release/edu/wpi/first/tools/Shuffleboard/2025.3.2/Shuffleboard-2025.3.2-linuxarm64.jar
        dest-filename: Shuffleboard.jar
        sha256: e77ef43410b62f1e415c7e98f168e679123e51fa4a86ed669f497a109a7cc610

      # Icon
      - type: file
        url: https://github.com/wpilibsuite/branding/raw/main/export/png/wpilib-icon-128.png
        sha256: 40e08b0d1f78b5bcb468ff35aa6349cdba695b3207d66da40f90e61eacff1146
        dest-filename: wpilib-icon-128.png

      # Metadata
      - type: file
        path: io.github.project516.Shuffleboard.desktop
      - type: file
        path: io.github.project516.Shuffleboard.metainfo.xml
