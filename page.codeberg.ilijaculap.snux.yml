app-id: page.codeberg.ilijaculap.snux
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: run-snux

finish-args:
  - --socket=x11
  - --share=ipc

modules:
- name: tkinter
  buildsystem: simple
  build-commands:
    - pip3 install --prefix=${FLATPAK_DEST} .
  sources:
    - type: git
      url: https://github.com/iwalton3/tkinter-standalone
      commit: d9cb97c5bd4f814c73678366e0e48220776b6ad3
 
  modules:
  - name: tcl
    buildsystem: autotools
    subdir: unix
    post-install:
      - chmod 755 /app/lib/libtcl*.so
    cleanup:
      - /bin
      - /lib/pkgconfig
      - /man
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/tcl/tcl8.6.13-src.tar.gz
        sha256: 43a1fae7412f61ff11de2cfd05d28cfc3a73762f354a417c62370a54e2caf066
        x-checker-data:
          type: anitya
          project-id: 4941
          stable-only: true
          url-template: https://prdownloads.sourceforge.net/tcl/tcl$version-src.tar.gz
  
  - name: tk
    buildsystem: autotools
    subdir: unix
    post-install:
      - chmod 755 /app/lib/libtk*.so
    cleanup:
      - /bin
      - /lib/pkgconfig
      - /man
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/tcl/tk8.6.13-src.tar.gz
        sha256: 2e65fa069a23365440a3c56c556b8673b5e32a283800d8d9b257e3f584ce0675
        x-checker-data:
          type: anitya
          project-id: 11426
          stable-only: true
          url-template: https://prdownloads.sourceforge.net/tcl/tk$version-src.tar.gz

- name: python3-pillow
  buildsystem: simple
  build-commands:
    - "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} \"pillow\" --no-build-isolation"
  sources:
    - type: file
      url: https://files.pythonhosted.org/packages/a5/26/0d95c04c868f6bdb0c447e3ee2de5564411845e36a858cfd63766bc7b563/pillow-11.0.0.tar.gz
      sha256: 72bacbaf24ac003fea9bff9837d1eedb6088758d41e100c1552930151f677739

- name: snux
  buildsystem: simple
  build-commands:
    - cp -r . /app/snux/
    - mkdir -p /app/share/icons/hicolor/512x512/apps/
    - mkdir -p /app/share/applications/
    - mkdir -p /app/share/metainfo/
    - install -Dm644 /app/snux/data/icon.png /app/share/icons/hicolor/512x512/apps/page.codeberg.ilijaculap.snux.png
    - install -Dm644 /app/snux/data/snux.desktop /app/share/applications/page.codeberg.ilijaculap.snux.desktop
    - install -Dm644 /app/snux/data/metainfo.xml /app/share/metainfo/page.codeberg.ilijaculap.snux.metainfo.xml
    - rm /app/snux/*.png
    - echo "cd /app/snux && python3 Snux.py" > /app/bin/run-snux
    - chmod +x /app/bin/run-snux
  sources:
    - type: git
      url: https://codeberg.org/ilijaculap/snux
      commit: 4566084e59
