app-id: io.github.whelanh.scidCommunity
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: scidCommunity

finish-args:
  - --filesystem=xdg-documents  # access Documents folder for chess databases
  - --persist=.scidCommunity    # persistent app data
  - --share=network             # access the network
  - --socket=x11             # show windows with x11
  - --share=ipc              # share IPC namespace with the host (necessary for X11)
  - --device=dri             # OpenGL rendering
  - --socket=pulseaudio      # play sound with PulseAudio

modules:
  - name: stockfish # Stockfish engine, put into /app/engines/stockfish/
    buildsystem: simple
    build-options:
      arch:
        x86_64:
          env:
            ARCH: x86-64
        aarch64:
          env:
            ARCH: armv8
    build-commands:
      - cp nn-5af11540bbfe.nnue ./src
      - cd src; make -j build
      - mkdir -p /app/engines/stockfish
      - cp ./src/stockfish /app/engines/stockfish/
      - cp ./nn-5af11540bbfe.nnue /app/engines/stockfish/
    sources:
      - type: archive
        url: https://github.com/official-stockfish/Stockfish/releases/download/sf_16/stockfish-ubuntu-x86-64-modern.tar
        sha256: dc94bdfbc0097a7606d3ed13b855cb03ee99184301b6fc8f8d85c68c4726bf8a
      - type: file
        url: https://tests.stockfishchess.org/api/nn/nn-5af11540bbfe.nnue
        sha256: 5af11540bbfefcb54e38c5dd000cab4b469dfa7599a1d55be5d2722c20a8929b

  - name: tcl # latest stable tcl, required for scid
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/tcl/tcl-core8.6.15-src.tar.gz
        sha256: 844775491e435e34d83d6ccfbadd1342f1855f1705253233a86152df0765e78d
    subdir: "unix"
    post-install:
      - chmod 755 /app/lib/libtcl*.so

  - name: tk # latest stable tk, required for scid
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/tcl/tk8.6.15-src.tar.gz
        sha256: 550969f35379f952b3020f3ab7b9dd5bfd11c1ef7c9b7c6a75f5c49aca793fec
    subdir: "unix"
    post-install:
      - chmod 755 /app/lib/libtk*.so

  - name: scid # main app
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/whelanh/scidCommunity.git
        commit: 1794c9d33be9cbf709c4327d81700a844e9a7afd
