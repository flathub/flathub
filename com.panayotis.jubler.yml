app-id: com.panayotis.jubler
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk17
command: jubler

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
  - --filesystem=home
  - --share=network

modules:
  - name: openjdk
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk17/install.sh

  - name: jubler
    buildsystem: simple
    build-commands:
      - install -d /app/bin /app/lib /app/lib/lib
      - cp -r lib/* /app/lib/
      - install -Dm755 libffdecode_64.so /app/lib/lib/libffdecode_64.so
      - |
        cat > /app/bin/jubler << 'EOF'
        #!/bin/sh
        exec /app/jre/bin/java -jar /app/lib/jubler.jar "$@"
        EOF
      - chmod +x /app/bin/jubler
      - install -Dm644 com.panayotis.jubler.desktop /app/share/applications/com.panayotis.jubler.desktop
      - install -Dm644 com.panayotis.jubler.metainfo.xml /app/share/metainfo/com.panayotis.jubler.metainfo.xml
      - install -Dm644 logo.svg /app/share/icons/hicolor/scalable/apps/com.panayotis.jubler.svg
    sources:
      - type: archive
        url: https://github.com/teras/Jubler/releases/download/v9.0.1/Jubler-9.0.1-generic.tar.gz
        sha256: d4e85793b8439b3bbd71d061433a239bfeae1d8645c8674deb41821630714330

      - type: file
        path: com.panayotis.jubler.desktop

      - type: file
        path: com.panayotis.jubler.metainfo.xml

      - type: file
        path: ../logo/logo.svg

      - type: file
        path: ../installer/extra/linux64/lib/libffdecode_64.so
