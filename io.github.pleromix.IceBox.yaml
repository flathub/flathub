app-id: io.github.pleromix.IceBox
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: run.sh
only-arches:
  - x86_64
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk21
finish-args:
  - --share=ipc
  - --filesystem=home
  - --device=dri
  - --socket=x11
  - --env=PATH=/app/jre/bin:/app/bin:/usr/bin
modules:
  - name: icebox
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk21/install.sh
      - install -d /app/openjfx
      - cp -r openjfx/lib/* /app/openjfx/
      - install -Dm644 icebox.jar /app/icebox.jar
      - install -Dm755 run.sh /app/bin/run.sh
      - install -Dm644 source/io.github.pleromix.IceBox.metainfo.xml /app/share/metainfo/io.github.pleromix.IceBox.metainfo.xml
      - install -Dm644 source/io.github.pleromix.IceBox.desktop /app/share/applications/io.github.pleromix.IceBox.desktop
      - install -Dm644 source/io.github.pleromix.IceBox.svg /app/share/icons/hicolor/scalable/apps/io.github.pleromix.IceBox.svg
    cleanup:
      - '/openjfx/javafx.web.jar'
      - '/openjfx/libjfxwebkit.so'
      - '/openjfx/javafx.swing.jar'
      - '/openjfx/javafx-swt.jar'
      - '/openjfx/javafx.media.jar'
      - '/openjfx/libjfxmedia.so'
      - '/openjfx/libgstreamer-lite.so'
      - '/openjfx/libfxplugins.so'
      - '/openjfx/libavplugin-*.so'
    sources:
      - type: git
        url: https://github.com/pleromix/IceBox
        tag: v1.0.0
        dest: 'source'
      - type: file
        url: https://github.com/pleromix/IceBox/releases/download/v1.0.0/icebox.jar
        sha256: 797eb7dab892dad090a39e336075f9548ad0eab9dc9bd695700b6e62b850b233
      - type: archive
        url: https://download2.gluonhq.com/openjfx/21.0.7/openjfx-21.0.7_linux-x64_bin-sdk.zip
        sha256: 18226c0cbaf4d83fc907273948cd3fe44478e5931d4e4d8f11df46e9f8aeda3d
        dest: 'openjfx'
        strip-components: 1
        only-arches:
          - x86_64
      - type: file
        path: run.sh
