app-id: org.RimSort.RimSort
runtime: org.kde.Platform
runtime-version: "6.7"
sdk: org.kde.Sdk
base: io.qt.PySide.BaseApp
base-version: "6.7"
cleanup-commands:
  - /app/cleanup-BaseApp.sh
command: RimSort
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio

  # XDG commons folders
  - --filesystem=xdg-download
  - --filesystem=xdg-pictures
  - --filesystem=xdg-videos

  # external disk mount
  - --filesystem=/media
  - --filesystem=/run/media
  - --filesystem=/mnt

  # file chooser
  - --talk-name=org.freedesktop.portal.FileChooser

  # steamworks values
  - --env=PYTHONPATH=/app/bin/libs

modules:
  # generate from requirements.txt with python3 flatpak-pip-generator --requirements-file=requirements.txt --output pypi-dependencies
  #
  # maturin
  - maturin.json
  # Python crypto
  - python3-requirements-binaries.json
  # Python dependencies from requirement.txts
  - pypi-dependencies.json

  - steamfiles.json

  - psutil.json

  - name: RimSort
    buildsystem: simple
    build-commands:
      - ./distribute.py --build-steamworkspy --skip-submodules --skip-build --skip-pip --skip-todds
      - mkdir -p /app/bin
      - cp -R app /app/bin/
      - cp -R libs /app/bin/
      - install -D app/__main__.py /app/bin/RimSort
      # - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} . --no-build-isolation
    sources:
      - type: git
        url: https://github.com/RimSort/RimSort.git
        tag: v1.0.10
      - type: patch
        path: run.patch
      - type: patch
        path: distribute.patch
      - type: patch
        path: SteamworksPy.cpp.patch
      - type: file
        url: https://github.com/oceancabbage/RimSort/raw/steamworks-sdk/steamworks_sdk_155.zip
        sha256: 3d5ab5d2b5538fdbe49fd81abf3b6bc6c18b91bcc6a0fecd4122f22b243ee704
# todo add TODS

# https://github.com/todds-encoder/todds/releases/download/0.4.1/todds_Linux_x86_64_0.4.1.zip
# flatpak run org.RimSort.RimSort ---command=bas
#
# flatpak run --command=sh --devel org.RimSort.RimSort
# /app/bin/RimSort
#
# Traceback (most recent call last):
#   File "/app/bin/RimSort", line 37, in <module>
#     from app.controllers.app_controller import AppController
#   File "/app/bin/app/controllers/app_controller.py", line 7, in <module>
#     from app.controllers.main_window_controller import MainWindowController
#   File "/app/bin/app/controllers/main_window_controller.py", line 6, in <module>
#     from app.utils.metadata import MetadataManager
#   File "/app/bin/app/utils/metadata.py", line 30, in <module>
#     from app.utils.steam.steamcmd.wrapper import SteamcmdInterface
#   File "/app/bin/app/utils/steam/steamcmd/wrapper.py", line 23, in <module>
#     from app.windows.runner_panel import RunnerPanel
#   File "/app/bin/app/windows/runner_panel.py", line 20, in <module>
#     from app.utils.steam.webapi.wrapper import (
#   File "/app/bin/app/utils/steam/webapi/wrapper.py", line 18, in <module>
#     from app.utils.steam.steamworks.wrapper import SteamworksAppDependenciesQuery
#   File "/app/bin/app/utils/steam/steamworks/wrapper.py", line 17, in <module>
#     from steamworks import STEAMWORKS  # type: ignore
#     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
# ModuleNotFoundError: No module named 'steamworks'

# # If we're running from a Python interpreter, makesure steamworks module is in our sys.path ($PYTHONPATH)
# # Ensure that this is available by running `git submodule update --init --recursive`
# # You can automatically ensure this is done by utilizing distribute.py
# if "__compiled__" not in globals():
#     sys.path.append(str((Path(getcwd()) / "submodules" / "SteamworksPy")))

# >>> sys.path
# ['', '/usr/lib/python311.zip', '/usr/lib/python3.11', '/usr/lib/python3.11/lib-dynload', '/app/lib/python3.11/site-packages', '/usr/lib/python3.11/site-packages']
# /app/lib/python3.11/site-packages
#
# /app/bin/libs
# cp /app/bin/libs/* /app/lib/python3.11/site-packages/

# import sys;
# sys.path

#Â /usr/lib/extensions/vulkan/gamescope/lib/python3.11/site-packages:/usr/lib/python3.11/site-packages
