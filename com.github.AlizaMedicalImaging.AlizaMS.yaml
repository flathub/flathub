app-id: com.github.AlizaMedicalImaging.AlizaMS
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '5.15-21.08'
command: alizams
rename-desktop-file: alizams.desktop
rename-appdata-file: alizams.metainfo.xml
rename-icon: alizams
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --filesystem=home
cleanup:
  - /include
  - /lib/cmake
  - '*.la'
  - '*.a'
  - '/share/man'
  - '/share/doc'
  - '/share/ITK-5.2'

modules:

  - name: ITK
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE:STRING=Release
      - -DBUILD_TESTING:BOOL=OFF
      - -DITK_BUILD_DEFAULT_MODULES:BOOL=OFF
      - -DITKGroup_Core:BOOL=ON
      - -DITKGroup_Filtering:BOOL=ON
      - -DITKGroup_Segmentation:BOOL=ON
      - -DITKGroup_Nonunit:BOOL=ON
      - -DBUILD_EXAMPLES:BOOL=OFF
      - -DITK_USE_SYSTEM_ZLIB:BOOL=ON
      - -DITK_FORBID_DOWNLOADS=ON
    sources:
      - type: archive
        url: https://github.com/InsightSoftwareConsortium/ITK/archive/refs/tags/v5.2.1.tar.gz
        sha256: 6022b2b64624b8bcec3333fe48d5f74ff6ebceb3bdf98258ba7d7fbbc76b99ab
        x-checker-data:
          type: anitya
          project-id: 223473
          stable-only: true
          url-template: https://github.com/InsightSoftwareConsortium/ITK/archive/refs/tags/v$version.tar.gz

  - name: alizams
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE:STRING=RelWithDebInfo
      - -DALIZA_QT_VERSION:STRING=5
      - -DMDCM_USE_SYSTEM_ZLIB:BOOL=ON
    post-install:
      - desktop-file-edit --set-icon $FLATPAK_ID --set-key Exec --set-value
        'alizams' /app/share/applications/alizams.desktop
      - install -Dm644 alizams.metainfo.xml /app/share/metainfo/alizams.metainfo.xml
      - appstream-util modify /app/share/metainfo/alizams.metainfo.xml 
        id com.github.AlizaMedicalImaging.AlizaMS
    sources:
      - type: archive
        url: https://github.com/AlizaMedicalImaging/AlizaMS/archive/v1.7.3/AlizaMS-1.7.3.tar.gz
        sha256: 5070ddf6e93d5bfb025c24df2e2bfe13fb964ce4db5738ca7abf34a8fe05d387
      # Let's wait the next release to include the appdata file
      - type: file
        url: https://raw.githubusercontent.com/AlizaMedicalImaging/AlizaMS/master/package/archive/usr/share/metainfo/alizams.metainfo.xml
        sha256: 15c80721de203f1a57ab8571fb01869a32b5e515eb140ea9e16a09ce98c633a3

