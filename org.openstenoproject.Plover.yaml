app-id: org.openstenoproject.Plover
runtime: org.kde.Platform
runtime-version: "6.9"
sdk: org.kde.Sdk
base: io.qt.PySide.BaseApp
base-version: "6.9"
command: plover
finish-args:
  - --share=network
  - --share=ipc
  - --socket=wayland
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
  - --device=all
modules:
  # This file was generated with (from reqs/dist.txt):
  # ../flatpak-builder-tools/pip/flatpak-pip-generator appdirs pkginfo plover-stroke Pygments pyserial python-xlib evdev packaging psutil readme-renderer[md] requests-cache requests-futures rtf_tokenize setuptools wcwidth Babel --yaml --checker-data
  - modules/python3-modules.yaml
  # plover needs pygments & pip, but pygments is already installed in SDK but not in a runtime, so just copying to /app
  - modules/python3-pygments.yaml
  - modules/python3-pip.yaml
  - name: plover
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation --prefix=/app .

      - install -Dm 644 linux/plover.desktop --target-directory ${FLATPAK_DEST}/share/applications
      - install -Dm 644 plover/assets/plover.png --target-directory ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps
      - install -Dm 644 ${FLATPAK_ID}.metainfo.xml --target-directory ${FLATPAK_DEST}/share/metainfo

      # Rename instances of `plover` to `${FLATPAK_ID}`
      - rename plover ${FLATPAK_ID} ${FLATPAK_DEST}/share/{applications/*,icons/hicolor/*/apps/*}
      # Modify original `.desktop` file to use the correct icon name
      - desktop-file-edit --set-icon="${FLATPAK_ID}" ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
    sources:
      - type: archive
        url: https://github.com/openstenoproject/plover/archive/refs/tags/v5.0.0.dev3.tar.gz
        sha256: d0e9ba0214a66dcac54c4f2666ba72fe25151f77fd3277c7ad72ba9fe8064b31
        x-checker-data:
          type: anitya
          project-id: 194337
          url-template: https://github.com/openstenoproject/plover/archive/refs/tags/v$version.tar.gz
          is-main-source: true
          # should be changed when v5 is stable
          stable-only: false
      - type: file
        path: org.openstenoproject.Plover.metainfo.xml
cleanup-commands:
  - /app/cleanup-BaseApp.sh
