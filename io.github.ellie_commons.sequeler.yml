id: io.github.ellie_commons.sequeler
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
base: io.elementary.BaseApp
base-version: circe-25.08
command: io.github.ellie_commons.sequeler
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --talk-name=org.freedesktop.secrets
  - --share=network
cleanup:
  - /include
  - /lib/pkgconfig
  - /share/vala
  - /man
  - '*.a'
  - '*.la'
build-options:
  libdir: /app/lib
modules:
  - name: gtksourceview
    buildsystem: meson
    build-options:
      config-opts:
        - -Dgtk_doc=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gtksourceview/4.8/gtksourceview-4.8.4.tar.xz
        sha256: 7ec9d18fb283d1f84a3a3eff3b7a72b09a10c9c006597b3fbabbb5958420a87d
        x-checker-data:
          type: gnome
          name: gtksourceview
          versions:
            <: '4.99'

  - name: libgda
    build-options:
      config-opts:
        - --with-java=no
        - --with-jni=no
        - --with-oracle=no
        - --disable-gdaui-gi
      cflags: -Wno-error=incompatible-pointer-types -Wno-error=implicit-function-declaration
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libgda/5.2/libgda-5.2.9.tar.xz
        sha256: 59caed8ca72b1ac6437c9844f0677f8a296d52cfd1c0049116026abfb1d87d9b
        x-checker-data:
          type: gnome
          name: libgda
          versions:
            <: 5.2.10
      - type: patch
        path: 0001-Explicit-parameters-in-function-declaration.patch

    modules:
      - name: postgresql-libs
        build-options:
          config-opts:
            - --with-python=no
            - --with-perl=no
            - --with-libxml
            - --with-openssl
        sources:
          - type: archive
            url: https://ftp.postgresql.org/pub/source/v18.1/postgresql-18.1.tar.gz
            sha256: b0f18c2d6973d2aa023cfc77feda787d7bbe9c31a3977d0f04ac29885fb98ec4
            x-checker-data:
              type: anitya
              project-id: 381406
              url-template: https://ftp.postgresql.org/pub/source/v$version/postgresql-$version.tar.gz

      - name: jemalloc
        cleanup:
          - /bin/
          - /share
        sources:
          - type: archive
            url: https://github.com/jemalloc/jemalloc/archive/5.3.0.tar.gz
            sha256: ef6f74fd45e95ee4ef7f9e19ebe5b075ca6b7fbe0140612b2a161abafb7ee179
            x-checker-data:
              type: json
              url: https://api.github.com/repos/jemalloc/jemalloc/releases/latest
              version-query: .tag_name
              url-query: '"https://github.com/jemalloc/jemalloc/archive/" + .tag_name + ".tar.gz"'
              timestamp-query: .published_at

      - name: libaio
        buildsystem: simple
        build-commands:
          - make
          - make prefix=/app install
        sources:
          - type: archive
            url: https://pagure.io/libaio/archive/libaio-0.3.113/libaio-libaio-0.3.113.tar.gz
            sha256: 716c7059703247344eb066b54ecbc3ca2134f0103307192e6c2b7dab5f9528ab
            x-checker-data:
              type: anitya
              project-id: 1557
              url-template: https://pagure.io/libaio/archive/libaio-$version/libaio-libaio-$version.tar.gz

      - name: libfmt
        buildsystem: cmake-ninja
        sources:
          - type: git
            url: https://github.com/fmtlib/fmt.git
            tag: 12.1.0
            commit: 407c905e45ad75fc29bf0f9bb7c5c2fd3475976f
            x-checker-data:
              type: git
              tag-pattern: ^([\d.]+)$

      - name: mariadb
        buildsystem: cmake-ninja
        config-opts:
          - -DCMAKE_BUILD_TYPE=Release
          - -DBUILD_CONFIG=mysql_release
          - -DWITH_INNOBASE_STORAGE_ENGINE=1
          - -DWITH_PCRE=system
          - -DWITH_LIBFMT=system
          - -DWITH_SBOM=0
          - -DWITHOUT_ARCHIVE_STORAGE_ENGINE=1
          - -DWITHOUT_BLACKHOLE_STORAGE_ENGINE=1
          - -DWITHOUT_PARTITION_STORAGE_ENGINE=1
          - -DWITHOUT_TOKUDB=1
          - -DWITHOUT_EXAMPLE_STORAGE_ENGINE=1
          - -DWITHOUT_FEDERATED_STORAGE_ENGINE=1
          - -DWITHOUT_PBXT_STORAGE_ENGINE=1
          - -DWITHOUT_SERVER=ON
          - -DPLUGIN_AUTH_PAM=NO
        cleanup:
          - /bin/
        sources:
          - type: git
            url: https://github.com/MariaDB/server.git
            tag: mariadb-12.2.1
            commit: 144dead8826f4a84008a76ef7fcc44e816f92930
            x-checker-data:
              type: git
              tag-pattern: ^mariadb-([\d.]+)$

      - shared-modules/intltool/intltool-0.51.json

  - name: libssh2
    sources:
      - type: archive
        url: https://www.libssh2.org/download/libssh2-1.11.1.tar.gz
        sha256: d9ec76cbe34db98eec3539fe2c899d26b0c837cb3eb466a56b0f109cabf658f7
        x-checker-data:
          type: anitya
          project-id: 1730
          url-template: https://www.libssh2.org/download/libssh2-$version.tar.gz

  - name: libfiposix
    sources:
      - type: archive
        url: https://github.com/sionescu/libfixposix/archive/v0.5.1.tar.gz
        sha256: 5d9d3d321d4c7302040389c43f966a70d180abb58d1d7df370f39e0d402d50d4
        x-checker-data:
          type: json
          url: https://api.github.com/repos/sionescu/libfixposix/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: '"https://github.com/sionescu/libfixposix/archive/" + .tag_name + ".tar.gz"'
          timestamp-query: .published_at
      - type: script
        dest-filename: autogen.sh
        commands:
          - autoreconf -vfi

  - name: sequeler
    buildsystem: meson
    build-options:
      config-opts:
        - -Dsized-app-icon=false
    sources:
      - type: archive
        url: https://github.com/ellie-commons/sequeler/archive/v0.9.0-1.tar.gz
        sha256: 600b86f5c34c8301c9499f51c45495d321dc2e64d77e10e9333582d942896251
