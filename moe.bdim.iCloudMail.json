{
  "app-id": "moe.bdim.iCloudMail",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "24.08",
  "sdk": "org.freedesktop.Sdk",
  "sdk-extensions": [
    "org.freedesktop.Sdk.Extension.node20"
  ],
  "base": "org.electronjs.Electron2.BaseApp",
  "base-version": "24.08",
  "command": "icloud-mail",
  "separate-locales": false,
  "finish-args": [
    "--socket=fallback-x11",
    "--socket=wayland",
    "--socket=pulseaudio",
    "--share=ipc",
    "--share=network",
    "--device=dri",
    "--talk-name=org.freedesktop.Notifications",
    "--talk-name=org.kde.StatusNotifierWatcher",
    "--own-name=org.mpris.MediaPlayer2.chromium.*",
    "--filesystem=xdg-download"
  ],
  "modules": [
    {
      "name": "icloud-mail",
      "buildsystem": "simple",
      "build-options": {
        "append-path": "/usr/lib/sdk/node20/bin",
        "env": {
          "NPM_CONFIG_LOGLEVEL": "info",
          "npm_config_cache": "flatpak-node/npm-cache",
          "npm_config_offline": "true",
          "ELECTRON_SKIP_BINARY_DOWNLOAD": "1"
        }
      },
      "build-commands": [
        "npm ci --offline --legacy-peer-deps --ignore-scripts",
        "unzip -q flatpak-node/cache/electron/electron-v30.0.1-linux-$(uname -m | sed 's/x86_64/x64/;s/aarch64/arm64/').zip -d node_modules/electron/dist",
        "chmod +x node_modules/electron/dist/electron",
        "install -d /app/icloud-mail",
        "cp -ra . /app/icloud-mail/",
        "install -Dm644 icon.png /app/share/icons/hicolor/256x256/apps/moe.bdim.iCloudMail.png",
        "install -Dm644 moe.bdim.iCloudMail.desktop /app/share/applications/moe.bdim.iCloudMail.desktop",
        "install -Dm644 moe.bdim.iCloudMail.metainfo.xml /app/share/metainfo/moe.bdim.iCloudMail.metainfo.xml",
        "install -Dm755 icloud-mail.sh /app/bin/icloud-mail"
      ],
      "sources": [
        {
          "type": "file",
          "path": "package.json"
        },
        {
          "type": "file",
          "path": "package-lock.json"
        },
        "generated-sources.json",
        {
          "type": "file",
          "path": "main.js"
        },
        {
          "type": "file",
          "path": "preload.js"
        },
        {
          "type": "file",
          "path": "icon.png"
        },
        {
          "type": "file",
          "path": "moe.bdim.iCloudMail.desktop"
        },
        {
          "type": "file",
          "path": "moe.bdim.iCloudMail.metainfo.xml"
        },
        {
          "type": "script",
          "dest-filename": "icloud-mail.sh",
          "commands": [
            "export TMPDIR=\"$XDG_RUNTIME_DIR/app/$FLATPAK_ID\"",
            "exec zypak-wrapper.sh /app/icloud-mail/node_modules/electron/dist/electron /app/icloud-mail/main.js \"$@\""
          ]
        }
      ]
    }
  ]
}
