app-id: ro.go.hmlendea.SokoGrump
runtime: org.freedesktop.Platform
runtime-version: '21.08'
separate-locales: false
command: sokogrump

finish-args:
  - --share=ipc
  - --device=dri
  - --socket=x11

modules:
  - name: sokogrump
    buildsystem: simple
    build-commands:
      - unzip -d "sokogrump" "sokogrump.zip"
      - cp -r "sokogrump" /app
      - install -Dm 644 "icon.png" "${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png"
      - install -Dm 644 "sokogrump/${FLATPAK_ID}.desktop" "${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop"
      - install -Dm 644 "${FLATPAK_ID}.metainfo.xml" "${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml"
      - install -Dm 755 "sokogrump.sh" "/app/bin/sokogrump"
      - desktop-file-edit "${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop" --set-key "Exec" --set-value "sokogrump" --set-key "Icon" --set-value "${FLATPAK_ID}"
    sources:
      - type: file
        only-arches: [ arm ]
        url: https://github.com/hmlendea/sokogrump/releases/download/v2.2.0/sokogrump_2.2.0_linux-arm.zip
        dest-filename: sokogrump.zip
        sha256: ff01a984c693ca9cd118d66d79847d851b05491f91c4e910004ae646667b1949
        x-checker-data:
          type: json
          url: https://api.github.com/repos/hmlendea/sokogrump/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: .assets[] | select(.name=="sokogrump_" + $version +
            "_linux-arm.zip") | .browser_download_url
      - type: file
        only-arches: [ aarch64 ]
        url: https://github.com/hmlendea/sokogrump/releases/download/v2.2.0/sokogrump_2.2.0_linux-arm64.zip
        dest-filename: sokogrump.zip
        sha256: d0855faabd998094043752a3ea782eb85a9c20c2d10f8af153a7aa95f0ea8db1
        x-checker-data:
          type: json
          url: https://api.github.com/repos/hmlendea/sokogrump/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: .assets[] | select(.name=="sokogrump_" + $version +
            "_linux-arm64.zip") | .browser_download_url
      - type: file
        only-arches: [ x86_64 ]
        url: https://github.com/hmlendea/sokogrump/releases/download/v2.2.0/sokogrump_2.2.0_linux-x64.zip
        dest-filename: sokogrump.zip
        sha256: cc3f18fec807d6926db81aeef84350f8f440e0738f2c2251552b3c9e90763c4b
        x-checker-data:
          type: json
          url: https://api.github.com/repos/hmlendea/sokogrump/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: .assets[] | select(.name=="sokogrump_" + $version +
            "_linux-x64.zip") | .browser_download_url
      - type: file
        path: ro.go.hmlendea.SokoGrump.metainfo.xml
      - type: file
        url: https://raw.githubusercontent.com/hmlendea/sokogrump/80abe82e7a30dffe8f8dca8ee6357325f4ee24bf/icon.png
        dest-filename: icon.png
        sha256: 35137309694e9cc07407f50cbffc958293be3802ed417671a7a70e9d69e7ab33
      - type: script
        dest-filename: sokogrump.sh
        commands:
          - export TMPDIR="${XDG_RUNTIME_DIR}/app/${FLATPAK_ID}"
          - exec /app/sokogrump/SokoGrump "$@"
