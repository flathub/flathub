app-id: org.openair.podcast
runtime: org.gnome.Platform
runtime-version: "46"
sdk: org.gnome.Sdk
command: OpenAir
separate-locales: false

finish-args:
  - --share=ipc

  - --device=dri

  - --socket=wayland
  - --socket=fallback-x11

  - --socket=pulseaudio
  - --share=network
  - --filesystem=host
  - --filesystem=xdg-download
  - --talk-name=org.freedesktop.Notifications

  - --system-talk-name=org.freedesktop.NetworkManager
  - --socket=system-bus

build-options:
  env:
    LIBGL_ALWAYS_SOFTWARE: "1"

modules:
  - name: openair
    buildsystem: simple
    only-arches:
      - x86_64
    build-commands:
      - cp -R openair/bin/ /app/openair
      - chmod +x /app/openair/OpenAir
      - mkdir /app/bin/
      - mkdir /app/lib/
      - ln -s /app/openair/OpenAir /app/bin/OpenAir
      - ln -s /app/lib/x86_64-linux-gnu/libsqlite3.so.0 /app/lib/libsqlite3.so

      - install -Dm644 openair/icons/icon.png /app/icons/icon.png

      - install -Dm644 openair/org.openair.podcast.xml /app/share/appdata/org.openair.podcast.appdata.xml
      - install -Dm644 openair/icons/24x24/org.openair.podcast.png /app/share/icons/hicolor/24x24/apps/org.openair.podcast.png
      - install -Dm644 openair/icons/32x32/org.openair.podcast.png /app/share/icons/hicolor/32x32/apps/org.openair.podcast.png
      - install -Dm644 openair/icons/48x48/org.openair.podcast.png /app/share/icons/hicolor/48x48/apps/org.openair.podcast.png
      - install -Dm644 openair/icons/64x64/org.openair.podcast.png /app/share/icons/hicolor/64x64/apps/org.openair.podcast.png
      - install -Dm644 openair/icons/128x128/org.openair.podcast.png /app/share/icons/hicolor/128x128/apps/org.openair.podcast.png
      - install -Dm644 openair/icons/256x256/org.openair.podcast.png /app/share/icons/hicolor/256x256/apps/org.openair.podcast.png
      - install -Dm644 openair/icons/512x512/org.openair.podcast.png /app/share/icons/hicolor/512x512/apps/org.openair.podcast.png
      - install -Dm644 openair/org.openair.podcast.desktop /app/share/applications/org.openair.podcast.desktop
    sources:
      - type: archive
        # path: openair-binary-v0-10-0.tar.gz
        url: https://github.com/OpenAir-Podcast/OpenAir/releases/download/v0.10.0/openair-binary-v0-10-0.tar.gz
        sha256: 6c2db013612d70b1a13f205ba6e837a56f26949fecc59e9ed51d1066ae4a4216
        dest: "openair"
