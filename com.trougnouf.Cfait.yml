# NOTE: The 'tag' and 'commit' fields below are automatically updated by scripts/prepare_release.py
app-id: com.trougnouf.Cfait
runtime: org.freedesktop.Platform
runtime-version: "25.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: cfait-gui
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --device=dri

modules:
  - name: cfait
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/rust-stable/bin
      env:
        CARGO_HOME: /run/build/cfait/cargo
    build-commands:
      # Build the TUI binary
      - cargo --offline build --release --verbose --features tui
      # Build the GUI binary
      - cargo --offline build --release --verbose --features gui --bin gui
      # Install binaries to /app/bin
      - install -Dm755 target/release/cfait -t /app/bin/
      - install -Dm755 target/release/gui /app/bin/cfait-gui
      # Install desktop file and icons (fix Icon name to match app-id)
      - desktop-file-edit --set-icon=com.trougnouf.Cfait assets/cfait.desktop
      - install -Dm644 assets/cfait.desktop /app/share/applications/com.trougnouf.Cfait.desktop
      - install -Dm644 assets/cfait.svg /app/share/icons/hicolor/scalable/apps/com.trougnouf.Cfait.svg
      - install -Dm644 assets/com.trougnouf.Cfait.metainfo.xml /app/share/metainfo/com.trougnouf.Cfait.metainfo.xml

    sources:
      # Application source
      - type: git
        url: https://codeberg.org/trougnouf/cfait
        commit: 01bd097043716548da9071e38794036bb8860b88
        x-checker-data:
          type: git
          url: https://codeberg.org/trougnouf/cfait
          tag-pattern: ^v([\d.]+)$
      # Cargo dependencies
      - cargo-sources.yml
