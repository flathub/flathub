#!/usr/bin/env bash
set -euo pipefail

EXTRA="/app/extra"
TARBALL="$EXTRA/AlderonGamesLauncher.tar.xz"

# Ensure the tarball exists
[ -f "$TARBALL" ] || { echo "Missing $TARBALL"; exit 1; }

# Extract into /app/extra
tar -xJf "$TARBALL" -C "$EXTRA"

# Find the unpacked directory
APPDIR="$(find "$EXTRA" -maxdepth 1 -mindepth 1 -type d -iname '*alderonlauncher*' -print -quit)"
if [ -z "$APPDIR" ]; then
  APPDIR="$EXTRA"
fi

# Stable pointer used by run.sh
rm -f "$EXTRA/current"
ln -s "$APPDIR" "$EXTRA/current"

# Make top-level files executable
chmod +x "$APPDIR"/* 2>/dev/null || true

rm -f "$TARBALL"