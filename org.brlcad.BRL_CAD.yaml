app-id: org.brlcad.BRL_CAD
runtime: org.kde.Sdk
runtime-version: 5.15-22.08
sdk: org.kde.Sdk
command: mged
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
cleanup:
  - /share/doc
  - '*.la'
  - '*.a'

modules:
  - name: BRL-CAD
    buildsystem: cmake
    builddir: true
    build-options:
      cflags: -Wno-error=stringop-overflow -Wno-error=format-truncation -Wno-error=inline
        -Wno-error=format-overflow -Wno-error=dangling-pointer -Wno-error=array-bounds -Wno-error=nonnull -Wno-error=maybe-uninitialized
      cxxflags: -Wno-error=stringop-overflow -Wno-error=format-truncation -Wno-error=inline
        -Wno-error=format-overflow -Wno-error=dangling-pointer -Wno-error=array-bounds -Wno-error=nonnull -Wno-error=maybe-uninitialized
    config-opts:
      - -DBRLCAD_BUNDLED_LIBS=ON
      - -DBUILD_STATIC_LIBS:BOOL=OFF
      - -DBRLCAD_EXTRADOCS:BOOL=OFF
      - -DBRLCAD_ENABLE_OSG:BOOL=ON
      - -DBUILD_TESTING:BOOL=OFF
    sources:
      - type: git
        url: https://github.com/BRL-CAD/brlcad.git
        commit: dc7c0b221cd74c13a3a4a6c74c679bf91cc8da42
        tag: rel-7-34-2
        x-checker-data:
          type: git
          tag-pattern: ^rel-([\d-]+)$

    # The files disappear from source folders after install, so I cannot use post-install
  - name: BRL-CAD-metainfo-desktopfile
    buildsystem: simple
    build-commands:
      - install -Dm644 mged.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.mged.desktop
      - install -Dm644 rtwizard.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.rtwizard.desktop
      - install -Dm644 brlcad-db.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.brlcad-db.desktop
      - install -Dm644 archer.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.Archer.desktop
      - install -Dm644 ${FLATPAK_ID}.metainfo.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml
      - install -Dm0644 mged.png /app/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.mged.png
      - install -Dm0644 rtwizard.png /app/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.rtwizard.png
      - install -Dm0644 brlcad-db.png /app/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.brlcad-db.png
      - install -Dm0644 archer.png /app/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.archer.png
    sources:
      - type: file
        path: mged.desktop
      - type: file
        path: rtwizard.desktop
      - type: file
        path: brlcad-db.desktop
      - type: file
        path: archer.desktop
      - type: file
        path: org.brlcad.BRL_CAD.metainfo.xml
      - type: file
        path: mged.png
      - type: file
        path: rtwizard.png
      - type: file
        path: brlcad-db.png
      - type: file
        path: archer.png
