app-id: com.neogamelab.neostation
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: neostation

finish-args:
  - --share=network
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=dri
  - --device=all
  - --filesystem=home
  - --filesystem=xdg-data/ROMs:ro
  - --filesystem=xdg-config/retroarch:rw
  - --filesystem=~/.var/app/org.libretro.RetroArch/config/retroarch:rw
  - --filesystem=xdg-data/eden:rw
  - --filesystem=xdg-config/eden:rw
  - --filesystem=xdg-data/citron:rw
  - --filesystem=xdg-config/citron:rw
  - --filesystem=xdg-data/Ryujinx:rw
  - --filesystem=xdg-config/Ryujinx:rw
  - --persist=.local/share/neostation
  - --talk-name=org.freedesktop.secrets
  - --talk-name=org.freedesktop.portal.OpenURI

modules:
  # libsecret for flutter_secure_storage
  - name: libsecret
    buildsystem: meson
    config-opts:
      - -Dmanpage=false
      - -Dvapi=false
      - -Dgtk_doc=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libsecret/0.21/libsecret-0.21.4.tar.xz
        sha256: 163d08d783be6d4ab9a979ceb5a4fecbc1d9660d3c34168c581301cd53912b20

  # SQLite3
  - name: sqlite
    buildsystem: autotools
    sources:
      - type: archive
        url: https://www.sqlite.org/2023/sqlite-autoconf-3420000.tar.gz
        sha256: 7abcfd161c6e2742ca5c6c0895d1f853c940f203304a0b49da4e1eca5d088ca6

  # MPV dependencies
  - name: nv-codec-headers
    cleanup:
      - '*'
    no-autogen: true
    make-install-args:
      - PREFIX=/app
    sources:
      - type: git
        url: https://github.com/FFmpeg/nv-codec-headers.git
        tag: n12.1.14.0

  - name: libdav1d
    buildsystem: meson
    sources:
      - type: archive
        url: https://code.videolan.org/videolan/dav1d/-/archive/1.3.0/dav1d-1.3.0.tar.gz
        sha256: 27b7f327ee0be152b0f5b520e95c8d027a9e4f0dbb25c61d7c718592c8523e2d

  - name: ffmpeg
    config-opts:
      - --enable-shared
      - --disable-static
      - --enable-gnutls
      - --disable-doc
      - --disable-programs
      - --disable-encoders
      - --disable-muxers
      - --enable-encoder=png
      - --enable-libdav1d
      - --disable-vulkan
    sources:
      - type: archive
        url: https://ffmpeg.org/releases/ffmpeg-6.1.tar.xz
        sha256: 488c76e57dd9b3bee901f71d5c95eaf1db4a5a31fe46a28654e837144207c270

  - name: libass
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://github.com/libass/libass/releases/download/0.17.1/libass-0.17.1.tar.xz
        sha256: f0da0bbfba476c16ae3e1cfd862256d30915911f7abaa1b16ce62ee653192784

  - name: libplacebo
    buildsystem: meson
    config-opts:
      - -Dvulkan=disabled
      - -Dshaderc=disabled
      - -Dglslang=disabled
      - -Dd3d11=disabled
      - -Ddemos=false
    sources:
      - type: git
        url: https://github.com/haasn/libplacebo.git
        tag: v6.338.2
        commit: 64c1954570f1cd57f8570a57e51fb0249b57bb90

  - name: mpv
    buildsystem: meson
    config-opts:
      - -Dlibmpv=true
      - -Dlua=disabled
      - -Ddebug=false
      - -Dbuild-date=false
    sources:
      - type: archive
        url: https://github.com/mpv-player/mpv/archive/v0.37.0.tar.gz
        sha256: 1d2d4adbaf048a2fa6ee134575032c4b2dad9a7efafd5b3e69b88db935afaddf

  # NeoStation app (descarga binario pre-compilado)
  - name: neostation
    buildsystem: simple
    build-commands:
      # Extract and install the pre-built Flutter bundle
      - install -Dm755 neostation /app/bin/neostation
      - cp -r lib /app/bin/
      - cp -r data /app/bin/
      # Install icon
      - install -Dm644 com.neogamelab.neostation.png /app/share/icons/hicolor/256x256/apps/com.neogamelab.neostation.png
      # Install desktop file
      - install -Dm644 com.neogamelab.neostation.desktop /app/share/applications/com.neogamelab.neostation.desktop
      # Install metainfo
      - install -Dm644 com.neogamelab.neostation.metainfo.xml /app/share/metainfo/com.neogamelab.neostation.metainfo.xml
    sources:
      - type: archive
        url: https://github.com/NeoGameLab/neostation-release/releases/download/v0.0.17/neostation-linux-0.0.17.tar.gz
        sha256: cc5d6e6a95a1bebb3892404aae1f18cbec731b84d42f1630be3e3b5326d807a7
      
      # Desktop integration files
      - type: file
        path: com.neogamelab.neostation.png
      - type: file
        path: com.neogamelab.neostation.desktop
      - type: file
        path: com.neogamelab.neostation.metainfo.xml
