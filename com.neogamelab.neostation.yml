app-id: com.neogamelab.neostation
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: neostation

finish-args:
  - --share=network
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --device=dri
  - --device=all
  - --persist=.
  - --talk-name=org.freedesktop.secrets

modules:
  # MPV dependencies
  - name: libass
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://github.com/libass/libass/releases/download/0.17.1/libass-0.17.1.tar.xz
        sha256: f0da0bbfba476c16ae3e1cfd862256d30915911f7abaa1b16ce62ee653192784

  - name: libplacebo
    buildsystem: meson
    config-opts:
      - -Dvulkan=disabled
      - -Dshaderc=disabled
      - -Dglslang=disabled
      - -Dd3d11=disabled
      - -Ddemos=false
    sources:
      - type: git
        url: https://github.com/haasn/libplacebo.git
        tag: v6.338.2
        commit: 64c1954570f1cd57f8570a57e51fb0249b57bb90

  - name: mpv
    buildsystem: meson
    config-opts:
      - -Dlibmpv=true
      - -Dlua=disabled
      - -Ddebug=false
      - -Dbuild-date=false
    sources:
      - type: archive
        url: https://github.com/mpv-player/mpv/archive/v0.37.0.tar.gz
        sha256: 1d2d4adbaf048a2fa6ee134575032c4b2dad9a7efafd5b3e69b88db935afaddf

  # NeoStation app (descarga binario pre-compilado)
  - name: neostation
    buildsystem: simple
    build-commands:
      # Extract and install the pre-built Flutter bundle
      - install -Dm755 neostation /app/bin/neostation
      - cp -r lib /app/bin/
      - cp -r data /app/bin/
      # Install icon
      - install -Dm644 com.neogamelab.neostation.png /app/share/icons/hicolor/256x256/apps/com.neogamelab.neostation.png
      # Install desktop file
      - install -Dm644 com.neogamelab.neostation.desktop /app/share/applications/com.neogamelab.neostation.desktop
      # Install metainfo
      - install -Dm644 com.neogamelab.neostation.metainfo.xml /app/share/metainfo/com.neogamelab.neostation.metainfo.xml
    sources:
      - type: archive
        url: https://github.com/NeoGameLab/neostation-release/releases/download/v0.0.17/neostation-linux-0.0.17.tar.gz
        sha256: cc5d6e6a95a1bebb3892404aae1f18cbec731b84d42f1630be3e3b5326d807a7
        only-arches:
          - x86_64
      
      # Desktop integration files
      - type: file
        path: com.neogamelab.neostation.png
      - type: file
        path: com.neogamelab.neostation.desktop
      - type: file
        path: com.neogamelab.neostation.metainfo.xml
