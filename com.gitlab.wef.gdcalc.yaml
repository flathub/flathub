app-id: com.gitlab.wef.gdcalc
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: gdcalc
finish-args:
  - --device=dri
  - --persist=.local/share/dcalc
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=x11
cleanup:
  - /include
  - /lib/pkgconfig
modules:
  - name: gdcalc
    post-install:
      - install -Dm644 gdcalc.glade -t ${FLATPAK_DEST}/share/gdcalc/
      - install -Dm644 gdcalc.css -t ${FLATPAK_DEST}/etc/gdcalc/
      - |
        for s in 48 64 96 128 192; do
          install -Dm644 ${s}.png ${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/${FLATPAK_ID}.png
        done
      - ln -s ${FLATPAK_ID}.png ${FLATPAK_DEST}/share/icons/hicolor/48x48/apps/gdcalc.png
      - install -Dm644 gdcalc.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - desktop-file-edit --set-key=Icon --set-value=${FLATPAK_ID} ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 ${FLATPAK_ID}.metainfo.xml -t ${FLATPAK_DEST}/share/metainfo/
      - install -Dm644 doc/manual_en.html -t ${FLATPAK_DEST}/share/doc/gdcalc/
    sources:
      - type: archive
        url: https://gitlab.com/wef/gdcalc/-/archive/3.1/gdcalc-3.1.tar.gz
        sha256: 0a45ac5de54ce5a1da3c4231b6c06890d93dc3f37230a01bd2b17ff100ca09c3
        x-checker-data:
          type: anitya
          project-id: 236225
          stable-only: true
          url-template: https://gitlab.com/wef/gdcalc/-/archive/$version/gdcalc-$version.tar.gz
      - type: file
        path: com.gitlab.wef.gdcalc.metainfo.xml
      - type: file
        path: icons/48.png
      - type: file
        path: icons/64.png
      - type: file
        path: icons/96.png
      - type: file
        path: icons/128.png
      - type: file
        path: icons/192.png
      - type: shell
        commands:
          - sed -i 's#/etc/gdcalc#/app/etc/gdcalc#' src/main.c
    modules:
      - ncurses/libncurses.json
