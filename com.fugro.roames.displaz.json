{
  "id": "com.fugro.roames.displaz",
  "runtime": "org.kde.Platform",
  "runtime-version": "5.11",
  "sdk": "org.kde.Sdk",
  "command": "displaz",
  "finish-args": [
    "--socket=x11",
    "--share=ipc",
    "--socket=wayland",
    "--device=dri",
    "--filesystem=host"
  ],
  "modules": [
    {
      "name": "displaz",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/nigels-com/displaz.git",
          "branch": "flatpak"
        },
        {
          "type": "shell",
          "commands": [
            "mkdir -p thirdparty/external/downloads"
          ]
        },
        {
          "type": "file",
          "url": "http://download.savannah.nongnu.org/releases/openexr/ilmbase-2.2.0.tar.gz",
          "dest-filename": "thirdparty/external/downloads/ilmbase-2.2.0.tar.gz",
          "sha256": "ecf815b60695555c1fbc73679e84c7c9902f4e8faa6e8000d2f905b8b86cedc7"
        }
      ],
      "build-commands": [
        "mkdir build_external",
        "pushd build_external && cmake ../thirdparty/external && make -j ${FLATPAK_BUILDER_N_JOBS} && popd",
        "mkdir build",
        "pushd build && cmake -DCMAKE_INSTALL_PREFIX=/app .. && make -j ${FLATPAK_BUILDER_N_JOBS} install && popd",
        "install -TDm644 src/resource/icons/hicolor/scalable/apps/displaz.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg",
        "install -TDm644 src/resource/icons/hicolor/256x256/apps/displaz.png  ${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.png",
        "install -TDm644 src/resource/icons/hicolor/128x128/apps/displaz.png  ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png",
        "install -TDm644 src/resource/icons/hicolor/48x48/apps/displaz.png    ${FLATPAK_DEST}/share/icons/hicolor/48x48/apps/${FLATPAK_ID}.png",
        "install -TDm644 src/resource/icons/hicolor/32x32/apps/displaz.png    ${FLATPAK_DEST}/share/icons/hicolor/32x32/apps/${FLATPAK_ID}.png",
        "install -TDm644 src/resource/icons/hicolor/16x16/apps/displaz.png    ${FLATPAK_DEST}/share/icons/hicolor/16x16/apps/${FLATPAK_ID}.png",
        "install -TDm644 flatpak/${FLATPAK_ID}.desktop     ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop",
        "install -TDm644 flatpak/${FLATPAK_ID}.appdata.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.appdata.xml"
      ]
    }
  ]
}
