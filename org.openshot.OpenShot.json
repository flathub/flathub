{
    "app-id": "org.openshot.OpenShot",
    "branch": "stable",
    "runtime": "org.kde.Platform",
    "runtime-version": "5.9",
    "sdk": "org.kde.Sdk",
    "command": "openshot-qt",
    "writable-sdk": true,
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--device=all",
        "--share=network",
        "--filesystem=host",
        "--socket=pulseaudio",
        "--env=PYTHONPATH=/app/lib/python3/dist-packages"
    ],
    "modules": [
        {
            "name": "qtwebkit",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_INSTALL_PREFIX=/usr",
                "-DPORT=Qt",
                "-DENABLE_API_TESTS=OFF",
                "-DENABLE_INSPECTOR_UI=OFF",
                "-DENABLE_LEGACY_WEB_AUDIO=OFF",
                "-DENABLE_MEDIA_SOURCE=OFF",
                "-DENABLE_NETSCAPE_PLUGIN_API=OFF",
                "-DENABLE_PRINT_SUPPORT=OFF",
                "-DENABLE_SAMPLING_PROFILER=OFF",
                "-DENABLE_SPELLCHECK=OFF",
                "-DENABLE_VIDEO=OFF",
                "-DENABLE_WEBKIT2=OFF",
                "-DENABLE_WEB_AUDIO=OFF",
                "-DUSE_GSTREAMER=OFF"
            ],
            "post-install": [
                "mkdir -p /app/lib",
                "cp -r /usr/lib/libQt5WebKit* /app/lib"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/annulen/webkit/releases/download/qtwebkit-5.212.0-alpha2/qtwebkit-5.212.0-alpha2.tar.xz",
                    "sha256": "f8f901de567e11fc5659402b6b827eac75505ff9c5072d8e919aa306003f8f8a"
                }
            ]
        },
        {
            "name": "sip",
            "buildsystem": "simple",
            "build-commands": [
                "python3 configure.py --bindir=/app/bin --destdir=/app/lib/python3/dist-packages --incdir=/app/include/python3 --sipdir=/app/share/sip --stubsdir=/app/lib/python3/dist-packages",
                "make -j `nproc`",
                "make install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/pyqt/files/sip/sip-4.19.6/sip-4.19.6.tar.gz",
                    "sha256": "9dda27ae181bea782ebc8768d29f22f85ab6e5128ee3ab21f491febad707925a"
                }
            ]
        },
        {
            "name": "pyqt",
            "buildsystem": "simple",
            "build-commands": [
                "python3 configure.py PREFIX=/app -w --confirm-license --sip-incdir=/app/include/python3 --bindir=/app/bin --destdir=/app/lib/python3/dist-packages --designer-plugindir=/app/lib/plugins/designer --qml-plugindir=/app/lib/plugins/PyQt5 --sipdir=/app/share/sip --stubsdir=/app/lib/python3/dist-packages/PyQt5",
                "make -j `nproc`",
                "make install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/pyqt/files/PyQt5/PyQt-5.9.2/PyQt5_gpl-5.9.2.tar.gz",
                    "sha256": "c190dac598c97b0113ca5e7a37c71c623f02d1d713088addfacac4acfa4b8394"
                }
            ],
            "cleanup": [
                "/bin"
            ]
        },
        {
            "name": "libopenshot-audio",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/OpenShot/libopenshot-audio/archive/v0.1.5.tar.gz",
                    "sha256": "366151ea971fa7d0734777068d40b333a3df83ca33233dc2cd630aeed40d2071"
                }
            ]
        },
        {
            "name": "zeromq",
            "config-opts": [
                "--disable-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/zeromq/libzmq/releases/download/v4.2.3/zeromq-4.2.3.tar.gz",
                    "sha256": "8f1e2b2aade4dbfde98d82366d61baef2f62e812530160d2e6d0a5bb24e40bc0"
                }
            ]
        },
        {
            "name": "swig",
            "config-opts": [
                "--without-alllang",
                "--with-python=/usr/bin/python3",
                "--without-boost",
                "--without-pcre"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/swig/files/swig/swig-3.0.12/swig-3.0.12.tar.gz",
                    "sha256": "7cf9f447ae7ed1c51722efc45e7f14418d15d7a1e143ac9f09a668999f4fc94d"
                }
            ],
            "cleanup": [
                "*"
            ]
        },
        {
            "name": "cppzmq",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/zeromq/cppzmq/archive/v4.2.3.tar.gz",
                    "sha256": "3e6b57bf49115f4ae893b1ff7848ead7267013087dc7be1ab27636a97144d373"
                }
            ]
        },
        {
            "name": "x264",
            "config-opts": [
                "--disable-cli",
                "--enable-shared"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.videolan.org/x264/snapshots/x264-snapshot-20171223-2245-stable.tar.bz2",
                    "sha256": "ee4ba2c3d1caf786ad66d3fa86bdc368a8f827318788a62a9c8444b2c35816bf"
                }
            ]
        },
        {
            "name": "ffmpeg",
            "config-opts": [
                "--enable-gpl",
                "--disable-static",
                "--enable-shared",
                "--disable-doc",
                "--disable-programs",
                "--enable-libfontconfig",
                "--enable-libfreetype",
                "--enable-libopus",
                "--enable-librsvg",
                "--enable-libvpx",
                "--enable-avresample",
                "--enable-libx264"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://ffmpeg.org/releases/ffmpeg-3.4.1.tar.xz",
                    "sha256": "5a77278a63741efa74e26bf197b9bb09ac6381b9757391b922407210f0f991c0"
                }
            ],
            "cleanup": [
                "/share/ffmpeg"
            ]
        },
        {
            "name": "unittest-cpp",
            "config-opts": [
                "--disable-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/unittest-cpp/unittest-cpp/releases/download/v2.0.0/unittest-cpp-2.0.0.tar.gz",
                    "sha256": "1d1b118518dc200e6b87bbf3ae7bfd00a0cfc6be708255f98e5e3d627a7c9f98"
                }
            ]
        },
        {
            "name": "imagemagick",
            "config-opts": [
                "--disable-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.imagemagick.org/download/ImageMagick-6.9.9-33.tar.xz",
                    "sha256": "996adc81c91ebb589c0483b88ce4ddd76e91e0acee4858f71c9d024bda717869"
                }
            ],
            "cleanup": [
                "/share/doc"
            ]
        },
        {
            "name": "libopenshot",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release",
                "-DLIBOPENSHOT_AUDIO_BASE_DIR=/app/include/libopenshot-audio",
                "-DUNITTEST++_INCLUDE_DIR=/app/include/UnitTest++"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/OpenShot/libopenshot/archive/v0.1.9.tar.gz",
                    "sha256": "2547969818092d77a1c742e27cf416b34b4d326abf6b089fc10b921f4a4141ec"
                },
                {
                    "type": "shell",
                    "commands": [
                        "sed -i 's|${_REL_PYTHON_MODULE_PATH}|lib/python3/dist-packages|g' src/bindings/python/CMakeLists.txt"
                    ]
                }
            ]
        },
        {
            "name": "cython",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/ee/2a/c4d2cdd19c84c32d978d18e9355d1ba9982a383de87d0fcb5928553d37f4/Cython-0.27.3.tar.gz",
                    "sha256": "6a00512de1f2e3ce66ba35c5420babaef1fe2d9c43a8faab4080b0dbcc26bc64"
                }
            ],
            "cleanup": [
                "/bin"
            ]
        },
        {
            "name": "pyzmq",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/zeromq/pyzmq/archive/v16.0.3.tar.gz",
                    "sha256": "680b03afd8acab0c61cab825e4c358cbb25ce05eb922e3044e4408694010dcea"
                }
            ]
        },
        {
            "name": "requests",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app --root=/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/b0/e1/eab4fc3752e3d240468a8c0b284607899d2fbfb236a56b7377a329aa8d09/requests-2.18.4.tar.gz",
                    "sha256": "9c443e7324ba5b85070c4a818ade28bfabedf16ea10206da1132edaa6dda237e"
                }
            ]
        },
        {
            "name": "urllib3",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app --root=/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/ee/11/7c59620aceedcc1ef65e156cc5ce5a24ef87be4107c2b74458464e437a5d/urllib3-1.22.tar.gz",
                    "sha256": "cc44da8e1145637334317feebd728bd869a35285b93cbb4cca2577da7e62db4f"
                }
            ]
        },
        {
            "name": "chardet",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app --root=/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/fc/bb/a5768c230f9ddb03acc9ef3f0d4a3cf93462473795d18e9535498c8f929d/chardet-3.0.4.tar.gz",
                    "sha256": "84ab92ed1c4d4f16916e05906b6b75a6c0fb5db821cc65e70cbd64a3e2a5eaae"
                }
            ]
        },
        {
            "name": "certifi",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app --root=/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/23/3f/8be01c50ed24a4bd6b8da799839066ce0288f66f5e11f0367323467f0cbc/certifi-2017.11.5.tar.gz",
                    "sha256": "5ec74291ca1136b40f0379e1128ff80e866597e4e2c1e755739a913bbc3613c0"
                }
            ]
        },
        {
            "name": "idna",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app --root=/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/f4/bd/0467d62790828c23c47fc1dfa1b1f052b24efdf5290f071c7a91d0d82fd3/idna-2.6.tar.gz",
                    "sha256": "2c6a5de3089009e3da7c5dde64a141dbc8551d5b7f6cf4ed7c2568d0cc520a8f"
                }
            ]
        },
        {
            "name": "openshot-qt",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app --root=/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/OpenShot/openshot-qt/archive/v2.4.1.tar.gz",
                    "sha256": "da388c08cd94ec503a57756871244d9bb8746973807e2f95618a0d9d5e11fae9"
                },
                {
                    "type": "file",
                    "path": "org.openshot.OpenShot.appdata.xml"
                }
            ],
            "post-install": [
                "mv /app/share/applications/openshot-qt.desktop /app/share/applications/org.openshot.OpenShot.desktop",
                "desktop-file-edit --set-key=Icon --set-value='org.openshot.OpenShot' /app/share/applications/org.openshot.OpenShot.desktop",
                "mv /app/share/mime/packages/openshot-qt.xml /app/share/mime/packages/org.openshot.OpenShot.xml",
                "mkdir -p /app/share/icons/hicolor/scalable/apps",
                "mv /app/share/pixmaps/openshot-qt.svg /app/share/icons/hicolor/scalable/apps/org.openshot.OpenShot.svg",
                "install -Dm644 org.openshot.OpenShot.appdata.xml /app/share/appdata/org.openshot.OpenShot.appdata.xml"
            ]
        }
    ],
    "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/share/cmake",
        "/share/man",
        "*.la"
    ]
}
