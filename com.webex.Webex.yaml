app-id: com.webex.Webex
runtime: org.freedesktop.Platform
runtime-version: "22.08"
sdk: org.freedesktop.Sdk
command: webex
separate-locales: false
tags:
  - proprietary
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --share=network
  - --device=all
  - --filesystem=xdg-run/pipewire-0
  - --env=QT_QPA_PLATFORM=
  - --own-name=org.kde.*
  - --talk-name=org.gnome.Shell
  # Are any of the args below needed?
  - --talk-name=org.freedesktop.ScreenSaver
  - --talk-name=com.canonical.AppMenu.Registrar
  - --system-talk-name=org.bluez
  - --system-talk-name=org.freedesktop.login1
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.gtk.Notifications
  - --talk-name=com.canonical.AppMenu.Registrar
  - --talk-name=org.freedesktop.secrets
modules:
  - shared-modules/libsecret/libsecret.json
  - name: zypak
    sources:
    - type: git
      url: https://github.com/refi64/zypak
      # Webex branch. See https://github.com/refi64/zypak/issues/14
      commit: a6ee776624ee7667f04ffc5f86447ef3d989cef6
  - name: webex
    buildsystem: simple
    build-commands:
      - install -Dm755 /usr/bin/ar /app/bin/ar
      - install -Dm755 /usr/lib/$(gcc -print-multiarch)/libbfd-*.so -t /app/lib/
      - install -Dm755 apply_extra /app/bin/apply_extra
      - install -Dm644 com.webex.Webex.appdata.xml /app/share/appdata/com.webex.Webex.appdata.xml
      - install -Dm755 webex.sh /app/bin/webex
    sources:
      - type: script
        dest-filename: apply_extra
        commands:
          - ar x Webex.deb
          - tar xf data.tar.xz
          - mv ./opt/Webex/* .
          - rmdir ./opt/Webex ./opt
          - rm data.tar.xz control.tar.gz debian-binary
          - mkdir -p export/share/applications
          - sed -e 's$Icon=/opt/Webex/bin/sparklogosmall.png$Icon=com.webex.Webex$' -e 's$/opt/Webex/bin/CiscoCollabHost$/app/bin/webex$' -e '/^Version/d' bin/webex.desktop > export/share/applications/com.webex.Webex.desktop
          - mkdir -p export/share/icons/hicolor/96x96/apps
          - install -p -Dm644 bin/sparklogosmall.png export/share/icons/hicolor/96x96/apps/com.webex.Webex.png
      - type: script
        dest-filename: webex.sh
        commands:
          - export TMPDIR="$XDG_RUNTIME_DIR/app/$FLATPAK_ID"
          - export ZYPAK_QUIRKS=webex-trampoline
          - exec zypak-wrapper /app/extra/bin/CiscoCollabHost "$@"
      - type: file
        path: com.webex.Webex.appdata.xml
      - type: extra-data
        filename: Webex.deb
        only-arches:
          - x86_64
        url: https://binaries.webex.com/WebexDesktop-Ubuntu-Official-Package/Webex.deb
        sha256: c119963483717f37c26785c9abf3e6170c048b6ee728df4f7727b4135a26d82e
        size: 278762476
        x-checker-data:
          type: html
          url: https://help.webex.com/en-US/article/8dmbcr/Webex-App-|-What's-New
          version-pattern: "Linuxâ€”([\\d\\.]*)"
          url-template: https://binaries.webex.com/WebexDesktop-Ubuntu-Official-Package/Webex.deb
