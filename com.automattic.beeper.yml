app-id: com.automattic.beeper
base: org.electronjs.Electron2.BaseApp
base-version: "24.08"
runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
command: start-beeper
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=network
  - --filesystem=xdg-download
  - --filesystem=xdg-pictures
  - --filesystem=xdg-documents
  - --device=dri
  - --talk-name=org.kde.StatusNotifierWatcher
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons
  - --env=ELECTRON_TRASH=gio
  - --env=ELECTRON_OZONE_PLATFORM_HINT=auto
modules:
  - name: beeper
    buildsystem: simple
    cleanup:
      - squashfs-root
    sources:
      - type: file
        url: https://beeper-desktop.download.beeper.com/builds/Beeper-4.0.478.AppImage
        sha256: 49a60e62b4afce1602f2e3cf11b04c4d3663381483c60e22537a807f965a413b
        dest-filename: beeper.AppImage

      - type: script
        dest-filename: start-beeper.sh
        commands:
          - exec zypak-wrapper /app/beepertexts "$@"

      - type: file
        path: com.automattic.beeper.metainfo.xml

    build-commands:
      - chmod +x beeper.AppImage
      - ./beeper.AppImage --appimage-extract
      - mv squashfs-root/* "${FLATPAK_DEST}/"

      - install -Dm644 "${FLATPAK_DEST}/usr/share/icons/hicolor/0x0/apps/beepertexts.png" "${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.png"
      - install -Dm644 "${FLATPAK_DEST}/beepertexts.desktop" "${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop"

      - desktop-file-edit --set-key=Exec --set-value="start-beeper" "${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop"
      - desktop-file-edit --set-icon com.automattic.beeper "${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop"

      - install -Dm644 com.automattic.beeper.metainfo.xml "${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml"
      - install -Dm 755 start-beeper.sh "${FLATPAK_DEST}/bin/start-beeper"
