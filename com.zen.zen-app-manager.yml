app-id: com.zen.zen-app-manager
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
build-options:
  append-path: /usr/lib/sdk/rust-stable/bin
command: zen-app-manager
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --socket=session-bus
  # GTK theme and font access
  - --filesystem=xdg-run/dconf
  - --filesystem=~/.config/dconf:ro
  - --talk-name=ca.desrt.dconf
  - --env=DCONF_USER_CONFIG_DIR=.config/dconf
  # Permissions required to manage startup applications
  - --filesystem=xdg-config/autostart:create
  - --filesystem=xdg-data/autostart:create

modules:
  - name: zen-app-manager
    buildsystem: simple
    build-commands:
      - mkdir -p .cargo && cp cargo/config .cargo/config
      - cargo build --release --manifest-path src-tauri/Cargo.toml
      - install -D -m755 src-tauri/target/release/zen-app-manager /app/bin/zen-app-manager
      - install -D -m644 src-tauri/icons/128x128.png /app/share/icons/hicolor/128x128/apps/com.zen.zen-app-manager.png
      # Adjust desktop file for Flatpak
      - sed -i 's|^Exec=.*|Exec=zen-app-manager|' zen-app-manager.desktop
      - sed -i 's|^Icon=.*|Icon=com.zen.zen-app-manager|' zen-app-manager.desktop
      - install -D -m644 zen-app-manager.desktop /app/share/applications/com.zen.zen-app-manager.desktop
      - install -D -m644 com.zen.zen-app-manager.metainfo.xml /app/share/metainfo/com.zen.zen-app-manager.metainfo.xml
    sources:
      - type: git
        url: https://github.com/d0ksan8/zen-app-manager.git
        tag: main
        commit: 23f53c74970cdd888c8e48056d85c12fbd176a19
      - generated-sources.json
      # NOTE: Rust dependencies (crates) should be added here.
      # Flathub is offline during build, so
      # all libraries must be defined beforehand.
