app-id:      com.github.sr0w.bwget
runtime:     org.freedesktop.Platform
runtime-version: '23.08'
sdk:         org.freedesktop.Sdk
license:     MIT                           # ← NEW

build-options:
  append-path: /app/bin
  env:
    PYTHONUSERBASE: /app

command: bwget

modules:
  # ───────── upstream code ─────────
  - name: bwget
    buildsystem: simple
    build-commands:
      # install Python deps from the local wheel cache
      - pip3 install --no-cache-dir --no-warn-script-location --user \
          --find-links="../pypi_deps" \
          requests rich tomli

      # normalise LF endings and install script
      - sed -i 's/\r$//' bwget-0.3.2.py
      - install -Dm755 bwget-0.3.2.py /app/bin/bwget

      # install the icon (512 × 512 PNG)
      - install -Dm644 ../../com.github.sr0w.bwget.png \
          /app/share/icons/hicolor/512x512/apps/com.github.sr0w.bwget.png

      # install the AppStream metadata
      - install -Dm644 ../../com.github.sr0w.bwget.metainfo.xml \
          /app/share/metainfo/com.github.sr0w.bwget.metainfo.xml
    sources:
      - type: git
        url: https://github.com/Sr-0w/bwget.git
        branch: master

  # ───────── vendored PyPI wheels ─────────
  - name: pypi_deps
    buildsystem: simple
    build-commands:
      - install -d /app           # nothing to install; wheels just need staging
    sources:
      - type: pypi
        package: requests
        version: 2.31.0
      - type: pypi
        package: rich
        version: 13.7.1
      - type: pypi
        package: tomli
        version: 2.0.1

# optional: automatically bump when a new Git tag appears
x-checker-data:
  type: git
  url: https://github.com/Sr-0w/bwget.git
  tag-pattern: ^v?(\d+\.\d+\.\d+)$

finish-args:
  - --share=network
  - --filesystem=home
