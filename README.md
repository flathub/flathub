This is where the magic happens.
