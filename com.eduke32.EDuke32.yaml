app-id: com.eduke32.EDuke32
runtime: org.gnome.Platform
runtime-version: '3.32'
sdk: org.gnome.Sdk
command: eduke32.sh
finish-args:
  - --share=ipc
  - --share=network
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
  # For storing game files
  - --filesystem=xdg-documents/EDuke32:create
  # Unfortunately doesn't seem to respect XDG
  - --persist=.config/eduke32
modules:
  - shared-modules/glu/glu-9.0.0.json

  - name: EDuke32
    buildsystem: simple
    build-commands:
      - make
      - install -Dm755 -t ${FLATPAK_DEST}/bin/ eduke32 mapster32 eduke32.sh mapster32.sh
      - install -Dm644 -t ${FLATPAK_DEST}/share/applications/ com.eduke32.EDuke32.desktop com.eduke32.EDuke32-mapster32.desktop
      - install -Dm644 -t ${FLATPAK_DEST}/share/appdata/ com.eduke32.EDuke32.appdata.xml
      - install -Dm644 eduke32-icon128.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
      - install -Dm644 mapster32-icon128.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/${FLATPAK_ID}-mapster32.png
    sources:
    - type: archive
      url: http://dukeworld.duke4.net/eduke32/synthesis/20190804-7888/eduke32_src_20190804-7888.tar.xz
      sha256: efd616405032d525d97b807ce2a835728561f0e29063099d59d7467904ab908b
    - type: patch
      path: xdg_docs.patch
    - type: script
      dest-filename: eduke32.sh
      commands:
        - exec /app/bin/eduke32 "$@"
    - type: script
      dest-filename: mapster32.sh
      commands:
        - exec /app/bin/mapster32 "$@"
    - type: file
      path: com.eduke32.EDuke32.appdata.xml
    - type: file
      path: com.eduke32.EDuke32.desktop
    - type: file
      path: com.eduke32.EDuke32-mapster32.desktop
    - type: file
      path: eduke32-icon128.png
    - type: file
      path: mapster32-icon128.png
