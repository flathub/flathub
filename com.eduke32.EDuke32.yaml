app-id: com.eduke32.EDuke32
runtime: org.gnome.Platform
runtime-version: '3.28'
sdk: org.gnome.Sdk
command: eduke32.sh
finish-args:
  - --share=ipc
  - --share=network
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=dri
  # For storing game files
  - --filesystem=~/.eduke32:ro
  # Unfortunately doesn't seem to respect XDG
  - --persist=.config/eduke32

modules:
  - shared-modules/glu/glu-9.0.0.json

  - name: EDuke32
    buildsystem: simple
    build-commands:
      - make
      - install -Dm755 -t /app/bin/ eduke32 mapster32 eduke32.sh mapster32.sh
      - install -Dm644 -t /app/share/applications/ com.eduke32.EDuke32.desktop com.eduke32.EDuke32-mapster32.desktop
      - install -Dm644 -t /app/share/appdata/ com.eduke32.EDuke32.appdata.xml
      - install -Dm644 eduke32-icon128.png /app/share/icons/hicolor/128x128/apps/com.eduke32.EDuke32.png
      - install -Dm644 mapster32-icon128.png /app/share/icons/hicolor/128x128/apps/com.eduke32.EDuke32-mapster32.png
    sources:
    - type: archive
      url: http://dukeworld.duke4.net/eduke32/synthesis/20180809-6969/eduke32_src_20180809-6969.tar.xz
      sha256: 9f84e980a410b91cd759fd9ceb368b866b6e80ed7984d9ba45220ca60c4de3ba
    - type: script
      dest-filename: eduke32.sh
      commands:
        - exec /app/bin/eduke32 -j ~/.eduke32 "$@"
    - type: script
      dest-filename: mapster32.sh
      commands:
        - exec /app/bin/mapster32 -j ~/.eduke32 "$@"
    - type: file
      path: com.eduke32.EDuke32.appdata.xml
    - type: file
      path: com.eduke32.EDuke32.desktop
    - type: file
      path: com.eduke32.EDuke32-mapster32.desktop
    - type: file
      path: eduke32-icon128.png
    - type: file
      path: mapster32-icon128.png
