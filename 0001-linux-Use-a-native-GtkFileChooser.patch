From 5478a813fbe3fc5662386139b4ad984e38fcfccd Mon Sep 17 00:00:00 2001
From: Bastien Nocera <hadess@hadess.net>
Date: Sat, 23 Jun 2018 16:51:06 +0200
Subject: [PATCH] linux: Use a native GtkFileChooser

So that we get automatic Flatpak and portals support.
---
 src/linux/ugui/ucass.c    | 6 +++---
 src/linux/ugui/udisk.c    | 6 +++---
 src/linux/ugui/umemo.c    | 6 +++---
 src/linux/ugui/uprinter.c | 6 +++---
 4 files changed, 12 insertions(+), 12 deletions(-)

diff --git a/src/linux/ugui/ucass.c b/src/linux/ugui/ucass.c
index b4f2a81..926a219 100644
--- a/src/linux/ugui/ucass.c
+++ b/src/linux/ugui/ucass.c
@@ -325,11 +325,11 @@ static void open_file (GtkButton *button, gpointer data)
     gchar *file_name;
 
     if (first) {
-        dialog = gtk_file_chooser_dialog_new (
+        dialog = gtk_file_chooser_native_new (
                  is_fr?"SÃ©lectionner une cassette":"Select a tape",
                  (GtkWindow *) wControl, GTK_FILE_CHOOSER_ACTION_OPEN,
-                 is_fr?"_Annuler":"_Cancel", GTK_RESPONSE_CANCEL,
-                 is_fr?"_Ouvrir":"_Open", GTK_RESPONSE_ACCEPT, NULL);
+                 is_fr?"_Ouvrir":"_Open",
+                 is_fr?"_Annuler":"_Cancel");
         filter = gtk_file_filter_new ();
         gtk_file_filter_set_name (filter, is_fr?"Fichiers cassette (.k7)":"Tape files (.k7)");
         gtk_file_filter_add_mime_type (filter, "application/x-thomson-cassette");
diff --git a/src/linux/ugui/udisk.c b/src/linux/ugui/udisk.c
index d6e9c8a..99881bc 100644
--- a/src/linux/ugui/udisk.c
+++ b/src/linux/ugui/udisk.c
@@ -309,11 +309,11 @@ static void open_file (GtkButton *button, struct FILE_VECTOR *vector)
     char *file_name;
 
     if (vector->first_file) {
-        dialog = gtk_file_chooser_dialog_new (
+        dialog = gtk_file_chooser_native_new (
                  is_fr?"SÃ©lectionner une disquette":"Select a disk",
                  (GtkWindow *) wControl, GTK_FILE_CHOOSER_ACTION_OPEN,
-                 is_fr?"_Annuler":"_Cancel", GTK_RESPONSE_CANCEL,
-                 is_fr?"_Ouvrir":"_Open", GTK_RESPONSE_ACCEPT, NULL);
+                 is_fr?"_Ouvrir":"_Open",
+                 is_fr?"_Annuler":"_Cancel");
         filter = gtk_file_filter_new ();
         gtk_file_filter_set_name (filter, is_fr?"Fichiers disquette"
                                                :"Disk files");
diff --git a/src/linux/ugui/umemo.c b/src/linux/ugui/umemo.c
index b81de33..066f404 100644
--- a/src/linux/ugui/umemo.c
+++ b/src/linux/ugui/umemo.c
@@ -203,11 +203,11 @@ static void open_file (GtkButton *button, gpointer data)
     char *file_name;
 
     if (first) {
-        dialog = gtk_file_chooser_dialog_new (
+        dialog = gtk_file_chooser_native_new (
                  is_fr?"SÃ©lectionner une cartouche":"Select a cartridge",
                  (GtkWindow *) wControl, GTK_FILE_CHOOSER_ACTION_OPEN,
-                 is_fr?"_Annuler":"_Cancel", GTK_RESPONSE_CANCEL,
-                 is_fr?"_Ouvrir":"_Open", GTK_RESPONSE_ACCEPT, NULL);
+                 is_fr?"_Ouvrir":"_Open",
+                 is_fr?"_Annuler":"_Cancel");
         filter = gtk_file_filter_new ();
         gtk_file_filter_set_name (filter, is_fr?"Fichiers cartouche (.m7)":"Cartridge files (.m7)");
         gtk_file_filter_add_mime_type (filter, "application/x-thomson-cartridge-memo7");
diff --git a/src/linux/ugui/uprinter.c b/src/linux/ugui/uprinter.c
index f37bfdc..05dcca2 100644
--- a/src/linux/ugui/uprinter.c
+++ b/src/linux/ugui/uprinter.c
@@ -173,13 +173,13 @@ void uprinter_Init (GtkWidget *notebook)
     gtk_box_pack_start( GTK_BOX(hbox2), widget, FALSE, FALSE, 0);
 
     /* dialog pour le répertoire */
-    dialog = gtk_file_chooser_dialog_new (
+    dialog = gtk_file_chooser_native_new (
              is_fr?"SÃ©lectionner un rÃ©pertoire de sauvegarde"
                   :"Select the folder to save in",
              (GtkWindow *) wControl,
              GTK_FILE_CHOOSER_ACTION_SELECT_FOLDER,
-             is_fr?"_Annuler":"_Cancel", GTK_RESPONSE_CANCEL,
-             is_fr?"_Ouvrir":"_Open", GTK_RESPONSE_ACCEPT, NULL);
+             is_fr?"_Ouvrir":"_Open",
+             is_fr?"_Annuler":"_Cancel");
     gtk_file_chooser_set_current_folder(
                      (GtkFileChooser *)dialog,
                      (teo.lprt.folder == NULL)?"":teo.lprt.folder);
-- 
2.17.1

