app-id: org.codeberg.trougnouf.cfait
runtime: org.freedesktop.Platform
runtime-version: "25.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: cfait-gui
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --device=dri
  - --filesystem=xdg-data/cfait:create

modules:
  - name: cfait
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/rust-stable/bin
      env:
        CARGO_HOME: /run/build/cfait/cargo
    build-commands:
      # Build the TUI binary
      - cargo --offline build --release --verbose --features tui
      # Build the GUI binary
      - cargo --offline build --release --verbose --features gui --bin gui
      # Install binaries to /app/bin
      - install -Dm755 target/release/cfait -t /app/bin/
      - install -Dm755 target/release/gui /app/bin/cfait-gui
      # Install desktop file and icons (fix Icon name to match app-id)
      - sed -i 's/Icon=cfait/Icon=org.codeberg.trougnouf.cfait/' assets/cfait.desktop
      - install -Dm644 assets/cfait.desktop /app/share/applications/org.codeberg.trougnouf.cfait.desktop
      - install -Dm644 assets/cfait.svg /app/share/icons/hicolor/scalable/apps/org.codeberg.trougnouf.cfait.svg
      - install -Dm644 assets/org.codeberg.trougnouf.cfait.metainfo.xml /app/share/metainfo/org.codeberg.trougnouf.cfait.metainfo.xml

    sources:
      # Application source
      - type: git
        url: https://codeberg.org/trougnouf/cfait
        tag: v0.4.1
        commit: 3a381dc79048e585302f8fd0eca2a14f9fea52e9
      # Cargo dependencies
      - cargo-sources.yml
