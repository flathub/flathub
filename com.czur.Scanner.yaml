app-id: com.czur.Scanner
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
separate-locales: false
command: scanner
tags: [proprietary]
finish-args:
  - --socket=x11
  - --share=ipc
  - --device=all
  - --filesystem=xdg-pictures
  - --persists=.czur
modules:
  - name: scanner
    buildsystem: simple
    build-commands:
      - make install
      - install -D scanner.sh /app/bin/scanner
      - install -Dm644 com.czur.Scanner.desktop -t /app/share/applications
      - install -Dm644 com.czur.Scanner.metainfo.xml -t /app/share/metainfo
      - install -Dm644 256.png /app/share/icons/hicolor/256x256/apps/com.czur.Scanner.png
      - install -Dm644 512.png /app/share/icons/hicolor/512x512/apps/com.czur.Scanner.png
      - install -D apply_extra -t /app/bin
      - cp /usr/bin/ar /app/bin
      - install -D /usr/lib/x86_64-linux-gnu/libbfd-*.so -t /app/lib
    sources:
      - type: script
        dest-filename: apply_extra
        commands:
          - LD_LIBRARY_PATH=/app/lib ar x scanner.deb
          - tar xf data.tar.xz
          - mv opt/scanner scanner
          - rm -r scanner.deb control.tar.gz data.tar.xz debian-binary etc opt tmp usr
      - type: file
        path: com.czur.Scanner.desktop
      - type: file
        path: com.czur.Scanner.metainfo.xml
      - type: file
        path: 512.png
      - type: file
        path: 256.png
      - type: extra-data
        filename: scanner.deb
        only-arches: [x86_64]
        url: https://resource.czur-files.com/software/windows/scanner_x86_64_1.5.220817.deb
        sha256: 9500daaec5681d6a4c340a3d5bb9ce5a4ea0d4880e25e535f435ef9071f54d98
        size: 372413770
      - type: file
        path: Makefile
      - type: file
        path: fix-app-location.c
      - type: script
        dest-filename: scanner.sh
        commands:
          - cd /app/extra/scanner/
          - 'LD_PRELOAD=/app/lib/libfix-app-location.so exec ./scanner 2>&1 > /dev/null'
