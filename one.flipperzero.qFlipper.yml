app-id: one.flipperzero.qFlipper
runtime: org.kde.Platform
runtime-version: "5.15-21.08"
sdk: org.kde.Sdk
command: qFlipper-cli
rename-desktop-file: qFlipper.desktop
rename-icon: qFlipper
finish-args:
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=all
  - --device=dri
  - --share=ipc
  - --share=network
modules:
  - shared-modules/libusb/libusb.json
  # - name: qt5compat
  #   buildsystem: cmake-ninja
  #   sources:
  #     - type: git
  #       url: https://github.com/qt/qt5compat
  #       commit: 9c65f561114410655e005b335db37e6c6fd83843
  #       tag: v6.3.1
  - name: qFlipper
    buildsystem: simple
    build-commands:
      - ls driver-tool/libwdi
      - ls 3rdparty/nanopb
      - export QML_SOURCES_PATHS='.'
      - qmake qFlipper.pro -spec linux-g++ CONFIG+=qtquickcompiler PREFIX=/app
      - make qmake_all
      - make -j$(nproc)
      - make install
    sources:
      - type: git
        url: https://github.com/flipperdevices/qFlipper
        tag: "1.1.3"

  - name: metainfo
    buildsystem: simple
    build-commands:
      - mkdir -p ${FLATPAK_DEST}/share/metainfo/
      - install -Dm644 one.flipperzero.qFlipper.metainfo.xml ${FLATPAK_DEST}/share/metainfo/
    sources:
      - type: file
        path: one.flipperzero.qFlipper.metainfo.xml