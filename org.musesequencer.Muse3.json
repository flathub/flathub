{
  "app-id": "org.musesequencer.Muse3",
  "branch": "stable",
  "runtime": "org.kde.Platform",
  "runtime-version": "5.11",
  "sdk": "org.kde.Sdk",
  "command": "muse3",
  "rename-desktop-file": "muse.desktop",
  "rename-appdata-file": "muse.appdata.xml",
  "rename-icon": "muse_icon",
  "finish-args": [
    /* X11 + XShm access */
    "--share=ipc",
    "--socket=x11",
    /* Wayland */
    "--socket=wayland",
    /* Note playback */
    "--socket=pulseaudio",
    /* MIDI */
    "--device=all",
    /* Allow loading, saving files from anywhere (portals donâ€™t work yet) */
    "--filesystem=host",
    /* Allow other instances to see lockfiles */
    "--env=TMPDIR=/var/tmp",
    "--env=QT_AUTO_SCREEN_SCALE_FACTOR=1"
  ],
  "modules": [
    "shared-modules/gtk2/gtk2.json",
    {
      "name": "sigc++-2",
      "sources": [
        {
          "type": "archive",
          "url": "http://ftp.gnome.org/pub/GNOME/sources/libsigc++/2.8/libsigc++-2.8.0.tar.xz",
          "sha256": "774980d027c52947cb9ee4fac6ffe2ca60cc2f753068a89dfd281c83dbff9651"
        }
      ]
    },
    {
      "name": "cairomm",
      "sources": [
        {
          "type": "archive",
          "url": "http://ftp.gnome.org/pub/GNOME/sources/cairomm/1.12/cairomm-1.12.0.tar.xz",
          "sha256": "a54ada8394a86182525c0762e6f50db6b9212a2109280d13ec6a0b29bfd1afe6"
        }
      ]
    },
    {
      "name": "glibmm",
      "sources": [
        {
          "type": "archive",
          "url": "http://ftp.gnome.org/pub/GNOME/sources/glibmm/2.48/glibmm-2.48.1.tar.xz",
          "sha256": "dc225f7d2f466479766332483ea78f82dc349d59399d30c00de50e5073157cdf"
        }
      ]
    },
    {
      "name": "pangomm",
      "sources": [
        {
          "type": "archive",
          "url": "http://ftp.gnome.org/pub/GNOME/sources/pangomm/2.40/pangomm-2.40.1.tar.xz",
          "sha256": "9762ee2a2d5781be6797448d4dd2383ce14907159b30bc12bf6b08e7227be3af"
        }
      ]
    },
    {
      "name": "atkmm",
      "sources": [
        {
          "type": "archive",
          "url": "http://ftp.gnome.org/pub/GNOME/sources/atkmm/2.24/atkmm-2.24.2.tar.xz",
          "sha256": "ff95385759e2af23828d4056356f25376cfabc41e690ac1df055371537e458bd"
        }
      ]
    },
    {
      "name": "gtkmm",
      "sources": [
        {
          "type": "archive",
          "url": "http://ftp.gnome.org/pub/GNOME/sources/gtkmm/2.24/gtkmm-2.24.5.tar.xz",
          "sha256": "0680a53b7bf90b4e4bf444d1d89e6df41c777e0bacc96e9c09fc4dd2f5fe6b72"
        }
      ]
    },
    {
      "name": "ladspa",
      "no-autogen": true,
      "subdir": "src",
      "make-install-args": [
        "INSTALL_PLUGINS_DIR=/app/lib/ladspa",
        "INSTALL_INCLUDE_DIR=/app/include",
        "INSTALL_BINARY_DIR=/app/bin"
      ],
      "cleanup": [
        "/bin"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://www.ladspa.org/download/ladspa_sdk_1.15.tgz",
          "sha256": "4229959b09d20c88c8c86f4aa76427843011705df22d9c28b38359fd1829fded"
        }
      ]
    },
    {
      "name": "jack1",
      "config-opts": [
        "--libdir=/app/lib"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://jackaudio.org/downloads/jack-audio-connection-kit-0.125.0.tar.gz",
          "sha256": "3517b5bff82139a76b2b66fe2fd9a3b34b6e594c184f95a988524c575b11d444"
        }
      ],
      "cleanup": [
        ""
      ]
    },
    {
      "name": "audiofile",
      "sources": [
        {
          "type": "archive",
          "url": "http://audiofile.68k.org/audiofile-0.3.6.tar.gz",
          "sha256": "cdc60df19ab08bfe55344395739bb08f50fc15c92da3962fac334d3bff116965"
        },
        {
          "type": "patch",
          "path": "patches/audiofile-gcc6.patch"
        }
      ]
    },
    {
      "name": "lash",
      "config-opts": [
        "--disable-static",
        "--disable-serv-inst",
        "CFLAGS=-D_GNU_SOURCE"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://download.savannah.gnu.org/releases/lash/lash-0.5.4.tar.gz",
          "sha256": "105a7da84415c4725c6bcad28e70f23aeb4534f94fc80ca262b6a2cef2226c16"
        },
        {
          "type": "patch",
          "strip-components": 0,
          "path": "patches/lash-0.5.3-no-static-lib.patch"
        },
        {
          "type": "patch",
          "path": "patches/lash-gcc47.patch"
        },
        {
          "type": "patch",
          "path": "patches/lash-linking.patch"
        }
      ]
    },
    {
      "name": "rtaudio",
      "config-opts": [
        "--disable-static",
        "--enable-shared"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://www.music.mcgill.ca/~gary/rtaudio/release/rtaudio-5.0.0.tar.gz",
          "sha256": "799deae1192da52cc2c15a078ed3b42449580be7d096fe9bc841c5bba0289c57"
        }
      ]
    },
    {
      "name": "liblo",
      "sources": [
        {
          "type": "archive",
          "url": "http://download.sf.net/sourceforge/liblo/liblo-0.29.tar.gz",
          "sha256": "ace1b4e234091425c150261d1ca7070cece48ee3c228a5612d048116d864c06a"
        }
      ]
    },
    {
      "name": "dssi",
      "sources": [
        {
          "type": "archive",
          "url": "http://download.sf.net/sourceforge/dssi/dssi-1.1.1.tar.gz",
          "sha256": "f2c82b073a947c8255284249097667f9b14e660bf86186f3fcd3b3b3e087814e"
        }
      ]
    },
    {
      "name": "libinstpatch",
      "sources": [
        {
          "type": "archive",
          "url": "https://iweb.dl.sourceforge.net/project/swami/libinstpatch/1.0.0/libinstpatch-1.0.0.tar.gz",
          "sha256": "8943e2226d97609104365f0105be87b326a0b2335cea22d29604a45f8ef1cee7"
        },
        {
          "type": "patch",
          "strip-components": 0,
          "path": "patches/instpatch.examples.patch"
        }
      ]
    },
    {
      "name": "muse3",
      "buildsystem": "simple",
      "build-commands": [
        /* For some reason the cmake buildsystem in flatpak fail */
        /* and we can't use the script in the tree as we need to set the prefix */
        "mkdir build && cd build && cmake -DCMAKE_BUILD_TYPE=release -DCMAKE_INSTALL_PREFIX=/app ..",
        "cd build && make install"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://iweb.dl.sourceforge.net/project/lmuse/muse-3.0/muse-3.0.2.tar.gz",
          "sha256": "c9efddb901632ce7acfb163e319a56eae27b841dc30dd19d417bbc14a9d1b748"
        },
        {
          "type": "patch",
          "path": "patches/muse-QButtonGroup.patch"
        },
        {
          "type": "patch",
          "strip-components": 2,
          "path": "patches/muse-qt511.patch"
        }
      ]
    }
  ]
}
