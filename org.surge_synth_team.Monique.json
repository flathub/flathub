{
    "id": "org.surge_synth_team.Monique",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "23.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "MoniqueMonosynth",
    "finish-args": [
        "--socket=x11",
        "--share=ipc",
        "--socket=pulseaudio",
        "--filesystem=xdg-run/pipewire-0",
        "--persist=.config"
    ],
    "build-options": {
        "env": {
            "PLUGINS_DIR": "/app/extensions/Plugins/Monique"
        }
    },
    "add-extensions": {
        "org.freedesktop.LinuxAudio.Plugins.Monique": {
            "directory": "extensions/Plugins/Monique",
            "version": "23.08",
            "add-ld-path": "lib",
            "bundle": true,
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": false
        }
    },
    "modules": [
        {
            "name": "monique",
            "buildsystem": "cmake-ninja",
            "config_opts": [
                "-DCMAKE_AR=/usr/bin/gcc-ar",
                "-DCMAKE_NM=/usr/bin/gcc-nm",
                "-DCMAKE_RANLIB=/usr/bin/gcc-ranlib",
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DBUILD_LV2=OFF"
            ],
            "no-make-install": true,
            "post-install": [
                "install -Dm755 -t ${FLATPAK_DEST}/bin ./MoniqueMonosynth_artefacts/RelWithDebInfo/Standalone/MoniqueMonosynth",
                "install -Dm644 resources/icon/monique_512x512.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png",
                "install -Dm644 resources/icon/monique_128x128.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png",
                "install -Dm644 resources/icon/monique_64x64.png ${FLATPAK_DEST}/share/icons/hicolor/64x64/apps/${FLATPAK_ID}.png",
                "install -Dm644 -t ${FLATPAK_DEST}/share/applications org.surge_synth_team.Monique.desktop",
                "install -Dm644 -t ${FLATPAK_DEST}/share/metainfo org.surge_synth_team.Monique.metainfo.xml",
                "install -d ${PLUGINS_DIR}/vst3",
                "cp -r MoniqueMonosynth_artefacts/RelWithDebInfo/VST3/*.vst3 ${PLUGINS_DIR}/vst3",
                "#install -d ${PLUGINS_DIR}/lv2",
                "#cp -r MoniqueMonosynth_artefacts/RelWithDebInfo/LV2/*.lv2 ${PLUGINS_DIR}/lv2",
                "install -Dm755 MoniqueMonosynth_artefacts/RelWithDebInfo/CLAP/*.clap -t ${PLUGINS_DIR}/clap",
                "install -Dm644 org.freedesktop.LinuxAudio.Plugins.Monique.metainfo.xml -t ${PLUGINS_DIR}/share/metainfo",
                "appstreamcli compose --components=org.freedesktop.LinuxAudio.Plugins.Monique --prefix=/ --origin=org.freedesktop.LinuxAudio.Plugins.Monique --result-root=${PLUGINS_DIR} --data-dir=${PLUGINS_DIR}/share/app-info/xmls ${PLUGINS_DIR}"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/surge-synthesizer/monique-monosynth.git",
                    "commit": "ea69e8f19eec86921d8592b5f6076883a1e52d79"
                },
                {
                    "type": "file",
                    "path": "org.surge_synth_team.Monique.desktop"
                },
                {
                    "type": "file",
                    "path": "org.surge_synth_team.Monique.metainfo.xml"
                },
                {
                    "type": "file",
                    "path": "org.freedesktop.LinuxAudio.Plugins.Monique.metainfo.xml"
                }
            ]
        }
    ]
}
