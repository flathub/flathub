{
    "id": "org.surge_synth_team.Monique",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "23.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "MoniqueMonosynth",
    "finish-args": [
        "--socket=x11",
        "--share=ipc",
        "--socket=pulseaudio",
        "--filesystem=xdg-run/pipewire-0",
        "--persist=.config"
    ],
    "build-options": {
        "env": {
            "PLUGINS_DIR": "/app/extensions/Plugins/Monique"
        }
    },
    "add-extensions": {
        "org.freedesktop.LinuxAudio.Plugins.Monique": {
            "directory": "extensions/Plugins/Monique",
            "version": "23.08",
            "add-ld-path": "lib",
            "bundle": true,
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": false
        }
    },
    "modules": [
        {
            "name": "monique",
            "buildsystem": "cmake-ninja",
            "config_opts": [
                "-DCMAKE_AR=/usr/bin/gcc-ar",
                "-DCMAKE_NM=/usr/bin/gcc-nm",
                "-DCMAKE_RANLIB=/usr/bin/gcc-ranlib",
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo"
            ],
            "no-make-install": true,
            "post-install": [
                "install -Dm755 -t ${FLATPAK_DEST}/bin ./MoniqueMonosynth_artefacts/RelWithDebInfo/Standalone/MoniqueMonosynth",
                "install -Dm644 Images/Logo_MonoPlugs_1.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg",
                "install -Dm644 -t ${FLATPAK_DEST}/share/applications org.surge_synth_team.Monique.desktop",
                "install -Dm644 -t ${FLATPAK_DEST}/share/metainfo org.surge_synth_team.Monique.metainfo.xml",
                "install -d ${PLUGINS_DIR}/vst3",
                "cp -r MoniqueMonosynth_artefacts/RelWithDebInfo/VST3/*.vst3 ${PLUGINS_DIR}/vst3",
                "install -Dm644 -t ${PLUGINS_DIR}/share/metainfo org.freedesktop.LinuxAudio.Plugins.Monique.metainfo.xml",
                "appstream-compose --basename=org.freedesktop.LinuxAudio.Plugins.Monique --prefix=${PLUGINS_DIR} --origin=flatpak org.freedesktop.LinuxAudio.Plugins.Monique"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/surge-synthesizer/monique-monosynth.git",
                    "commit": "5b0041c8e6050f7fbde00595aac93f488fb418e1"
                },
                {
                    "type": "patch",
                    "path": "patches/monique-square-icon.patch"
                },
                {
                    "type": "patch",
                    "options": [
                      "-d",
                      "libs"
                    ],
                    "path": "patches/juce-614-header.patch"
                },
                {
                    "type": "file",
                    "path": "org.surge_synth_team.Monique.desktop"
                },
                {
                    "type": "file",
                    "path": "org.surge_synth_team.Monique.metainfo.xml"
                },
                {
                    "type": "file",
                    "path": "org.freedesktop.LinuxAudio.Plugins.Monique.metainfo.xml"
                }
            ]
        }
    ]
}
