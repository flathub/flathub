app-id: io.github.lephotographelibre.BlueNotebook
runtime: org.kde.Platform
runtime-version: '5.15-23.08'
sdk: org.kde.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: '5.15-23.08' 
command: bluenotebook
finish-args:
  # (X11 et Wayland) Access
  - --socket=fallback-x11
  - --socket=wayland
  # X11 shared memory
  - --share=ipc
  # (need for WebEngine)
  - --device=dri
  # Network access for integration (Météo, YouTube, etc.)
  - --share=network
  # Sound for Youtube Inegration 
  - --socket=pulseaudio
  # The application requires --filesystem=home because it manages a Journal directory (a library of markdown files and assets) that the user can place anywhere in their home directory (e.g., for synchronization purposes like Dropbox/Nextcloud). The app needs persistent read/write access to this directory across restarts without prompting the user via a portal every time.
  - --filesystem=home
  # - --filesystem=xdg-documents
  # For emoji font
  - --env=FONTCONFIG_FILE=/app/etc/fonts/fonts.conf

modules:
  # Python dependancies generated
  - python3-requirements.yaml

  # Font Noto Color Emoji for emojis
  - name: noto-color-emoji
    buildsystem: simple
    build-commands:
      - install -d -m 755 /app/share/fonts/
      - install -m 644 NotoColorEmoji.ttf /app/share/fonts/
      - install -d -m 755 /app/etc/fonts/conf.d/
      - install -m 644 75-noto-color-emoji.conf /app/etc/fonts/conf.d/
      - install -m 644 fonts.conf /app/etc/fonts/fonts.conf
      - fc-cache -f -v /app/share/fonts/
    sources:
      - type: file
        url: https://github.com/googlefonts/noto-emoji/raw/8998f5dd683424a73e2314a8c1f1e359c19e8742/fonts/NotoColorEmoji.ttf
        sha256: 72a635cb3d2f3524c51620cdde406b217204e8a6a06c6a096ff8ed4b5fd6e27b
      - type: file
        path: 75-noto-color-emoji.conf
      - type: file
        path: fonts.conf

  # Add Noto Sans font
  - name: noto-sans
    buildsystem: simple
    build-commands:
      - install -d -m 755 /app/share/fonts/
      - install -m 644 NotoSans-*.ttf /app/share/fonts/
      - fc-cache -f -v /app/share/fonts/
    sources:
      - type: file
        url: https://github.com/notofonts/noto-fonts/raw/c971829a87e7920f960e7277c3dafd9bedd3c601/hinted/ttf/NotoSans/NotoSans-Regular.ttf
        sha256: b85c38ecea8a7cfb39c24e395a4007474fa5a4fc864f6ee33309eb4948d232d5
      - type: file
        url: https://github.com/notofonts/noto-fonts/raw/c971829a87e7920f960e7277c3dafd9bedd3c601/hinted/ttf/NotoSans/NotoSans-Bold.ttf
        sha256: c976e4b1b99edc88775377fcc21692ca4bfa46b6d6ca6522bfda505b28ff9d6a
      - type: file
        url: https://github.com/notofonts/noto-fonts/raw/c971829a87e7920f960e7277c3dafd9bedd3c601/hinted/ttf/NotoSans/NotoSans-Italic.ttf
        sha256: 36cff144df01309dab648bea71baff9bb074026914afe63aeacc8bc90b67a28b
      - type: file
        url: https://github.com/notofonts/noto-fonts/raw/c971829a87e7920f960e7277c3dafd9bedd3c601/hinted/ttf/NotoSans/NotoSans-BoldItalic.ttf
        sha256: 6edf4227ef0fa846aca70e86a307804ca4401741830f5b3af0f2554abe2b8466

  # Bluenotebook App
  - name: bluenotebook
    buildsystem: simple
    build-commands:
      # Créer les répertoires de destination
      - mkdir -p /app/share/bluenotebook
      - mkdir -p /app/bin
      - mkdir -p /app/share/applications
      - mkdir -p /app/share/metainfo
      - mkdir -p /app/share/icons/hicolor/128x128/apps
      - install -Dm755 flatpak/bluenotebook-wrapper.sh /app/bin/bluenotebook
      - mkdir -p /app/share/icons/hicolor/32x32/apps

      - install -Dm644 flatpak/io.github.lephotographelibre.BlueNotebook.desktop -t /app/share/applications/
      # Copy Source code
      - cp -r . /app/share/bluenotebook

      # Installer le script wrapper
      - install -Dm644 flatpak/bluenotebook_128x128.png /app/share/icons/hicolor/128x128/apps/io.github.lephotographelibre.BlueNotebook.png
      - install -Dm644 flatpak/bluenotebook_64x64.png /app/share/icons/hicolor/64x64/apps/io.github.lephotographelibre.BlueNotebook.png
      - install -Dm644 flatpak/bluenotebook_32x32.png /app/share/icons/hicolor/32x32/apps/io.github.lephotographelibre.BlueNotebook.png
      - install -m 644 flatpak/io.github.lephotographelibre.BlueNotebook.desktop /app/share/applications/

      # Install AppStream (metainfo)
      - install -m 644 flatpak/io.github.lephotographelibre.BlueNotebook.metainfo.xml /app/share/metainfo/

      # Installer PNG Icons
      - install -m 644 flatpak/bluenotebook_128x128.png /app/share/icons/hicolor/128x128/apps/io.github.lephotographelibre.BlueNotebook.png
      - install -m 644 flatpak/bluenotebook_64x64.png /app/share/icons/hicolor/64x64/apps/io.github.lephotographelibre.BlueNotebook.png
      - install -m 644 flatpak/bluenotebook_32x32.png /app/share/icons/hicolor/32x32/apps/io.github.lephotographelibre.BlueNotebook.png


    sources:
      - type: git
        url: https://github.com/lephotographelibre/BlueNotebook.git
        tag: v4.1.3
