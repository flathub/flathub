id: de.bwravencl.ControllerBuddy
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: launch.sh
finish-args:
  - --device=all
  - --env=JAVA_TOOL_OPTIONS=-Dawt.useSystemAAFontSettings=gasp
  - --filesystem=xdg-documents
  - --persist=.java
  - --share=network
  - --socket=x11
  - --share=ipc
  - --talk-name=org.freedesktop.ScreenSaver
  - --talk-name=org.freedesktop.Flatpak
modules:
  - name: ControllerBuddy
    buildsystem: simple
    build-commands:
      - |
        cp -R ControllerBuddy/* /app/ &&
        install -Dm 755 launch.sh -t /app/bin &&
        install -Dm 755 update-profiles.sh -t /app/bin &&
        install -Dm 755 InstallControllerBuddy.sh /app/bin/InstallControllerBuddy.sh &&
        install -Dm 644 icon.svg "/app/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg" &&
        install -Dm 644 "$FLATPAK_ID.desktop" -t /app/share/applications &&
        install -Dm 644 "$FLATPAK_ID-update-profiles.desktop" -t /app/share/applications &&
        install -Dm 644 "$FLATPAK_ID.metainfo.xml" -t /app/share/metainfo
    sources:
      - type: archive
        only-arches:
          - x86_64
        url: https://github.com/bwRavencl/ControllerBuddy/releases/download/1.3.58-c8b1fde/ControllerBuddy-linux-x86-64-1.3.58-c8b1fde.tgz
        sha256: b65d33b9cf872ef0923e32efa87f85c5e0ce4f3df76190a2f2d89f4475a01310
        strip-components: 0
        x-checker-data:
          type: anitya
          project-id: 376393
          stable-only: false
          url-template: https://github.com/bwRavencl/ControllerBuddy/releases/download/$version/ControllerBuddy-linux-x86-64-$version.tgz
      - type: archive
        only-arches:
          - aarch64
        url: https://github.com/bwRavencl/ControllerBuddy/releases/download/1.3.58-c8b1fde/ControllerBuddy-linux-aarch64-1.3.58-c8b1fde.tgz
        sha256: e3e1f553c5ce2b8db6639806de6aeb16295a43c5442bd3976996f5b4976bd648
        strip-components: 0
        x-checker-data:
          type: anitya
          project-id: 376393
          stable-only: false
          url-template: https://github.com/bwRavencl/ControllerBuddy/releases/download/$version/ControllerBuddy-linux-aarch64-$version.tgz
      - type: file
        url: https://raw.githubusercontent.com/bwRavencl/ControllerBuddy/refs/tags/1.3.58-c8b1fde/icon.svg
        sha256: 22cb081b000a30f248e6c5f842a9519d933339d01449fe2889e3379cc5628523
        x-checker-data:
          type: anitya
          project-id: 376393
          stable-only: false
          url-template: https://raw.githubusercontent.com/bwRavencl/ControllerBuddy/refs/tags/$version/icon.svg
      - type: file
        url: https://github.com/bwRavencl/ControllerBuddy-Install-Script/releases/download/1.0.82-07b845a/InstallControllerBuddy.sh
        sha256: 0cfe30ef1f118ebd33ba83f358fdb9b0ddea11adac1128b79d183b50acb4fc20
        x-checker-data:
          type: anitya
          project-id: 376395
          stable-only: false
          url-template: https://github.com/bwRavencl/ControllerBuddy-Install-Script/releases/download/$version/InstallControllerBuddy.sh
      - type: script
        dest-filename: launch.sh
        commands:
          - |
            script_file="$XDG_RUNTIME_DIR/app/$FLATPAK_ID/InstallControllerBuddy.sh"
            install -Dm 755 /app/bin/InstallControllerBuddy.sh "$script_file"
            status_file="$script_file.status"
            rm -f "$status_file"
            xterm -fa Mono -e 'flatpak-spawn --host '"$script_file"' prepare ; echo $? > '"$status_file"
            status=$(cat "$status_file" 2>/dev/null)
            rm -f "$status_file"
            if [ "$status" -ne 0 ]
            then
              exit "$status"
            fi
            if [ ! -d "$(xdg-user-dir DOCUMENTS)/ControllerBuddy-Profiles" ]
            then
              /app/bin/update-profiles.sh
            fi
            /app/bin/ControllerBuddy "$@"
      - type: script
        dest-filename: update-profiles.sh
        commands:
          - xterm -fa Mono -e /app/bin/InstallControllerBuddy.sh profiles
      - type: file
        path: de.bwravencl.ControllerBuddy.desktop
      - type: file
        path: de.bwravencl.ControllerBuddy-update-profiles.desktop
      - type: file
        path: de.bwravencl.ControllerBuddy.metainfo.xml
  - name: git
    make-args:
      - INSTALL_SYMLINKS=1
    make-install-args:
      - INSTALL_SYMLINKS=1
    cleanup:
      - /lib/pkgconfig
      - /man
    sources:
      - type: archive
        url: https://www.kernel.org/pub/software/scm/git/git-2.48.1.tar.xz
        sha256: 1c5d545f5dc1eb51e95d2c50d98fdf88b1a36ba1fa30e9ae5d5385c6024f82ad
        x-checker-data:
          type: anitya
          project-id: 5350
          stable-only: true
          url-template: https://www.kernel.org/pub/software/scm/git/git-$version.tar.xz
  - name: xterm
    buildsystem: autotools
    config-opts:
      - --disable-full-tgetent
    sources:
      - type: archive
        url: https://invisible-mirror.net/archives/xterm/xterm-397.tgz
        sha256: 2e9b742b9cba44ecec58074e513237f6cd6d5923f1737cb36a4e5625f4ae8662
        x-checker-data:
          type: anitya
          project-id: 5272
          url-template: https://invisible-mirror.net/archives/xterm/xterm-$version.tgz
    modules:
      - name: libXmu
        buildsystem: autotools
        sources:
          - type: archive
            url: https://xorg.freedesktop.org/releases/individual/lib/libXmu-1.2.1.tar.gz
            sha256: bf0902583dd1123856c11e0a5085bd3c6e9886fbbd44954464975fd7d52eb599
            x-checker-data:
              type: anitya
              project-id: 1785
              url-template: https://xorg.freedesktop.org/releases/individual/lib/libXmu-$version.tar.gz
      - name: libXaw
        buildsystem: autotools
        sources:
          - type: archive
            url: https://xorg.freedesktop.org/releases/individual/lib/libXaw-1.0.16.tar.gz
            sha256: 012f90adf8739f2f023d63a5fee1528949cf2aba92ef7ac1abcfc2ae9cf28798
            x-checker-data:
              type: anitya
              project-id: 1766
              url-template: https://xorg.freedesktop.org/releases/individual/lib/libXaw-$version.tar.gz
