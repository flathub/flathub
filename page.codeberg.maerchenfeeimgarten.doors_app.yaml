id: page.codeberg.maerchenfeeimgarten.doors_app

runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk

command: "doors_app"
finish-args:
  - --socket=wayland # Permission needed to show the window
  - --socket=fallback-x11 # Permission needed to show the window
  - --share=ipc
  - --persist=.local/share/page.codeberg.maerchenfeeimgarten.doors-app/
modules:
  - name: doors_app
    buildsystem: simple

    sources:
      # A reference to the previously generated flatpak metainfo file
      - type: file
        url: https://codeberg.org/MaerchenfeeimGarten/doors_app/raw/commit/81b269ea5abab5dfd52d31fccd5736e59f783b60/page.codeberg.maerchenfeeimgarten.doors_app.metainfo.xml
        sha256: cac99cdbcdd214f0dbb4599e38b7590c536a36f1e89fed8ecc35189833d4a524
      # If you use Codeberg releases, you can target an existing remote file
      - type: file
        url: https://codeberg.org/MaerchenfeeimGarten/doors_app/releases/download/v0.1.1/doors_app_0.1.1_amd64.deb
        sha256: b55c57c08afebcc5de2603aca49ae00f7ec3309f9b75e9c219128b5ac2da76c7
        only-arches: [x86_64] # This source is only used on x86_64 Computers
      - type: file
        url: https://codeberg.org/MaerchenfeeimGarten/doors_app/raw/commit/08c40d84e108cd5be848ea24e938c5bafaa56bd6/page.codeberg.maerchenfeeimgarten.doors_app.desktop
        sha256: 64a39aae2cefc8578592ba098db4858a888df4563df180a56d7c5923b56b0ba7

    build-commands:
      - set -e

      # Extract the deb package
      - mkdir deb-extract
      - ar -x *.deb --output deb-extract
      - tar -C deb-extract -xf deb-extract/data.tar.gz

      # Copy binary
      - 'install -Dm755 deb-extract/usr/bin/doors_app /app/bin/doors_app'
      
      # Copy desktop file
      - install -Dm644 page.codeberg.maerchenfeeimgarten.doors_app.desktop /app/share/applications/page.codeberg.maerchenfeeimgarten.doors_app.desktop

      # Copy icons
      - install -Dm644 deb-extract/usr/share/icons/hicolor/128x128/apps/doors_app.png /app/share/icons/hicolor/128x128/apps/page.codeberg.maerchenfeeimgarten.doors_app.png
      - install -Dm644 deb-extract/usr/share/icons/hicolor/32x32/apps/doors_app.png /app/share/icons/hicolor/32x32/apps/page.codeberg.maerchenfeeimgarten.doors_app.png
      - install -Dm644 deb-extract/usr/share/icons/hicolor/256x256@2/apps/doors_app.png /app/share/icons/hicolor/256x256@2/apps/page.codeberg.maerchenfeeimgarten.doors_app.png
      - install -Dm644 page.codeberg.maerchenfeeimgarten.doors_app.metainfo.xml /app/share/metainfo/page.codeberg.maerchenfeeimgarten.doors_app.metainfo.xml
