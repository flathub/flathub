id: page.codeberg.maerchenfeeimgarten.doors_app

runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
  
command: "doors_app"
finish-args:
  - --socket=wayland # Permission needed to show the window
  - --socket=fallback-x11 # Permission needed to show the window
  - --share=ipc # is needed because of x11
  - --device=dri # for OpenGL rendering
  
modules:
  - name: doors_app
    buildsystem: simple
    build-options:
        append-path: /usr/lib/sdk/rust-stable/bin
        env:
          CARGO_HOME: /run/build/v-extract/doors_app/cargo

    sources:
      - type: file
        url: https://codeberg.org/MaerchenfeeimGarten/doors_app/raw/commit/18e1bb889539fecf59c1bda6ebb998391cc86a44/page.codeberg.maerchenfeeimgarten.doors_app.metainfo.xml
        sha256: 394b22be73645d4ec5698ef693480239f52326a7bc322648307d0f5729762e55
      - type: archive
        url: https://codeberg.org/MaerchenfeeimGarten/doors_app/archive/v0.1.4.tar.gz
        sha256: 0d77ea76419225a25df5c7ea82fa2ef2f6417b88b8f1b28bc05be9a7b5e3a275
      - type: file
        url: https://codeberg.org/MaerchenfeeimGarten/doors_app/raw/commit/08c40d84e108cd5be848ea24e938c5bafaa56bd6/page.codeberg.maerchenfeeimgarten.doors_app.desktop
        sha256: 64a39aae2cefc8578592ba098db4858a888df4563df180a56d7c5923b56b0ba7
      - type: archive
        url: https://codeberg.org/MaerchenfeeimGarten/cargo_vendored_version_of_tauri-cli/archive/v0.0.2.tar.gz
        sha256: 67ca2ce2b046f53a14a7748fbf0b44220cdba784cb9d580c1f96aada475e7a35
        
    build-commands:
    
      # build cargo-tauri build command
      - |
        cd cargo_vendored_version_of_tauri-cli
        cargo --offline build 
        
      #build .deb file
      - ./cargo_vendored_version_of_tauri-cli/target/debug/cargo-tauri build -b deb

      
      # Extract the deb package
      - cp src-tauri/target/release/bundle/deb/*.deb ./
      - mkdir deb-extract
      - ar -x *.deb --output deb-extract
      - tar -C deb-extract -xf deb-extract/data.tar.gz

      # Copy binary
      - 'install -Dm755 deb-extract/usr/bin/doors_app /app/bin/doors_app'
      
      # Copy desktop file
      - install -Dm644 page.codeberg.maerchenfeeimgarten.doors_app.desktop /app/share/applications/page.codeberg.maerchenfeeimgarten.doors_app.desktop

      # Copy icons
      - install -Dm644 deb-extract/usr/share/icons/hicolor/128x128/apps/doors_app.png /app/share/icons/hicolor/128x128/apps/page.codeberg.maerchenfeeimgarten.doors_app.png
      - install -Dm644 deb-extract/usr/share/icons/hicolor/32x32/apps/doors_app.png /app/share/icons/hicolor/32x32/apps/page.codeberg.maerchenfeeimgarten.doors_app.png
      - install -Dm644 deb-extract/usr/share/icons/hicolor/256x256@2/apps/doors_app.png /app/share/icons/hicolor/256x256@2/apps/page.codeberg.maerchenfeeimgarten.doors_app.png
      - install -Dm644 page.codeberg.maerchenfeeimgarten.doors_app.metainfo.xml /app/share/metainfo/page.codeberg.maerchenfeeimgarten.doors_app.metainfo.xml
