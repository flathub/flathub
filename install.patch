From 6d797fd1d274ad0293ea876491db9eb4a0732769 Mon Sep 17 00:00:00 2001
Message-Id: <6d797fd1d274ad0293ea876491db9eb4a0732769.1650913997.git.matthias.mailaender@lablicate.com>
From: =?UTF-8?q?Matthias=20Mail=C3=A4nder?=
 <Mailaender@users.noreply.github.com>
Date: Mon, 25 Apr 2022 20:25:28 +0200
Subject: [PATCH] Install Linux metadata into the correct folders

---
 singleapp/app.pro |  9 ++++++---
 src/QXmlEdit.pro  |  9 ++++++---
 src/cconfig.pri   | 24 ++++++++++++++++++++++++
 3 files changed, 36 insertions(+), 6 deletions(-)

diff --git a/singleapp/app.pro b/singleapp/app.pro
index 529c52e..ea8e031 100644
--- a/singleapp/app.pro
+++ b/singleapp/app.pro
@@ -142,9 +142,11 @@ snippets.files = data/snippets/{6d11b8d1-e285-46b2-8375-79e17cab9862}.xml \
 manual.path = $$INST_DOC_DIR
 manual.files = ../doc/QXmlEdit_manual.pdf
 
-desktopInfo.path = $$INST_DATA_DIR
-desktopInfo.files = ../install_scripts/environment/desktop/QXmlEdit.desktop \
-    ../install_scripts/environment/desktop/QXmlEdit.appdata.xml
+desktopInfo.path = $$INST_DESKTOP_DIR
+desktopInfo.files = ../install_scripts/environment/desktop/QXmlEdit.desktop
+
+metaInfo.path = $$INST_APPDATA_DIR
+metaInfo.files = ../install_scripts/environment/desktop/QXmlEdit.appdata.xml
 
 #-----------------------------------------------------------
 
@@ -158,6 +160,7 @@ unix:INSTALLS += snippets
 unix:INSTALLS += styles
 unix:INSTALLS += manual
 unix:INSTALLS += desktopInfo
+unix:INSTALLS += metaInfo
 
 include("../src/allsources.pri")
 
diff --git a/src/QXmlEdit.pro b/src/QXmlEdit.pro
index 37e8d2c..8c4d9a5 100644
--- a/src/QXmlEdit.pro
+++ b/src/QXmlEdit.pro
@@ -453,9 +453,11 @@ snippets.files = data/snippets/{6d11b8d1-e285-46b2-8375-79e17cab9862}.xml \
 manual.path = $$INST_DOC_DIR
 manual.files = ../doc/QXmlEdit_manual.pdf
 
-desktopInfo.path = $$INST_DATA_DIR
-desktopInfo.files = ../install_scripts/environment/desktop/QXmlEdit.desktop \
-    ../install_scripts/environment/desktop/QXmlEdit.appdata.xml
+desktopInfo.path = $$INST_DESKTOP_DIR
+desktopInfo.files = ../install_scripts/environment/desktop/QXmlEdit.desktop
+
+metaInfo.path = $$INST_APPDATA_DIR
+metaInfo.files = ../install_scripts/environment/desktop/QXmlEdit.appdata.xml
 
 # resources are defined in paths.h
 unix:!macx:DEFINES += UNIX_RESOURCES
@@ -466,6 +468,7 @@ unix:INSTALLS += snippets
 unix:INSTALLS += styles
 unix:INSTALLS += manual
 unix:INSTALLS += desktopInfo
+unix:INSTALLS += metaInfo
 
 OTHER_FILES += \
     resources/test.xsd \
diff --git a/src/cconfig.pri b/src/cconfig.pri
index 6b32e1f..6c28364 100644
--- a/src/cconfig.pri
+++ b/src/cconfig.pri
@@ -35,6 +35,8 @@
 ############################ BEGIN INSTALLATION FOLDERS DECLARATION ###########################################
 
 #message(QXMLEDIT_INST_DATA_DIR = $$(QXMLEDIT_INST_DATA_DIR))
+#message(QXMLEDIT_INST_APPDATA_DIR = $$(QXMLEDIT_INST_APPDATA_DIR))
+#message(QXMLEDIT_INST_DESKTOP_DIR = $$(QXMLEDIT_INST_DESKTOP_DIR))
 #message(QXMLEDIT_INST_DIR = $$(QXMLEDIT_INST_DIR))
 #message(QXMLEDIT_INST_DOC_DIR = $$(QXMLEDIT_INST_DOC_DIR))
 #message(QXMLEDIT_INST_LIB_DIR = $$(QXMLEDIT_INST_LIB_DIR))
@@ -55,6 +57,28 @@ message("Inst data dir $$INST_DATA_DIR")
 
 ###########################################
 
+INST_APPDATA_DIR=$$(QXMLEDIT_INST_APPDATA_DIR)
+!isEmpty(QXMLEDIT_INST_APPDATA_DIR) {
+    INST_APPDATA_DIR=$$QXMLEDIT_INST_APPDATA_DIR
+}
+isEmpty(INST_APPDATA_DIR) {
+    INST_APPDATA_DIR = /usr/share/appdata/
+}
+message("Inst app data dir $$INST_APPDATA_DIR")
+
+###########################################
+
+INST_DESKTOP_DIR=$$(QXMLEDIT_INST_DESKTOP_DIR)
+!isEmpty(QXMLEDIT_INST_DESKTOP_DIR) {
+    INST_DESKTOP_DIR=$$QXMLEDIT_INST_DESKTOP_DIR
+}
+isEmpty(INST_DESKTOP_DIR) {
+    INST_DESKTOP_DIR = /usr/share/applications/
+}
+message("Inst desktop data dir $$INST_DESKTOP_DIR")
+
+###########################################
+
 INST_DIR=$$(QXMLEDIT_INST_DIR)
 !isEmpty(QXMLEDIT_INST_DIR) {
     INST_DIR=$$QXMLEDIT_INST_DIR
-- 
2.25.1

