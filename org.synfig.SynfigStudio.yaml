app-id: org.synfig.SynfigStudio
branch: stable
runtime: org.gnome.Platform
runtime-version: '3.28'
sdk: org.gnome.Sdk
command: synfigstudio
rename-appdata-file: synfigstudio.appdata.xml
rename-desktop-file: synfigstudio.desktop
rename-icon: synfig_icon
finish-args:
  - --socket=x11
  - --share=ipc
  - --socket=wayland
  - --filesystem=host
  - --filesystem=xdg-run/dconf
  - --filesystem=~/.config/dconf:ro
  - --talk-name=ca.desrt.dconf
  - --env=DCONF_USER_CONFIG_DIR=.config/dconf
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/aclocal
  - /share/man
  - '*.la'
  - '*.a'
modules:
  - name: sigc++
    config-opts:
      - --disable-documentation
    cleanup:
      - /lib/sigc++-*
    sources:            
      - type: archive
        url: http://ftp.gnome.org/pub/GNOME/sources/libsigc++/2.10/libsigc++-2.10.0.tar.xz
        sha256: f843d6346260bfcb4426259e314512b99e296e8ca241d771d21ac64f28298d81

  - name: glibmm
    config-opts:
      - --disable-documentation
    cleanup:
      - /lib/glibmm-*
      - /lib/giomm-*
    sources: 
      - type: archive
        url: http://ftp.gnome.org/pub/GNOME/sources/glibmm/2.56/glibmm-2.56.0.tar.xz
        sha256: 6e74fcba0d245451c58fc8a196e9d103789bc510e1eee1a9b1e816c5209e79a9

  - name: cairomm
    config-opts:
      - --disable-documentation
    cleanup:
      - /lib/cairomm-*
    sources: 
      - type: archive
        url: http://ftp.gnome.org/pub/GNOME/sources/cairomm/1.12/cairomm-1.12.0.tar.xz
        sha256: a54ada8394a86182525c0762e6f50db6b9212a2109280d13ec6a0b29bfd1afe6

  - name: pangomm
    config-opts:
      - --disable-documentation
    cleanup:
      - /lib/pangomm-*
    sources: 
      - type: archive
        url: http://ftp.gnome.org/pub/GNOME/sources/pangomm/2.40/pangomm-2.40.1.tar.xz
        sha256: 9762ee2a2d5781be6797448d4dd2383ce14907159b30bc12bf6b08e7227be3af

  - name: atkmm
    config-opts:
      - --disable-documentation
    cleanup:
      - /lib/atkmm-*
    sources: 
      - type: archive
        url: http://ftp.gnome.org/pub/GNOME/sources/atkmm/2.24/atkmm-2.24.2.tar.xz
        sha256: ff95385759e2af23828d4056356f25376cfabc41e690ac1df055371537e458bd

  - name: gtkmm
    config-opts:
      - --disable-documentation
    cleanup:
      - /lib/gtkmm-*
      - /lib/gdkmm-*
    sources: 
      - type: archive
        url: http://ftp.gnome.org/pub/GNOME/sources/gtkmm/3.22/gtkmm-3.22.2.tar.xz
        sha256: 91afd98a31519536f5f397c2d79696e3d53143b80b75778521ca7b48cb280090

  - name: libxml++
    config-opts:
      - --disable-documentation
    cleanup:
      - /lib/libxml++-2.6
    sources:
      - type: archive
        url: http://ftp.gnome.org/pub/GNOME/sources/libxml++/2.40/libxml++-2.40.1.tar.xz
        sha256: 4ad4abdd3258874f61c2e2a41d08e9930677976d303653cd1670d3e9f35463e9

  - name: fftw
    config-opts:
      - --disable-static
      - --enable-shared
      - --disable-doc
      - --enable-threads
    cleanup:
      - /bin
    sources:
      - type: archive
        url: http://www.fftw.org/fftw-3.3.8.tar.gz
        sha256: 6113262f6e92c5bd474f2875fa1b01054c4ad5040f6b0da7c03c98821d9ae303
        
  - name: ilmbase
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://download.savannah.nongnu.org/releases/openexr/ilmbase-2.2.1.tar.gz
        sha256: cac206e63be68136ef556c2b555df659f45098c159ce24804e9d5e9e0286609e

  - name: openexr
    config-opts:
      - --disable-static
    cleanup:
      - /bin
      - /share/doc
    sources:
      - type: archive
        url: https://download.savannah.nongnu.org/releases/openexr/openexr-2.2.1.tar.gz
        sha256: 8f9a5af6131583404261931d9a5c83de0a425cb4b8b25ddab2b169fbf113aecd

  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app --with-libraries=chrono,filesystem,iostreams,program_options,system
      - ./b2 -j $FLATPAK_BUILDER_N_JOBS install
    sources:
      - type: archive
        url: https://dl.bintray.com/boostorg/release/1.67.0/source/boost_1_67_0.tar.bz2
        sha256: 2684c972994ee57fc5632e03bf044746f6eb45d4920c343937a465fd67a5adba

  - name: imagemagick
    config-opts:
      - --disable-static
    cleanup:
      - /share/doc
    sources:
      - type: archive
        url: https://github.com/ImageMagick/ImageMagick6/archive/6.9.10-8.tar.gz
        sha256: 82b1c536906228f5021be455e7b2bfbe6af189e0a3b257a7589632e645615815

  - name: libx264
    config-opts:
      - --disable-cli
      - --enable-shared
    sources:
      - type: archive
        url: https://download.videolan.org/x264/snapshots/x264-snapshot-20171223-2245-stable.tar.bz2
        sha256: ee4ba2c3d1caf786ad66d3fa86bdc368a8f827318788a62a9c8444b2c35816bf

  - name: ffmpeg
    config-opts:
      - --enable-gpl
      - --disable-static
      - --enable-shared
      - --disable-doc
      - --disable-ffplay
      - --disable-ffprobe
      - --enable-libopus
      - --enable-libvpx
      - --enable-libx264
    post-install:
      - chrpath -d /app/bin/ffmpeg
    cleanup:
      - /share/ffmpeg/examples
    sources:
      - type: archive
        url: https://ffmpeg.org/releases/ffmpeg-4.0.2.tar.xz
        sha256: a95c0cc9eb990e94031d2183f2e6e444cc61c99f6f182d1575c433d62afb2f97

  - name: mlt
    config-opts:
      - --enable-gpl
      - --enable-gpl3
      - --disable-gtk2
    sources:
      - type: archive
        url: https://github.com/mltframework/mlt/releases/download/v6.10.0/mlt-6.10.0.tar.gz
        sha256: 10642a80f81e12c6cc5405e60ced640b3dd325c793fe73207ae07de321ad6810

  - name: ETL
    sources:
      - type: archive
        url: https://github.com/synfig/synfig/releases/download/v1.2.1/ETL-1.2.1.tar.gz
        sha256: 754d88c5ddfdef54f27d1e17f62a902eb9f09fbe7ef9aebded34541b4c1700e6

  - name: synfig
    config-opts:
      - --with-boost=/app
    sources:
      - type: archive
        url: https://github.com/synfig/synfig/releases/download/v1.2.1/synfig-1.2.1.tar.gz
        sha256: 4d8bada4e99f05ee16b4256fc3f5a551d00a745347944837bbd6fa158b57e457

  - name: synfigstudio
    post-install:
      - mv /app/share/mime/packages/synfigstudio.xml /app/share/mime/packages/org.synfig.SynfigStudio.xml
    sources:
      - type: archive
        url: https://github.com/synfig/synfig/releases/download/v1.2.1/synfigstudio-1.2.1.tar.gz
        sha256: 1a97875e0039895604085649bcd30cf0d6165f4c865299ca13d45d2dfbfab05d
