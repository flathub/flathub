id: org.webkitgtk.BaseApp
branch: "20.08"
sdk: org.freedesktop.Sdk
runtime: org.freedesktop.Platform
runtime-version: "20.08"
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=all
  - --share=network
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=ca.desrt.dconf
  - --filesystem=xdg-run/dconf
  - --filesystem=xdg-config/dconf:ro
cleanup:
  - "*.a"
  - /share/man
  - /share/help
modules:

  - name: webkitgtk
    buildsystem: cmake-ninja
    builddir: true
    build-options:
      cflags: "-g1"
      cxxflags: "-g1"
    config-opts:
      - -DPORT=GTK
      - -DCMAKE_BUILD_TYPE=Release
      - -DENABLE_PLUGIN_PROCESS_GTK2=OFF
      - -DENABLE_GTKDOC=OFF
      - -DENABLE_MINIBROWSER=OFF
      - -DPYTHON_EXECUTABLE=/usr/bin/python3
    sources:
      - type: archive
        url: "https://webkitgtk.org/releases/webkitgtk-2.24.1.tar.xz"
        sha256: 53cb8eaad2ca4caaae663d68331b83fd27d5bd5f6c5388d6ea3c455e338f396d
        x-checker-data:
          type: html
          url: https://webkitgtk.org/releases/
          version-pattern: LATEST-STABLE-(\d[\.\d]+\d)
          url-template: https://webkitgtk.org/releases/webkitgtk-$version.tar.xz
          is-main-source: true
    modules:

      - name: libsecret
        sources:
          - type: archive
            url: "https://download.gnome.org/sources/libsecret/0.18/libsecret-0.18.8.tar.xz"
            sha256: 3bfa889d260e0dbabcf5b9967f2aae12edcd2ddc9adc365de7a5cc840c311d15
            x-checker-data:
              type: gnome
              name: libsecret

      - name: enchant
        sources:
          - type: archive
            url: "https://github.com/AbiWord/enchant/releases/download/v2.2.3/enchant-2.2.3.tar.gz"
            sha256: abd8e915675cff54c0d4da5029d95c528362266557c61c7149d53fa069b8076d
            x-checker-data:
              type: json
              url: https://api.github.com/repos/AbiWord/enchant/releases/latest
              version-query: .tag_name | sub("^[vV]"; "")
              url-query: .assets[] | select(.name=="enchant-\($version).tar.gz") | .browser_download_url

      - name: libnotify
        sources:
          - type: archive
            url: "https://download.gnome.org/sources/libnotify/0.7/libnotify-0.7.8.tar.xz"
            sha256: 69209e0b663776a00c7b6c0e560302a8dbf66b2551d55616304f240bba66e18c
            x-checker-data:
              type: gnome
              name: libnotify
              stable-only: false
        modules:

          - name: gnome-common
            sources:
              - type: archive
                url: "https://download.gnome.org/sources/gnome-common/3.18/gnome-common-3.18.0.tar.xz"
                sha256: 22569e370ae755e04527b76328befc4c73b62bfd4a572499fde116b8318af8cf
                x-checker-data:
                  type: gnome
                  name: gnome-common

      - name: woff2
        buildsystem: cmake-ninja
        sources:
          - type: archive
            archive-type: tar-gzip
            url: "https://github.com/google/woff2/archive/v1.0.2.tar.gz"
            sha256: add272bb09e6384a4833ffca4896350fdb16e0ca22df68c0384773c67a175594
            x-checker-data:
              type: json
              url: https://api.github.com/repos/google/woff2/releases/latest
              version-query: .tag_name | sub("^[vV]"; "")
              url-query: '"https://github.com/google/woff2/archive/v\($version)/woff2-\($version).tar.gz"'
