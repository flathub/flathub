id: org.webkitgtk.BaseApp
branch: '20.08'
sdk: org.freedesktop.Sdk
runtime: org.freedesktop.Platform
runtime-version: '20.08'
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=all
  - --share=network
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=ca.desrt.dconf
  - --filesystem=xdg-run/dconf
  - --filesystem=xdg-config/dconf:ro
cleanup:
  - '*.a'
  - /share/man
  - /share/help
modules:

  - name: webkitgtk
    buildsystem: cmake-ninja
    builddir: true
    build-options:
      cflags: -g1
      cxxflags: -g1
    config-opts:
      - -DPORT=GTK
      - -DCMAKE_BUILD_TYPE=Release
      - -DENABLE_PLUGIN_PROCESS_GTK2=OFF
      - -DENABLE_GTKDOC=OFF
      - -DENABLE_MINIBROWSER=OFF
      - -DENABLE_GAMEPAD=OFF
      - -DPYTHON_EXECUTABLE=/usr/bin/python3
      - -DUSE_WPE_RENDERER=ON
    sources:
      - type: archive
        url: https://webkitgtk.org/releases/webkitgtk-2.32.0.tar.xz
        sha256: 9d7df4dae9ada2394257565acc2a68ace9308c4c61c3fcc00111dc1f11076bf0
        x-checker-data:
          type: html
          url: https://webkitgtk.org/releases/
          version-pattern: LATEST-STABLE-(\d[\.\d]+\d)
          url-template: https://webkitgtk.org/releases/webkitgtk-$version.tar.xz
          is-main-source: true
    modules:

      - name: libsecret
        sources:
          - type: archive
            url: https://download.gnome.org/sources/libsecret/0.20/libsecret-0.20.4.tar.xz
            sha256: 325a4c54db320c406711bf2b55e5cb5b6c29823426aa82596a907595abb39d28
            x-checker-data:
              type: gnome
              name: libsecret

      - name: enchant
        sources:
          - type: archive
            url: https://github.com/AbiWord/enchant/releases/download/v2.2.15/enchant-2.2.15.tar.gz
            sha256: 3b0f2215578115f28e2a6aa549b35128600394304bd79d6f28b0d3b3d6f46c03
            x-checker-data:
              type: json
              url: https://api.github.com/repos/AbiWord/enchant/releases/latest
              version-query: .tag_name | sub("^[vV]"; "")
              url-query: .assets[] | select(.name=="enchant-\($version).tar.gz") |
                .browser_download_url

      - name: libnotify
        buildsystem: meson
        config-opts:
          - -Dtests=false
          - -Dman=false
          - -Dgtk_doc=false
          - -Ddocbook_docs=disabled
        sources:
          - type: archive
            url: https://download.gnome.org/sources/libnotify/0.7/libnotify-0.7.9.tar.xz
            sha256: 66c0517ed16df7af258e83208faaf5069727dfd66995c4bbc51c16954d674761
            x-checker-data:
              type: gnome
              name: libnotify
              stable-only: false
        modules:

          - name: gnome-common
            sources:
              - type: archive
                url: https://download.gnome.org/sources/gnome-common/3.18/gnome-common-3.18.0.tar.xz
                sha256: 22569e370ae755e04527b76328befc4c73b62bfd4a572499fde116b8318af8cf
                x-checker-data:
                  type: gnome
                  name: gnome-common

      - name: woff2
        buildsystem: cmake-ninja
        sources:
          - type: archive
            archive-type: tar-gzip
            url: https://github.com/google/woff2/archive/v1.0.2/woff2-1.0.2.tar.gz
            sha256: add272bb09e6384a4833ffca4896350fdb16e0ca22df68c0384773c67a175594
            x-checker-data:
              type: json
              url: https://api.github.com/repos/google/woff2/releases/latest
              version-query: .tag_name | sub("^[vV]"; "")
              url-query: '"https://github.com/google/woff2/archive/v\($version)/woff2-\($version).tar.gz"'

      - name: wpebackend-fdo
        buildsystem: meson
        sources:
          - type: archive
            url: https://github.com/Igalia/WPEBackend-fdo/releases/download/1.8.3/wpebackend-fdo-1.8.3.tar.xz
            sha256: 3d0b4282a1bd9e0664d7a20abe14e982f3285296ac62de56cae2a404b9d28b9e
            x-checker-data:
              type: json
              url: https://api.github.com/repos/Igalia/WPEBackend-fdo/releases/latest
              version-query: .tag_name | sub("^[vV]"; "")
              url-query: .assets[] | select(.name=="wpebackend-fdo-\($version).tar.xz") |
                .browser_download_url
        modules:

          - name: libwpe
            buildsystem: cmake-ninja
            sources:
              - type: archive
                url: https://github.com/WebPlatformForEmbedded/libwpe/releases/download/1.10.0/libwpe-1.10.0.tar.xz
                sha256: 2415e270d45e3595ed4052bc105f733744dc2d3677e12ff4a831e5029841084d
                x-checker-data:
                  type: json
                  url: https://api.github.com/repos/WebPlatformForEmbedded/libwpe/releases/latest
                  version-query: .tag_name | sub("^[vV]"; "")
                  url-query: .assets[] | select(.name=="libwpe-\($version).tar.xz") |
                    .browser_download_url
