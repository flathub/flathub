app-id: io.github.cmus.cmus
runtime: org.freedesktop.Platform
runtime-version: '19.08'
sdk: org.freedesktop.Sdk
command: cmus
finish-args:
  - --socket=pulseaudio
  - --filesystem=xdg-music
  - --filesystem=/media
  - --filesystem=/run/media
  - --own-name=org.mpris.MediaPlayer2.cmus

modules:
  - name: faad2
    sources:
      - type: archive
        url: https://github.com/knik0/faad2/archive/2_10_0.tar.gz
        sha512: 92c8b5e79f85b7a7caac9e7954959c26d74ef148a658dcb37e2c1b303fc2fcc5a0d12f21e7bd476870498109bdd03916a56c13f578186a69d6eceb103222e771

  - name: libmad
    sources:
      - type: archive
        url: ftp://ftp.mars.org/pub/mpeg/libmad-0.15.1b.tar.gz
        sha512: 2cad30347fb310dc605c46bacd9da117f447a5cabedd8fefdb24ab5de641429e5ec5ce8af7aefa6a75a3f545d3adfa255e3fa0a2d50971f76bc0c4fc0400cc45
      - type: patch
        path: libmad-optimize.diff

  - name: libmp4v2
    sources:
      - type: archive
        url: https://github.com/TechSmith/mp4v2/archive/Release-ThirdParty-MP4v2-4.1.3.tar.gz
        sha512: 6cb63997ae7a162f91f11872f5a42e10305cf57fe52989650c8817daab94f079518668f408719d2df4e64047987679e3d82a5dd202ea69cc9fe4b7b5c84fbe11
      - type: patch
        path: libmp4v2-c++11.patch

  - name: libmodplug
    sources:
      - type: archive
        url: https://download.sourceforge.net/project/modplug-xmms/libmodplug/0.8.9.0/libmodplug-0.8.9.0.tar.gz
        sha512: 880e10154fd367ee24ace53ca7e32a5c1fee7dfff1f934e6499944c12779427da63e2f55f8d6ce25db0a42a5b4424053bf64305b31dbfc4ef6a8909924d655fd

  # Instruction taken from org.freac.freac.json
  - name: musepack
    buildsystem: autotools
    config-opts:
      - LDFLAGS=-Wl,--allow-multiple-definition
    sources:
      - type: archive
        url: https://files.musepack.net/source/musepack_src_r475.tar.gz
        sha256: a4b1742f997f83e1056142d556a8c20845ba764b70365ff9ccf2e3f81c427b2b
      - type: shell
        commands: 
          - touch include/config.h.in
          - head -n 34 configure.in >> configure.ac
          - echo "AM_CONDITIONAL([HAVE_VISIBILITY], [false])" >> configure.ac
          - echo "AC_CHECK_LIB([m],[cos])" >> configure.ac
          - tail -n 18 configure.in >> configure.ac
          - rm configure.in
          - autoreconf -i

  - name: opus
    cleanup:
      - /share/aclocal
    config-opts:
      - --disable-doc
      - --disable-extra-programs
    sources:
      - type: archive
        url: https://archive.mozilla.org/pub/opus/opus-1.3.1.tar.gz
        sha512: 6cd5e4d8a0551ed5fb59488c07a5cc18a241d1fde5f9eb9f16cd4e77abcdb4134dd51ad1d737be1e6039bfa56912510b8648152f2478a1f21c7c1d9ce32933cd

  - name: opusfile
    config-opts:
      - --disable-doc
      - --disable-examples
    sources:
      - type: archive
        url: https://downloads.xiph.org/releases/opus/opusfile-0.12.tar.gz
        sha512: e25e6968a3183ac0628ce1000840fd6f9f636e92ba984d6a72b76fb2a98ec632d2de4c66a8e4c05ef30655c2a4a13ab35f89606fa7d79a54cfa8506543ca57af

  - name: cmus
    sources:
      - type: archive
        url: https://github.com/cmus/cmus/archive/v2.8.0.tar.gz
        sha512: cf359dfcefa833a5b10a2d16ac405672bea762b62b7177c115560127035682fba65c15b9a8710179a343d1f99212a0260b5c095542982202e2cd1bef5b0c17fc
      - type: patch
        path: configure.patch
