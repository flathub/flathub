app-id: com.outerwildsmods.owmods_cli

runtime: org.freedesktop.Platform
runtime-version: "22.08"

sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.mono6
  - org.freedesktop.Sdk.Extension.rust-stable

command: owmods

build-options:
  append-path: /usr/lib/sdk/rust-stable/bin

finish-args:
  - --share=network
  - --filesystem=/tmp:rw
  - --filesystem=~/.steam/steam/steamapps/common/Outer Wilds/:rw

modules:
  - name: Mono
    buildsystem: simple
    build-commands:
      - bash /usr/lib/sdk/mono6/install.sh
      - cp -ar /usr/lib/sdk/mono6/lib/mono/gac/System.Windows.Forms /app/lib/mono/gac
  - name: owmods_cli
    sources:
      - type: git
        url: https://github.com/Bwc9876/ow-mod-man/
        tag: cli_v0.4.0
        commit: 0ef628d6c210b52dc0e8e2721965c63ee2065540
        x-checker-data:
          type: git
          tag-pattern: ^cli_v((?:\d+.)*\d+)$
      - type: file
        path: com.outerwildsmods.owmods_cli.metainfo.xml
      - cargo-sources.json
    buildsystem: simple
    build-options:
      env:
        CARGO_HOME: /run/build/owmods_cli/cargo
    build-commands:
      - cargo --offline fetch
      - cargo --offline build -p owmods_cli --release
      - install -Dm644 -t /app/share/metainfo/ com.outerwildsmods.owmods_cli.metainfo.xml
      - install -Dm755 -t /app/bin/ target/release/owmods
