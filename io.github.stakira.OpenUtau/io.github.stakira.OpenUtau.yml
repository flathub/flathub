id: io.github.stakira.OpenUtau
runtime: org.freedesktop.Platform
runtime-version: "23.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.dotnet6
command: openutau-wrapper
rename-icon: io.github.stakira.OpenUtau

finish-args:
  # Audio support
  - --socket=pulseaudio
  # GUI support
  - --socket=x11
  - --socket=wayland
  - --share=ipc
  # File system access for projects and voicebanks
  - --filesystem=home
  # Network access for updates and downloads
  - --share=network
  # Device access for audio devices
  - --device=all

modules:
  # .NET 6 Runtime Module
  - name: dotnet-runtime
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/dotnet6/bin/install.sh

  # OpenUTAU Application
  - name: openutau
    buildsystem: simple
    build-commands:
      # Copy the application files (archive is already extracted)
      - mkdir -p /app/lib/openutau
      - cp -r * /app/lib/openutau/

      # Make the main executable accessible
      - chmod +x /app/lib/openutau/OpenUtau

      # Install wrapper script
      - install -Dm755 openutau-wrapper /app/bin/openutau-wrapper

      # Install desktop file
      - install -Dm644 io.github.stakira.OpenUtau.desktop /app/share/applications/io.github.stakira.OpenUtau.desktop

      # Install AppStream metadata
      - install -Dm644 io.github.stakira.OpenUtau.metainfo.xml /app/share/metainfo/io.github.stakira.OpenUtau.metainfo.xml

      # Install icon
      - install -Dm644 openutau.svg /app/share/icons/hicolor/scalable/apps/io.github.stakira.OpenUtau.svg

    sources:
      # OpenUTAU binary release
      - type: archive
        url: https://github.com/stakira/OpenUtau/releases/download/build/0.1.529/OpenUtau-linux-x64.tar.gz
        sha256: b40bd3dcb86522ef3f33dfe3cd3b77927db7be4fd80fd5685b6997270db073f8

      # Application icon
      - type: file
        url: https://raw.githubusercontent.com/stakira/OpenUtau/master/Logo/openutau.svg
        sha256: 490fd7489bb3c4225c3f2d1e96ba8320bd481da6eb031b97229dcf06997c2f5b

      # Wrapper script
      - type: file
        path: openutau-wrapper

      # Desktop file
      - type: file
        path: io.github.stakira.OpenUtau.desktop

      # AppStream metadata
      - type: file
        path: io.github.stakira.OpenUtau.metainfo.xml
