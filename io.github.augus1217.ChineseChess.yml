app-id: io.github.augus1217.ChineseChess
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '23.08'
command: chinese-chess
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=network
  - --device=dri
  # 允許存取設定檔等
  - --filesystem=xdg-run/app/${FLATPAK_ID}:create

modules:
  - name: chinese-chess
    buildsystem: simple
    build-commands:
      # 解壓縮 deb 檔案 (ar x) 並解包 data.tar.xz
      - ar x chinese-chess.deb
      - tar -xf data.tar.xz
      # 安裝主程式到 /app/bin
      - install -d /app/bin
      - cp -r opt/Chinese-Chess/* /app/bin/
      # 安裝啟動腳本
      - install -D -m 755 chinese-chess.sh /app/bin/chinese-chess
      # 安裝圖示與 Desktop 檔案 (假設 deb 中有，若無則需手動指定)
      - install -D -m 644 usr/share/icons/hicolor/512x512/apps/chinese-chess-by-augus.png /app/share/icons/hicolor/512x512/apps/io.github.augus1217.ChineseChess.png
      - install -D -m 644 usr/share/applications/chinese-chess-by-augus.desktop /app/share/applications/io.github.augus1217.ChineseChess.desktop
      # 修正 Desktop 檔案中的 Exec 和 Icon
      - sed -i 's|^Exec=.*|Exec=chinese-chess|' /app/share/applications/io.github.augus1217.ChineseChess.desktop
      - sed -i 's|^Icon=.*|Icon=io.github.augus1217.ChineseChess|' /app/share/applications/io.github.augus1217.ChineseChess.desktop
      # 確保 cpu_features_linux 有執行權限
      - chmod +x /app/bin/resources/app/api/cpu_features_linux
    sources:
      - type: file
        path: chinese-chess.sh
      - type: file
        # 注意：提交時請將此 URL 替換為您 GitHub Release 的真實 .deb 下載連結
        url: https://github.com/Augus1217/Chinese-Chess/releases/download/v1.5.0/chinese-chess-by-augus_1.5.0_amd64.deb
        # 注意：提交時請填入該 .deb 檔案的 SHA256
        sha256: 7d2b3769b157b6b39c2a56e4b3c0b4f8163a14a7f77ec2d23a481b7745524ea3
        dest-filename: chinese-chess.deb
