id: io.neovim.nvim.tool.ripgrep
runtime: io.neovim.nvim
runtime-version: stable
sdk: org.freedesktop.Sdk//23.08
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
build-extension: true
appstream-compose: false
build-options:
  append-path: "/usr/lib/sdk/rust-stable/bin"
  env:
    RUSTFLAGS: "-g"
  prefix: "/app/tools/ripgrep"
modules:
  - name: ripgrep
    buildsystem: simple
    build-options:
      env:
        CARGO_HOME: "/run/build/ripgrep/cargo"
    build-commands:
      - cargo --offline fetch --manifest-path Cargo.toml --verbose
      - cargo --offline build --release --verbose --features pcre2
      - install -Dm755 ./target/release/rg -t ${FLATPAK_DEST}/bin/
      - install -Dm0644 ${FLATPAK_ID}.metainfo.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml
      - appstream-compose --basename=${FLATPAK_ID} --prefix=${FLATPAK_DEST} --origin=flatpak ${FLATPAK_ID}
    sources:
      - type: git
        url: https://github.com/BurntSushi/ripgrep.git
        tag: 14.1.0
        commit: e50df40a1967708b9781486b1c017e48040bceb0
        x-checker-data:
          type: json
          url: https://api.github.com/repos/BurntSushi/ripgrep/releases/latest
          tag-query: ".tag_name"
          timestamp-query: ".published_at"
          is-main-source: true
      - generated-sources.json
      - type: file
        path: io.neovim.nvim.tool.ripgrep.metainfo.xml
