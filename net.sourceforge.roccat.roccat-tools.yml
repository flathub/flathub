app-id: net.sourceforge.roccat.roccat-tools
runtime: org.gnome.Platform
sdk:  org.gnome.Sdk
runtime-version: '44'

finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=x11
  - --device=all
  - --device=dri
  # necessary for audio feedback
  # - --socket=pulseaudio
  # - --socket=session-bus
rename-icon: roccat

modules:
  - shared-modules/lua5.4/lua-5.4.json
  - shared-modules/libcanberra/libcanberra.json
  - shared-modules/gtk2/gtk2.json
  - shared-modules/dbus-glib/dbus-glib.json

  - name: libgaminggear
    buildsystem: cmake
    config-opts:
      - -DCMAKE_C_FLAGS=-isystem /usr/include/harfbuzz
      - -DINSTALL_PKGCONFIGDIR=/app/lib/pkgconfig
      - -DINSTALL_CMAKE_MODULESDIR=/app/lib/cmake
      - -DCMAKE_INSTALL_PREFIX=/app
      - -DINSTALL_LIBDIR=/app/lib
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/libgaminggear/libgaminggear-0.15.1.tar.bz2
        sha1: 78cf02ae89cb0e4d8276cfef7da78a49c7c83a44

  - name: roccat-tools
    buildsystem: cmake
    config-opts:
      - -DCMAKE_C_FLAGS=-isystem /usr/include/harfbuzz
      - -DINSTALL_PKGCONFIGDIR=/app/lib/pkgconfig
      - -DINSTALL_CMAKE_MODULESDIR=/app/lib/cmake
      - -DCMAKE_MODULE_PATH=/app/lib/cmake
      - -DCMAKE_INSTALL_PREFIX=/app
      - -DINSTALL_LIBDIR=/app/lib
      - -DUDEVDIR=/app/lib/udev
      - -DLIBDIR=/app/lib
      - -DWITH_LUA=5.4
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/roccat/roccat-tools/roccat-tools-5.9.0.tar.bz2
        sha1: 802a694ab5a10f53c5c97defc4bfc26b5f1f2b8c
      - type: patch
        path: patches/ryos-device-h.patch
      - type: patch
        path: patches/disable-roccateventhandler-desktop-install.patch
      - type: file
        path: net.sourceforge.roccat.roccat-tools.desktop
      - type: file
        path: net.sourceforge.roccat.roccat-tools.metainfo.xml
    post-install:
      # Install metainfo
      - install -Dm644 net.sourceforge.roccat.roccat-tools.metainfo.xml /app/share/metainfo/net.sourceforge.roccat.roccat-tools.metainfo.xml
      # Rename desktop files
      - cd /app/share/applications/ && for desktop_filename in *; do mv "$desktop_filename" "net.sourceforge.roccat.roccat-tools.$desktop_filename"; done;
      - cd /app/share/applications/ && for desktop_filename in *; do desktop-file-edit --set-key Icon --set-value $FLATPAK_ID "$desktop_filename"; done;
      - install -Dm755 net.sourceforge.roccat.roccat-tools.desktop -t /app/share/applications/
