name: ffms2
modules:
  - name: ffms2
    buildsystem: autotools
    build-options:
      strip: true
    config-opts:
      - --prefix=${FLATPAK_DEST}
      # TODO: Staticly link ffms2 and ffmpeg with aegisub.
      # - --disable-static
      # - --enable-shared
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://github.com/FFMS/ffms2.git
        # TODO: Wait for a new release to use it's tag.
        # tag: "2.40"
        commit: f20827cf280b669321cd5b62e01d744bc68c21fc
        # x-checker-data:
        #   type: git
        #   tag-pattern: ^[0-9]+\.[0-9]+$
    modules:
      - name: ffmpeg
        buildsystem: autotools
        build-options:
          strip: true
        config-opts:
          - --prefix=${FLATPAK_DEST}
          # Should be ok, since ffms2 binaries are GPL.
          - --enable-gpl
          # TODO: Consider using GPLv3.
          - --enable-version3
          - --enable-static
          - --enable-shared
          - --enable-lto
          # No CLI tool is used.
          - --disable-programs
          # No docs are needed in flatpak.
          - --disable-doc
          # Those components are not used in ffms2.
          # TODO: Consider this (libswresample & libavcodec are installed in ffms2's CI build):
          - --disable-avdevice
          - --disable-avcodec
          - --disable-swresample
          - --disable-postproc
          - --disable-avfilter
          - --disable-network
          # FFMS2 doens't do any encoding, hwaccel, muxing, filtering or use devices.
          - --disable-encoders
          - --disable-hwaccels
          - --disable-muxers
          - --disable-filters
          - --disable-devices
          # External library support:
          - --disable-alsa
          - --disable-iconv
          # TODO: Considor using `aom` over `dav1d`.
          # - --enable-libaom # AV1 video decoding via libaom
          - --enable-libdav1d # AV1 decoding via libdav1d
          - --enable-libjxl # JPEG XL decoding via libjxl
          - --enable-libopenjpeg # JPEG 2000 decoding via OpenJPEG
          # FIX: Enable libvpx (can't be detected by ffmpeg)
          # - --enable-libvpx # VP8 and VP9 decoding via libvpx
          # Developer options:
          - --disable-debug
        cleanup:
          - /share/ffmpeg
        sources:
          - type: git
            url: https://github.com/FFmpeg/FFmpeg.git
            mirror-urls:
              - https://git.ffmpeg.org/ffmpeg.git
            tag: n6.1
            commit: d4ff0020b40b524a490cf62eccbd3a318f4c0e58
            x-checker-data:
              type: git
              tag-pattern: ^n([\d.]{3,7})$
        # modules:
        #   - name: libvpx
        #     buildsystem: autotools
        #     config-opts:
        #       - --prefix=${FLATPAK_DEST}
        #       - --disable-shared
        #       - --enable-static
        #       - --disable-examples
        #       - --disable-tools
        #       - --disable-docs
        #       - --disable-install-docs
        #       - --disable-install-srcs
        #       - --disable-install-bins
        #       - --disable-unit-tests
        #       - --enable-pic
        #       - --enable-postproc
        #       - --enable-runtime-cpu-detect
        #       - --enable-shared
        #       - --enable-vp8
        #       - --enable-vp9
        #       - --enable-vp9-postproc
        #       - --enable-vp9-highbitdepth
        #       - --enable-vp9-temporal-denoising
        #     sources:
        #       - type: git
        #         url: https://chromium.googlesource.com/webm/libvpx
        #         tag: v1.13.1
        #         commit: 10b9492dcf05b652e2e4b370e205bd605d421972
        #         x-checker-data:
        #           type: git
        #           version-scheme: semantic
