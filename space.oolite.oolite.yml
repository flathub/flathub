app-id: space.oolite.oolite
runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
command: oolite
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --share=network
  - --socket=pulseaudio
  - --device=dri
  - --persist=GNUstep
  - --persist=oolite-saves
modules:
  - name: espeak-ng
    cleanup:
      - "*.la"
    no-parallel-make: true
    build-options:
      ldflags: "-Wl,--allow-multiple-definition"
    sources:
      - type: git
        url: "https://github.com/espeak-ng/espeak-ng.git"
        tag: "1.52.0"
        commit: "4870adfa25b1a32b4361592f1be8a40337c58d6c"
    post-install:
      - "ln -s /app/lib/libespeak-ng.so /app/lib/libespeak.so"
      - "ln -s /app/lib/libespeak-ng.a /app/lib/libespeak.a"
  - shared-modules/SDL/sdl12-compat.json
  - name: "gnustep-make"
    buildsystem: "autotools"
    sources: 
      - type: "archive"
        url: "https://github.com/gnustep/tools-make/archive/make-2_9_3.tar.gz"
        sha256: "aad12caecb0398b099f3b8b0282cecc3f01a9f371200641b2e1e535ae6ee2543"
        x-checker-data: 
          type: "anitya"
          project-id: 1220
          stable-only: true
          url-template: "https://github.com/gnustep/tools-make/archive/make-$version.tar.gz"
    cleanup:
      - '*'
  - name: gnustep-base
    buildsystem: autotools
    sources:
      - type: archive
        url: "https://github.com/gnustep/libs-base/releases/download/base-1_28_1/gnustep-base-1.28.1.tar.gz"
        sha256: 7e71b26970b229dd9e90332417f4c5e82630fd16c41c1f20c0a5bf0620435602
      - type: patch
        path: gnustep-base-libxml2-compat.patch
  - name: oolite
    buildsystem: simple
    build-commands:
      - rm deps/Linux-deps/include/png.h deps/Linux-deps/include/pngconf.h
      - make -f GNUmakefile debug=no strip=no -j$(nproc) GNUSTEP_MAKEFILES=/app/share/GNUstep/Makefiles OBJCFLAGS="-Wno-incompatible-pointer-types"
      - cp -r oolite.app/* /app/bin
      - install -D space.oolite.oolite.metainfo.xml /app/share/metainfo/space.oolite.oolite.metainfo.xml
      - install -D oolite-icon.png /app/share/icons/hicolor/256x256/apps/space.oolite.oolite.png
      - install -D oolite.desktop /app/share/applications/space.oolite.oolite.desktop
    sources:
      - type: git
        url: https://github.com/OoliteProject/oolite.git
        commit: 0b1ff49a78653669bfe8e153ae09699ba49cc496 
      - type: file
        path: space.oolite.oolite.metainfo.xml
      - type: file
        path: oolite-icon.png
      - type: file
        path: oolite.desktop
