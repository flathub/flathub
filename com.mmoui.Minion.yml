app-id: com.mmoui.Minion
runtime: org.freedesktop.Platform
runtime-version: '22.08'
command: minion.sh
sdk: org.freedesktop.Sdk
tags:
  - proprietary
modules:
  # Azul Zulu JRE FX for running Minion as it supports JFX out of the box
  - name: java-8-runtime
    buildsystem: simple
    build-commands:
      - mkdir -p                         /app/java/jre
      - cp -r jre-11.0.17-full/{bin,lib} /app/java/jre
    sources:
      - type: archive
        url: https://cdn.azul.com/zulu/bin/zulu8.66.0.15-ca-fx-jre8.0.352-linux_x64.tar.gz
        sha256: f3578ddb8fc53053d6c12507c7235e777d6a104d85f8b104fa043c81978d0cb9
        only-arches: x86_64
      - type: archive
        url: https://cdn.azul.com/zulu/bin/zulu8.66.0.15-ca-fx-jre8.0.352-linux_x64.tar.gz
        sha256: 2a2269e04716ddfb29404a3c5ba8a766b744dbac16c8df9c879adf3ea308d942
        only-arches: aarch64
  - name: minion
    buildsystem: simple
    build-commands:
      - install -Dm755 apply-extra        /app/bin/apply_extra
      - install -D minion.sh              /app/bin/minion.sh
      - install -D 48.png                 /app/share/icons/hicolor/48x48/apps/com.mmoui.Minion.png
      - install -D 64.png                 /app/share/icons/hicolor/64x64/apps/com.mmoui.Minion.png
      - install -D 96.png                 /app/share/icons/hicolor/96x96/apps/com.mmoui.Minion.png
      - install -D 128.png                /app/share/icons/hicolor/128x128/apps/com.mmoui.Minion.png
      - install -D $FLATPAK_ID.desktop -t /app/share/applications
    sources:
      - type: extra-data
        filename: Minion.zip
        sha256: 0098613cce6e3b99decc45e6ecf6b71c4b8eed7fe0cd991611d6df5a7093bc1b
        size: 7475461
        url: https://cdn.mmoui.com/minion/v3/Minion3.0.5-java.zip
        x-checker-data:
          type: html
          url: https://minion.mmoui.com/?download
          pattern: "href=\"(https://cdn.mmoui.com/minion/v3/(Minion[\\d.]+)-java.zip)\""
      - type: script
        dest-filename: apply-extra
        commands:
          - unzip Minion.zip
      - type: dir
        path: icons
      - type: file
        path: com.mmoui.Minion.desktop
      - type: script
        dest-filename: minion.sh
        commands:
          # If someone does press udpate it won't create a null folder + it won't hang the application
          - cd /tmp
          - java -jar /app/extra/Minion-jfx.jar
finish-args:
  - --env=PATH=$PATH:/app/java/jre/bin:/app/bin
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --socket=fallback-x11
  - --share=network
  - --device=dri
  - --filesystem=host
  - --filesystem=~/.var/app/com.valvesoftware.Steam
