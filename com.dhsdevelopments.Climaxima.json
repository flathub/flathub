{
    "app-id": "com.dhsdevelopments.Climaxima",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "18.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "clim-maxima",
    "modules": [
        {
            "name": "sbcl",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://prdownloads.sourceforge.net/sbcl/sbcl-1.5.3-x86-64-linux-binary.tar.bz2",
                    "sha256": "6fbd04e6fc81bc3b755372ba02410bc52466301b571337ff0a5f2b0ede6d76dc"
                },
                { "type": "file", "path": "ql.tar.gz" },
                { "type": "file", "path": "sbclrc" }
            ],
            "build-options": {
                "env": { "BUILD_ROOT": "/app/sbcl" }
            },
            "build-commands": [
                "sh install.sh",
                "zcat ql.tar.gz | (cd /app && tar xf -)",
                "mkdir /app/tools",
                "cp sbclrc /app/tools/sbcl-init.lisp"
            ]
        },
        {
            "name": "gnuplot",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://downloads.sourceforge.net/project/gnuplot/gnuplot/5.2.7/gnuplot-5.2.7.tar.gz",
                    "sha256": "97fe503ff3b2e356fe2ae32203fc7fd2cf9cef1f46b60fe46dc501a228b9f4ed"
                }
            ]
        },
        {
            "name": "mupdf",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://mupdf.com/downloads/archive/mupdf-1.15.0-source.tar.xz",
                    "sha1": "dc5b40405b9a497e37370e26b2a8b115c944fe8a"
                }
            ],
            "build-commands": [
                "make HAVE_X11=no HAVE_GLUT=no prefix=/app/mupdf",
                "make HAVE_X11=no HAVE_GLUT=no prefix=/app/mupdf install"
            ]
        },
        {
            "name": "ql-cache",
            "buildsystem": "simple",
            "sources": [
                { "type": "file", "url": "http://beta.quicklisp.org/archive/alexandria/2018-12-10/alexandria-20181210-git.tgz", "sha256": "0815417337258ccf3417a374f2f0222552f643447f6980353834e7c74e7ee035" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/babel/2017-12-27/babel-20171227-git.tgz", "sha256": "2e0b1e1513d2cf61f23f38f4d2b5fec23efecf88cb72b68aff7d07559334de98" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/bitio/2017-10-23/bitio-20171023-git.tgz", "sha256": "5d7338d993456e2d1345adfb88def17b5f044c91c393971029086182463eccc7" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/bordeaux-threads/2018-07-11/bordeaux-threads-v0.8.6.tgz", "sha256": "3ee42f65c46801d9277f37ce2253531164c40ead7fe7b255344f80ef574b6be0" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/cffi/2018-12-10/cffi_0.20.0.tgz", "sha256": "1f55086d6bf7badea03861f0705bf55e6db7a9ec27292479611a5cdc403e54c9" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/chipz/2019-02-02/chipz-20190202-git.tgz", "sha256": "aa58d80c12151f854b647b4d730ca29bba24c57f8954cb9ae777ee2968b568ee" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/cl-fad/2018-04-30/cl-fad-20180430-git.tgz", "sha256": "9a051defe62f5c168003dc1c928d3a5cd74b08b7c831d51562171b2c8637bb9c" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/cl-jpeg/2017-06-30/cl-jpeg-20170630-git.tgz", "sha256": "80460de88b75808fae1ba59824247b4ac6b06e2a4bd5898f9a0542aab6b09ff3" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/closer-mop/2019-05-21/closer-mop-20190521-git.tgz", "sha256": "bbf2ea87597bf8591afa77a86fabd1c1cfdaf98a64a48777b330529b3529e6c8" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/cl-pdf/2017-08-30/cl-pdf-20170830-git.tgz", "sha256": "1a016be0a889d0c29b7fbe5a0d69f6f4c503503bcd59156e10c19561a8999ff4" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/cl-ppcre/2019-05-21/cl-ppcre-20190521-git.tgz", "sha256": "1d4b08ea962612ba92cec7c6f5bb0b8e82efddb91affa0007ada3a95dc66d25c" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/cl-tga/2016-03-18/cl-tga-20160318-git.tgz", "sha256": "7301d299e37a0ca1c3d194f9e664348be7809fae8fe246aa4e7a67d9c0ee6281" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/cl-unicode/2019-05-21/cl-unicode-20190521-git.tgz", "sha256": "ecd90df05f53cec0a33eb504b9d3af0356832ad84cc0ddb3d5dc0dbb70f6405c" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/cl-vectors/2018-02-28/cl-vectors-20180228-git.tgz", "sha256": "9e323de154017df1e4c4831037bedfdc1d8f5de83b744b96cf4865fc9dbc9e39" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/clx/2019-05-21/clx-20190521-git.tgz", "sha256": "1a2379a214516793c8806ec7de566d9920e97a8e515c0e8a53967c6d938e4a67" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/collectors/2016-12-04/collectors-20161204-git.tgz", "sha256": "ee8b0548395a5048372c8c7387d17f42147d2e8448ae47ca4e1aabdcbdf0c231" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/deflate/2018-02-28/deflate-20180228-git.tgz", "sha256": "a1993390c7a58fb0b644805e5b73ae4e2e90093847d2eb857ec25761a576e29e" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/fast-io/2017-10-23/fast-io-20171023-git.tgz", "sha256": "5423e7d677191c96cb8da6c6d575b6011c0f7314fdbf1d89d0e21cbe2d578427" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/flexichain/2010-10-06/flexichain_1.5.1.tgz", "sha256": "cd16ad66cb8496d01b2e2b8ce4717535b628d74a7867b2af2a4c51cb58c24535" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/flexi-streams/2019-01-07/flexi-streams-20190107-git.tgz", "sha256": "259a64ec4f19da7abf64296864a4019daf53c330d1dc9945cefb377df59e13bb" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/ieee-floats/2017-08-30/ieee-floats-20170830-git.tgz", "sha256": "137bc5b3385c35101a6440112757df46570395cdaeed4bf11648353638c18495" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/iterate/2018-02-28/iterate-20180228-git.tgz", "sha256": "2b1e968360ffe6296b8de3c2ad916ab59a92d146bdc4e59a131b9dd3af6ee52f" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/lambda-fiddle/2018-08-31/lambda-fiddle-20180831-git.tgz", "sha256": "397aa0e1c99adc8e674b0b81b61a8c06a19b2777527944e0942a397b86881e0c" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/log4cl/2019-01-07/log4cl-20190107-git.tgz", "sha256": "d7107806e6125bf6449be64bd117827c760375702f12ca2a2c7ec9647ed5af30" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/monkeylib-binary-data/2011-12-03/monkeylib-binary-data-20111203-git.tgz", "sha256": "7abd5f0ccb2cbe54f99f817881dc732ad5ac89cedee1ff231f8bbb6c164e29a3" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/opticl/2018-12-10/opticl-20181210-git.tgz", "sha256": "5b7f88df038b8943849faab14e946198618992b82066cec4616bc129d1f5deae" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/opticl-core/2017-10-19/opticl-core-20171019-git.tgz", "sha256": "9e4bf832abcc73c47d9f183178a706ce8c9406cd9a0a1ea4848eb453de2027c9" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/parsley/2019-05-21/parsley-20190521-git.tgz", "sha256": "2c0aa0c3196a70a5cba0365f5aeae1f68d276ff9ed189dd0acd70d090ea867a0" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/pngload/2019-02-02/pngload-20190202-git.tgz", "sha256": "c651ca3b19de931998ebbea40967b3b4deb62e9701511a9a0bcd077b4999d255" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/retrospectiff/2017-10-19/retrospectiff-20171019-git.tgz", "sha256": "7e73256712da5ca860677b66cb1d682773206b18fbc6417c8e3f7741e9597ca6" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/salza2/2013-07-20/salza2-2.0.9.tgz", "sha256": "6aa36dc25fe2dfb411c03ad62edb39fcbf1d4ca8b45ba17a6ad20ebc9f9e10d4" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/skippy/2015-04-07/skippy-1.3.12.tgz", "sha256": "59bc1ca8204858419f6cf24a55ed26e06f50a60f9decddbe6d3dc970cbae729c" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/slime/2019-01-07/slime-v2.23.tgz", "sha256": "7eeebe719f755039ef3e48496f0097014012d18cf981e735e868e882bd0086d6" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/spatial-trees/2014-08-26/spatial-trees-20140826-git.tgz", "sha256": "422f3f4b239702cbecbc3f88f23aef26ab7b387c4198f4f0dc458bba99793c8f" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/split-sequence/2019-05-21/split-sequence-v2.0.0.tgz", "sha256": "6aa973591b2ba75a07774638f4702cdf329c2aa668e3f7e9866a06fab9ae9525" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/static-vectors/2017-10-19/static-vectors-v1.8.3.tgz", "sha256": "b39b0770ff2dd8e82aef8ffc46fbbd490249907890b0a77d4fabd16e36488620" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/string-case/2018-07-11/string-case-20180711-git.tgz", "sha256": "1fa4add5c0ac553ca0bc5324ee93732a0e0ba2b15ef94f026f11ec45ec8b66d8" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/symbol-munger/2015-04-07/symbol-munger-20150407-git.tgz", "sha256": "66634f8371819d568ccfab58dccf35c96d55b321063e9b85f77b9e5250a48c35" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/trivial-arguments/2018-08-31/trivial-arguments-20180831-git.tgz", "sha256": "b3968380d7472fcd054d8f541e53c52387f5526317aad7858668a54fe0d126b3" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/trivial-features/2016-12-04/trivial-features-20161204-git.tgz", "sha256": "424681538abfa8c5af41fae0099c6e5cb9b05f823a094abba42fcac312f35f44" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/trivial-garbage/2019-05-21/trivial-garbage-20190521-git.tgz", "sha256": "b439d4c011f9b0842c92a32c6cd44c611b94ebb623f0b5397ccfb195673e0b7a" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/trivial-gray-streams/2018-10-18/trivial-gray-streams-20181018-git.tgz", "sha256": "3b921381df112515661c174fafa04adf11cf4620ebd7e2cc1d7bfd548fab2d28" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/zpb-ttf/2013-07-20/zpb-ttf-1.0.3.tgz", "sha256": "4696b7ee85b52328a996d43cbf2fe2968ac07ff75242683a17912f7641033bc7" },
                { "type": "file", "url": "http://beta.quicklisp.org/archive/zpng/2015-04-07/zpng-1.2.2.tgz", "sha256": "3d70a1579930f98655bf56d6cf390ac19a1b076b7bbd807ea82b32cb137e6224" }
            ],
            "build-commands": [
                "mkdir -p /app/quicklisp/dists/quicklisp/archives",
                "cp *.tgz /app/quicklisp/dists/quicklisp/archives"
            ]
        },
        {
            "name": "mcclim",
            "buildsystem": "simple",
            "sources": [
                { "type": "git", "url": "https://github.com/McCLIM/McCLIM", "commit": "e0dafe84596a156d410dbed1254d3a038442921b" }
            ],
            "build-options": {
                "env": {
                    "SBCL_HOME": "/app/sbcl/usr/local/lib/sbcl"
                }
            },
            "build-commands": [
                "cp -ar . /app/McCLIM",
                "ln -s /app/McCLIM /app/quicklisp/local-projects",
                "sed -i 's/\"libfontconfig\\.so\"/(:or \"libfontconfig\\.so\\.1\" \"libfontconfig\\.so\")/' /app/McCLIM/Extensions/fontconfig/src/functions.lisp",
                "sed -i 's/\"libharfbuzz\\.so\"/(:or \"libharfbuzz\\.so\\.0\" \"libharfbuzz\\.so\")/' /app/McCLIM/Extensions/harfbuzz/src/functions.lisp"
            ]
        },
        {
            "name": "cl-freetype2",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/lokedhs/cl-freetype2",
                    "commit": "fe9d8108154cb4f4e46622bcaea4ba6155a3b5af"
                }
            ],
            "build-commands": [
                "cp -ar . /app/cl-freetype2",
                "ln -s /app/cl-freetype2 /app/quicklisp/local-projects"
            ]
        },
        {
            "name": "maxima-code",
            "sources": [
                {
                    "type": "git",
                    "url": "https://git.code.sf.net/p/maxima/code",
                    "commit": "0721ffcd43de13fd288362373edc9681929abed9"
                }
            ],
            "build-options": {
                "env": {
                    "SBCL_HOME": "/app/sbcl/usr/local/lib/sbcl"
                }
            },
            "config-opts": [ "--enable-sbcl", "--with-sbcl=/app/sbcl/usr/local/bin/sbcl" ],
            "build-commands": [ "cp -ar . /app/maxima-code",
                                "ln -s /app/maxima-code /app/quicklisp/local-projects/maxima-code" ]
        },
        {
            "name": "climaxima",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/lokedhs/maxima-client",
                    "commit": "3c198d28f5b036a7b584387a2e2480869026a664"
                },
                { "type": "file", "path": "startup.lisp" },
                { "type": "file", "path": "build.sh" }
            ],
            "build-options": {
                "env": {
                    "SBCL_HOME": "/app/sbcl/usr/local/lib/sbcl"
                }
            },
            "build-commands": [
                "cp -ar . /app/maxima-client-build",
                "ln -s /app/maxima-client-build /app/quicklisp/local-projects/maxima-client-build",
                "cd /app/maxima-client-build && sh build.sh",
                "mkdir /app/maxima-client",
                "cp /app/maxima-client-build/clim-maxima /app/maxima-client",
                "cp -ar /app/maxima-client-build/fonts /app/maxima-client-build/images /app/maxima-client",
                "mkdir /app/maxima-client/infoparser",
                "cp -ar /app/maxima-client-build/infoparser/docs /app/maxima-client-build/infoparser/figures /app/maxima-client/infoparser",
                "mkdir -p /app/bin",
                "ln -s /app/maxima-client/clim-maxima /app/bin/clim-maxima"
            ]
        },
        {
            "name": "desktop-integration",
            "buildsystem": "simple",
            "sources": [ { "type": "file", "path": "com.dhsdevelopments.Climaxima.appdata.xml" },
                         { "type": "file", "path": "com.dhsdevelopments.Climaxima.desktop" } ],
            "build-commands": [
                "mkdir -p /app/share/metainfo",
                "cp com.dhsdevelopments.Climaxima.appdata.xml /app/share/metainfo/com.dhsdevelopments.Climaxima.appdata.xml",
                "mkdir -p /app/share/applications",
                "cp com.dhsdevelopments.Climaxima.desktop /app/share/applications/com.dhsdevelopments.Climaxima.desktop"
            ]
        }
    ],
    "finish-args": [
        "--socket=x11",
        "--share=ipc",
        "--share=network"
    ],
    "cleanup-commands": [
        "rm -fr /app/mupdf",
        "rm -fr /app/McCLIM",
        "rm -fr /app/cl-freetype2",
        "rm -fr /app/quicklisp",
        "rm -fr /app/sbcl",
        "rm -fr /app/tools",
        "rm -fr /app/maxima-client-build"
    ]
}
