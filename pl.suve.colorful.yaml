app-id: pl.suve.colorful

runtime: org.freedesktop.Platform
runtime-version: "23.08"

sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.freepascal

build-options:
  append-path: /usr/lib/sdk/freepascal/bin
  env:
    PPC_CONFIG_PATH: /usr/lib/sdk/freepascal/etc
    FPCDIR: /usr/lib/sdk/freepascal/fpcsrc

command: colorful
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --socket=pulseaudio
  - --device=dri

modules:
  - name: optipng
    sources:
      - type: archive
        url: https://netcologne.dl.sourceforge.net/project/optipng/OptiPNG/optipng-0.7.8/optipng-0.7.8.tar.gz
        sha256: 25a3bd68481f21502ccaa0f4c13f84dcf6b20338e4c4e8c51f2cefbd8513398c
    buildsystem: autotools
    build-options:
      config-opts: 
        - --with-system-libs
    cleanup:
      - '*'

  - name: vorbis-tools
    buildsystem: autotools
    sources:
      - type: archive
        url: https://downloads.xiph.org/releases/vorbis/vorbis-tools-1.4.2.tar.gz
        sha256: db7774ec2bf2c939b139452183669be84fda5774d6400fc57fde37f77624f0b0
    cleanup:
      - '*'

  - name: colorful
    sources:
      - type: archive
        url: https://github.com/suve/LD25/releases/download/release-2.0/colorful-2.0-source.zip
        sha512: c609fa0f73924966f73839050f497d0ec6e425a2bc22878047f81ddd113f082b17686d533514dabd0bc9fbb04ead5909751ec7153b7d9966ef9a70163f23b21c

      # Upstream commit that updates metadata files
      # https://github.com/suve/LD25/commit/0f7861669b9df34f4826f1a6085872d1a3000b5f
      - type: patch
        path: 0f7861669b9df34f4826f1a6085872d1a3000b5f.patch

      # Upstream commit that adds info about releases to metadata
      # https://github.com/suve/LD25/commit/d94d992293aa77c9ae0a8b2c9019f51b5ef21e4b
      - type: patch
        path: d94d992293aa77c9ae0a8b2c9019f51b5ef21e4b.patch

      # Makefile is hardcoded to /usr, switch to /app
      - type: patch
        path: fix-file-paths.patch

    buildsystem: simple
    build-commands:
      - ./configure.sh --assets=systemwide
      - make executable
      - make -j assets
      - make install

    cleanup:
      - /share/man/
