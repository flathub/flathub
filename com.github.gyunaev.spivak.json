{
    "app-id": "com.github.gyunaev.spivak",
    "command": "spivak",
    "rename-desktop-file": "spivak.desktop",
    "rename-icon": "spivak",
    "runtime": "org.kde.Platform",
    "runtime-version": "5.10",
    "sdk": "org.kde.Sdk",
    "finish-args":[
	"--socket=x11",
	"--socket=pulseaudio",
	"--share=network",
	"--device=dri"
    ],
    "cleanup": [
	"/include",
	"/lib/pkgconfig",
	"/lib64/pkgconfig",
	"/share/doc",
	"/share/man",
	"*.a",
	"*.la"
    ],
    "modules":[
	{
	    "name": "cld2",
	    "buildsystem": "simple",
	    "build-commands": [
		"cd internal && CXXFLAGS=\"-std=c++98 $CXXFLAGS\" sh ./compile_libs.sh",
		"install -Dm755 internal/libcld2.so /app/lib/libcld2.so",
		"install -Dm755 internal/libcld2_full.so /app/lib/libcld2_full.so",
		"for header in internal/*.h public/*.h; do install -Dm644 $header /app/include/cld2/$header; done"
	    ],
	    "sources":[
		{
		    "type": "git",
		    "url": "https://github.com/CLD2Owners/cld2.git",
		    "commit": "b56fa78a2fe44ac2851bae5bf4f4693a0644da7b"
		}
	    ]
	},
	{
	    "name": "libzip",
	    "buildsystem": "cmake",
	    "cleanup": ["/bin"],
	    "sources":[
		{
		    "type": "archive",
		    "url": "https://libzip.org/download/libzip-1.4.0.tar.xz",
		    "sha256": "e508aba025f5f94b267d5120fc33761bcd98440ebe49dbfe2ed3df3afeacc7b1"
		}
	    ]
	},
	{
	    "name": "uchardet",
	    "buildsystem": "cmake",
	    "cleanup": ["/bin"],
	    "sources":[
		{
		    "type": "archive",
		    "url": "https://www.freedesktop.org/software/uchardet/releases/uchardet-0.0.6.tar.xz",
		    "sha256": "8351328cdfbcb2432e63938721dd781eb8c11ebc56e3a89d0f84576b96002c61"
		}
	    ]
	},
	{
	    "name": "spivak",
	    "no-parallel-make": true,
	    "sources":[
		{
		    "type": "git",
		    "url": "https://github.com/gyunaev/spivak.git",
		    "tag": "v1.2"
		},
		{
		    "type": "script",
		    "dest-filename": "autogen.sh",
		    "commands": [
			"qmake -r PREFIX=/app QMAKE_LIBDIR=/app/lib CONFIG+=release",
			"touch configure",
			"chmod +x configure"
		    ]
		},
		{
		    "type": "file",
		    "path": "com.github.gyunaev.spivak.appdata.xml"
		}
	    ],
	    "post-install": [
		"mkdir -p /app/bin /app/lib/spivak/plugins /app/share/appdata /app/share/applications /app/share/icons/hicolor/64x64/apps",
		"cp src/spivak /app/bin/spivak",
		"cp plugins/languagedetector/plugin_langdetect.so /app/lib/spivak/plugins/plugin_langdetect.so",
		"cp packaging/spivak.desktop /app/share/applications/spivak.desktop",
		"cp packaging/icon.png /app/share/icons/hicolor/64x64/apps/spivak.png",
		"cp com.github.gyunaev.spivak.appdata.xml /app/share/appdata"
	    ]
	}
    ]
}
