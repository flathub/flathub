app-id: net.sourceforge.uhexen2
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: /app/bin/uhexen2.sh

add-extensions:
  org.freedesktop.Platform.GL:
    directory: lib/GL
    version: '22.08'

modules:
  - shared-modules/glu/glu-9.json
  - shared-modules/SDL/SDL-1.2.15.json
  - shared-modules/libmad/libmad.json

  - name: uhexen2
    sources:
      - type: git
        url: https://github.com/sezero/uhexen2
        tag: uhexen2-1.5.9
        commit: 4ef664bc41e3998b0d2a55ff1166dadf34c936be
        x-checker-data:
          type: git
          tag-pattern: ^uhexen2-(.*)$
    buildsystem: simple
    build-commands:
      - cd engine/hexen2 && make glh2
      - install -D -m755 -t /app/bin/ ./engine/hexen2/glhexen2
      - install -D -m755 -t /app/bin/data1/ ./gamecode/res/h2/*

  - name: launcher
    sources:
      - type: file
        path: net.sourceforge.uhexen2.desktop
      - type: file
        path: net.sourceforge.uhexen2.appdata.xml
      - type: file
        path: net.sourceforge.uhexen2.png
      - type: script
        dest-filename: uhexen2.sh
        commands:
          - ls ~/.hexen2/data1/pak0.pak || zenity --error --text "Game data (the /data1/ directory)  must be added to:\n~/.var/app/net.sourceforge.uhexen2/.hexen2/data1/" --ok-label "Close" --width=400
          - /app/bin/glhexen2 "$@"
    buildsystem: simple
    build-commands:
      - install -D -m755 -t /app/bin/ uhexen2.sh
      - install -D -m644 -t /app/share/icons/hicolor/256x256/apps/ net.sourceforge.uhexen2.png
      - install -D -m644 -t /app/share/applications/  net.sourceforge.uhexen2.desktop
      - install -D -m644 -t /app/share/metainfo/ net.sourceforge.uhexen2.appdata.xml

cleanup:
  - /include
  - /lib/*.a
  - /lib/*.la
  - /lib/pkgconfig

finish-args:
  # hardware 3D
  - --device=dri
  # X11 + XShm access
  - --share=ipc
  - --socket=x11
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # Audio
  - --socket=pulseaudio
  # Data path
  - --persist=.hexen2
