app-id: ai.menlo.jan
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '24.08'

sdk-extensions:
  - org.freedesktop.Sdk.Extension.node20

command: run.sh
separate-locales: false

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
  - --share=network
  - --filesystem=home
  - --env=ELECTRON_TRASH=gio

modules:
  - name: jan
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin /app/jan
      - chmod +x jan-linux.AppImage
      - ./jan-linux.AppImage --appimage-extract
      - mv squashfs-root/* /app/jan/
      - rm -rf squashfs-root jan-linux.AppImage
      - install -Dm755 -t /app/bin/ run.sh
      - install -Dm644 -t /app/share/applications/ ai.menlo.jan.desktop
      - install -Dm644 -t /app/share/metainfo/ ai.menlo.jan.metainfo.xml
      - install -Dm644 ai.menlo.jan.png /app/share/icons/hicolor/256x256/apps/ai.menlo.jan.png
    sources:
      - type: file
        url: https://github.com/janhq/jan/releases/download/v0.5.12/jan-linux-x86_64-0.5.12.AppImage
        dest-filename: jan-linux.AppImage
        sha256: b48ca53f954eb79df02bf29f82c2ba1e2317d1886e8893032e7d0bf5763a6894
        x-checker-data:
          type: json
          url: https://api.github.com/repos/janhq/jan/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-template: https://github.com/janhq/jan/releases/download/v$version/jan-linux-x86_64-$version.AppImage

      - type: script
        dest-filename: run.sh
        commands:
          - zypak-wrapper.sh /app/jan/jan "$@"
      - type: file
        path: ai.menlo.jan.desktop
      - type: file
        path: ai.menlo.jan.metainfo.xml
      - type: file
        path: ai.menlo.jan.png