id: one.mixin.messenger
runtime: org.gnome.Platform
runtime-version: '42'
sdk: org.gnome.Sdk
command: mixin_desktop
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --socket=pulseaudio
  - --share=network
  - --filesystem=home
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher

modules:
  - name: mixin_desktop
    buildsystem: simple
    build-commands:
    - mkdir -p FlutterApp
    - tar -xf mixin_desktop_linux_amd64_portable.tar.gz -C FlutterApp
    - cp -r FlutterApp /app/
    - chmod +x /app/FlutterApp/mixin_desktop
    - mkdir -p /app/bin
    - ln -s /app/FlutterApp/mixin_desktop /app/bin/mixin_desktop
    - install -Dm644 one.mixin.messenger.metainfo.xml -t /app/share/metainfo/
    - install -Dm644 mixin_desktop.png /app/share/icons/hicolor/256x256/apps/one.mixin.messenger.png
    - install -Dm644 mixin_desktop_128.png /app/share/icons/hicolor/128x128/apps/one.mixin.messenger.png
    - install -Dm644 one.mixin.messenger.desktop -t /app/share/applications/
    - install -Dm644 one.mixin.messenger.metainfo.xml -t /app/share/appdata/
    sources:
      - type: file
        path: one.mixin.messenger.desktop
      - type: file
        path: mixin_desktop.png
      - type: file
        path: mixin_desktop_128.png
      - type: file
        url: https://github.com/MixinNetwork/flutter-app/releases/download/v0.37.8/mixin_desktop_linux_amd64_portable.tar.gz
        sha256: 69ed7803b1c18bd4560e61abec727905ba5b7579cb6677e9865cf9034119d9e9
      - type: file
        path: one.mixin.messenger.metainfo.xml