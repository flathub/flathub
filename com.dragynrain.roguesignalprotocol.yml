app-id: com.dragynrain.roguesignalprotocol
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: rogue-signal-protocol

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --socket=pulseaudio
  - --device=all
  - --persist=.local/share/RogueSignalProtocol

modules:
  - name: RogueSignalProtocol
    buildsystem: simple
    build-commands:
      - tar -xzf game.tar.gz

      - install -dm755 /app/lib/rogue-signal-protocol
      - install -dm755 /app/bin
      - install -dm755 /app/share/applications
      - install -dm755 /app/share/icons/hicolor/256x256/apps
      - install -dm755 /app/share/metainfo
      - install -dm755 /app/share/licenses/com.dragynrain.roguesignalprotocol

      - install -Dm755 RogueSignalProtocol /app/lib/rogue-signal-protocol/RogueSignalProtocol

      - cp -r graphics /app/lib/rogue-signal-protocol/
      - cp -r sound /app/lib/rogue-signal-protocol/
      - cp -r music /app/lib/rogue-signal-protocol/

      - install -Dm644 game_content.json /app/lib/rogue-signal-protocol/
      - install -Dm644 game_rules.json /app/lib/rogue-signal-protocol/
      - install -Dm644 graphics_tiles.json /app/lib/rogue-signal-protocol/
      - install -Dm644 narrative_content.json /app/lib/rogue-signal-protocol/
      - install -Dm644 default_bindings.json /app/lib/rogue-signal-protocol/
      - install -Dm644 KreativeSquare.ttf /app/lib/rogue-signal-protocol/

      - test -f README.txt && install -Dm644 README.txt /app/lib/rogue-signal-protocol/ || true
      - test -f LICENSE && install -Dm644 LICENSE /app/share/licenses/com.dragynrain.roguesignalprotocol/ || true
      - test -f debug_mode.flag && install -Dm644 debug_mode.flag /app/lib/rogue-signal-protocol/ || true

      - |
        cat > /app/bin/rogue-signal-protocol << 'WRAPPER'
        #!/bin/sh
        cd /app/lib/rogue-signal-protocol
        exec ./RogueSignalProtocol "$@"
        WRAPPER
      - chmod +x /app/bin/rogue-signal-protocol

      - install -Dm644 rogue-signal-protocol.desktop /app/share/applications/com.dragynrain.roguesignalprotocol.desktop
      - install -Dm644 logo-256.png /app/share/icons/hicolor/256x256/apps/com.dragynrain.roguesignalprotocol.png
      - install -Dm644 com.dragynrain.roguesignalprotocol.metainfo.xml /app/share/metainfo/

    sources:
      - type: file
        url: https://github.com/Dragynrain/RogueSignalProtocol/releases/download/v0.9.0-beta/RogueSignalProtocol-Linux.tar.gz
        sha256: 6b50e04ac2b20bd336d9b8b7570e6693905bfc03de4a1df4019b642258bd9a21
        dest-filename: game.tar.gz

      - type: file
        url: https://raw.githubusercontent.com/Dragynrain/RogueSignalProtocol/main/docs/images/logo-256.png
        sha256: 5f753961c3550168d1fead02ad18cf6178f7ef24f35e4c39f9000d7f9d26fe5c
        dest-filename: logo-256.png

      - type: inline
        dest-filename: rogue-signal-protocol.desktop
        contents: |
          [Desktop Entry]
          Name=Rogue Signal Protocol
          GenericName=Roguelike Game
          Comment=Cyberpunk roguelike game
          Exec=rogue-signal-protocol
          Icon=com.dragynrain.roguesignalprotocol
          Terminal=false
          Type=Application
          Categories=Game;RolePlaying;
          Keywords=roguelike;cyberpunk;tactical;turn-based;indie;
          StartupNotify=true

      - type: inline
        dest-filename: com.dragynrain.roguesignalprotocol.metainfo.xml
        contents: |
          <?xml version="1.0" encoding="UTF-8"?>
          <component type="desktop-application">
            <id>com.dragynrain.roguesignalprotocol</id>
            <name>Rogue Signal Protocol</name>
            <summary>Coffee break cyberspace stealth roguelike</summary>
            <metadata_license>MIT</metadata_license>
            <project_license>MIT</project_license>
            <developer id="com.dragynrain">
              <name>Dragynrain</name>
            </developer>
            <description>
              <p>
                A traditional turn-based coffee break stealth roguelike where you play as
                an escaped digital consciousness navigating hostile cyberspace networks.
                Quick 10-15 minute runs with permadeath - each death teaches lessons,
                each run reveals more of the story.
              </p>
              <p>Features:</p>
              <ul>
                <li>Enemy movement prediction - see their next 3 planned moves</li>
                <li>Stealth-focused gameplay with blind spots and ambushes</li>
                <li>12 exploits (abilities) and 6 code hacks to discover</li>
                <li>47 achievements and 20 Ascension difficulty levels</li>
                <li>Full gamepad support (Steam Deck compatible)</li>
              </ul>
            </description>
            <launchable type="desktop-id">com.dragynrain.roguesignalprotocol.desktop</launchable>
            <url type="homepage">https://dragynrain.itch.io/rogue-signal-protocol</url>
            <url type="bugtracker">https://github.com/Dragynrain/RogueSignalProtocol/issues</url>
            <screenshots>
              <screenshot type="default">
                <image type="source">https://raw.githubusercontent.com/Dragynrain/RogueSignalProtocol/main/docs/images/screenshots/screenshot-1.png</image>
                <caption>Tactical gameplay with enemy movement prediction</caption>
              </screenshot>
              <screenshot>
                <image type="source">https://raw.githubusercontent.com/Dragynrain/RogueSignalProtocol/main/docs/images/screenshots/screenshot-2.png</image>
                <caption>Stealth navigation through cyberspace</caption>
              </screenshot>
              <screenshot>
                <image type="source">https://raw.githubusercontent.com/Dragynrain/RogueSignalProtocol/main/docs/images/screenshots/screenshot-3.png</image>
                <caption>Exploits and abilities system</caption>
              </screenshot>
            </screenshots>
            <provides>
              <binary>rogue-signal-protocol</binary>
            </provides>
            <requires>
              <display_length compare="ge">800</display_length>
            </requires>
            <recommends>
              <control>keyboard</control>
              <control>pointing</control>
              <control>gamepad</control>
            </recommends>
            <supports>
              <control>keyboard</control>
              <control>pointing</control>
              <control>gamepad</control>
            </supports>
            <categories>
              <category>Game</category>
              <category>RolePlaying</category>
            </categories>
            <keywords>
              <keyword>roguelike</keyword>
              <keyword>cyberpunk</keyword>
              <keyword>tactical</keyword>
              <keyword>turn-based</keyword>
              <keyword>indie</keyword>
              <keyword>permadeath</keyword>
            </keywords>
            <releases>
              <release version="0.9.0-beta" date="2025-12-27" type="development">
                <description>
                  <p>Beta release - feature complete, seeking community testing.</p>
                </description>
              </release>
            </releases>
            <content_rating type="oars-1.1">
              <content_attribute id="violence-cartoon">mild</content_attribute>
              <content_attribute id="violence-fantasy">moderate</content_attribute>
            </content_rating>
          </component>
