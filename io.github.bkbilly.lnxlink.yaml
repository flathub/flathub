id: io.github.bkbilly.lnxlink
runtime: org.gnome.Platform
runtime-version: '46'
sdk: org.gnome.Sdk
command: lnxlink
finish-args:
  # Wayland access
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  # For DBus
  - --system-talk-name=org.freedesktop.NetworkManager
  - --system-talk-name=org.freedesktop.login1
  - --system-talk-name=org.freedesktop.UPower
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.gnome.Mutter.IdleMonitor
  - --talk-name=org.mpris.MediaPlayer2.*
  # Access to network
  - --share=network
  # Access to audio
  - --socket=pulseaudio
  # Access to Bluetooth
  - --allow=bluetooth
  # Needs to save files locally
  - --filesystem=xdg-documents
  # Access to filesystem
  - --filesystem=/tmp/
  - --filesystem=/var/run/reboot-required
  # Access to camera, gamepad
  - --device=all
modules:
  - flatpak-modules-meson.yaml
  - flatpak-modules-scikit.yaml
  - flatpak-modules.yaml
  - name: opencv
    buildsystem: cmake-ninja
    builddir: true
    sources:
    - type: git
      url: https://github.com/opencv/opencv.git
      tag: 4.9.0
      commit: dad8af6b17f8e60d7b95a1203a1b4d22f56574cf
    config-opts:
    - "-DBUILD_EXAMPLES=OFF"
    - "-DBUILD_TESTS=OFF"
    - "-DBUILD_DOCS=OFF"
    - "-DBUILD_PERF_TESTS=OFF"
    - "-DBUILD_NEW_PYTHON_SUPPORT=OFF"
    - "-DBUILD_ZLIB=OFF"
    - "-DOPENCV_BUILD_3RDPARTY_LIBS=OFF"
    - "-DINSTALL_C_EXAMPLES=OFF"
    - "-DINSTALL_PYTHON_EXAMPLES=OFF"
    - "-DBUILD_opencv_core=ON"
    - "-DBUILD_opencv_imgproc=ON"
    - "-DBUILD_opencv_imgcodecs=ON"
    - "-DBUILD_opencv_objdetect=ON"
    - "-DBUILD_opencv_calib3d=ON"
    - "-DBUILD_opencv_features2d=ON"
    - "-DBUILD_opencv_flann=ON"
    - "-DBUILD_opencv_dnn=ON"
    - "-DBUILD_opencv_photo=ON"
    - "-DBUILD_opencv_java=OFF"
    - "-DBUILD_opencv_java_bindings_generator=OFF"
    - "-DBUILD_opencv_js=OFF"
    - "-DBUILD_opencv_python2=OFF"
    - "-DBUILD_opencv_python3=ON"
    - "-DBUILD_opencv_python_bindings_generator=ON"
    - "-DBUILD_opencv_shape=OFF"
    - "-DBUILD_opencv_highgui=OFF"
    - "-DBUILD_opencv_superres=OFF"
    - "-DBUILD_opencv_stitching=OFF"
    - "-DBUILD_opencv_videostab=ON"
    - "-DBUILD_opencv_videoio=ON"
    - "-DBUILD_opencv_video=ON"
    - "-DBUILD_opencv_apps=OFF"
    - "-DBUILD_opencv_gapi=OFF"
    - "-DPYTHON_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.9.so"
    - "-DWITH_PROTOBUF=ON"
    - "-DWITH_1394=OFF"
    - "-DWITH_VTK=OFF"
    - "-DWITH_EIGEN=OFF"
    - "-DWITH_FFMPEG=ON"
    - "-DWITH_GSTREAMER=ON"
    - "-DWITH_GTK=OFF"
    - "-DWITH_IPP=OFF"
    - "-DWITH_JASPER=OFF"
    - "-DWITH_JPEG=ON"
    - "-DWITH_MATLAB=OFF"
    - "-DWITH_OPENJPEG=ON"
    - "-DWITH_OPENEXR=OFF"
    - "-DWITH_OPENNI=OFF"
    - "-DWITH_OPENMP=OFF"
    - "-DWITH_PNG=ON"
    - "-DWITH_PVAPI=OFF"
    - "-DWITH_QT=OFF"
    - "-DWITH_QUICKTIME=OFF"
    - "-DWITH_QT_OPENGL=OFF"
    - "-DWITH_TBB=OFF"
    - "-DWITH_TIFF=OFF"
    - "-DWITH_UNICAP=OFF"
    - "-DWITH_V4L=OFF"
    - "-DWITH_VFW=OFF"
    - "-DWITH_VIDEOINPUT=ON"
    - "-DWITH_XINE=OFF"
    - "-DWITH_VA_INTEL=OFF"
    - "-DWITH_GPHOTO2=OFF"
    - "-DWITH_WEBP=OFF"
    - "-DWITH_IMGCODEC_HDR=OFF"
    - "-DWITH_IMGCODEC_SUNRASTER=OFF"
    - "-DWITH_IMGCODEC_PXM=OFF"
    - "-DWITH_CUDA=OFF"
    - "-DWITH_CUFFT=OFF"
    - "-DWITH_CUBLAS=OFF"
    - "-DWITH_NVCUVID=OFF"
    - "-DWITH_OPENCL=OFF"
    - "-DWITH_OPENCL_SVM=OFF"
    - "-DWITH_OPENCLAMDFFT=OFF"
    - "-DWITH_OPENCLAMDBLAS=OFF"
    - "-DWITH_OPENJPEG=ON"
    - "-DCV_ENABLE_INTRINSICS=OFF"
    - "-DCV_DISABLE_OPTIMIZATION=OFF"
    - "-DCV_TRACE=OFF"
    cleanup:
    - "/bin/*"
    - "/share/licenses/*"
    - "/share/opencv4/haarcascades/haarcascade_eye_tree_eyeglasses.xml"
    - "/share/opencv4/haarcascades/haarcascade_eye.xml"
    - "/share/opencv4/haarcascades/haarcascade_frontalcatface_extended.xml"
    - "/share/opencv4/haarcascades/haarcascade_frontalcatface.xml"
    - "/share/opencv4/haarcascades/haarcascade_frontalface_alt_tree.xml"
    - "/share/opencv4/haarcascades/haarcascade_frontalface_alt.xml"
    - "/share/opencv4/haarcascades/haarcascade_frontalface_default.xml"
    - "/share/opencv4/haarcascades/haarcascade_fullbody.xml"
    - "/share/opencv4/haarcascades/haarcascade_lefteye_2splits.xml"
    - "/share/opencv4/haarcascades/haarcascade_licence_plate_rus_16stages.xml"
    - "/share/opencv4/haarcascades/haarcascade_lowerbody.xml"
    - "/share/opencv4/haarcascades/haarcascade_profileface.xml"
    - "/share/opencv4/haarcascades/haarcascade_righteye_2splits.xml"
    - "/share/opencv4/haarcascades/haarcascade_russian_plate_number.xml"
    - "/share/opencv4/haarcascades/haarcascade_smile.xml"
    - "/share/opencv4/haarcascades/haarcascade_upperbody.xml"
    - "/share/opencv4/lbpcascades/lbpcascade_frontalcatface.xml"
    - "/share/opencv4/lbpcascades/lbpcascade_frontalface_improved.xml"
    - "/share/opencv4/lbpcascades/lbpcascade_frontalface.xml"
    - "/share/opencv4/lbpcascades/lbpcascade_profileface.xml"
    - "/share/opencv4/lbpcascades/lbpcascade_silverware.xml"
    - "/share/opencv4/valgrind.supp"
    - "/share/opencv4/valgrind_3rdparty.supp"
  - flatpak-lnxlink.yaml
  - name: xdotool
    buildsystem: simple
    build-commands:
    - make -j4 && PREFIX=./build make install
    - cp -r ./build/*  /app/
    sources:
    - type: archive
      url: https://github.com/jordansissel/xdotool/releases/download/v3.20211022.1/xdotool-3.20211022.1.tar.gz
      sha256: 96f0facfde6d78eacad35b91b0f46fecd0b35e474c03e00e30da3fdd345f9ada
  - name: metadata
    buildsystem: simple
    build-commands:
      - install -Dm644 -t ${FLATPAK_DEST}/share/metainfo ${FLATPAK_ID}.metainfo.xml
    sources:
      - type: file
        path: io.github.bkbilly.lnxlink.metainfo.xml
