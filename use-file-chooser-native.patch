From 42fe73a865cff2aa551b48808d5baa141e70c98f Mon Sep 17 00:00:00 2001
From: Hugo Posnic <hugo.posnic@gmail.com>
Date: Fri, 2 Aug 2019 13:14:05 +0200
Subject: [PATCH] Use FileChooserNative instead of FileChooserDialog

---
 data/io.github.ImEditor.appdata.xml.in |  2 +-
 po/fr.po                               | 50 ++++++++++++++++----------
 po/imeditor.pot                        | 34 +++++++++---------
 src/interface/dialog.py                | 37 +++++++++++--------
 4 files changed, 70 insertions(+), 53 deletions(-)

diff --git a/data/io.github.ImEditor.appdata.xml.in b/data/io.github.ImEditor.appdata.xml.in
index 57ef07c..41ccd83 100644
--- a/data/io.github.ImEditor.appdata.xml.in
+++ b/data/io.github.ImEditor.appdata.xml.in
@@ -7,7 +7,7 @@
 	<name>ImEditor</name>
 	<summary>Simple &amp; versatile image editor</summary>
 	<description>
-		<p>ImEditor is simple image editor, supporting PNG, JPEG, WEBP, BMP, ICO file types.</p>
+		<p>ImEditor is a simple image editor, supporting PNG, JPEG, WEBP, BMP, ICO file types.</p>
 		<p>It offers several tools to modify an image.</p>
 	</description>
 
diff --git a/po/fr.po b/po/fr.po
index bc0696f..cc9d8ad 100644
--- a/po/fr.po
+++ b/po/fr.po
@@ -7,8 +7,8 @@ msgid ""
 msgstr ""
 "Project-Id-Version: imeditor\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2019-08-01 17:05+0200\n"
-"PO-Revision-Date: 2019-08-01 17:08+0200\n"
+"POT-Creation-Date: 2019-08-02 13:12+0200\n"
+"PO-Revision-Date: 2019-08-02 13:13+0200\n"
 "Last-Translator: Hugo Posnic <hugo.posnic@gmail.com>\n"
 "Language-Team: \n"
 "Language: fr\n"
@@ -19,6 +19,7 @@ msgstr ""
 "Plural-Forms: nplurals=2; plural=(n > 1);\n"
 
 #: data/io.github.ImEditor.desktop.in:3
+#: data/io.github.ImEditor.appdata.xml.in:7
 msgid "ImEditor"
 msgstr ""
 
@@ -35,8 +36,23 @@ msgstr "Crayon;Dessin;"
 msgid "io.github.ImEditor"
 msgstr ""
 
+#: data/io.github.ImEditor.appdata.xml.in:8
+msgid "Simple &amp; versatile image editor"
+msgstr "Éditeur d'images simple & polyvalent"
+
+#: data/io.github.ImEditor.appdata.xml.in:10
+msgid ""
+"ImEditor is a simple image editor, supporting PNG, JPEG, WEBP, BMP, ICO file "
+"types."
+msgstr ""
+"ImEditor est un éditeur d'image simple qui supporte les fichier de type PNG, "
+"JPEG, WEBP, BMP, ICO."
+
+#: data/io.github.ImEditor.appdata.xml.in:11
+msgid "It offers several tools to modify an image."
+msgstr "Il propose plusieurs outils pour modifier une image."
+
 #: src/interface/dialog.py:56 src/interface/dialog.py:167
-#: src/interface/dialog.py:203 src/interface/dialog.py:209
 msgid "Cancel"
 msgstr "Annuler"
 
@@ -120,22 +136,6 @@ msgstr "Couleur de fond"
 msgid "Format"
 msgstr "Format"
 
-#: src/interface/dialog.py:200
-msgid "Open image"
-msgstr "Ouvrir une image"
-
-#: src/interface/dialog.py:204
-msgid "Open"
-msgstr "Ouvrir"
-
-#: src/interface/dialog.py:206
-msgid "Save image"
-msgstr "Sauvegarder l'image"
-
-#: src/interface/dialog.py:210
-msgid "Save"
-msgstr "Sauvegarder"
-
 #: src/interface/interface.py:21
 msgid "Simple & versatile image editor"
 msgstr "Éditeur d'images simple et polyvalent"
@@ -296,3 +296,15 @@ msgstr "Carré"
 #: src/interface/tab.py:64
 msgid "Color"
 msgstr "Couleur"
+
+#~ msgid "Open image"
+#~ msgstr "Ouvrir une image"
+
+#~ msgid "Open"
+#~ msgstr "Ouvrir"
+
+#~ msgid "Save image"
+#~ msgstr "Sauvegarder l'image"
+
+#~ msgid "Save"
+#~ msgstr "Sauvegarder"
diff --git a/po/imeditor.pot b/po/imeditor.pot
index b1a4bd5..5fbe03d 100644
--- a/po/imeditor.pot
+++ b/po/imeditor.pot
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: imeditor\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2019-08-01 17:05+0200\n"
+"POT-Creation-Date: 2019-08-02 13:12+0200\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -18,6 +18,7 @@ msgstr ""
 "Content-Transfer-Encoding: 8bit\n"
 
 #: data/io.github.ImEditor.desktop.in:3
+#: data/io.github.ImEditor.appdata.xml.in:7
 msgid "ImEditor"
 msgstr ""
 
@@ -34,8 +35,21 @@ msgstr ""
 msgid "io.github.ImEditor"
 msgstr ""
 
+#: data/io.github.ImEditor.appdata.xml.in:8
+msgid "Simple &amp; versatile image editor"
+msgstr ""
+
+#: data/io.github.ImEditor.appdata.xml.in:10
+msgid ""
+"ImEditor is a simple image editor, supporting PNG, JPEG, WEBP, BMP, ICO file "
+"types."
+msgstr ""
+
+#: data/io.github.ImEditor.appdata.xml.in:11
+msgid "It offers several tools to modify an image."
+msgstr ""
+
 #: src/interface/dialog.py:56 src/interface/dialog.py:167
-#: src/interface/dialog.py:203 src/interface/dialog.py:209
 msgid "Cancel"
 msgstr ""
 
@@ -119,22 +133,6 @@ msgstr ""
 msgid "Format"
 msgstr ""
 
-#: src/interface/dialog.py:200
-msgid "Open image"
-msgstr ""
-
-#: src/interface/dialog.py:204
-msgid "Open"
-msgstr ""
-
-#: src/interface/dialog.py:206
-msgid "Save image"
-msgstr ""
-
-#: src/interface/dialog.py:210
-msgid "Save"
-msgstr ""
-
 #: src/interface/interface.py:21
 msgid "Simple & versatile image editor"
 msgstr ""
diff --git a/src/interface/dialog.py b/src/interface/dialog.py
index 09c3761..a219326 100755
--- a/src/interface/dialog.py
+++ b/src/interface/dialog.py
@@ -196,23 +196,30 @@ def new_image_dialog(parent):
 
 
 def file_dialog(parent, action, filename=None):
+    file_chooser = Gtk.FileChooserNative()
+    file_chooser.set_transient_for(parent)
     if action == 'open':
-        dialog = Gtk.FileChooserDialog(_("Open image"),
-            parent,
-            Gtk.FileChooserAction.OPEN,
-            (_("Cancel"), Gtk.ResponseType.CANCEL,
-            _("Open"), Gtk.ResponseType.OK))
+        file_chooser.set_action(Gtk.FileChooserAction.OPEN)
+        file_filter = Gtk.FileFilter()
+        file_filter.set_name("Images")
+        file_filter.add_mime_type('image/bmp')
+        file_filter.add_mime_type('image/jpeg')
+        file_filter.add_mime_type('image/jpg')
+        file_filter.add_mime_type('image/png')
+        file_filter.add_mime_type('image/webp')
+        file_filter.add_mime_type('image/ico')
+        file_chooser.add_filter(file_filter)
     elif action == 'save':
-        dialog = Gtk.FileChooserDialog(_("Save image"),
-            parent,
-            Gtk.FileChooserAction.SAVE,
-            (_("Cancel"), Gtk.ResponseType.CANCEL,
-            _("Save"), Gtk.ResponseType.OK))
-        dialog.set_current_name(filename)
-    response = dialog.run()
-    filename = dialog.get_filename() if response == Gtk.ResponseType.OK else None
-    dialog.destroy()
-    return filename
+        file_chooser.set_action(Gtk.FileChooserAction.SAVE)
+        file_chooser.set_do_overwrite_confirmation(True)
+        file_chooser.set_current_name(filename)
+
+    response = file_chooser.run()
+    if response == Gtk.ResponseType.ACCEPT:
+        filename = file_chooser.get_filename()
+        return filename
+    file_chooser.destroy()
+    return None
 
 
 def message_dialog(parent, dialog_type, title, text):
-- 
2.21.0

