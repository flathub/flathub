{
    "name": "xmlstarlet",
    "config-opts": [
        "--disable-static-libs",
        "--with-libxml-libs-prefix=/usr/lib",
        "--with-libxml-include-prefix=/usr/include/libxml2",
        "--prefix=/app/opt/xmlstarlet",
        "--exec-prefix=/app/opt/xmlstarlet"
    ],
    "sources": [
        {
            "type": "archive",
            "url": "http://downloads.sourceforge.net/xmlstar/xmlstarlet-1.6.1.tar.gz",
            "sha256": "15d838c4f3375332fd95554619179b69e4ec91418a3a5296e7c631b7ed19e7ca"
        },
        {
            "type": "patch",
            "path": "xmlstarlet-1.6.1-nogit.patch",
            "strip-components": 1,
            "sha256": "c54485c5e2bd038219884250228333113a9751e999baa28a833a679f79421890"
        },
        {
            "type": "shell",
            "commands": [
                "echo 'fix configure: xml2 & xslt';",
                "sed -r -i 's/^([[:blank:]]*XSTAR_LIB_CHECK[[:blank:]]*\\(\\[LIBXML\\],[[:blank:]]*\\[)xml2-config(\\]\\))/\\1pkg-config libxml-2.0\\2/' 'configure.ac';",
                "sed -r -i 's/^([[:blank:]]*XSTAR_LIB_CHECK[[:blank:]]*\\(\\[LIBXSLT\\],[[:blank:]]*\\[)xslt-config(\\]\\))/\\1pkg-config libxslt\\2/' 'configure.ac';",
                "grep -Ei 'XSTAR_LIB_CHECK' 'configure.ac' || :;"
            ]
        },
        {
            "type": "shell",
            "commands": [
                "echo 'fix configure: xml2 & xslt version';",
                "sed -r -i 's/^(\\[LIBXML_REQUIRED_VERSION=)/#\\1/' 'configure.ac';",
                "sed -r -i 's/^(\\[LIBXSLT_REQUIRED_VERSION=)/#\\1/' 'configure.ac';",
                "grep -Ei '_REQUIRED_VERSION' 'configure.ac' || :;"
            ]
        },
        {
            "type": "shell",
            "commands": [
                "echo 'autoreconf';",
                "cp -p /usr/share/automake-*/config.{sub,guess} .;",
                "autoreconf -i;"
            ]
        }
    ],
    "post-install": [
        "echo 'post-install: symlink';",
        "[[ -f '/app/opt/xmlstarlet/bin/xmlstarlet' ]] || ln -s 'xml' '/app/opt/xmlstarlet/bin/xmlstarlet';",
        "echo 'post-install: docs';",
        "install -d '/app/opt/xmlstarlet/share/doc/xmlstarlet'; install -p -m 0644 'AUTHORS' 'ChangeLog' 'INSTALL' 'NEWS' 'README' 'TODO' '/app/opt/xmlstarlet/share/doc/xmlstarlet/';",
        "echo 'post-install: licenses';",
        "install -d '/app/opt/xmlstarlet/share/licenses/xmlstarlet'; install -p -m 0644 'COPYING' 'Copyright' '/app/opt/xmlstarlet/share/licenses/xmlstarlet/';"
    ],
    "cleanup": [
        "/opt/xmlstarlet/share/doc",
        "/opt/xmlstarlet/share/man"
    ]
}
