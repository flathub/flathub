From 94e321937911dbba6a738684e9158ffdebe06b33 Mon Sep 17 00:00:00 2001
From: scx <scx.mail@gmail.com>
Date: Sat, 27 Apr 2019 19:46:11 +0200
Subject: [PATCH] wxFileSelector: always check for an empty return value

Closes #1115

See also: https://wiki.wxwidgets.org/WxFileSelector
---
 src/wxMaxima.cpp | 24 ++++++++++++++----------
 1 file changed, 14 insertions(+), 10 deletions(-)

diff --git a/src/wxMaxima.cpp b/src/wxMaxima.cpp
index 8844ca85..43d44fe0 100644
--- a/src/wxMaxima.cpp
+++ b/src/wxMaxima.cpp
@@ -4090,16 +4090,19 @@ void wxMaxima::FileMenu(wxCommandEvent &event)
                                       "xml from broken .wxmx (*.xml)|*.xml"),
                                      wxFD_OPEN);
 
-      // On the mac the "File/New" menu item by default opens a new window instead od
-      // reusing the old one.
-      #ifdef __WXOSX__
-      if(m_worksheet->IsEmpty())
+      if (!file.empty())
+      {
+        // On the mac the "File/New" menu item by default opens a new window instead od
+        // reusing the old one.
+        #ifdef __WXOSX__
+        if(m_worksheet->IsEmpty())
+          OpenFile(file,wxEmptyString);
+        else
+          wxGetApp().NewWindow(file);
+        #else
         OpenFile(file,wxEmptyString);
-      else
-        wxGetApp().NewWindow(file);
-      #else
-      OpenFile(file,wxEmptyString);
-      #endif
+        #endif
+      }
     }
       break;
 
@@ -4240,7 +4243,8 @@ void wxMaxima::FileMenu(wxCommandEvent &event)
                                      _("Maxima package (*.mac)|*.mac|"
                                                "Lisp package (*.lisp)|*.lisp|All|*"),
                                      wxFD_OPEN);
-      OpenFile(file, wxT("load"));
+      if (!file.empty())
+        OpenFile(file, wxT("load"));
     }
       break;
 
