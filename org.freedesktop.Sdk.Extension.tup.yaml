id: org.freedesktop.Sdk.Extension.tup
branch: '24.08'
runtime: org.freedesktop.Sdk
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
build-extension: true
separate-locales: false
command: tup
modules:
  - name: tup
    sources:
      - type: archive
        url: https://gittup.org/tup/releases/tup-v0.8.tar.gz
        sha512: 3f09a3defc97d174ed85d84679ad4a41bd83e12d84fa151a38c2aedd613f2739989fd9ebeb2d316bd716cf5afd3aead64d7d0cad968e705fe4092c5e7fd9a0ee
      - type: patch
        path: tup-disable-unconditional-x86-arch-siblings.patch
      - type: file
        path: org.freedesktop.Sdk.Extension.tup.metainfo.xml
      - type: script
        dest-filename: tup.config
        commands:
          - CONFIG_TUP_USE_SYSTEM_PCRE=y
          - CONFIG_TUP_USE_SYSTEM_SQLITE=y
          - CONFIG_TUP_SERVER=ldpreload
          - CONFIG_X86_ARCH_SIBLINGS=n
    buildsystem: simple
    build-options:
      env:
        TUP_SERVER: ldpreload
    build-commands:
      - ./bootstrap.sh
      - install -Dm755 ./build/tup -t $FLATPAK_DEST/bin/
      - install -Dm755 ./build/tup-ldpreload.so -t $FLATPAK_DEST/bin/
      - install -Dm644 org.freedesktop.Sdk.Extension.tup.metainfo.xml -t ${FLATPAK_DEST}/share/metainfo
