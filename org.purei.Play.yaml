app-id: org.purei.Play
runtime: org.kde.Platform
runtime-version: '5.15-21.08'
sdk: org.kde.Sdk
command: Play
finish-args:
  - --share=ipc
  - --share=network
  - --socket=wayland
  - --socket=fallback-x11
  - --filesystem=host:ro
  - --device=all
  - --socket=pulseaudio
modules:
  - "shared-modules/glu/glu-9.json"
  - "shared-modules/glew/glew.json"
  - name: openal
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DALSOFT_REQUIRE_PULSEAUDIO=ON
      - -DALSOFT_BACKEND_PIPEWIRE=off
    cleanup: 
        - /bin
        - /include
        - /lib/pkgconfig
        - /share
    sources:
      - type: git
        url: https://github.com/kcat/openal-soft.git
        tag: 1.21.1
  - name: evdev
    config-opts: 
      - --disable-static
    cleanup: 
      - /bin
      - /include
      - /lib/pkgconfig
      - /lib/*.la
      - /share/man
    sources:
      - type: archive
        url: https://freedesktop.org/software/libevdev/libevdev-1.5.7.tar.xz
        sha256: a1e59e37a2f0d397ffd7e83b73af0e638db83b8dd08902ef0f651a21cc1dd422
  - name: Play!
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    post-install:
      - |
        GIT_VERSION=$(git describe --always);
        GIT_DATE=$(git show -s --format=%cs);
        sed -i 's|<releases>|<releases>\n    <release date="'${GIT_DATE}'" version="'${GIT_VERSION}'"/>|' ${FLATPAK_DEST}/share/metainfo/org.purei.Play.metainfo.xml;
    sources:
      - type: git
        url: https://github.com/jpd002/Play-.git
        branch: master
        commit: eb061f6be52e68ede8f8094372eda66f9b7b925f
