app-id: club.zbridge.zbridge
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
- org.freedesktop.Sdk.Extension.node20
build-options:
  append-path: /usr/lib/sdk/node20/bin
  env:
    NPM_CONFIG_OFFLINE: 'true'
    NPM_CONFIG_SKIP_SCRIPTS: 'true'
    NPM_CONFIG_PROGRESS: 'false'
    ELECTRON_CACHE: /run/build/zbridge-club/flatpak-node/cache/electron
    ELECTRON_BUILDER_CACHE: /run/build/zbridge-club/flatpak-node/cache/electron-builder
base: org.electronjs.Electron2.BaseApp
base-version: '25.08'
command: zbridge-club
finish-args:
- --share=ipc
- --socket=fallback-x11
- --socket=wayland
- --socket=pulseaudio
- --share=network
- --device=dri
- --filesystem=xdg-download/zBridge_Club:create
modules:
- name: zbridge-club
  buildsystem: simple
  build-commands:
  - mkdir -p flatpak-node/cache/electron
  - cp electron-shasums.txt flatpak-node/cache/electron/SHASUMS256.txt-29.4.6
  - npm install --offline --cache=npm-cache --ignore-scripts
  - find node_modules/app-builder-bin/linux -name app-builder -exec chmod +x {} +
  - npx electron-builder --linux --dir
  - cp -r dist/linux*-unpacked /app/zbridge-club
  - mkdir -p /app/bin
  - cp zbridge-club.sh /app/bin/zbridge-club
  - chmod +x /app/bin/zbridge-club
  - install -Dm644 club.zbridge.zbridge.desktop /app/share/applications/club.zbridge.zbridge.desktop
  - install -Dm644 club.zbridge.zbridge.metainfo.xml /app/share/metainfo/club.zbridge.zbridge.metainfo.xml
  - install -Dm644 icon.png /app/share/icons/hicolor/512x512/apps/club.zbridge.zbridge.png
  sources:
  - type: git
    url: https://github.com/amitter84/zbridge-flatpak-source.git
    tag: v1.0.4
  - dest: flatpak-node/cache/electron
    only-arches:
    - x86_64
    sha256: 2346338e2ffa12276f5b3bc6d63ff357c39f42d260ad45f19471ef7bbf18a389
    type: file
    url: https://github.com/electron/electron/releases/download/v29.4.6/electron-v29.4.6-linux-x64.zip
  - dest: flatpak-node/cache/electron
    only-arches:
    - arm
    sha256: 9007e44a5cb5b7645455e7895d2039d3264cab2eb0ecf8dbb4295344d392ca74
    type: file
    url: https://github.com/electron/electron/releases/download/v29.4.6/electron-v29.4.6-linux-armv7l.zip
  - dest: flatpak-node/cache/electron
    only-arches:
    - aarch64
    sha256: 14d5b54ef561cea2ca28c55a877bc1a1a3e360ca2f9e69ab3aa719054eca8552
    type: file
    url: https://github.com/electron/electron/releases/download/v29.4.6/electron-v29.4.6-linux-arm64.zip
  - node-sources.json
  - type: file
    path: zbridge-club.sh
  - type: file
    path: electron-shasums.txt
