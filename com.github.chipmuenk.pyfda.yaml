app-id: com.github.chipmuenk.pyfda
runtime: org.kde.Platform
runtime-version: '5.15-21.08'
sdk: org.kde.Sdk
# when the runtime version changes, check if python version changed, because in pyqt5 the
# python version is hardcoded!
command: pyfdax
finish-args:
- "--socket=wayland"
- "--socket=fallback-x11"
- "--device=dri"
- "--own-name=com.github.chipmuenk.pyfda"
- "--filesystem=home"
rename-icon: pyfda_icon #Image will renamed to match the app-id konvention
rename-appdata-file: pyfda.appdata.xml
rename-desktop-file: pyfda.desktop
modules:
  - "pyqt5.json"

  - name: python3-packaging
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/df/9e/d1a7217f69310c1db8fdf8ab396229f55a699ce34a203691794c5d1cad0c/packaging-21.3.tar.gz
        sha256: dd47c42927d89ab911e606518907cc2d3a1f38bbd026385970643f9c5b8ecfeb
        x-checker-data:
          type: pypi
          name: packaging
      #- type: patch
        #path: relax-dependencies.patch

  - name: python-pyparsing
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/d6/60/9bed18f43275b34198eb9720d4c1238c68b3755620d20df0afd89424d32b/pyparsing-3.0.7.tar.gz
        sha256: 18ee9022775d270c55187733956460083db60b37d0d0fb357445f3094eed3eea
        x-checker-data:
          type: pypi
          name: pyparsing 

  - name: python-numpy
    buildsystem: simple
    build-commands:
      - rm pyproject.toml
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/64/4a/b008d1f8a7b9f5206ecf70a53f84e654707e7616a771d84c05151a4713e9/numpy-1.22.3.zip
        sha256: dbc7601a3b7472d559dc7b933b18b4b66f9aa7452c120e87dfb33d02008c8a18
        x-checker-data:
          type: pypi
          name: numpy
          
  - name: python-certifi # needed by matplotlib
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/6c/ae/d26450834f0acc9e3d1f74508da6df1551ceab6c2ce0766a593362d6d57f/certifi-2021.10.8.tar.gz
        sha256: 78884e7c1d4b00ce3cea67b44566851c4343c120abd683433ce934a68ea58872
        x-checker-data:
          type: pypi
          name: certifi
          
  - name: qhull # needed by matplotlib
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: http://www.qhull.org/download/qhull-2020-src-8.0.2.tgz
        sha256: b5c2d7eb833278881b952c8a52d20179eab87766b00b865000469a45c1838b7e

  - name: python-setuptools-scm
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/4a/18/477d3d9eb2f88230ff2a41de9d8ffa3554b706352787d289f57f76bfba0b/setuptools_scm-6.4.2.tar.gz
        sha256: 6833ac65c6ed9711a4d5d2266f8024cfa07c533a0e55f4c12f6eff280a5a9e30
        x-checker-data:
          type: pypi
          name: setuptools-scm
          
  - name: python-flit-core
    buildsystem: simple
    build-commands:
      - pip3 install . --prefix=/app --no-index --find-links .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/15/d1/d8798b83e953fd6f86ca9b50f93eec464a9305b0661469c8234e61095481/flit_core-3.7.1.tar.gz
        sha256: 14955af340c43035dbfa96b5ee47407e377ee337f69e70f73064940d27d0a44f
        x-checker-data:
          type: pypi
          name: flit_core
          
  - python3-tomli.json # needed by python-setuptools-scm-git-archive     
          
  - name: python-setuptools-scm-git-archive # needed by matplotlib
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/7e/2c/0c15b29a1b5940250bfdc4a4f53272e35cd7cf8a34159291b6b4ec9eb291/setuptools_scm_git_archive-1.1.tar.gz
        sha256: 6026f61089b73fa1b5ee737e95314f41cb512609b393530385ed281d0b46c062
        x-checker-data:
          type: pypi
          name: setuptools-scm-git-archive
          
  - name: python-matplotlib
    buildsystem: simple
    build-options:
      env:
        MPLSETUPCFG: /run/build/python-matplotlib/matplotlib-setup.cfg
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: file
        path: matplotlib-setup.cfg
      - type: archive
        url: https://files.pythonhosted.org/packages/8a/46/425a44ab9a71afd2f2c8a78b039c1af8ec21e370047f0ad6e43ca819788e/matplotlib-3.5.1.tar.gz
        sha256: b2e9810e09c3a47b73ce9cab5a72243a1258f61e7900969097a817232246ce1c
        x-checker-data:
          type: pypi
          name: matplotlib

  - name: python-cppy # needed by kiwisolver
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/e0/94/3cca7fccecf9b63219f3bf8f08af719f6d3ab06c4acdcc9372a15a12b593/cppy-1.2.0.tar.gz
        sha256: 95e8862e4f826c3f2a6b7b658333b162f80cbe9f943aa0d0a7a6b2ef850aeffc
        x-checker-data:
          type: pypi
          name: cppy

  - name: python-kiwisolver # needed by matplotlib
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/c7/c0/5eef3c2fb687b71433f61638e317d468c3276d210bd462cfa0c3039ddf26/kiwisolver-1.4.1.tar.gz
        sha256: 91bfcd2a14bea6f93c86876c4abccb53dc3f0bcad55e3a0af0b3e57ced6eef11
        x-checker-data:
          type: pypi
          name: kiwisolver

  - name: python-numexpr # needed by pyfda
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/76/b3/935d7a16f696ecfa8e06ce1153b1f54925a42904c245cebb15077762b965/numexpr-2.8.1.tar.gz
        sha256: cd779aa44dd986c4ef10163519239602b027be06a527946656207acf1f58113b
        x-checker-data:
          type: pypi
          name: numexpr

  - name: python-markdown # needed by pyfda
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/15/06/d60f21eda994b044cbd496892d4d4c5c708aa597fcaded7d421513cb219b/Markdown-3.3.6.tar.gz
        sha256: 76df8ae32294ec39dcf89340382882dfa12975f87f45c3ed1ecdb1e8cefc7006
        x-checker-data:
          type: pypi
          name: Markdown

  - name: python-mplcursors # needed by pyfda
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/93/d1/ff80fd8a5d7c2bb9ef9968bbffdb65445bec990c427d55899af22900f57d/mplcursors-0.5.1.tar.gz
        sha256: d52bc6e6c68371937dcf147d29ddd396f64a610663af006ef9145055bd2dcc84
        x-checker-data:
          type: pypi
          name: mplcursors

  - name: python-docutils # needed by pyfda
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/57/b1/b880503681ea1b64df05106fc7e3c4e3801736cf63deffc6fa7fc5404cf5/docutils-0.18.1.tar.gz
        sha256: 679987caf361a7539d76e584cbeddc311e3aee937877c87346f31debc63e9d06
        x-checker-data:
          type: pypi
          name: docutils

  - name: python-xlwt # needed by pyfda
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/06/97/56a6f56ce44578a69343449aa5a0d98eefe04085d69da539f3034e2cd5c1/xlwt-1.3.0.tar.gz
        sha256: c59912717a9b28f1a3c2a98fd60741014b06b043936dcecbc113eaaada156c88
        x-checker-data:
          type: pypi
          name: xlwt

  - "python3-Pillow.json" # pyfda does not startup without
  
  - name: python-cycler # pyfda does not startup without
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/34/45/a7caaacbfc2fa60bee42effc4bcc7d7c6dbe9c349500e04f65a861c15eb9/cycler-0.11.0.tar.gz
        sha256: 9c87405839a19696e837b3b818fed3f5f69f16f1eec1a1ad77e043dcea9c772f
        x-checker-data:
          type: pypi
          name: cycler
          
  - name: python-dateutil # pyfda does not startup without
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/4c/c4/13b4776ea2d76c115c1d1b84579f3764ee6d57204f6be27119f13a61d0a9/python-dateutil-2.8.2.tar.gz
        sha256: 0123cacc1627ae19ddf3c27a5de5bd67ee4586fbdd6440d9748f8abb483d3e86
        x-checker-data:
          type: pypi
          name: python-dateutil

  - name: pyfda
    buildsystem: simple
    build-commands:
    - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    - desktop-file-install --dir=/app/share/applications ressource/mime/applications/pyfda.desktop
    - install -Dm755 ressource/linux/pyfda.appdata.xml /app/share/appdata/pyfda.appdata.xml
    - install -Dm755 pyfda/images/icons/pyfda_icon_16.png /app/share/icons/hicolor/16x16/apps/pyfda_icon.png
    - install -Dm755 pyfda/images/icons/pyfda_icon_32.png /app/share/icons/hicolor/32x32/apps/pyfda_icon.png
    - install -Dm755 pyfda/images/icons/pyfda_icon_64.png /app/share/icons/hicolor/64x64/apps/pyfda_icon.png
    - install -Dm755 pyfda/images/icons/pyfda_icon_128.png /app/share/icons/hicolor/128x128/apps/pyfda_icon.png
    - install -Dm755 pyfda/images/icons/pyfda_icon_256.png /app/share/icons/hicolor/256x256/apps/pyfda_icon.png
    - install -Dm755 pyfda/images/icons/pyfda_icon.svg /app/share/icons/hicolor/scalable/apps/pyfda_icon.svg
    sources:
    - type: git
      url: https://github.com/chipmuenk/pyfda.git
      commit: a2be5eaabd182e223ba8e940390bebc4bf1b22f8
