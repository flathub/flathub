From 2c0fb75409f38e149151f29f994ce513c18956ea Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?I=C3=B1aki=20=C3=9Acar?= <iucar@fedoraproject.org>
Date: Sat, 30 May 2020 14:13:27 +0200
Subject: [PATCH] unbundle qtsingleapplication

---
 src/cpp/desktop/CMakeLists.txt              | 5 ++---
 src/cpp/desktop/DesktopPosixApplication.hpp | 2 +-
 2 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/src/cpp/desktop/CMakeLists.txt b/src/cpp/desktop/CMakeLists.txt
index 8028a68..3b05e20 100644
--- a/src/cpp/desktop/CMakeLists.txt
+++ b/src/cpp/desktop/CMakeLists.txt
@@ -156,7 +156,6 @@ endif (NOT WIN32)
 
 set(MOC_DESKTOP_HEADER_FILES ${DESKTOP_HEADER_FILES})
 list(REMOVE_ITEM MOC_DESKTOP_HEADER_FILES
-  ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/qtsingleapplication/qtlockedfile.h
   ${CMAKE_CURRENT_SOURCE_DIR}/DesktopDetectRHome.hpp
   ${CMAKE_CURRENT_SOURCE_DIR}/DesktopOptions.hpp
   ${CMAKE_CURRENT_SOURCE_DIR}/DesktopRVersion.hpp
@@ -225,8 +224,6 @@ set(DESKTOP_SOURCE_FILES
   DesktopSynctex.cpp
   DesktopJobLauncherOverlay.cpp
   RemoteDesktopSessionLauncherOverlay.cpp
-  3rdparty/qtsingleapplication/qtsingleapplication.cpp
-  3rdparty/qtsingleapplication/qtlocalpeer.cpp
 )
 
 if(WIN32)
@@ -387,6 +384,7 @@ if(NOT APPLE)
    target_link_libraries(rstudio
       ${RSTUDIO_QTMODULES}
       ${QT_LIBRARIES}
+      Qt5Solutions_SingleApplication-2.6
       ${Boost_LIBRARIES}
       rstudio-core
       ${CRASHPAD_LIBRARIES}
@@ -430,6 +428,7 @@ else()
    target_link_libraries(RStudio
       ${RSTUDIO_QTMODULES}
       ${QT_LIBRARIES}
+      Qt5Solutions_SingleApplication-2.6
       rstudio-core
       ${APPLICATION_SERVICES_LIBRARY}
       ${COCOA_LIBRARY}
diff --git a/src/cpp/desktop/DesktopPosixApplication.hpp b/src/cpp/desktop/DesktopPosixApplication.hpp
index b1cbe33..c83951d 100644
--- a/src/cpp/desktop/DesktopPosixApplication.hpp
+++ b/src/cpp/desktop/DesktopPosixApplication.hpp
@@ -16,7 +16,7 @@
 #ifndef DESKTOP_POSIX_APPLICATION_HPP
 #define DESKTOP_POSIX_APPLICATION_HPP
 
-#include "3rdparty/qtsingleapplication/QtSingleApplication"
+#include <qt5/QtSolutions/QtSingleApplication>
 
 #include "DesktopApplicationLaunch.hpp"
 
-- 
2.25.2

