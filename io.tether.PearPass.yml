# Flatpak manifest for PearPass Desktop Application
# A secure, decentralized and fully local password manager
#
# NOTE: The following placeholder values need to be updated before submission:
# - Asset URLs (icon, metainfo, desktop file, binary archive)
# - SHA512 checksums for all external resources
# - Verify the executable name matches the built binary

id: io.tether.PearPass
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: pearpass
base: org.electronjs.Electron2.BaseApp
base-version: '25.08'
finish-args:
  # Inter-process communication (required for Electron)
  - --share=ipc
  # Network access (required for peer-to-peer sync functionality)
  - --share=network
  # X11 display (required for GUI)
  - --socket=x11
  # Audio (for notification sounds)
  - --socket=pulseaudio
  # Device access (may be needed for hardware security keys)
  - --device=all
  # System tray support
  - --talk-name=org.kde.StatusNotifierWatcher
  # Cursor theme support
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons
  # Screen saver interaction (prevent idle during sensitive operations)
  - --talk-name=org.freedesktop.ScreenSaver
  # Secrets service for keyring integration
  - --talk-name=org.freedesktop.secrets
  # Persistent storage for Pear configuration
  - --persist=.config/pear
  # Persistent storage for PearPass vault data
  - --persist=.pearpass
modules:
  - name: pearpass-x64
    only-arches:
      - x86_64
    buildsystem: simple
    build-commands:
      # Install AppStream metainfo
      - install -Dm644 io.tether.PearPass.metainfo.xml /app/share/metainfo/io.tether.PearPass.metainfo.xml
      # Install application icon (512x512)
      - install -Dm644 io.tether.PearPass.png /app/share/icons/hicolor/512x512/apps/io.tether.PearPass.png
      # Install desktop entry
      - install -Dm644 io.tether.PearPass.desktop /app/share/applications/io.tether.PearPass.desktop
      # Install the application binary
      - cp pearpass $FLATPAK_DEST/bin
    sources:
      # Application icon (from GitHub repository)
      - type: file
        url: https://raw.githubusercontent.com/tetherto/pearpass-app-desktop/main/assets/darwin/icon.png
        sha512: 8b14978257490d87b3bd2a0f2374962925e956af09fe84a3c3109b9b263c9d003be131e196014d03f8f5bc1de2066917fcab78d6363508e26d0b4b753ec01010
        dest-filename: io.tether.PearPass.png
      # AppStream metainfo XML (from GitHub repository)
      - type: file
        url: https://raw.githubusercontent.com/tetherto/pearpass-app-desktop/main/flatpak/io.tether.PearPass.metainfo.xml
        sha512: ebb3dd7d499e2390fa9105dfaa0717b6c85e2d31329b32a36d325d43d7edbf84b1f7363ae81ac0326addcacd5fe7d4322e83bd4d5c3049cc2c92bb103ae1035c
      # Desktop entry file (from GitHub repository)
      - type: file
        url: https://raw.githubusercontent.com/tetherto/pearpass-app-desktop/main/flatpak/io.tether.PearPass.desktop
        sha512: 961567834706eb09a8c45009c828ee0d1ec04d9969eafb87502855f408e9fd0e84b6c02ae4bea9671601f47878495b5d3398324aeba4f640f8617441b18931a2
      # Main application binary archive (source from GitHub release)
      - type: archive
        url: https://github.com/tetherto/pearpass-app-desktop/archive/refs/tags/v1.0.1.tar.gz
        sha512: 5974afe2acb4b0263f5da90106da7e513a561c73a9fd80375d6de589668e55eaec6f91dcf1d8ae6644137a2635e485baf70e969734e18c387e57d026b3779fa2
        strip-components: 0

