From aa78503a0fc286625ccb4fe5d0976a4ca03e8273 Mon Sep 17 00:00:00 2001
From: Henri Menke <henri@henrimenke.de>
Date: Thu, 11 Sep 2025 10:12:43 +0200
Subject: [PATCH] Add AppStream upstream metadata

---
 cmake/klfinstallpaths.cmake    |  1 +
 src/CMakeLists.txt             |  5 ++++
 src/klatexformula-metainfo.xml | 51 ++++++++++++++++++++++++++++++++++
 3 files changed, 57 insertions(+)
 create mode 100644 src/klatexformula-metainfo.xml

diff --git a/cmake/klfinstallpaths.cmake b/cmake/klfinstallpaths.cmake
index 1edb406..bcb7f83 100644
--- a/cmake/klfinstallpaths.cmake
+++ b/cmake/klfinstallpaths.cmake
@@ -243,6 +243,7 @@ if(KLF_BUILD_GUI)
     KLFSetIfNotDefined(KLF_INSTALL_SHARE_PIXMAPS_DIR "share/pixmaps/")
     KLFSetIfNotDefined(KLF_INSTALL_ICON_THEME "")
     KLFSetIfNotDefined(KLF_INSTALL_SHARE_MIME_PACKAGES_DIR "share/mime/packages/")
+    KLFSetIfNotDefined(KLF_INSTALL_SHARE_METAINFO_DIR "share/metainfo/")
   
     # Reasonable Icon= entry given the installation settings
     set(klf_icon "klatexformula")
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 4265326..5df71f1 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -560,6 +560,11 @@ if(KLF_BUILD_GUI)
       install(FILES "${CMAKE_SOURCE_DIR}/src/klatexformula-mime.xml"
         DESTINATION "${KLF_INSTALL_SHARE_MIME_PACKAGES_DIR}")
     endif()
+    if(KLF_INSTALL_SHARE_METAINFO_DIR)
+      install(FILES "${CMAKE_SOURCE_DIR}/src/klatexformula-metainfo.xml"
+        DESTINATION "${KLF_INSTALL_SHARE_METAINFO_DIR}"
+        RENAME "io.sourceforge.klatexformula.klatexformula.metainfo.xml")
+    endif()
 
     if(KLF_INSTALL_POST_UPDATEMIMEDATABASE)
       install(CODE
diff --git a/src/klatexformula-metainfo.xml b/src/klatexformula-metainfo.xml
new file mode 100644
index 0000000..bc9597f
--- /dev/null
+++ b/src/klatexformula-metainfo.xml
@@ -0,0 +1,51 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<component type="desktop-application">
+  <id>io.sourceforge.klatexformula.klatexformula</id>
+
+  <name>KLatexFormula</name>
+  <summary>Generate images from LaTeX equations that you can drag and drop, copy and paste or save to disk</summary>
+  <developer_name>The KLatexFormula developers</developer_name>
+
+  <url type="homepage">https://klatexformula.sourceforge.io</url>
+  <url type="bugtracker">https://github.com/klatexformula/klatexformula/issues</url>
+
+  <metadata_license>CC0-1.0</metadata_license>
+  <project_license>GPL-2.0-or-later</project_license>
+
+  <description>
+    <p>
+      This application provides an easy-to-use graphical user interface for generating images from LaTeX equations. These images can be dragged and dropped or copied and pasted into external applications (presentations, text documents, graphics...), or can be saved to disk in a variety of formats (PNG, JPG, BMP, EPS, PDF, etc.). In addition to the graphical user interface, a command-line interface and a C++ library is provided to perform the same job.
+    </p>
+  </description>
+
+  <launchable type="desktop-id">io.sourceforge.klatexformula.klatexformula.desktop</launchable>
+  <screenshots>
+    <screenshot type="default">
+      <caption>Main window rendering the von Neumann entropy equation</caption>
+      <image>https://klatexformula.sourceforge.io/assets/klf-linux-mainwin-vonNeumann-shadow.png</image>
+    </screenshot>
+    <screenshot>
+      <caption>What's new in this version of KLatexFormula</caption>
+      <image>https://klatexformula.sourceforge.io/assets/klf-linux-whatsnew.png</image>
+    </screenshot>
+  </screenshots>
+  <categories>
+    <category>Science</category>
+  </categories>
+  <content_rating type="oars-1.1">
+  </content_rating>
+  <releases>
+    <release version="4.1.0" date="2020-05-18" type="stable">
+      <description>
+        <p>A long overdue version of KLatexFormula fixes a few issues and provides support for the PDF-based latex engines <code>pdflatex</code>, <code>xelatex</code> and <code>lualatex</code>.</p>
+        <p>New features include:</p>
+        <ul>
+          <li>Support for PDF-based and unicode LaTeX engines <code>pdflatex</code>, <code>xelatex</code> and <code>lualatex</code> via a user script. (In expanded mode, select <em>Script</em> ▸ <em>user script “Run pdflatex engine”</em>)</li>
+          <li>Ukrainian translation by Yuri Chornoivan.</li>
+          <li>Bug fix in copy/paste on Windows.</li>
+          <li>Minor enhancements and bug fixes.</li>
+        </ul>
+      </description>
+    </release>
+  </releases>
+</component>
-- 
2.51.0

