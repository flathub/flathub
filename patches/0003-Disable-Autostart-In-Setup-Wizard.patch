From 9dcd1c268b38e9392b13201b1890758bf78e1477 Mon Sep 17 00:00:00 2001
From: Martchus <martchus@gmx.net>
Date: Sun, 19 May 2024 16:28:44 +0200
Subject: [PATCH] Disable the autostart setting via `NO_AUTOSTART_SETTINGS`
 also in wizard

---
 syncthingwidgets/CMakeLists.txt      | 2 +-
 syncthingwidgets/settings/wizard.cpp | 3 ++-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/syncthingwidgets/CMakeLists.txt b/syncthingwidgets/CMakeLists.txt
index 6bcb37d7..f02f8e15 100644
--- a/syncthingwidgets/CMakeLists.txt
+++ b/syncthingwidgets/CMakeLists.txt
@@ -118,7 +118,7 @@ option(NO_AUTOSTART_SETTINGS
        OFF)
 if (NO_AUTOSTART_SETTINGS)
     set_property(
-        SOURCE settings/settingsdialog.cpp
+        SOURCE settings/settingsdialog.cpp settings/wizard.cpp
         APPEND
         PROPERTY COMPILE_DEFINITIONS SYNCTHINGWIDGETS_AUTOSTART_DISABLED)
 endif ()
diff --git a/syncthingwidgets/settings/wizard.cpp b/syncthingwidgets/settings/wizard.cpp
index 68f20468..9c2df325 100644
--- a/syncthingwidgets/settings/wizard.cpp
+++ b/syncthingwidgets/settings/wizard.cpp
@@ -37,7 +37,8 @@
 #include <initializer_list>
 #include <string_view>
 
-#if (defined(PLATFORM_LINUX) && !defined(Q_OS_ANDROID)) || defined(PLATFORM_WINDOWS) || defined(PLATFORM_MAC)
+#if !defined(SYNCTHINGWIDGETS_AUTOSTART_DISABLED)                                                                                                    \
+    && ((defined(PLATFORM_LINUX) && !defined(Q_OS_ANDROID)) || defined(PLATFORM_WINDOWS) || defined(PLATFORM_MAC))
 #define SETTINGS_WIZARD_AUTOSTART
 #endif
